<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Solver - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Solver</h2>
<div id="posts">
<div class="post">
    <h4>#29387 - Jau - Fri Nov 19, 2004 12:40 pm</h4>
    <div class="postbody"><span class="postbody">I've got this code to implement physics:
<br/>
<br/>
    hero.vx = hero.vx + hero.ax * dt;
<br/>
    hero.vy = hero.vy + hero.ay * dt;
<br/>
<br/>
    hero.x = hero.x + hero.vx * dt;
<br/>
    hero.y = hero.y + hero.vy * dt;
<br/>
<br/>
where v is velocity and a acceleration
<br/>
but it goes too fast and I need more precision. I've got to put dt =1 that is the minimum that I can put. How can I solve this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#29388 - identitycrisisuk - Fri Nov 19, 2004 1:07 pm</h4>
    <div class="postbody"><span class="postbody">If you look at the thread I posted on how to make a character jump in Coding, it eventually talks about using fixed point. This will help you to slow down your movement as you can create numbers that you view as being less than 1. For example you could use the value 1&lt;&lt;4 for dt, which you may think wil create very large velocities and positions which it will. However they key is that you perform a &gt;&gt;8 (just an example shift value, the bigger the number the more decimal accuracy but the less space you have for the integer part of the number) before you use the value to position something on screen. Hope that makes sense to you, I've only just got into using it myself but I think it's great!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#29563 - Jau - Mon Nov 22, 2004 12:10 am</h4>
    <div class="postbody"><span class="postbody">thank you very much for your help</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30209 - Jau - Mon Nov 29, 2004 3:37 pm</h4>
    <div class="postbody"><span class="postbody">Now I need to do collision detection, but with this code it's hard. For example, when I jump high enough at the return it goes too fast and my character goes to a tile inside the floor, instead of going just above the floor. The return velocity is good for playing, but it's too fast for my collision detection. How do I get a collision detection robust enough for fast velocities? Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30214 - identitycrisisuk - Mon Nov 29, 2004 4:13 pm</h4>
    <div class="postbody"><span class="postbody">I've not actually got to this point yet (still learning how to scroll backgrounds properly) but I had anticipated that there would be cases where the speed of a character might make them move through more than a tile in a frame and skip a tile that needs to be collided with. I don't know how wise this is on the GBA but I plan to do ray-like collision detection, where you check the line that a character will move along in a frame, finding the first object that it will hit on that path. It seems like a lot to do but I've seen a few people on here say you can do surprising stuff on the GBA if you code it well. I really kinda need ray collision detection as I want to have a gun that fires but you won't see a bullet, it will just damage the first thing it comes into contact with in a straight line.<br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">CanIKickIt(YES_YOU_CAN);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30221 - keldon - Mon Nov 29, 2004 5:10 pm</h4>
    <div class="postbody"><span class="postbody">erm, well you know that maths problem of where will two trains hit; that is 1-d collision detection. If you've never done this maths problem then here is the lowdown:
<br/>
<br/>
The distance an object advances every frame is called the gradient. The floor has no gradient, so it is constant.
<br/>
<span style="font-style: italic">floor's gradient</span>: x = 10
<br/>
<br/>
A moving object would have a gradient of how far it advances each frame.
<br/>
<span style="font-style: italic">character's gradient</span>: x = 5 + <span style="font-style: italic">jumpDistance</span>*<span style="font-style: italic">numFrames</span>
<br/>
<br/>
Now the number of frames the character is doing this for will tell you whether they will collide long before it happens, which may be necessary for AI.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
collision = 5 - 10 = -5
<br/>
numFrames = 3
<br/>
jumpDistance = 2
<br/>
collision = -5 + 2*3
<br/>
-5 + 2*3 &gt; 0 == true
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now the logic is that by seeing where two lines collide will tell you if they will ever touch each other in this instance. If the value <span style="font-style: italic">collision</span> was below 0 then they will not collide.
<br/>
<br/>
You can take this further to take the y-coordinates to check collision with a wall. And I'm sure someone else will point out an easier way to do this using matrices or something.
<br/>
<br/>
---
<br/>
<br/>
There are some things you can do, like just check whether or not your character crosses the line at all; but where your game seems to have them going completely past the line you might want to know where it took place so that you know where he should be after the jump.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30587 - identitycrisisuk - Thu Dec 02, 2004 2:07 pm</h4>
    <div class="postbody"><span class="postbody">Would anyone have any pointers on how I'd go about making a ray collision test that will tell me what tiles a ray will pass through if allowed to travel to it's end point? I'm just using 8x8 tiles and a collision map output by MapEd so I'd be looking for any tiles != 0 for a collision tile of some sort, after I'd got it I'd choose how to handle it for things like slopes. My character position is stored as a single number rather than splitting it into a tile and offset but these can easily be retrieved by getting pos&gt;&gt;3 and pos&amp;7.
<br/>
<br/>
My first thought was to compare the horizontal and vertical components of the movement that I want to make separately as that should make it quite easy to find the first tile it can collide with in that direction. But I think whichever direction I choose to check first it could bring up some problems in certain situations. For example if the path was pretty much diagonal and it will pass very close to a corner tile before a drop. Checking the vertical first will say that it can only move a small amount but it will be able to move freely horizontally.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">*&lt;- Start Here
<br/>
 \
<br/>
  \
<br/>
   \
<br/>
--+ \    *&lt;- Will actually move here
<br/>
  |  \
<br/>
  |   \
<br/>
  |    \
<br/>
  |     \
<br/>
  |      *&lt;- Should move here</td> </tr></table><span class="postbody">
<br/>
<br/>
I can't think of a relatively simple way to just get the tiles that the line will pass through. I think if I can get this then any other problems can be sorted out.<br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">CanIKickIt(YES_YOU_CAN);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30589 - keldon - Thu Dec 02, 2004 2:41 pm</h4>
    <div class="postbody"><span class="postbody">So is that what you're saying:
<br/>
- Your character has a position
<br/>
- It wants to move to a new position
<br/>
- This movement vector is refered to as the ray
<br/>
- You wish to find all tiles the ray will pass through
<br/>
<br/>
If so that it's basically a lineTo algorithm. And in this you replace the putPixel call with a tile!=0 check.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30594 - identitycrisisuk - Thu Dec 02, 2004 4:31 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for that.
<br/>
<br/>
I found <a class="postlink" href="http://www.edepot.com/lined.html" target="_blank">this</a> page which is supposedly a very fast algorithm for drawing lines using fixed point. Just one question, it uses abs and I was wondering whether that is something supported well by the GBA? I couldn't remember the include for abs anyway so I got it to work using the macro:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define abs(x)      ((x &gt; 0) ? x : -x)</td> </tr></table><span class="postbody">Would there be any point in using the standard abs function over this macro?<br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">CanIKickIt(YES_YOU_CAN);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30614 - keldon - Thu Dec 02, 2004 8:42 pm</h4>
    <div class="postbody"><span class="postbody">if <span style="font-style: italic"><span style="text-decoration: underline">abs(x)</span></span> will always return a positive <span style="font-style: italic"><span style="text-decoration: underline">x</span></span> then that's fine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30615 - identitycrisisuk - Thu Dec 02, 2004 8:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">if <span style="font-style: italic"><span style="text-decoration: underline">abs(x)</span></span> will always return a positive <span style="font-style: italic"><span style="text-decoration: underline">x</span></span> then that's fine.</td> </tr></table><span class="postbody">
<br/>
I can't quite decide if that's a subtle hint that my macro <span style="font-style: italic">might</span> not always return a positive value :s<br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">CanIKickIt(YES_YOU_CAN);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30620 - tepples - Thu Dec 02, 2004 9:19 pm</h4>
    <div class="postbody"><span class="postbody">What happens when you take abs(INT_MIN)? Under the representation used for signed int on compilers that target ARM7TDMI, there is one more int less than 0 than greater than 0.
<br/>
<br/>
Anyway, you're supposed to use an inline function instead of a macro in order to keep from evaluating the argument twice, especially if the argument has a function call or a read-modify-write operator (++, --, etc). So put this in a header file somewhere:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static inline unsigned int myabs(signed int x)
<br/>
{
<br/>
  return (x &gt;= 0) ? x : -x;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30625 - identitycrisisuk - Thu Dec 02, 2004 9:49 pm</h4>
    <div class="postbody"><span class="postbody">Ah, I had thought about putting x &gt;= 0 but I didn't think it made any difference. Good call on it being a function too, I always forget about evaluating arguments multiple times in macros.<br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">CanIKickIt(YES_YOU_CAN);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30873 - identitycrisisuk - Sun Dec 05, 2004 7:27 pm</h4>
    <div class="postbody"><span class="postbody">Ach, I'm thinking I'm overcomplicating things with this ray collision detection as I don't think my character ever moves faster than 8 pixels per frame and even if it was possible to do so it would be better to cap it. 8 pixels per frame would mean a whole screen crossed in half of a second and it's just nicer knowing you can't move more than one tile in a frame. I tried doing that thing with the lines but I think it got complicated at the point of impact so I was just getting stuck in walls. Can stand on the floor now though :D
<br/>
<br/>
I've got some old code for tile collisions but unfortunately I never got round to putting in sliding along walls (it was from overhead) so you just stop if you run into a wall at an angle. With my current thing being a platformer that's not an option so I'll need to figure out a way of doing that. My first thought is:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if you can move to the final position
<br/>
   move to it
<br/>
otherwise
<br/>
   move as far as you can in x
<br/>
   move as far as you can in y, from the new x position</td> </tr></table><span class="postbody"><br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">CanIKickIt(YES_YOU_CAN);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30879 - tepples - Sun Dec 05, 2004 8:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>identitycrisisuk wrote:</b></span></td> </tr> <tr> <td class="quote">I don't think my character ever moves faster than 8 pixels per frame and even if it was possible to do so it would be better to cap it.</td> </tr></table><span class="postbody">
<br/>
Good job for the jump physics, but does your character have a gun?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">8 pixels per frame would mean a whole screen crossed in half of a second</td> </tr></table><span class="postbody">
<br/>
Bullets go faster.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">My first thought is:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if you can move to the final position
<br/>
   move to it
<br/>
otherwise
<br/>
   move as far as you can in x
<br/>
   move as far as you can in y, from the new x position</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
That should work, except on perhaps diagonal walls and floors. For a platformer, you may need separate states (if you haven't looked up <a class="postlink" href="http://en.wikipedia.org/wiki/Finite_state_machine" target="_blank">finite state machines</a>, do so now) for standing on something and in mid-air.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30903 - identitycrisisuk - Sun Dec 05, 2004 11:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Good job for the jump physics, but does your character have a gun?
<br/>
<br/>
Bullets go faster.</td> </tr></table><span class="postbody">
<br/>
He does indeed and I will come back to the ray collision detection when I get to using them properly. What I plan to do is have no visible indication of the bullet, I kinda dislike that effect you get of rapid fire just looking like an unmoving line of bullets. I'll just calculate what will get hit by that 'bullet' (will just be in code) and have the effect of the shot happen within a few frames of the bullet being fired. This may be a splash of blood if an enemy is hit, spark off the level etc.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">That should work, except on perhaps diagonal walls and floors. For a platformer, you may need separate states (if you haven't looked up <a class="postlink" href="http://en.wikipedia.org/wiki/Finite_state_machine" target="_blank">finite state machines</a>, do so now) for standing on something and in mid-air.</td> </tr></table><span class="postbody">
<br/>
I'm ignoring diagonals for now but I will need them eventually I think. It will probably need a specific state to stop it from looking like the character is constantly falling and landing as you go down one if I carried on using what I've programmed so far.<br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">CanIKickIt(YES_YOU_CAN);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
