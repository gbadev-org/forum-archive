<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Nasty slowdown from 3 lines of code.. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Nasty slowdown from 3 lines of code..</h2>
<div id="posts">
<div class="post">
    <h4>#44273 - Ultima2876 - Tue May 31, 2005 4:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">source_variables = (spriteno * 16);
<br/>
source_colltype = (obj_var[(source_variables + 0)] - ((obj_var[(source_variables + 0)] &gt;&gt; 8) &lt;&lt; 8));
<br/>
source_ysize = (obj_var[(source_variables + 5)] - ((obj_var[(source_variables + 5)] &gt;&gt; 8) &lt;&lt; 8));</td> </tr></table><span class="postbody">
<br/>
<br/>
My game's got an FPS counter in it, and when I comment these three lines out I gain 8 FPS. For three lines of code, I think that's just wrong.
<br/>
<br/>
source_variables is an int, obj_var[] is an array of signed ints (in Iwram - it's 2048 elements), and spriteno is an int. The odd shifting at the end of the lines is to get rid of some bits (the wole calculation is to get just the lower 8 bits, because the upper bits contain data for another variable). I didn't think this could possibly be the source of slowdown, since the shifts are fast... anyone have a possible explanation?
<br/>
<br/>
Cheers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44276 - strager - Tue May 31, 2005 4:57 pm</h4>
    <div class="postbody"><span class="postbody">Well, it is MUCH easier to use an AND then a SHIFT:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
source_variables = spriteno * 16;
<br/>
source_colltype = obj_var[source_variables] &amp; 0xFF;
<br/>
source_ysize = obj_var[source_variables + 5] &amp; 0xFF;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Try that and see if there is an improvement.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44277 - poslundc - Tue May 31, 2005 5:16 pm</h4>
    <div class="postbody"><span class="postbody">Assert to make sure you aren't exceeding the bounds of your array and accessing invalid areas of memory; that could have something to do with it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44284 - Ultima2876 - Tue May 31, 2005 5:35 pm</h4>
    <div class="postbody"><span class="postbody">It worked, thanks - that section run nicely now ^_^</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
