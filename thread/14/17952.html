<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Semi-beginner in need of help. DEVKITPRO/TONC - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Semi-beginner in need of help. DEVKITPRO/TONC</h2>
<div id="posts">
<div class="post">
    <h4>#177974 - CountSymphonic - Sat Jun 22, 2013 5:40 am</h4>
    <div class="postbody"><span class="postbody">Hey all, first I must say that it's nice to join everyone here in this exciting area of programming. It is my hope that this be the start of something wonderful not only for myself, but for the entire scene.
<br/>
<br/>
Ahh, pipe dreams. Anyways I'm somewhat of a semi-beginner, meaning that I've been getting into programming off and on for about 10 years... however I never got real deep into it. That said, here's what I'm familiar with as far as C is concerned, mind you, I don't necessarily mean that I've mastered the concepts, more that I UNDERSTAND them; Branches, Loops, Pointers, Functions, Variables, Libs and Includes (let's just say I know the basic of the basics with these), setting up IDE.
<br/>
<br/>
I've been able to put together a basic hello world, a calculator, and a very simple text based game in C, for the command line interface. Nothing fancy, or complex for that matter. I was going to learn Allegro, but I really want to skip that and go straight to the juice... GBA programming. I want desperately to use GBA programming, making a Zelda clone to facilitate learning C and GBA programming simultaneously.  Obviously this will make things a bit more complicated, but this is how I wish to proceed.
<br/>
<br/>
That said. I'm so freaking confused and lost right now. There seems to be no real documentation on DEVKITARM/LIBGBA. So learning how to use it, well that's my roadblock. Also there's TONC, which is rich with explanations and whatnot, however, can I use the TONC library without using functions from DevKitArm/libgba? Can I use TONC's features alone to create a full fledged Zelda clone?
<br/>
<br/>
I've got everything set up, I've compiled hello worlds for the GBA, they work great. I just need to figure out how to proceed further. I would use source code examples to help me learn but I'm having a lot of trouble finding what I need. I've been looking around for info googling for the past  couple of weeks!
<br/>
<br/>
Thanks in "advance"... heh.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177975 - DekuTree64 - Sat Jun 22, 2013 5:51 pm</h4>
    <div class="postbody"><span class="postbody">Hello and welcome :)
<br/>
I kind of vanished from the programming scene a few years back, but have been getting back into it this past month, working on a GBA game somewhere between FF1 and FF4 style.
<br/>
<br/>
If you can get a hello world program to compile and run, you're already done with the hard part. I think libgba has auto-generated documentation via Doxygen, but it's easy enough to make your own Gba.h as well. Here's mine (I use the linkscript and crt0 from devkitpro, but that's it): <a class="postlink" href="http://deku.rydia.net/temp/Gba.h" target="_blank">http://deku.rydia.net/temp/Gba.h</a>
<br/>
Feel free to use it, if you like it better than libgba's split up headers. The actual info in it is pretty much all from <a class="postlink" href="http://nocash.emubase.de/gbatek.htm" target="_blank">GBATEK</a> anyway (which is the go-to reference for how the GBA hardware works).
<br/>
<br/>
I'm not that familiar with TONC, but regardless of whether you actually use its libraries, the tutorials should be good for learning the general way things go... copy some data to a particular memory area, set some register values, stuff shows up on the screen.
<br/>
<br/>
As for the game, probably the most difficult part of a Zelda clone will be creating the maps. But it can be done without a fancy map editor, especially if you have simple tilesets like Zelda 1. Sometimes I even "draw" maps in code :) For example, a single-screen map using 16x16 pixel tiles like Zelda uses could be done like this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u8 testmap[15*10] = {
<br/>
 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3,
<br/>
 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6,
<br/>
 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6,
<br/>
 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6,
<br/>
 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6,
<br/>
 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6,
<br/>
 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6,
<br/>
 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6,
<br/>
 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6,
<br/>
 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9,
<br/>
};</td> </tr></table><span class="postbody">
<br/>
Where tile 0 in your tileset image is blank and unused, tile 1 is a "top left" wall corner tile, 2 is "top" wall, 9 is "bottom right" corner, and 5 is walkable floor.
<br/>
<br/>
GBA screen resolution is 240x160 pixels, so divide by 16 (tile size) and that's 15 tiles wide, 10 tiles tall (hence the map dimensions). <span style="font-style: italic">However</span>, GBA only supports 8x8 tiles... so in order to do 16x16 tiles, you have to build them out of four 8x8 tiles. So that map can't be copied to VRAM straight away. You have to use a separate table generated from your tileset image to translate each map tile index into 4 different GBA tile indices... it's a little tricky at first, but harder to explain than to understand.
<br/>
<br/>
For your very first learning, just work in 8x8 tiles directly. But once you understand the hardware better and want to get to the actual game making, learn how to do the 16x16 tile thing.
<br/>
<br/>
Good luck and have fun! Not many active GBA devs these days, it seems, but rest assured there are still people out there with a soft spot for it :)<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177976 - CountSymphonic - Mon Jun 24, 2013 5:00 am</h4>
    <div class="postbody"><span class="postbody">Wow thanks for the reply. It's nice to know the GBA scene still lives! I'll definitely have a look at the header. But yes, I've managed to get things compiled and running.
<br/>
<br/>
For me, making the maps seems to be fairly easy. I was already using 16x16, because it just allows more detail. I've already started creating my own tileset in that format (16x16), and played with GBAMAPPY for creating the maps, kudos to you for being able to do it in code. Now, making the maps for me is easy, I'm thinking implementing them will be the tricky part, but hopefully not too hard as your explanation will definitely be instrumental in getting this to work on the GBA, so thank you very much for your generous advice.
<br/>
<br/>
I've really been stuck for two weeks figuring out how to work with all of the GBA programming. I understand what you're saying about GBATEK. I have a copy of it, is that basically what I need to learn and understand how to code for the GBA in C? I've pretty much just been looking at a ton of source examples, and whenever there was something I didn't understand, it was off to the C books for a good study... since I'm still a bit blah with C anyways.
<br/>
<br/>
Final Fantasy was always a huge inspiration for me, that's awesome that you're doing something of that caliber.
<br/>
<br/>
But basically about getting the 16x16 thing down. Can I make a function that tells the GBA to handle 8x8 tiles as 16x16 tiles? In laymen's words anyways, obviously the function would require more code, using the method you indicated and surely there's more ways to do it. The way my custom tileset is arranged, the tiles are already set up as 16x16. Either way, I understand what you're saying. I'm just thinking I'll have to make a function that handles the tiles as 16x16.
<br/>
<br/>
BTW, I took a look at your demos. Very, very impressive work. Inspiring even, alot of it brought me back to the Golden Sun days... :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177977 - DekuTree64 - Mon Jun 24, 2013 7:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>CountSymphonic wrote:</b></span></td> </tr> <tr> <td class="quote">I've really been stuck for two weeks figuring out how to work with all of the GBA programming. I understand what you're saying about GBATEK. I have a copy of it, is that basically what I need to learn and understand how to code for the GBA in C?</td> </tr></table><span class="postbody">
<br/>
GBATEK has all the info you need about the GBA hardware, but it's definitely not a tutorial, and would be hard to piece together how it all works from that. And it has nothing to do with C.
<br/>
<br/>
The TONC tutorials will give you a much better guide to how tile VRAM, screen VRAM, palette RAM, and BG control registers all work together, and do demonstrate it in C.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But basically about getting the 16x16 thing down. Can I make a function that tells the GBA to handle 8x8 tiles as 16x16 tiles?</td> </tr></table><span class="postbody">
<br/>
That's the idea. The only real tricky bit has to do with tile ordering, i.e. this: (image scaled up 4x so the grid lines and numbers are more readable and don't cover everything so much... fat lines mark 16x16 tile borders, thin lines mark 8x8 tile borders)
<br/>
<a href="http://deku.rydia.net/temp/TileIndexProblem.gif">[Images not permitted - Click here to view it]</a>
<br/>
If you break up the image into 8x8 tiles, then your first 16x16 tile is made up of tiles 0, 1, 6, and 7... which is a pain to work with. Much easier if it's 0, 1, 2, 3, and second 16x16 tile is made up of 8x8 tiles 4, 5, 6 and 7. Here's one way to make that happen... arrange your tiles all into a vertical strip 16 pixels wide:
<br/>
<a href="http://deku.rydia.net/temp/TileIndexProblem2.gif">[Images not permitted - Click here to view it]</a>
<br/>
Which is still kind of a pain to do. I reorder the wide image tiles in my BMP to GBA-friendly format converter, but the strip style is probably less confusing.
<br/>
<br/>
Come to think of it, do you have a BMP to GBA-friendly format converter? If not, you (and anyone else) are welcome to use mine: <a class="postlink" href="http://deku.rydia.net/program/bmpconv.zip" target="_blank">http://deku.rydia.net/program/bmpconv.zip</a>
<br/>
Don't judge the code too harshly... I wrote that around 10 years ago and haven't changed it much since, aside from adding the 16x16 tile mode a couple weeks ago :P
<br/>
It takes an 8-bit .bmp file and spits out 3 files, which you need to get into your GBA ROM any way you can... I use Tepples' GBFS. The .gfx file contains the actual tile pixel data (just copy it to VRAM directly), .pal file can be copied to palette RAM directly, and the .map file contains screen map data, in the format described <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#lcdvrambgscreendataformatbgmap" target="_blank">here</a>
<br/>
<br/>
Also as mentioned on that page, hardware BG screen maps are always 32x32 tiles. Screen data is very much the same concept as the map in your map editor. Each 16-bit value of the screen data contains a tile number to display there, as well as flags for horizontal/vertical flipping, and a palette index if using 4 bits per pixel tile data (I almost always use 4-bit myself)
<br/>
<br/>
So, the .map file is in the correct format to copy to VRAM directly, except it will only line up correctly if the original .bmp was 256 pixels (32 tiles) wide like hardware BG maps. Otherwise you have to copy it row by row:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for (y = 0; y &lt; srcHeight; y++)
<br/>
    for(x = 0; x &lt; srcWidth; x++)
<br/>
        bgScreenVRAM[x + y*32] = srcMapFile[x + y*srcWidth];</td> </tr></table><span class="postbody">
<br/>
Where srcWidth is the width of the .bmp, in 8x8 tiles.
<br/>
<br/>
But since you'll be using a 16 pixel wide image, and it's just a tileset which is referenced by map editor data, then your copy to screen will actually look more like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    // This assumes game maps are always 15 tiles wide, 10 tiles tall (i.e. the size of the screen)
<br/>
for(y = 0; y &lt; 10; y++)
<br/>
{
<br/>
    for(x = 0; x &lt; 15; x++)
<br/>
    {
<br/>
        int tileIndex = gameMap[x + y*15];
<br/>
        bgScreenVRAM[(x*2 + 0) + (y*2 + 0)*32] = srcMapFile[tileIndex*4 + 0];
<br/>
        bgScreenVRAM[(x*2 + 1) + (y*2 + 0)*32] = srcMapFile[tileIndex*4 + 1];
<br/>
        bgScreenVRAM[(x*2 + 0) + (y*2 + 1)*32] = srcMapFile[tileIndex*4 + 2];
<br/>
        bgScreenVRAM[(x*2 + 1) + (y*2 + 1)*32] = srcMapFile[tileIndex*4 + 3];
<br/>
    }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">BTW, I took a look at your demos. Very, very impressive work. Inspiring even, alot of it brought me back to the Golden Sun days... :)</td> </tr></table><span class="postbody">
<br/>
Thanks :) You know, Golden Sun brings me back to the Lufia 2 days... I love the puzzle solving in both of those games. I think I'll add some of that to mine, since I prefer visible enemies instead of random battles, and dungeons are pretty much just boring maze navigation if you're not being punished for every step you take.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177978 - CountSymphonic - Tue Jun 25, 2013 10:20 am</h4>
    <div class="postbody"><span class="postbody">I thought I read somewhere for GBA, that you could use arrays for the graphics in two ways. One in a linear fashion and the other in a 2d fashion... might I take advantage of the linear fashion when arranging my tiles for 16x16? If they are all numbered in a straight 1,2,3 fashion and arranged properly before hand?
<br/>
<br/>
Either way, your insight will definitely prove to be an invaluable reference, my next test rom will have to be practicing loading up tiles, as I've been messing with text and colors for my first test, and it's starting to get old haha. I suppose that after a while testing out all these different features with the GBA that it will all come together eventually. Thanks again for sharing your wisdom, you've obviously put much effort and dedication into learning this stuff. So next up on the agenda is loading tiles. They say it's best to practice with the bitmap modes because they're "easier" but I feel like skipping straight to the tile modes, shame on me. After that, it's time for practicing with button input, vsync, and animations! One step at a time.
<br/>
<br/>
On a side note, I think we share something very interesting in common. It's nice to know that I'm not the only music composer that is also into programming and making RPG's. It's because of music and the interesting distraction it gives that I'm not very sharp with programming, I spent years on music after all! I have this sneaking suspicion that it was the music in the many great RPG's and the RPG's themselves that also might've inspired you to want to get into music and programming also, that's how it was for me anyways.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Thanks :) You know, Golden Sun brings me back to the Lufia 2 days... I love the puzzle solving in both of those games. I think I'll add some of that to mine, since I prefer visible enemies instead of random battles, and dungeons are pretty much just boring maze navigation if you're not being punished for every step you take.</td> </tr></table><span class="postbody">
<br/>
<br/>
FFVII is a wonderful example of this issue that you present, which FFVII is one of my all time favorites from childhood. I find it more difficult nowadays to play through that game because of the repetitive nature, while games like Zelda still feel fresh. Don't get me wrong though. I still appreciate the nature of turn based RPG's, especially the music ;) 
<br/>
<br/>
What are you currently using for your music production software? Still sticking with MIDI's and .sf2's?
<br/>
<br/>
I thought I might've had a converter bmp to gba, stuffed in my hard drive somewhere, but honestly, I prefer to have more options so I can choose something that might be more suitable for my needs. But by all means, I won't be the one to judge anyone's code. Mine's going to be looking a lot worse for a while anyways.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177979 - Dwedit - Tue Jun 25, 2013 4:07 pm</h4>
    <div class="postbody"><span class="postbody">Here's the short description of how to make games for console systems:
<br/>
<br/>
Background
<br/>
- Render a screen of a complete background to start.
<br/>
- Incrementally replace rows/columns of tiles as the camera moves.  Watch games like Golden Sun in the map viewer and you can see it do this.
<br/>
- Replace tiles that are visible on the screen if you have map tiles changing.
<br/>
<br/>
Game Objects
<br/>
- Have a list of all the objects to handle, be able to add, remove, and replace items in the list.  Probably a fixed size array, but you don't necessarily have to use that.
<br/>
- Call a handler for every object, the handler calls all the code that the object needs to do.  <span style="font-weight: bold">This is where almost all the code goes.</span>
<br/>
- Create new objects as the camera moves and objects become closer to the screen.
<br/>
- Remove objects that are too far from the screen.
<br/>
<br/>
Animation frames
<br/>
- A "frame" of a sprite will become one or more physical sprites for the hardware's sprite table (OAM).
<br/>
- Sprite flipping, etc...  Either store them separately, or generate them from unflipped versions.
<br/>
- Code will convert the object table into sprites for the OAM.
<br/>
<br/>
Sprite animations
<br/>
- You can separate the animation sequences from the game logic, so the game logic won't need to pick the exact animation frames all the time.
<br/>
- Call a handler for every object
<br/>
- Game logic selects which animation to play, and the animation code will select exactly which frame of animation to display, simple lists of sequential frames may be good enough.
<br/>
- Loop animations, trigger events after an animation has finished playing, etc...<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177980 - DekuTree64 - Tue Jun 25, 2013 6:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>CountSymphonic wrote:</b></span></td> </tr> <tr> <td class="quote">I thought I read somewhere for GBA, that you could use arrays for the graphics in two ways. One in a linear fashion and the other in a 2d fashion... might I take advantage of the linear fashion when arranging my tiles for 16x16? If they are all numbered in a straight 1,2,3 fashion and arranged properly before hand?</td> </tr></table><span class="postbody">
<br/>
BG tiles are always mapped linearly. The 2D mapping mode is only for sprites, and despite my attempts, I've never come up with a scenario that gives it any advantage whatsoever over 1D mapping. If you can think of one, let me know :lol:
<br/>
Bottom line: don't bother learning the 2D mapping mode.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I have this sneaking suspicion that it was the music in the many great RPG's and the RPG's themselves that also might've inspired you to want to get into music and programming also, that's how it was for me anyways.</td> </tr></table><span class="postbody">
<br/>
Close :) I've been playing music longer than I've been playing video games (and drawing longer than that). But the music in RPGs is a big part of the enjoyment of playing and inspiration to learn programming. I'm a particularly big fan of Yasunori Mitsuda (Chrono Trigger and Xenogears). Programmer/musicians aren't as rare as you might think. In fact, they seem to be somewhat related skills... whereas programming and artwork seem to be somewhat opposing.
<br/>
You should say hey to another friend of mine from this forum, who loves FF7 and music, and is getting to be a great 3D modeller as well: <a class="postlink" href="http://forum.gbadev.org/profile.php?mode=viewprofile&amp;u=9623" target="_blank">http://forum.gbadev.org/profile.php?mode=viewprofile&amp;u=9623</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">What are you currently using for your music production software? Still sticking with MIDI's and .sf2's?</td> </tr></table><span class="postbody">
<br/>
For this game, ModPlug tracker, 4 channel .mod format, using chiptune style instruments. Fun for the classic vibe, plus I already had a player written for it from my tutorial series :P Although I did write a new mixer because the tutorial one is terribly slow: <a class="postlink" href="http://deku.rydia.net/temp/SoundMix.s" target="_blank">http://deku.rydia.net/temp/SoundMix.s</a> <a class="postlink" href="http://deku.rydia.net/temp/Sound.h" target="_blank">http://deku.rydia.net/temp/Sound.h</a> Perhaps sometime I'll write another tutorial chapter explaining all the tricks used in it.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177981 - CountSymphonic - Wed Jun 26, 2013 2:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Background 
<br/>
- Render a screen of a complete background to start. 
<br/>
- Incrementally replace rows/columns of tiles as the camera moves. Watch games like Golden Sun in the map viewer and you can see it do this. 
<br/>
- Replace tiles that are visible on the screen if you have map tiles changing. </td> </tr></table><span class="postbody">
<br/>
<br/>
If I understand what you're saying... wouldn't a comparable example of this be something similar used in alot of 3D games today? For example, Wind Waker, a very sandbox style game. Very close up islands would be full blown 3D models, but as you got further away from the island it was more like a 2D plane, or perhaps a simpler model with less vertices and simpler textures, sort of a way to optimize things and keep the framerate up. Is this sort of what you're trying to explain? Loading and clearing tiles as you need/don't need them, depending on how close they are to the viewport?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Game Objects 
<br/>
- Have a list of all the objects to handle, be able to add, remove, and replace items in the list. Probably a fixed size array, but you don't necessarily have to use that. 
<br/>
- Call a handler for every object, the handler calls all the code that the object needs to do. This is where almost all the code goes. 
<br/>
- Create new objects as the camera moves and objects become closer to the screen. 
<br/>
- Remove objects that are too far from the screen. 
<br/>
<br/>
Animation frames 
<br/>
- A "frame" of a sprite will become one or more physical sprites for the hardware's sprite table (OAM). 
<br/>
- Sprite flipping, etc... Either store them separately, or generate them from unflipped versions. 
<br/>
- Code will convert the object table into sprites for the OAM. </td> </tr></table><span class="postbody">
<br/>
<br/>
Understood. Thank you, for your insight!
<br/>
<br/>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">BG tiles are always mapped linearly. The 2D mapping mode is only for sprites, and despite my attempts, I've never come up with a scenario that gives it any advantage whatsoever over 1D mapping. If you can think of one, let me know :lol: 
<br/>
Bottom line: don't bother learning the 2D mapping mode. </td> </tr></table><span class="postbody">
<br/>
<br/>
I see what you're saying. So with BG's being mapped linearly, does this mean that each 8x8 tile is in sequential order 1,2,3,4,5...? If not, how <span style="font-weight: bold">does</span> it work?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Close :) I've been playing music longer than I've been playing video games (and drawing longer than that). But the music in RPGs is a big part of the enjoyment of playing and inspiration to learn programming. I'm a particularly big fan of Yasunori Mitsuda (Chrono Trigger and Xenogears). Programmer/musicians aren't as rare as you might think. In fact, they seem to be somewhat related skills... whereas programming and artwork seem to be somewhat opposing. 
<br/>
You should say hey to another friend of mine from this forum, who loves FF7 and music, and is getting to be a great 3D modeller as well: <a href="http://forum.gbadev.org/profile.php?mode=viewprofile&amp;u=9623" target="_blank">http://forum.gbadev.org/profile.php?mode=viewprofile&amp;u=9623</a> </td> </tr></table><span class="postbody">
<br/>
<br/>
Interesting point you bring up. Music composition for me... does have a very abstracted way of being done. Song layers. Motifs, the patterns... sorta like functions that can be reused and varied. Interesting parallel.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">For this game, ModPlug tracker, 4 channel .mod format, using chiptune style instruments. Fun for the classic vibe, plus I already had a player written for it from my tutorial series :P Although I did write a new mixer because the tutorial one is terribly slow: <a href="http://deku.rydia.net/temp/SoundMix.s" target="_blank">http://deku.rydia.net/temp/SoundMix.s</a> <a href="http://deku.rydia.net/temp/Sound.h" target="_blank">http://deku.rydia.net/temp/Sound.h</a> Perhaps sometime I'll write another tutorial chapter explaining all the tricks used in it.</td> </tr></table><span class="postbody">
<br/>
<br/>
Cool I'll have to look into all that. For chiptunes, I would use LSDJ for Gameboy... which is useless for composing for homebrew games at this point... :( I also use Sunvox, which is an excellent modular tracker! If you have an Android phone/tablet or iOS device, it's great for NES/GB/GBA and POSSIBLY Sega Genesis style music. But it can only output to .wav and it's own proprietary format so it's useless for homebrew, but could be used to a great extent for PC based games.
<br/>
<br/>
You guys are awesome. Thanks for the help thus far. Besides that, we should definitely keep in touch. I feel right at home here :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177982 - Dwedit - Wed Jun 26, 2013 3:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>CountSymphonic wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If I understand what you're saying... wouldn't a comparable example of this be something similar used in alot of 3D games today? For example, Wind Waker, a very sandbox style game. Very close up islands would be full blown 3D models, but as you got further away from the island it was more like a 2D plane, or perhaps a simpler model with less vertices and simpler textures, sort of a way to optimize things and keep the framerate up. Is this sort of what you're trying to explain? Loading and clearing tiles as you need/don't need them, depending on how close they are to the viewport?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The trick of using low-detail polygon models is a nice trick to save resources, but I'm not taking about this at all.
<br/>
I'm saying it's literally impossible to scroll the screen without overwriting a newly exposed column or row of tiles on the VRAM map.  The hardware's tilemap is 32x32 8x8 tiles (256x256 pixels), and your screen is 240x160 pixels.  Scrolling works by wrapping, so when you go off the right edge of the tilemap, it's drawing tiles from the left edge.  So if you scroll horizontally at all, you will need to send new columns as they appear on the screen.
<br/>
So your camera is at X=0.  You've filled the map with 30 columns of 8x8 tiles.  You move one pixel to the right.  You need a new column of tiles to appear on the map.  Then you can move the camera to X position 8 and still not need any new tiles on the screen.  But when you move the camera to X position 9, then you need a new column of tiles on the map.
<br/>
Same idea when moving the camera to the left, and moving the camera vertically, you send new rows of tiles as they are exposed on the screen.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177983 - CountSymphonic - Wed Jun 26, 2013 8:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>CountSymphonic wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If I understand what you're saying... wouldn't a comparable example of this be something similar used in alot of 3D games today? For example, Wind Waker, a very sandbox style game. Very close up islands would be full blown 3D models, but as you got further away from the island it was more like a 2D plane, or perhaps a simpler model with less vertices and simpler textures, sort of a way to optimize things and keep the framerate up. Is this sort of what you're trying to explain? Loading and clearing tiles as you need/don't need them, depending on how close they are to the viewport?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The trick of using low-detail polygon models is a nice trick to save resources, but I'm not taking about this at all.
<br/>
I'm saying it's literally impossible to scroll the screen without overwriting a newly exposed column or row of tiles on the VRAM map.  The hardware's tilemap is 32x32 8x8 tiles (256x256 pixels), and your screen is 240x160 pixels.  Scrolling works by wrapping, so when you go off the right edge of the tilemap, it's drawing tiles from the left edge.  So if you scroll horizontally at all, you will need to send new columns as they appear on the screen.
<br/>
So your camera is at X=0.  You've filled the map with 30 columns of 8x8 tiles.  You move one pixel to the right.  You need a new column of tiles to appear on the map.  Then you can move the camera to X position 8 and still not need any new tiles on the screen.  But when you move the camera to X position 9, then you need a new column of tiles on the map.
<br/>
Same idea when moving the camera to the left, and moving the camera vertically, you send new rows of tiles as they are exposed on the screen.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
I misunderstood you. What you're saying is that if I were to load a small tilemap without updating the new tiles near the edge of the screen and if I were to move, I would end up seeing the tilemap repeat itself. I noticed this while toying around with one of the Tonc demos. Imust say, that this is something that I probably would've stumbled on trying to figure out on my own. This should make loading and handling 16x16 tiles more interesting heh heh.
<br/>
<br/>
<br/>
Thanks for the correction. It's easy to misinterpret the intended meaning in spoken language.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177984 - Dwedit - Thu Jun 27, 2013 2:14 am</h4>
    <div class="postbody"><span class="postbody">But you can also dynamically load graphics for tiles that will appear on the screen.  It's just a little tricky to do that.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177985 - CountSymphonic - Thu Jun 27, 2013 9:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">But you can also dynamically load graphics for tiles that will appear on the screen.  It's just a little tricky to do that.</td> </tr></table><span class="postbody">
<br/>
<br/>
Is it tricky because of memory constraints? Mem speed?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177986 - sverx - Thu Jun 27, 2013 11:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">But you can also dynamically load graphics for tiles that will appear on the screen.  It's just a little tricky to do that.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm curious about that. If you've got more than 1024 possible different tiles for a single background, how would you link the video ram dynamically allocated tile index with the tile map index you've got in rom and that you probably made with grit or similar?
<br/>
(I still never tried any approach, I'm just very curious... :D )<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177987 - Dwedit - Thu Jun 27, 2013 3:11 pm</h4>
    <div class="postbody"><span class="postbody">Surprisingly enough, on the GBA, VRAM is the second fastest kind of memory.  It's much faster than the 256k of EWRAM, or reading ROM out of the cartridge slot.  When you copy graphics from ROM to VRAM, reading the ROM is the slow part, writing to VRAM is the fast part.  It's like the exact opposite of a PC.  I've even executed code from inside of VRAM when I ran out of IWRAM, and it runs faster than code stored in EWRAM or ROM.
<br/>
<br/>
The reason it's tricky to dynamically load tiles is that you're no longer using simple tile indexes into VRAM.  There are two main ways to do it:
<br/>
<br/>
#1) Use a common tileset and a swappable tileset, then when certain areas get exposed on the screen, swap the tileset out.  Don't put areas using two different swappable tilesets next to each other, pad them apart with a screen that only uses the common tileset.
<br/>
<br/>
#2) Use a cache system for background tiles.
<br/>
You will need to use a lookup table which maps virtual tile numbers to physical tile numbers in VRAM.  If the tile is not found, add a tile to VRAM, and make note of it in the map.
<br/>
You also keep track of reference counts of tiles, so you know whether a tile is actually in use or not.
<br/>
When you add a new tile to VRAM, you look through the map, and find a tile which is no longer used.  FIFO is a good way to do this.  When you remove a tile, change its entry in the lookup table to indicate that it no longer exists.
<br/>
Data structures used:
<br/>
* Lookup converting virtual tiles to physical tiles (either a flat array, hash table, search tree, sorted list, etc)
<br/>
* Array mapping physical tiles to the virtual tile it corresponds to
<br/>
* Reference counts for physical tiles
<br/>
* Cursor for replacing tiles, this corresponds to a physical tile index
<br/>
Algorithm:
<br/>
Replacing a tile on the map with a new virtual tile:
<br/>
Decrease reference count of the old physical tile.
<br/>
Lookup contains the new virtual tile?
<br/>
 If so, use the known physical tile
<br/>
 Otherwise, replace an old tile with a new virtual tile
<br/>
Increase reference count of the new physical tile
<br/>
<br/>
Replacing a tile:
<br/>
Is physical tile at the cursor not in use (reference count is zero)?
<br/>
 If so:
<br/>
* remove old virtual tile from the lookup table
<br/>
* load graphics for the new virtual tile
<br/>
* set new virtual tile for physical-&gt;virtual array
<br/>
* set new physical tile for virtual-&gt;physical lookup table
<br/>
 If tile is in use:
<br/>
* move to the next tile and try again, this means wrapping to 0 when you reach the max tile number
<br/>
 If every single tile has a reference count &gt; 0
<br/>
* oh noes!  Abort so you don't crash.
<br/>
<br/>
To avoid a full cache, you can also replace tiles with a dummy tile when they scroll off the screen so the reference count decreases.
<br/>
<br/>
I think the cache system is overkill, but it should allow you to use any number of tiles you can possibly think of.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177988 - sverx - Fri Jun 28, 2013 11:00 am</h4>
    <div class="postbody"><span class="postbody">Wonderful explanation! Thanks! :)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177989 - CountSymphonic - Sat Jun 29, 2013 9:31 am</h4>
    <div class="postbody"><span class="postbody">Wow. This is an impressive library of information, you guys sure do know what you're doing and you know what? You're taking all the fun out me learning how to do it myself! Haha.
<br/>
<br/>
This thread will definitely be of good reference when I get around to putting together a tiling engine/demo. I can't wait to get started.
<br/>
<br/>
I managed to get in contact with the author of TONC. He seems like a pretty cool guy. It's a shame that he put together TONC when the NDS pretty much took over, which don't get me wrong... the NDS is amazing and all, but I'm a sucker for older hardware. I'd almost rather be putting together regular Gameboy homebrew if there was more reliable information out for it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177990 - gauauu - Mon Jul 01, 2013 2:55 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, Cearn is a great guy. Super helpful, nice, and really knowledgeable. Tonc's been the best way to learn GBA programming since...oh, whenever he made it. 2004 or whatever it was.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178039 - sverx - Tue Aug 13, 2013 2:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">[...]
<br/>
Use a cache system for background tiles.
<br/>
You will need to use a lookup table which maps virtual tile numbers to physical tile numbers in VRAM.  If the tile is not found, add a tile to VRAM, and make note of it in the map.
<br/>
You also keep track of reference counts of tiles, so you know whether a tile is actually in use or not.
<br/>
When you add a new tile to VRAM, you look through the map, and find a tile which is no longer used.  FIFO is a good way to do this.  When you remove a tile, change its entry in the lookup table to indicate that it no longer exists.
<br/>
Data structures used:
<br/>
* Lookup converting virtual tiles to physical tiles (either a flat array, hash table, search tree, sorted list, etc)
<br/>
* Array mapping physical tiles to the virtual tile it corresponds to
<br/>
* Reference counts for physical tiles
<br/>
* Cursor for replacing tiles, this corresponds to a physical tile index
<br/>
Algorithm:
<br/>
Replacing a tile on the map with a new virtual tile:
<br/>
Decrease reference count of the old physical tile.
<br/>
Lookup contains the new virtual tile?
<br/>
 If so, use the known physical tile
<br/>
 Otherwise, replace an old tile with a new virtual tile
<br/>
Increase reference count of the new physical tile
<br/>
<br/>
Replacing a tile:
<br/>
Is physical tile at the cursor not in use (reference count is zero)?
<br/>
 If so:
<br/>
* remove old virtual tile from the lookup table
<br/>
* load graphics for the new virtual tile
<br/>
* set new virtual tile for physical-&gt;virtual array
<br/>
* set new physical tile for virtual-&gt;physical lookup table
<br/>
 If tile is in use:
<br/>
* move to the next tile and try again, this means wrapping to 0 when you reach the max tile number
<br/>
 If every single tile has a reference count &gt; 0
<br/>
* oh noes!  Abort so you don't crash.
<br/>
<br/>
To avoid a full cache, you can also replace tiles with a dummy tile when they scroll off the screen so the reference count decreases.
<br/>
<br/>
I think the cache system is overkill, but it should allow you to use any number of tiles you can possibly think of.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm testing a simplified version of this. It works this way: we don't have to count the occurrences of the same tile... assume they're all different (they never repeat). This way you 'reserve' 31x21 tiles in VRAM and you just load the full 'row' (or 'column') that enters the screen, onto the tiles that are left by the row (or column) that goes off-screen.
<br/>
<br/>
Of course in the worst case (when we have both horizontal and vertical movement) we'll load 52 tiles, but that's true for your cache system too...
<br/>
<br/>
So far it seems it's working good enough. It could theoretically handle a background of any size, having up to 65536 tiles, using only one 32x32 VRAM map and 651 (31x21) tiles space (in VRAM too). This means I would probably be able to have up to 3 (!!!) backgrounds made this way at the very same moment... which is surely enough for me :)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178054 - sverx - Tue Aug 20, 2013 4:53 pm</h4>
    <div class="postbody"><span class="postbody">... and <a class="postlink" href="http://wcms.teleion.it/users/cgq/gba/InfiniteBackground1.gba" target="_blank">here</a>'s a little demo of it.
<br/>
The image is "Pixeltown: a massive (2835x900) pixel art beach city scene" (as described <a class="postlink" href="http://www.pixeljoint.com/pixels/downloads.asp" target="_blank">here</a>, bottom of page) created by <span style="font-weight: bold">stridenoble</span> and used with his kind permission.
<br/>
(I converted it to a 16 color image and then passed to GRIT which converted it to a <span style="font-weight: bold">39269</span> different tiles &amp; a <span style="font-weight: bold">355x113</span> flat map). I'm using a single 32x32 16 color-tiles background, with 651 (31x21) tiles allocated.
<br/>
Scroll using D-pad (and when you finally get bored, I suggest to download the original image ;) )<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
