<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Modifying the makefile - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Modifying the makefile</h2>
<div id="posts">
<div class="post">
    <h4>#12774 - dagamer34 - Wed Nov 26, 2003 2:24 am</h4>
    <div class="postbody"><span class="postbody">Right now i am looking at the makefile generated from the GBA AppWizard and am wondering how, if possible, to execute the SDL commandline version of vba when done building?
<br/>
<br/>
The emulator is in the devkit directory, so i added this line to the end of the makefile.
<br/>
<br/>
$(DEVDIR)\vba :$(PROJECT).gba
<br/>
<br/>
Is this correct?<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12775 - tepples - Wed Nov 26, 2003 3:46 am</h4>
    <div class="postbody"><span class="postbody">This is what I do:
<br/>
<br/>
In your makefile, make a target called 'run', put it first so that it's the default target, and have it depend on your finished binary. Then make 'run' a .PHONY target so that it gets re-"built" every time you run 'make'.
<br/>
<br/>
like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"># 8&lt; cut &gt;8
<br/>
<br/>
EMU = e:\gbadev\vboy\visualboyadvance.exe
<br/>
ROM = tod.gba
<br/>
<br/>
.PHONY: run
<br/>
<br/>
run: $(ROM)
<br/>
        $(EMU) $(ROM)
<br/>
<br/>
# 8&lt; cut &gt;8</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12786 - dagamer34 - Wed Nov 26, 2003 3:49 pm</h4>
    <div class="postbody"><span class="postbody">I got it to work correctly!!
<br/>
<br/>
Now i have one other problem. What is the order of execution for the targets??? I want to use a commandline exe to fix my rom's header BEFORE it runs in vba. Right now it fixes it after I close vba. Here is the code I put in.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
EMU = C:\Consoles\GBA\DevKits\visualboyadvance.exe 
<br/>
ROM = $(PROJECT).gba 
<br/>
ROMFIX = C:\Consoles\GBA\DevKits\GBARM.exe
<br/>
<br/>
.PHONY: run 
<br/>
.PHONY: run2
<br/>
<br/>
run2: $(ROM)
<br/>
       $(ROMFIX) -v $(ROM)
<br/>
   -@echo -------------------------------------------
<br/>
   -@echo Fixing rom now
<br/>
   -@echo -------------------------------------------
<br/>
<br/>
run: $(ROM) 
<br/>
        $(EMU) $(ROM)
<br/>
   -@echo -------------------------------------------
<br/>
   -@echo Playing in vba now
<br/>
   -@echo -------------------------------------------
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This code is placed right after my defined list of .O files. I have moved it everywhere and the vba STILL executes before GBARM (the header fixing tool i am using).<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12788 - poslundc - Wed Nov 26, 2003 4:20 pm</h4>
    <div class="postbody"><span class="postbody">I'm no makefile expert, but I believe the following will work:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
run: $(ROM)
<br/>
   $(ROMFIX) -v $(ROM)
<br/>
   $(EMU) $(ROM)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I applaud your attempts to make your makefile scalable, but do you really need to use a variable for your rom-fix program?
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12789 - dagamer34 - Wed Nov 26, 2003 4:21 pm</h4>
    <div class="postbody"><span class="postbody">Never mind. I fixed it. It depended on the order of the defined paths.
<br/>
<br/>
One last problem and i won't bother you all anymore.
<br/>
<br/>
I am trying to compile tutorial number 4a from Pern Projects and i keep getting an undefined reference to 'sin' and 'cos'. Now it compiles correctly when NOT using MSVC++ but doesn't when i do use it.
<br/>
<br/>
I do include math.h and have even changed my include and lib directories but no difference. Could someone help me?<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12793 - tepples - Wed Nov 26, 2003 5:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote">I got it to work correctly!!
<br/>
<br/>
Now i have one other problem. What is the order of execution for the targets???</td> </tr></table><span class="postbody">
<br/>
For the record, the first target is run by default, and any target's dependencies are run in essentially random but topologically-sorted order.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I want to use a commandline exe to fix my rom's header BEFORE it runs in vba.</td> </tr></table><span class="postbody">
<br/>
My makefiles run gbafix right after objcopy, as part of the 'test.gba' target.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">i keep getting an undefined reference to 'sin' and 'cos'. Now it compiles correctly when NOT using MSVC++ but doesn't when i do use it.</td> </tr></table><span class="postbody">
<br/>
Perhaps your normal makefile is including -lm, but the MSVC project file isn't. You shouldn't be using sin() and cos() in GBA code anyway because they bring in the large and slow floating-point library. Instead, you should be generating a fixed-point cosine lookup table on the PC side and compiling it into your GBA program.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12809 - dagamer34 - Wed Nov 26, 2003 10:38 pm</h4>
    <div class="postbody"><span class="postbody">I know i shouldn't be using those functions HOWEVER this is for testing purposes only. I already have a table for real-time use.
<br/>
<br/>
And where would i put the "-lm" flag?<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12810 - tepples - Thu Nov 27, 2003 12:08 am</h4>
    <div class="postbody"><span class="postbody">Normally, the -lm flag goes after all other object files and libraries (except before -lgcc -lc -lgcc if you're calling ld directly).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
