<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Compile error with DevKitAdv - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Compile error with DevKitAdv</h2>
<div id="posts">
<div class="post">
    <h4>#9126 - abonetochew - Mon Jul 28, 2003 9:29 pm</h4>
    <div class="postbody"><span class="postbody">I have installed DevKitAdv and it works <span style="font-style: italic">almost</span> perfectly for me.  This new program I'm working on uses (or tries to) the c++ <span style="font-weight: bold">new</span> and <span style="font-weight: bold">delete</span> operators.  I think I have the syntax correct, because I don't get any error messages right away, but when it's almost done compiling I get an error message like this:
<br/>
<br/>
/windows/TEMP/ccmlRafJ.o: In function `unit::walkto(int, int)':
<br/>
/windows/TEMP/ccmlRafJ.o(.text+0x34): undefined reference to `operator delete(void*)'
<br/>
/windows/TEMP/ccmlRafJ.o(.text+0x3c): undefined reference to `operator new[](unsigned long)'
<br/>
/windows/TEMP/ccmlRafJ.o: In function `unit::doit(int, int, int)':
<br/>
/windows/TEMP/ccmlRafJ.o(.text+0x3b4): undefined reference to `operator delete[](void*)'
<br/>
/windows/TEMP/ccmlRafJ.o(.text+0x5e0): undefined reference to `operator delete[](void*)'
<br/>
/windows/TEMP/ccmlRafJ.o(.text+0x648): undefined reference to `operator delete[](void*)'
<br/>
collect2: ld returned 1 exit status
<br/>
<br/>
The "ccmlRafJ.o" part changes each time I try.  Did I forget something obvious?<br/>_________________<br/>DS... shiny...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9132 - yaustar - Tue Jul 29, 2003 12:29 am</h4>
    <div class="postbody"><span class="postbody">Post the code so we can see what we are working with...<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9133 - hnager - Tue Jul 29, 2003 12:37 am</h4>
    <div class="postbody"><span class="postbody">What are you compiling with? gcc or g++?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9134 - abonetochew - Tue Jul 29, 2003 1:47 am</h4>
    <div class="postbody"><span class="postbody">Here's my code (gcc).  Don't worry if it's suboptimal, won't work, or is just plain stupid.  I just want it to compile so I can debug it.  I have written about 50% of that since I added new and delete, so about half of it is untested.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//Include other data
<br/>
#include "gba.h"
<br/>
#include "keys.h"
<br/>
#include "dispcnt.h"
<br/>
#include "palette.h"
<br/>
#include "BG0tdata.h"
<br/>
#include "BG1tdata.h"
<br/>
#include "BG0mdata.h"
<br/>
#include "OBJtdata.h"
<br/>
<br/>
//Define some pointers
<br/>
u16* BG0Tiles      = (u16*)0x6000000;
<br/>
u16* BG1Tiles      = (u16*)0x6004000;
<br/>
u16* BG0Map      = (u16*)0x6008000;
<br/>
u16* BG1Map      = (u16*)0x6008800;
<br/>
<br/>
u16* SpriteTiles   = (u16*)0x6010000;
<br/>
u16* PaletteMemory   = (u16*)0x5000000;
<br/>
u16* SpritePalette   = (u16*)0x5000200;
<br/>
u16* OAM      = (u16*)0x7000000;
<br/>
<br/>
class unit {
<br/>
  int x;
<br/>
  int y;
<br/>
  int gx;
<br/>
  int gy;
<br/>
  int wx;
<br/>
  int wy;
<br/>
  int maxhp;
<br/>
  int nowhp;
<br/>
  int walking;
<br/>
  u8* path;
<br/>
  int between;
<br/>
  int walkindex;
<br/>
<br/>
public:
<br/>
  void walkto(int, int);
<br/>
  void doit(int, int, int);
<br/>
  void createunit(int, int);
<br/>
};
<br/>
<br/>
<br/>
void unit::walkto(int tx, int ty) {
<br/>
  if(walking == 1)
<br/>
    delete path;
<br/>
  int o,d,xd,yd,nx,ny;
<br/>
  path = new u8[10];
<br/>
  walking = 1;
<br/>
  between = 0;
<br/>
  walkindex = 0;
<br/>
  o = 0;
<br/>
  gx = tx;
<br/>
  gy = ty;
<br/>
  nx = x;
<br/>
  ny = y;
<br/>
  while(o &lt; 10) {
<br/>
    xd = yd = d = 0;
<br/>
    if(tx &lt; nx) {nx--; xd = 1; d = 1;}
<br/>
    if((tx == nx) &amp;&amp; (xd = 0)) {xd = 1; d = 2;}
<br/>
    if((tx &gt; nx) &amp;&amp; (xd = 0)) {nx++; xd = 1; d = 3;}
<br/>
    if(ty &lt; ny) {ny--; yd = 1; d += 6;}
<br/>
    if((ty == ny) &amp;&amp; (yd = 0)) {yd = 1; d += 3;}
<br/>
    if((ty &gt; ny) &amp;&amp; (yd = 0)) {ny++; yd = 1;}
<br/>
    path[o] = d;
<br/>
    if(d == 5) {break;}
<br/>
    o++;
<br/>
  }
<br/>
}
<br/>
<br/>
void unit::doit(int oamindex, int vx, int vy) {
<br/>
  int d;
<br/>
  if(walking == 1) {
<br/>
    if(between == 0) {
<br/>
      wx = x / 8;
<br/>
      wy = y / 8;
<br/>
      d = path[walkindex];
<br/>
      switch(d) {
<br/>
        case 1: wx--; wy++; break;
<br/>
        case 2: wy++; break;
<br/>
        case 3: wx++; wy++; break;
<br/>
        case 4: wx--; break;
<br/>
        case 6: wx++; break;
<br/>
        case 7: wx--; wy--; break;
<br/>
        case 8: wy++; break;
<br/>
        case 9: wx++; wy--; break;
<br/>
      }
<br/>
      if(d == 5) {
<br/>
        delete [] path;
<br/>
        walking = 0;
<br/>
        between = 0;
<br/>
      }
<br/>
      else {
<br/>
        wx *= 8;
<br/>
        wy *= 8;
<br/>
        between = 1;
<br/>
        if(x &lt; wx) {x--;}
<br/>
        if(x &gt; wx) {x++;}
<br/>
        if(y &lt; wy) {y--;}
<br/>
        if(y &gt; wy) {y++;}
<br/>
      }
<br/>
    }
<br/>
    else {
<br/>
      if(x &lt; wx) {x--;}
<br/>
      if(x &gt; wx) {x++;}
<br/>
      if(y &lt; wy) {y--;}
<br/>
      if(y &gt; wy) {y++;}
<br/>
      if((x == wx) &amp;&amp; (y == wy)) {
<br/>
        walkindex++;
<br/>
        between = 0;
<br/>
        if(walkindex &gt;= 10) {
<br/>
          delete [] path;
<br/>
          walking = 0;
<br/>
          between = 0;
<br/>
        }
<br/>
      }
<br/>
      if((x == gx * 8) &amp;&amp; (y == gy * 8)) {
<br/>
        delete [] path;
<br/>
        walking = 0;
<br/>
        between = 0;
<br/>
      }
<br/>
    }
<br/>
  }
<br/>
  if((y - vy &gt; -8) &amp;&amp; (y - vy &lt; 168) &amp;&amp; (x - vx &gt; -8) &amp;&amp; (x - vx &lt; 248)) {
<br/>
    OAM[oamindex] = y - vy | 0x2000;
<br/>
    OAM[oamindex + 1] = x - vx;
<br/>
    OAM[oamindex + 2] = 1;
<br/>
  }
<br/>
}
<br/>
<br/>
void unit::createunit(int nx, int ny) {
<br/>
  x = nx;
<br/>
  y = ny;
<br/>
  maxhp = 10;
<br/>
  nowhp = 10;
<br/>
  walking = 0;
<br/>
  between = 0;
<br/>
}
<br/>
<br/>
u8 obstacles[64][64];
<br/>
unit bob;
<br/>
<br/>
int main() {
<br/>
  //Declare my variables
<br/>
  int o,x,y,sx,sy,gx,gy,vx,vy;
<br/>
<br/>
<br/>
  REG_DISPCNT = MODE_1 | OBJ_MAP_1D;
<br/>
<br/>
  //Load background palette
<br/>
  for(o = 0; o &lt; 256; o++)
<br/>
    PaletteMemory[o] = palette[o];
<br/>
<br/>
  //Load sprite palettes
<br/>
  for(o = 0; o &lt; 256; o++)
<br/>
    SpritePalette[o] = palette[o];
<br/>
<br/>
  //Load 256 BG0 tiles (16384 bytes/8192 u16's)
<br/>
  for(o = 0; o &lt; 8192; o++)
<br/>
    BG0Tiles[o] = BG0tiledata[o];
<br/>
<br/>
  //Load 256 BG1 tiles (16384 bytes/8192 u16's)
<br/>
  for(o = 0; o &lt; 8192; o++)
<br/>
    BG1Tiles[o] = BG1tiledata[o];
<br/>
<br/>
  //Load 256x256 BG0 map (2048 bytes/1024 u16's)
<br/>
  for(o = 0; o &lt; 1024; o++)
<br/>
    BG0Map[o] = BG0mapdata[o];
<br/>
<br/>
  //Fill 512x512 BG1 map with 1's (8192 bytes/4096 u16's)
<br/>
  for(o = 0; o &lt; 4096; o++)
<br/>
    BG1Map[o] = 0x0001;
<br/>
<br/>
  //Load 256 OBJ tiles (16384 bytes/8192 u16's)
<br/>
  for(o = 0; o &lt; 8192; o++)
<br/>
    SpriteTiles[o] = OBJtiledata[o];
<br/>
<br/>
<br/>
  REG_BG0CNT = 0x1080;
<br/>
  REG_BG0HOFS = 96;
<br/>
<br/>
  REG_BG1CNT = 0xD186;
<br/>
<br/>
  sx = 0;
<br/>
  sy = 0;
<br/>
  BG1Map[0] = 0x0004;
<br/>
  gx = 19;
<br/>
  gy = 19;
<br/>
  BG1Map[627] = 0x0005;
<br/>
<br/>
  x = 120;
<br/>
  y = 80;
<br/>
<br/>
  bob.createunit(0,0);
<br/>
<br/>
<br/>
  while(!(REG_DISPSTAT &amp; 0x0001)) {   //wait for vblank
<br/>
  }
<br/>
<br/>
  REG_DISPCNT = MODE_1 | OBJ_MAP_1D | BG0_ENABLE | BG1_ENABLE | OBJ_ENABLE;
<br/>
<br/>
  while(1) {   //loop forever
<br/>
    while(!(REG_DISPSTAT &amp; 0x0001)) {   //wait for vblank
<br/>
    }
<br/>
<br/>
    if(REG_P1 &amp; KEY_L) {
<br/>
      if(!(REG_P1 &amp; KEY_LEFT)) {
<br/>
        x -= 4;
<br/>
        if(x &lt; 0)
<br/>
          x = 0;
<br/>
      }
<br/>
      if(!(REG_P1 &amp; KEY_RIGHT)) {
<br/>
        x += 4;
<br/>
        if(x &gt; 239)
<br/>
          x = 239;
<br/>
      }
<br/>
      if(!(REG_P1 &amp; KEY_UP)) {
<br/>
        y -= 4;
<br/>
        if(y &lt; 0)
<br/>
          y = 0;
<br/>
      }
<br/>
      if(!(REG_P1 &amp; KEY_DOWN)) {
<br/>
        y += 4;
<br/>
        if(y &gt; 159)
<br/>
          y = 159;
<br/>
      }
<br/>
    }
<br/>
    if(!(REG_P1 &amp; KEY_L)) {
<br/>
      if(!(REG_P1 &amp; KEY_LEFT)) {
<br/>
        vx -= 4;
<br/>
        if(vx &lt; 0)
<br/>
          vx = 0;
<br/>
      }
<br/>
      if(!(REG_P1 &amp; KEY_RIGHT)) {
<br/>
        vx += 4;
<br/>
        if(vx &gt; 352)
<br/>
          vx = 352;
<br/>
      }
<br/>
      if(!(REG_P1 &amp; KEY_UP)) {
<br/>
        vy -= 4;
<br/>
        if(vy &lt; 0)
<br/>
          vy = 0;
<br/>
      }
<br/>
      if(!(REG_P1 &amp; KEY_DOWN)) {
<br/>
        vy += 4;
<br/>
        if(vy &gt; 352)
<br/>
          vy = 352;
<br/>
      }
<br/>
    }
<br/>
    if(x &lt; 160) {
<br/>
      if(!(REG_P1 &amp; KEY_B)) {
<br/>
        gx = (x + vx) &gt;&gt; 3;
<br/>
        gy = (y + vy) &gt;&gt; 3;
<br/>
        bob.walkto(gx, gy);
<br/>
      }
<br/>
    }
<br/>
<br/>
    //scroll BG1
<br/>
    REG_BG1HOFS = vx;
<br/>
    REG_BG1VOFS = vy;
<br/>
<br/>
    //y coord, 256 colors, [16x32]
<br/>
    OAM[0] = (y &amp; 0x00FF) | 0x2000 | 0x8000;
<br/>
    //x coord, [16x32]
<br/>
    OAM[1] = (x &amp; 0x01FF) | 0x8000;
<br/>
    OAM[2] = 2;
<br/>
    OAM[3] = 0;
<br/>
<br/>
    OAM[4] = 0;
<br/>
    OAM[5] = 0;
<br/>
    OAM[6] = 0;
<br/>
    OAM[7] = 0;
<br/>
    bob.doit(4, vx, vy);
<br/>
<br/>
    while(REG_DISPSTAT &amp; 0x0001) {  //wait for vdraw
<br/>
    }
<br/>
  }
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>DS... shiny...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9135 - hnager - Tue Jul 29, 2003 2:51 am</h4>
    <div class="postbody"><span class="postbody">I had the same problem a while back, did you try compiling with g++?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9137 - abonetochew - Tue Jul 29, 2003 4:12 am</h4>
    <div class="postbody"><span class="postbody">what is g++?<br/>_________________<br/>DS... shiny...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9141 - tepples - Tue Jul 29, 2003 6:30 am</h4>
    <div class="postbody"><span class="postbody">g++ is the same as gcc except it links in some extra libraries necessary for C++ language support.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9157 - abonetochew - Tue Jul 29, 2003 4:03 pm</h4>
    <div class="postbody"><span class="postbody">Well, that would explain it.  How do I compile with the g++ libraries?<br/>_________________<br/>DS... shiny...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9161 - tepples - Tue Jul 29, 2003 4:56 pm</h4>
    <div class="postbody"><span class="postbody">Provided your link script and crt0 support g++ (the ones included with DevKit Advance R4 and R5 beta 3 do), just replace <span style="font-weight: bold">gcc</span> with <span style="font-weight: bold">g++</span> in your linking command line (the one that produces the .elf).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9165 - abonetochew - Tue Jul 29, 2003 6:12 pm</h4>
    <div class="postbody"><span class="postbody">No more errors!  Thanks everyone!<br/>_________________<br/>DS... shiny...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
