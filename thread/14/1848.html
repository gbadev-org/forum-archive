<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ARM? THUMB? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > ARM? THUMB?</h2>
<div id="posts">
<div class="post">
    <h4>#9456 - Domovoi - Tue Aug 05, 2003 11:33 am</h4>
    <div class="postbody"><span class="postbody">I see a lot of references on these forums to ARM and THUMB modes... I searched around in the documentation section, and found some technical info on it, but I can't figure out exactly what they are for, and when you'd use either. Is this strictly for Assembly, or do you have to deal with it when programming in C/C++ as well? Is there any good starters tutorial on it available?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9466 - tepples - Tue Aug 05, 2003 3:19 pm</h4>
    <div class="postbody"><span class="postbody">Thumb instructions have 16 bits per instruction word and thus will run faster from cart ROM or from EWRAM. Use ARM instructions for those parts of your program that you choose to copy to IWRAM.
<br/>
<br/>
The following command lines will let you compile a given source code file in a given architecture:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gcc -marm -mthumb-interwork (rest of command line)   # compile as ARM
<br/>
gcc -mthumb -mthumb-interwork (rest of command line) # compile as Thumb</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9469 - Domovoi - Tue Aug 05, 2003 4:24 pm</h4>
    <div class="postbody"><span class="postbody">Interesting, thanks!
<br/>
<br/>
Hmmm... So the more time-critical functions (updating OAM, screen/character base blocks, that sort of thing?) get placed in IWRAM, and less often-used/critical functions in EWRAM?
<br/>
<br/>
This brings up another question... How do I know how large my functions are? With such little memory, it'd be useful to keep track of how much memory one is using, exactly... 
<br/>
<br/>
I suppose you'd only store a handful of functions in IWRAM, so that you have some space reserved for required data and such, right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9471 - tepples - Tue Aug 05, 2003 4:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Domovoi wrote:</b></span></td> </tr> <tr> <td class="quote">So the more time-critical functions (updating OAM, screen/character base blocks, that sort of thing?) get placed in IWRAM, and less often-used/critical functions in EWRAM?</td> </tr></table><span class="postbody">
<br/>
Less often used functions will usually go in ROM, unless you're making a multiboot program. Reasons to make a multiboot program include 1. actual multibooting, or 2. low battery drain.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">How do I know how large my functions are? With such little memory, it'd be useful to keep track of how much memory one is using, exactly... </td> </tr></table><span class="postbody">
<br/>
nm -n program.elf
<br/>
<br/>
Recent Jeff F linker scripts can also overlay the code in IWRAM, so that you can swap out functions that only one part of the program uses. However, I haven't seen a working example of a program that does this.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9476 - DekuTree64 - Tue Aug 05, 2003 7:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Recent Jeff F linker scripts can also overlay the code in IWRAM, so that you can swap out functions that only one part of the program uses. However, I haven't seen a working example of a program that does this.</td> </tr></table><span class="postbody">
<br/>
<br/>
Quite true. I tried to get it working, but I checked the data map and __iwram_overlay_start was getting set to 0x3001004 or something, and __iwram0_load_start was at 0x3001010, like it was aligning it to the nearest 16-bytes, but not aligning __iwram_overlay_start, so it was getting copied to the wrong place, and missing some instructions at the start of the function, so it locked up.
<br/>
But one solution I did come up with that works for ASM functions (since you can count up the instructions for the size) is to just declare an array, and copy your code into it, cast it to a function pointer and call it. Works great for interrupt functions that you only need for one effect in a demo, but need to be fast when they're used.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
