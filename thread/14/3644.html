<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>yet another timer question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > yet another timer question</h2>
<div id="posts">
<div class="post">
    <h4>#22893 - jhinders - Wed Jun 30, 2004 9:29 pm</h4>
    <div class="postbody"><span class="postbody">ok, i am trying to use a timer and basically i check it in a while loop:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   while(1)
<br/>
   {
<br/>
      CumulateTicks();
<br/>
   
<br/>
   }
<br/>
<br/>
<br/>
#define REG_TM2D       ( *(vu16*)0x4000108 )
<br/>
#define REG_TIM2CNT    ( *(vu16*)0x400010A )
<br/>
#define FREQUENCY_64 (1)
<br/>
#define TIMER_ENABLE  (1&lt;&lt;7)
<br/>
#define TIMER_MS (REG_TM2D / (262144/1000))
<br/>
<br/>
static void ResetTimer()
<br/>
{
<br/>
   REG_TIM2CNT = 0;
<br/>
   REG_TM2D = 0;
<br/>
   REG_TIM2CNT = FREQUENCY_64 | TIMER_ENABLE;
<br/>
}
<br/>
<br/>
static unsigned int Ticks = 0;
<br/>
<br/>
static void CumulateTicks()
<br/>
{
<br/>
   static DWORD cumulate = 0;
<br/>
   DWORD ms = TIMER_MS;
<br/>
   Ticks += ms;
<br/>
   cumulate += ms;
<br/>
<br/>
   ResetTimer();
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now i would assume that i would get values for Ticks that would go up at a fairly steady rate, but am not. i will get a difference of 13 between the current Ticks value and the next, and then sometimes get like 34 or something. Anyone know what stupidity i am doing?
<br/>
<br/>
thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22900 - jhinders - Wed Jun 30, 2004 10:25 pm</h4>
    <div class="postbody"><span class="postbody">ok, i'll respond to my own post. turns out i was waiting for vsync so the timer update was not always called at the appropriate time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22908 - poslundc - Wed Jun 30, 2004 10:48 pm</h4>
    <div class="postbody"><span class="postbody">The lesson is that the code you post should reflect the code in your program.
<br/>
<br/>
My first thought when looking at the description of the problem was that you were probably doing something like synching to VBlank, but your code only showed an infinite loop.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
