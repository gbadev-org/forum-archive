<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ARM GNU Toolchain and Soft Float Problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > ARM GNU Toolchain and Soft Float Problem</h2>
<div id="posts">
<div class="post">
    <h4>#17310 - bogston - Sat Mar 06, 2004 3:52 am</h4>
    <div class="postbody"><span class="postbody">I am attempting to build the ARM GCC Toolchain.  I have found linux.gbadev.org.  This site is very helpful.  The following tarballs are used:
<br/>
<br/>
binutils-2.11.2.tar.gz
<br/>
gcc-core-3.0.4.tar.gz
<br/>
newlib-1.11.0.tar.gz
<br/>
crtls.zip
<br/>
test.tar.gz
<br/>
<br/>
All the versions are listed on linux.gbadev.org.  Here's my problem:
<br/>
<br/>
I can assemble (the code is rainbow something) and execute using VisualGameBoy.  Works fine.
<br/>
<br/>
I can not compile the test program listed on linux.gbadev.org.   I get the error below.  Looks like I have a floating point library problem.  My guess is that I need to build gcc or newlib with -msoft-float, but this does not work.  Specifically, I seem to need crtbegin.o and crtend.o compiled with -msoft-float, but I have no clue how to do this.  Believe me, I have tried everything I can think of.   Any suggestions?  Thanks.
<br/>
<br/>
My compiler output from test.c:
<br/>
<br/>
/opt/arm/lib/gcc-lib/arm-thumb-elf/3.0.4/../../../../arm-thumb-elf/bin/ld: Error: __main.o uses hard floating point, whereas test.elf uses soft floating point
<br/>
File format not recognized: failed to merge target specific data of file /opt/arm/lib/gcc-lib/arm-thumb-elf/3.0.4/libgcc.a(__main.o)
<br/>
<br/>
/opt/arm/lib/gcc-lib/arm-thumb-elf/3.0.4/../../../../arm-thumb-elf/bin/ld: Error: unwind-dw2-fde.o uses hard floating point, whereas test.elf uses soft floating point
<br/>
File format not recognized: failed to merge target specific data of file /opt/arm/lib/gcc-lib/arm-thumb-elf/3.0.4/libgcc.a(unwind-dw2-fde.o)
<br/>
<br/>
/opt/arm/lib/gcc-lib/arm-thumb-elf/3.0.4/../../../../arm-thumb-elf/bin/ld: Error: /opt/arm/lib/gcc-lib/arm-thumb-elf/3.0.4/crtend.o uses hard floating point, whereas test.elf uses soft floating point
<br/>
File format not recognized: failed to merge target specific data of file /opt/arm/lib/gcc-lib/arm-thumb-elf/3.0.4/crtend.o
<br/>
<br/>
collect2: ld returned 1 exit status</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17311 - Miked0801 - Sat Mar 06, 2004 4:45 am</h4>
    <div class="postbody"><span class="postbody">The easy answer is don't ever used floats on GBA...
<br/>
<br/>
The harder answer is to put the -mSoftFloat or whatever the option is on the CFLAGS define within the make file you are running.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17326 - Torlus - Sat Mar 06, 2004 12:22 pm</h4>
    <div class="postbody"><span class="postbody">Quick workaround : add --no-warn-mismatch to your linker options.
<br/>
But remember that you won't be able to use any libc function using floats.
<br/>
<br/>
The best solution seems to make you own newlib build, with -msoft-float. Or maybe to make a full build of GCC with soft float by default. It's something I'll have a look at too... Has anyone in this forum done this before ?<br/>_________________<br/>GBA,GC,NGPC,GP32,FPGA,DS stuff at <a class="postlink" href="http://torlus.com/" target="_blank">http://torlus.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17336 - bogston - Sat Mar 06, 2004 4:41 pm</h4>
    <div class="postbody"><span class="postbody">&gt;&gt;From Torlus
<br/>
&gt;&gt;
<br/>
&gt;&gt;The best solution seems to make you own newlib build, with -msoft-float. Or maybe 
<br/>
&gt;&gt;to make a full build of GCC with soft float by default. It's something I'll have a look 
<br/>
&gt;&gt;at too... Has anyone in this forum done this before ?
<br/>
<br/>
This is my thought, too.  
<br/>
<br/>
I can get newlib built by adding -msoft-float to CFLAGS in the top-most Makefile.  Newlib doesn't seem to be the problem.  It's gcc.
<br/>
<br/>
I can not get gcc to build with -msoft-float added any of the various CFLAGS in the top-most Makefile.  GCC build fails about 25% done.  I have tried add -msoft-float to the Makefile in the build/gcc/gcc.  This lower gcc directory looks like the libc code, but it doesn't work either.   Build fails any.  It looks like the gcc Makefiles are meant to change by configure.
<br/>
<br/>
So, has anyone in this forum done this before?  If not, I have an idea on how to do this.
<br/>
<br/>
bogston</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17401 - Torlus - Sun Mar 07, 2004 10:46 am</h4>
    <div class="postbody"><span class="postbody">Well you don't need to compile GCC with -msoft-float (harware float on x86 works well :)). 
<br/>
All you have to do is to make your GCC build produce soft float operations by default. Look at that thread :
<br/>
<a class="postlink" href="http://sources.redhat.com/ml/crossgcc/2004-01/msg00173.html" target="_blank">http://sources.redhat.com/ml/crossgcc/2004-01/msg00173.html</a><br/>_________________<br/>GBA,GC,NGPC,GP32,FPGA,DS stuff at <a class="postlink" href="http://torlus.com/" target="_blank">http://torlus.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17607 - bogston - Thu Mar 11, 2004 1:42 am</h4>
    <div class="postbody"><span class="postbody">I got gcc and newlib to compile with soft-float using the message from sources.redhat.com.  Now I got this message:
<br/>
<br/>
/opt/arm/lib/gcc-lib/arm-elf/3.3.2/../../../../arm-elf/bin/ld: section .data [02001814 -&gt; 020020bb] overlaps section .fini [02001814 -&gt; 0200182b]
<br/>
collect2: ld returned 1 exit status
<br/>
<br/>
linux.gbadev.org mentions that this message occurs on gcc 3.3.2.  I saw this mentioned on Google as well.  I need to investigate further. Thanks for the help.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
