<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Compile problems... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Compile problems...</h2>
<div id="posts">
<div class="post">
    <h4>#39433 - AssHead - Fri Apr 08, 2005 9:33 pm</h4>
    <div class="postbody"><span class="postbody">I've been spoiled by MSVC++, so I'm not very good with command line compilers. I'm writing a GBA game using Devkit Advance. I need to switch my project from C to C++ so I can take advantage of C++'s OOP features. I switched my compiler to g++, but I got an error about missing libstdc++.a. I redownloaded Devkit and found the file, but now I'm getting new linking errors.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
g++ -c -O2  src/entity/entity.cpp
<br/>
g++ -c -O2  src/entity/entity_player.cpp
<br/>
g++ -c -O2  src/main.cpp
<br/>
g++ -c -O2  src/bg.cpp
<br/>
g++ -c -O2  src/gba.cpp
<br/>
g++ -o rom.elf entity.o entity_player.o main.o bg.o gba.o
<br/>
/cygdrive/c/devkitadv/bin/../lib/gcc-lib/arm-agb-elf/3.0.2/../../../libstdc++.a(
<br/>
pure.o): In function `__cxa_pure_virtual':
<br/>
pure.o(.text+0x18): undefined reference to `write'
<br/>
/cygdrive/c/devkitadv/bin/../lib/gcc-lib/arm-agb-elf/3.0.2/../../../libstdc++.a(
<br/>
eh_throw.o): In function `__cxa_rethrow':
<br/>
eh_throw.o(.text+0x114): undefined reference to `_Unwind_SjLj_Resume_or_Rethrow'
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I done some searching on Google, and found something about these symbols being defined in libgcc_s.so.1. I have no clue what kind of file this is, and I can't seem to find it anywhere. It didn't come with Devkit Advance. Can anyone help me out?
<br/>
<br/>
Thanks. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39448 - tepples - Fri Apr 08, 2005 11:45 pm</h4>
    <div class="postbody"><span class="postbody">You get the "undefined reference to write" error because the default implementation of a pure virtual function will try to write() an error message to the screen, but the GBA has no standard implementation of character I/O. Therefore, you'll need to implement write(). If you are using <a class="postlink" href="http://www.pineight.com/gba/#agbtty" target="_blank">AGBTTY</a> or another terminal emulator as your text backend, it should look something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;sys/types.h&gt;
<br/>
#include &lt;sys/uio.h&gt;
<br/>
#include &lt;unistd.h&gt;
<br/>
#include &lt;errno.h&gt;
<br/>
#include "agbtty.h"
<br/>
<br/>
ssize_t write(int d, const void *buf, size_t nbytes)
<br/>
{
<br/>
  if(d == 1 || d == 2)  /* file descriptors for stdout or stderr */
<br/>
  {
<br/>
    return agbtty_write(const void *buf, size_t nbytes);
<br/>
  }
<br/>
  else
<br/>
  {
<br/>
    errno = EBADF;
<br/>
    return -1;
<br/>
  }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Otherwise, just tell it to ignore the write using a stub implementation:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;sys/types.h&gt;
<br/>
#include &lt;sys/uio.h&gt;
<br/>
#include &lt;unistd.h&gt;
<br/>
<br/>
ssize_t write(int d, const void *buf, size_t nbytes)
<br/>
{
<br/>
  return nbytes;
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39459 - AssHead - Sat Apr 09, 2005 4:19 am</h4>
    <div class="postbody"><span class="postbody">Thanks! That took care of the write() problem, but I still get the "undefined reference to `_Unwind_SjLj_Resume_or_Rethrow'" error. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
g++ -c -O2  src/main.cpp
<br/>
g++ -c -O2  src/bg.cpp
<br/>
g++ -c -O2  src/gba.cpp
<br/>
g++ -c -O2  src/entity/entity.cpp
<br/>
g++ -c -O2  src/entity/entity_player.cpp
<br/>
g++ -o rom.elf main.o bg.o gba.o entity.o entity_player.o
<br/>
/cygdrive/c/devkitadv/bin/../lib/gcc-lib/arm-agb-elf/3.0.2/../../../libstdc++.a(
<br/>
eh_throw.o): In function `__cxa_rethrow':
<br/>
eh_throw.o(.text+0x114): undefined reference to `_Unwind_SjLj_Resume_or_Rethrow'</td> </tr></table><span class="postbody">
<br/>
<br/>
[EDIT] Nevermind. I'm just going to switch back to C. I guess I'll just have to redesign my entity system.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39508 - Quirky - Sat Apr 09, 2005 8:36 pm</h4>
    <div class="postbody"><span class="postbody">You might need some -mthumb-interworking flags on the link step perhaps? Which version of Devkit Advance are you using? I vaguely remember C++ not being well tested in a couple of releases, though I may be wrong. Have you tried switching to Devkit ARM?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39513 - AssHead - Sat Apr 09, 2005 9:37 pm</h4>
    <div class="postbody"><span class="postbody">I hope I can get this working. I'm going nuts trying to design a game engine that doesn't rely on inheritance.
<br/>
<br/>
I tried the -mthumb-interwork flag. I got couple hundred errors about "blah.o doesn't support interworking, whereas blah.o does." It didn't fix the '_Unwind_SjLj_Resume_or_Rethrow' error.
<br/>
<br/>
I downloaded Devkit way back in October of 03 and its been collecting dust on my hard drive since then. I can't seem to find a version number anywhere so I'm not sure exactly which release I'm using. I'm going to switch to Devkit ARM later and see if that does it.
<br/>
<br/>
[EDIT] Ok, I've switched over to DevKitArm. It compiles fine now, but the rom won't run! I just get a blank white screen. Did I set up DevKit wrong? Or am I not compiling something right? Sorry to ask so many questions, but I really don't know much about GCC and I'm pretty much in the dark about what to try next. Heres my makefile.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
CC = arm-elf-g++
<br/>
CFLAGS =  -c
<br/>
LIST = main.o bg.o gba.o
<br/>
ENT_LIST = entity.o entity_player.o
<br/>
<br/>
all: rom.gba
<br/>
<br/>
rom.gba: rom.elf
<br/>
   arm-elf-objcopy -O binary rom.elf rom.gba
<br/>
   gbafix rom.gba -tMYROM -cMYRM -mMM -r1
<br/>
<br/>
rom.elf: $(LIST) $(ENT_LIST)
<br/>
   $(CC) -o rom.elf $(LIST) $(ENT_LIST)
<br/>
<br/>
$(ENT_LIST): %.o: src/entity/%.cpp
<br/>
   $(CC) $(CFLAGS) $&lt;
<br/>
<br/>
$(LIST): %.o: src/%.cpp
<br/>
   $(CC) $(CFLAGS) $&lt;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by AssHead on Sun Apr 10, 2005 12:04 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#39521 - tepples - Sat Apr 09, 2005 11:54 pm</h4>
    <div class="postbody"><span class="postbody">Have you tried to compile C++ with inheritance but without exceptions?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39522 - AssHead - Sun Apr 10, 2005 12:07 am</h4>
    <div class="postbody"><span class="postbody">I edited my above reply around the same time you posted, tepples. Switching to DevKitArm worked, but now I've got a new problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39523 - tepples - Sun Apr 10, 2005 12:25 am</h4>
    <div class="postbody"><span class="postbody">With devkitARM, you have to add <span style="font-weight: bold">-specs=gba.specs</span> or <span style="font-weight: bold">-specs=gba_mb.specs</span> (depending on whether it's a ROM or a multiboot) somewhere on the linker command line (the one with -o something.elf). Otherwise, it seems to default to a build for some platform other than Game Boy Advance.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39529 - AssHead - Sun Apr 10, 2005 12:58 am</h4>
    <div class="postbody"><span class="postbody">I added that line, but the emulator still gives me a plain white screen. Am I missing anything else?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
CC = arm-elf-g++
<br/>
CFLAGS =  -c -O2 -Wall
<br/>
LIST = main.o bg.o gba.o
<br/>
ENT_LIST = entity.o entity_player.o
<br/>
<br/>
all: rom.gba
<br/>
<br/>
rom.gba: rom.elf
<br/>
   arm-elf-objcopy -O binary rom.elf rom.gba
<br/>
   gbafix rom.gba -tMYROM -cMYRM -mMM -r1
<br/>
<br/>
rom.elf: $(LIST) $(ENT_LIST)
<br/>
   $(CC) -specs=gba.specs -o rom.elf $(LIST) $(ENT_LIST)
<br/>
<br/>
$(ENT_LIST): %.o: src/entity/%.cpp
<br/>
   $(CC) $(CFLAGS) $&lt;
<br/>
<br/>
$(LIST): %.o: src/%.cpp
<br/>
   $(CC) $(CFLAGS) $&lt;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39531 - tepples - Sun Apr 10, 2005 1:16 am</h4>
    <div class="postbody"><span class="postbody">Make sure to use -mthumb-interwork on every line that calls $(CC), and make sure to use -mthumb when compiling C source code (other than code that you intend to put in IWRAM) and when linking.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39532 - AssHead - Sun Apr 10, 2005 1:31 am</h4>
    <div class="postbody"><span class="postbody">THAT DID IT! It works perfectly now. I tried putting -mthumb-interwork in before, but I forgot to add it to the linking stage and I got a bunch of errors. Thanks for all your help. I can finally move onto finishing my entity system. :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
