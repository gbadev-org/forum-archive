<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Bug I can't seem to figure out. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Bug I can't seem to figure out.</h2>
<div id="posts">
<div class="post">
    <h4>#176380 - MisterLogan - Tue Jul 19, 2011 1:59 am</h4>
    <div class="postbody"><span class="postbody">Hey, I'm not sure this forum is still even alive, although I see posts every couple days so I assume there's a few people around.
<br/>
<br/>
I took up coding for the GBA a few weeks ago as a way to learn c++ (although right now it's the only reason I want to know c++), I know most people say to learn a bunch of c++ before you jump into the GBA but that's not really the kind of person I am.
<br/>
<br/>
 So here's why I'm posting here, I'm trying to keep npcs from walking through the main sprite, which is fixed on the screen, so I wrote in something to reserve tiles in whatever direction you move as soon as it checks that that tile isn't already in use by the background or an npc or whatever, then releases the previous tile you were on when you're one pixel away from the tile you're moving towards. 
<br/>
<br/>
The tiles that are used/unused are stored in a 16*16 1d array (map size / 16) with 0x0 being used and 0x1 being unused.
<br/>
<br/>
Instead of doing what I want there is a small slurry of bugs. First, it doesn't reserve the right tiles, much less free the right ones. Also, if you go towards the bottom of the map, right as the wrapped around tiles gets to the screen, the main sprite vanishes and the npc I have walking around changes into the main sprite.
<br/>
<br/>
Here's the function, the commented code is what's causing problems, specifically the lower 4 comments.
<br/>
(sorry if anything is terrible looking, I don't really know what good code looks like due to just starting, also, i know using division is bad, there's an easy way to take out most of it, plus the modulo, that I haven't put in yet, but I couldn't think of a way to not divide bgX by 16 and get the right value.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void acceptUserInput() {
<br/>
    if (InpVar2 &gt; 0) {
<br/>
       if(InpLoop == 0)
<br/>
            InpLoop = 16;
<br/>
      if (InpLoop == 16){
<br/>
          sprites[0].attribute2 = PRIORITY(1) | (InpVar2 * 2 - 1) * 16;
<br/>
          sprites[1].attribute2 = PRIORITY(2) | ((InpVar2 * 2 - 1) * 16) + 8;
<br/>
          }
<br/>
        if(InpLoop == 8){
<br/>
           sprites[0].attribute2 = PRIORITY(1) |(InpVar2 - 1) * 32;
<br/>
           sprites[1].attribute2 = PRIORITY(2) |((InpVar2 - 1) * 32) + 8;
<br/>
        }
<br/>
      InpLoop -= 1;
<br/>
      if(InpLoop == 0)
<br/>
         InpVar2 = 0;
<br/>
    }
<br/>
<br/>
    else if (InpVar &gt; 0) {
<br/>
       if(InpLoop == 0)
<br/>
            InpLoop = 16;
<br/>
      if (InpLoop == 16){
<br/>
          sprites[0].attribute2 = PRIORITY(1) | (InpVar * 2 - 1) * 16;
<br/>
          sprites[1].attribute2 = PRIORITY(2) | (InpVar * 2 - 1) * 16 + 8;
<br/>
      }
<br/>
<br/>
        if(InpVar == 1){
<br/>
        bgY += 1;
<br/>
        a -= 1;
<br/>
       // if(InpLoop == 1)
<br/>
        //    city_otm[(bgX + 112 / 16) + (bgY + 80 - 15)] = 0x1;
<br/>
        }
<br/>
        else if(InpVar == 2){
<br/>
        bgY -= 1;
<br/>
        a += 1;
<br/>
       // if(InpLoop == 1)
<br/>
       //     city_otm[(bgX + 112 / 16) + (bgY + 80 + 15)] = 0x1;
<br/>
        }
<br/>
        else if(InpVar == 3){
<br/>
        bgX -= 1;
<br/>
        b += 1;
<br/>
      //  if(InpLoop == 1)
<br/>
        //    city_otm[(bgX + 112 / 16 + 1) + (bgY + 80)] = 0x1;
<br/>
        }
<br/>
        else if(InpVar == 4){
<br/>
        bgX += 1;
<br/>
        b -= 1;
<br/>
      //  if(InpLoop == 1)
<br/>
       //     city_otm[(bgX + 112 / 16) + (bgY + 80)] = 0x1;
<br/>
        }
<br/>
        REG_BG3VOFS = bgY;
<br/>
        REG_BG3HOFS = bgX;
<br/>
<br/>
        if(InpLoop == 8){
<br/>
           sprites[0].attribute2 = PRIORITY(1) | (InpVar - 1) * 32;
<br/>
           sprites[1].attribute2 = PRIORITY(2) | (InpVar - 1) * 32 + 8;
<br/>
        }
<br/>
      InpLoop -= 1;
<br/>
      if(InpLoop == 0)
<br/>
         InpVar = 0;
<br/>
   }
<br/>
   else {
<br/>
      if(keyDown(KEY_RIGHT)) {
<br/>
                                          //shhh, ignore this division.
<br/>
         if otmMovable(bgX%MapX/16+1, bgY%MapY/16) {
<br/>
             InpVar = 4;
<br/>
                           //the 112 and 80 are the sprites offset in pixels from the map start.
<br/>
             //city_otm[(bgX + 112 / 16 + 1) + (bgY + 80)] = 0x0;
<br/>
         }
<br/>
         else
<br/>
                InpVar2 = 4;
<br/>
      } else if(keyDown(KEY_LEFT)) {
<br/>
         if otmMovable(bgX%MapX/16-1, bgY%MapY/16) {
<br/>
            InpVar = 3;
<br/>
            //city_otm[(bgX + 112 / 16 - 1) + (bgY + 80)] = 0x0;
<br/>
         }
<br/>
         else
<br/>
                InpVar2 = 3;
<br/>
      } else if(keyDown(KEY_UP)) {
<br/>
         if otmMovable(bgX%MapX/16, bgY%MapY/16-1) {
<br/>
            InpVar = 2;
<br/>
            //city_otm[(bgX + 112 / 16) + (bgY + 80) - 16] = 0x0;
<br/>
         }
<br/>
         else
<br/>
                InpVar2 = 2;
<br/>
      } else if(keyDown(KEY_DOWN)) {
<br/>
         if otmMovable(bgX%MapX/16, bgY%MapY/16+1) {
<br/>
            InpVar = 1;
<br/>
            //city_otm[(bgX + 112 / 16) + (bgY + 80) + 16] = 0x0;
<br/>
         }
<br/>
         else
<br/>
                InpVar2 = 1;
<br/>
      }
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I tried setting all the tiles in the city_otm array to 0x1 to figure out what it was doing, but it seems random to me.
<br/>
<br/>
Anyway, if someone happens to see what I'm doing wrong here at a glance, I would be very grateful.
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176383 - gauauu - Tue Jul 19, 2011 3:23 pm</h4>
    <div class="postbody"><span class="postbody">Welcome!  Yeah, the forum is at least a little bit alive.  There's a lot of us that are still lurking around reading the one or two posts per day.
<br/>
<br/>
Anyway, I looked over your code, and I'm really having trouble following it.  Without more descriptive variables names (InpVar2? a? b?), I'm really having trouble understanding what each piece of code is trying to do.  It's better to name your variables something that really describes what they are.
<br/>
<br/>
I'd recommend changing your variable names, adding a few comments, then we can take another look.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176384 - MisterLogan - Tue Jul 19, 2011 10:35 pm</h4>
    <div class="postbody"><span class="postbody">Alright, awesome to hear this place still has some people.
<br/>
<br/>
I couldn't really think of a good name for inpvar without it being really long, but i'll try again. I guess I just forgot to rename a and b, although they don't have much to do with this bit, they're used to hold the other sprites onto the map when it moves.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void acceptUserInput() { 
<br/>
///this section is just to animate the sprite when you walk into walls
<br/>
    if (ForwardBlockUsed &gt; 0) { 
<br/>
       if(InpLoop == 0) 
<br/>
            InpLoop = 16; 
<br/>
      if (InpLoop == 16){ 
<br/>
         //every 32x16 sprite is split into two 16x16 sprites to give them different priorities.
<br/>
          sprites[0].attribute2 = PRIORITY(1) | (ForwardBlockUsed * 2 - 1) * 16; 
<br/>
          sprites[1].attribute2 = PRIORITY(2) | ((ForwardBlockUsed * 2 - 1) * 16) + 8; 
<br/>
          } 
<br/>
        if(InpLoop == 8){ 
<br/>
           sprites[0].attribute2 = PRIORITY(1) |(ForwardBlockUsed - 1) * 32; 
<br/>
           sprites[1].attribute2 = PRIORITY(2) |(ForwardBlockUsed - 1) * 32) + 8; 
<br/>
        } 
<br/>
      InpLoop -= 1; 
<br/>
      if(InpLoop == 0) 
<br/>
        ForwardBlockUsed = 0; 
<br/>
    }
<br/>
///ends here
<br/>
///this moves and animates the main sprite when you walk towards an open block.
<br/>
    else if ( ForwardBlockUnused &gt; 0) { 
<br/>
       if(InpLoop == 0) 
<br/>
///always loops things 16 times, moving one pixel every time, to keep everything within 16x16 squares.
<br/>
            InpLoop = 16; 
<br/>
      if (InpLoop == 16){ 
<br/>
         //at the start, changes to the first of the two animation frames in the direction you're going (main sprite goes from 0 to 128 in sprite data.)
<br/>
          sprites[0].attribute2 = PRIORITY(1) | ( ForwardBlockUnused * 2 - 1) * 16; 
<br/>
          sprites[1].attribute2 = PRIORITY(2) | ( ForwardBlockUnused * 2 - 1) * 16 + 8; 
<br/>
      } 
<br/>
<br/>
        if(ForwardBlockUnused == 1){ 
<br/>
        bgY += 1; 
<br/>
        SpriteHold1 -= 1; 
<br/>
       ///the + and - 15 on these are to account for the loop being 15 out of 16 steps from completion in either direction.
<br/>
       // if(InpLoop == 1) 
<br/>
        //    city_otm[(bgX + 112 / 16) + (bgY + 80 - 15)] = 0x1; 
<br/>
        } 
<br/>
        else if(ForwardBlockUnused == 2){ 
<br/>
        bgY -= 1; 
<br/>
        SpriteHold1 += 1; 
<br/>
       // if(InpLoop == 1) 
<br/>
       //     city_otm[(bgX + 112 / 16) + (bgY + 80 + 15)] = 0x1; 
<br/>
        } 
<br/>
        else if(ForwardBlockUnused == 3){ 
<br/>
        bgX -= 1; 
<br/>
        SpriteHold2 += 1; 
<br/>
       ///should only have to add one here since it's divided by sixteen.
<br/>
      //  if(InpLoop == 1) 
<br/>
        //    city_otm[(bgX + 112 / 16 + 1) + (bgY + 80)] = 0x1; 
<br/>
        } 
<br/>
        else if(ForwardBlockUnused == 4){ 
<br/>
        bgX += 1; 
<br/>
        SpriteHold2 -= 1; 
<br/>
      ///and nothing on this since you won't have another full count of sixteen on the fifteenth step.
<br/>
      //  if(InpLoop == 1) 
<br/>
       //     city_otm[(bgX + 112 / 16) + (bgY + 80)] = 0x1; 
<br/>
        } 
<br/>
        REG_BG3VOFS = bgY; 
<br/>
        REG_BG3HOFS = bgX; 
<br/>
<br/>
        if(InpLoop == 8){ 
<br/>
           sprites[0].attribute2 = PRIORITY(1) | (ForwardBlockUnused - 1) * 32; 
<br/>
           sprites[1].attribute2 = PRIORITY(2) | (ForwardBlockUnused - 1) * 32 + 8; 
<br/>
        } 
<br/>
      InpLoop -= 1; 
<br/>
      if(InpLoop == 0) 
<br/>
         ForwardBlockUnused = 0; 
<br/>
   } 
<br/>
///and it ends over here.
<br/>
///and if neither one of those two code blocks get executed, no key has been pressed, so it loops through this to check keys and decide which code to start running
<br/>
   else { 
<br/>
      if(keyDown(KEY_RIGHT)) { 
<br/>
          ///shhh, ignore this division. (this checks if the block in the direction you pressed is unused)
<br/>
         if otmMovable(bgX%MapX/16+1, bgY%MapY/16) { 
<br/>
            //if it's unused it flips this variable to 1, 2, 3, or 4, depending on the direction you pressed. it later uses this number to get the right sprite from memory.
<br/>
             ForwardBlockUnused = 4; 
<br/>
              //the 112 and 80 are the sprites offset in pixels from the map start. 
<br/>
              //this code should do the same thing as the otmMovable bit without using as much division, i just haven't switched the other bit to this yet
<br/>
             //city_otm[(bgX + 112 / 16 + 1) + (bgY + 80)] = 0x0; 
<br/>
         } 
<br/>
         else 
<br/>
             //if otmMovable doesn't check out, you have a used block in front of you, triggering this instead. just animates you moving against the wall.
<br/>
                ForwardBlockUsed = 4; 
<br/>
      } else if(keyDown(KEY_LEFT)) { 
<br/>
         if otmMovable(bgX%MapX/16-1, bgY%MapY/16) { 
<br/>
           ForwardBlockUnused = 3; 
<br/>
            //city_otm[(bgX + 112 / 16 - 1) + (bgY + 80)] = 0x0; 
<br/>
         } 
<br/>
         else 
<br/>
                ForwardBlockUsed = 3; 
<br/>
      } else if(keyDown(KEY_UP)) { 
<br/>
         if otmMovable(bgX%MapX/16, bgY%MapY/16-1) { 
<br/>
           ForwardBlockUnused = 2; 
<br/>
            //city_otm[(bgX + 112 / 16) + (bgY + 80) - 16] = 0x0; 
<br/>
         } 
<br/>
         else 
<br/>
               ForwardBlockUsed = 2; 
<br/>
      } else if(keyDown(KEY_DOWN)) { 
<br/>
         if otmMovable(bgX%MapX/16, bgY%MapY/16+1) { 
<br/>
           ForwardBlockUnused = 1; 
<br/>
            //city_otm[(bgX + 112 / 16) + (bgY + 80) + 16] = 0x0; 
<br/>
         } 
<br/>
         else 
<br/>
               ForwardBlockUsed = 1; 
<br/>
      } 
<br/>
   } 
<br/>
  ///and that ends that.
<br/>
} 
<br/>
///I hope this explains what's going on here better. To give some context as to where this code goes, it's grouped with a bunch of other functions in the main loop after vblank.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Thanks again for the help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176385 - Miked0801 - Wed Jul 20, 2011 5:37 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I'm also going to ask for another code cleanup here.  Your code is so full of "Magic Numbers", it's very hard to understand what is going on still.
<br/>
<br/>
Consider this a code review for your own growth and take nothing I say below personally:
<br/>
InpLoop = InputLoop?
<br/>
16 = ?
<br/>
(ForwardBlockUsed * 2) - 1 == some odd number?  * 16 and + 8 ?  These powers of 2 don't make sense to someone coming in from the outside.  Use constants.
<br/>
<br/>
InpLoop itself is a global I'm guessing, another source of confusion and poor maintainability.
<br/>
<br/>
Ok, it looks like 16 quite often is your sprite width.  Make a constant for that and use kSpriteWidth so we (and you!) know what that number means a week from now.
<br/>
<br/>
Oh my.  Is every single one of your variables global?  That will make this nearly impossible to debug - too many points of failure.  Those globals can be changed at any point in the program making debugging nearly impossible.
<br/>
<br/>
112 == ?
<br/>
80 + 15 == ?
<br/>
112 / 16 = ?
<br/>
0x1 = ?
<br/>
<br/>
Ok, reading your comments, 112 and 80 are offsets.  Const them please.  Good code can almost be read in english.
<br/>
<br/>
If forwardBlockUsed is being checked on nearly every value, consider using a switch statement to make this clearer.
<br/>
<br/>
And then at the bottom * 32 , * 32 + 8 ???
<br/>
<br/>
Also, the amount of ifs and elses hurts my head as well.  Strongly consider breaking up this function into a few smaller functions to help partition it against other points of failure.  The idea being, if you get each individual function to work correctly, you don't need to worry about it when debugging other things.
<br/>
<br/>
otmMovable(bgX%MapX/16-1, bgY%MapY/16)
<br/>
<br/>
Are you really, really sure of your order of operations here?  I'm not and I've been coding for many, many years.  Drop these into a local var and use parenthesis.  My guess is there is actually a bug on this line with mod being called when you don't expect it.
<br/>
<br/>
---------------------------------------
<br/>
<br/>
Anyways, what makes you so certain that your bug is in this module/function?  Since you are using globals for everything and are willy/nilly accessing arrays via these global values at will, the error could be anywhere.  You have quite the mess here to clean up before you will be able to effectively debug this.  May I also strongly (very strongly) suggest that you drop asserts all over the place here?  The kind of errors you are describing feel like array overwrite/underwrite issues where you are feeding bogus indexes into your arrays and trashing memory everywhere.  An assert before accessing an array can go a long ways in verifying and debugging this portion of your code.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void acceptUserInput(int passInVarsToNotUseGlobalsPlease)
<br/>
{
<br/>
    if (ForwardBlockUsed &gt; 0) 
<br/>
    { 
<br/>
        handle0Block();
<br/>
        return;
<br/>
    }
<br/>
<br/>
    // Easy to visually mixup ForwardBlockUsed and Unused.  Consider using different var names...
<br/>
    if(ForwardBlockUnused  &gt; 0)
<br/>
    {
<br/>
        DescriptiveFunctionNameForThisCaseBecauseIOnlyTypeItOnce(LocalVar1, LocaVar2, AsManyVarsAsItTakesToGetRidOfGlobalDeath);
<br/>
    }
<br/>
    else
<br/>
    {
<br/>
        DescriptiveFunctionNameForThisCaseAsWellBecauseIOnlyTypeItOnce();
<br/>
    }
<br/>
}
<br/>
<br/>
// And we've removed 1/2 the indentation and isolated some stuff.
<br/>
// Now some sample functions:
<br/>
<br/>
void DescriptiveFunctionNameForThisCaseAsWellBecauseIOnlyTypeItOnce()
<br/>
{
<br/>
    int keystate = keyDown(ALL_KEYS);
<br/>
<br/>
    switch(keyState)
<br/>
    {
<br/>
        case KEY_RIGHT:
<br/>
            handleKeyRightState();
<br/>
            break;
<br/>
        ...
<br/>
        default:
<br/>
            // Bad key state found
<br/>
            assert(false);
<br/>
    }
<br/>
}
<br/>
<br/>
void handleKeyRightState()
<br/>
{
<br/>
    // This allows ease of debugging with watches
<br/>
    int MovableX = ((bgX % MapX) / kSpriteWidth) + 1;
<br/>
    int MovableY = ((bgY % MapY) / kSpriteWidth) + 0;
<br/>
<br/>
   // Actually, there's a syntax error here as otmMovable() isn't surrounded by parenthesis for the if.  Is this supposed to be a comment?
<br/>
    ...
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176386 - MisterLogan - Wed Jul 20, 2011 9:20 pm</h4>
    <div class="postbody"><span class="postbody">Haha, I won't take anything personally, just realize nobody has shown me what things are good and bad, so of course I used global variables, it seemed like the best way to do stuff.
<br/>
<br/>
As far as otm_moveable, that from a friend who was playing with the code at the start of my learning c++, I think he defines it in a header, but there's even more division and such so i planned to remove it (hence the "ignore this").
<br/>
<br/>
I don't know anything about asserts but I'll look up how to use them.
<br/>
<br/>
Thanks again for the help, I'll try and implement your advice later tonight and post what I get.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176387 - MisterLogan - Thu Jul 21, 2011 7:54 am</h4>
    <div class="postbody"><span class="postbody">I almost have everything back to normal with new code, but I'm guessing I have to write my own macro to use asserts?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176391 - gauauu - Thu Jul 21, 2011 3:23 pm</h4>
    <div class="postbody"><span class="postbody">If I remember correctly, libnds comes with an assert function.
<br/>
<br/>
<a class="postlink" href="http://libnds.devkitpro.org/a00141.html#_details" target="_blank">http://libnds.devkitpro.org/a00141.html#_details</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
sassert(somethingThatShouldBeTrue, "That thing wasn't true!");
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You may or may not need to include sassert.h, not sure if that always gets automatically included with the other libnds headers.[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176392 - MisterLogan - Fri Jul 22, 2011 1:40 am</h4>
    <div class="postbody"><span class="postbody">Will that work for the GBA? I found an assert.h buried in devkitadv and included that, I can't seem to get it working though...
<br/>
<br/>
Miked, at one point in you example code you used this here:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int keystate = keyDown(ALL_KEYS);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't have any define for ALL_KEYS in the headers I'm using (the set I'm using is just called "gba.h") but I couldn't find ALL_KEYS in the TONC headers either, so what exactly is ALL_KEYS?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176394 - GLaDOS - Fri Jul 22, 2011 5:45 am</h4>
    <div class="postbody"><span class="postbody">I'd recommend coding it for the PC first and doing debugging there. It's much easier than trying to debug directly on the GBA. 
<br/>
<br/>
<br/>
That's what I did for the game I'm working on right now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176406 - Miked0801 - Fri Jul 22, 2011 6:24 pm</h4>
    <div class="postbody"><span class="postbody">The ALL_KEYS was just an idea for you.  I don't have access nor use the community libs.  I'm forced to work with Nintendo stuff for good or bad, though I haven;t done GBA stuff now for years :)
<br/>
<br/>
If you don't have access to an all keys thingy, then by all means use a if/else chain to check.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176426 - gauauu - Mon Jul 25, 2011 2:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MisterLogan wrote:</b></span></td> </tr> <tr> <td class="quote">Will that work for the GBA? I found an assert.h buried in devkitadv and included that, I can't seem to get it working though...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh, sorry, my brain was in DS mode.  No, I don't believe that will work for GBA.  You may have to make your own.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176431 - wintermute - Wed Jul 27, 2011 12:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MisterLogan wrote:</b></span></td> </tr> <tr> <td class="quote">Will that work for the GBA? I found an assert.h buried in devkitadv and included that, I can't seem to get it working though...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Please tell me you're not using devkitadv
<br/>
<br/>
with devkitARM and libgba the standard assert will work just fine, as it will with libnds for DS code.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;gba.h&gt;
<br/>
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
#include &lt;assert.h&gt;
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
// Program entry point
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
<br/>
<br/>
   // the vblank interrupt must be enabled for VBlankIntrWait() to work
<br/>
   // since the default dispatcher handles the bios flags no vblank handler
<br/>
   // is required
<br/>
   irqInit();
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
<br/>
   consoleDemoInit();
<br/>
   
<br/>
   iprintf("Hello World!\n");
<br/>
<br/>
   assert(1==0);
<br/>
<br/>
   while (1) {
<br/>
      VBlankIntrWait();
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Basically you just need to make sure that stdio is hooked up to enable printing. I think libtonc has stdout/stderr output features somewhere but you'll need to look.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176443 - MisterLogan - Thu Jul 28, 2011 2:59 am</h4>
    <div class="postbody"><span class="postbody">I stopped getting email alerts so I thought this thread didn't have any replies, but I guess it has had a few.
<br/>
<br/>
My original question has become irrelevant due to switching how a lot of things work, mostly to get infinite scrolling maps working and taking miked's advice, but people are telling my about handy stuff in here so I'm going to keep asking a few more questions. In a funny way it was sort of fixed by letting go of the problem for a while and working on something else.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Please tell me you're not using devkitadv</td> </tr></table><span class="postbody">
<br/>
<br/>
I am using devkitadv, I didn't know there was anything wrong with it (or that there was another optio ) and so far it's worked well enough. As they say, if it isn't broken, don't fix it. What are the main differences between them, I'm guessing an actual complete library for various registers is part of it? I ended up mixing the awful headers i was using with the tonc headers, but I would switch again if libgba is better.
<br/>
<br/>
Tonight I'm starting some research into audio, but it seems like a terribly daunting task, anything basic someone new to this should know?
<br/>
<br/>
edit: Noticing a suspicious amount of "WinterMute: Admin" on everything GBA related... :1  guess I'll just go ahead and grab devkitARM.
<br/>
<br/>
<br/>
Thanks everyone.</span><span class="gensmall"><br/><br/>Last edited by MisterLogan on Thu Jul 28, 2011 4:36 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#176444 - Dwedit - Thu Jul 28, 2011 3:33 am</h4>
    <div class="postbody"><span class="postbody">For audio, there's the easy way, and the hard way.
<br/>
<br/>
The easy way: Use Maxmod.  It comes included with the current versions of DevkitArm.
<br/>
The hard way: Write a software music synthesizer, and have a vblank or timer interrupt periodically call a function to fill an audio buffer. 
<br/>
<br/>
<br/>
edit: yay, post #1337<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176445 - Miked0801 - Thu Jul 28, 2011 5:11 am</h4>
    <div class="postbody"><span class="postbody">Lol - leet you are :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176448 - MisterLogan - Fri Jul 29, 2011 1:23 am</h4>
    <div class="postbody"><span class="postbody">One more short question on top of all the others.
<br/>
<br/>
 I'm using the collision maps that MapED exports now, but I wanted to have NPCs walking around so I figured, "Oh, well I'll just have them change values in the collisions array when they move". So I wrote that up, got a compile error (well, many, but one that matters) telling me that the array was const-ed. So I changed that and compiled, and now the background doesn't show up. I have no idea why it affects the background, I don't see them interacting in any way in the code, but sure enough, black background. 
<br/>
<br/>
Does the const change where the array is stored or something? If not a collision array like this, what do people do for object collisions?
<br/>
<br/>
The array is written as "const u16 bgCollision[256][256]ALIGN4 =" if that makes any difference.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176449 - GLaDOS - Fri Jul 29, 2011 5:37 am</h4>
    <div class="postbody"><span class="postbody">Your array is to big to easily fit in memory. It's 128kb. It won't fit in IWRAM at all and it would take up half of EWRAM just by itself.
<br/>
If you make it const, it will probably be placed in ROM where there's much more space available.
<br/>
<br/>
<br/>
Also, the way you handle collisions depends on your exact needs. My game takes an unconventional approach to handling collision data due to the requirements of the advanced physics I'm using.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176451 - MisterLogan - Fri Jul 29, 2011 5:46 am</h4>
    <div class="postbody"><span class="postbody">I know it needs to be in ROM, that's not what I was asking. I would just love to make it const and have it put in ROM but then I can't edit the array, which is the point.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">My game takes an unconventional approach to handling collision data due to the requirements of the advanced physics I'm using.</td> </tr></table><span class="postbody">
<br/>
<br/>
Okay...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176452 - GLaDOS - Fri Jul 29, 2011 5:49 am</h4>
    <div class="postbody"><span class="postbody">Well I can't really tell you what you should do without knowing anything about what you are trying to do.
<br/>
<br/>
One option is to manually check the locations of all NPCs instead of storing them in a collision map.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176453 - MisterLogan - Fri Jul 29, 2011 5:59 am</h4>
    <div class="postbody"><span class="postbody">That might work, I'm going to have a lot of NPCs on each map but I'll be loading/unloading them so they're only active when they get near the actual screen.
<br/>
<br/>
What kind of game are you working on? (if you're free to say that is)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176455 - GLaDOS - Fri Jul 29, 2011 7:16 am</h4>
    <div class="postbody"><span class="postbody">Portal</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176457 - MisterLogan - Fri Jul 29, 2011 8:49 am</h4>
    <div class="postbody"><span class="postbody">:1
<br/>
<br/>
&gt;&gt;GLaDOS
<br/>
<br/>
&gt;&gt;Portal
<br/>
<br/>
Probably should have taken a guess at that one.
<br/>
<br/>
EDIT:
<br/>
I'm off to bed for tonight, thanks for the help on stuff.
<br/>
<br/>
(And then one more question here in the parentheses. I'm switching to devkitARM and libgba and am almost done finding all the register defines and such, but when I try to compile I get errors from any graphics array headers (yeah, I'll stop using headers eventually...) using "ALIGN4". "Expected initializer before 'ALIGN4'" is the error. I'm guessing I just have some syntax that I need to change, or maybe I need to be using .o files or something, I don't really know. Syntax is just "const u16 arrayname[256][256]ALIGN4 = {lots, of, numbers, here};")</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176458 - wintermute - Fri Jul 29, 2011 9:47 am</h4>
    <div class="postbody"><span class="postbody">fwiw, libtonc should work fine with devkitARM, it was written and tested with it. libtonc has many more features than libgba does as well as much more detailed documentation so you might be better off sticking with that.
<br/>
<br/>
For libgba you want ALIGN(4), I guess the 2 extra characters were too much typing for Jasper :p
<br/>
<br/>
Putting graphics in headers is a bad idea, tonc has a section on this - <a class="postlink" href="http://www.coranac.com/tonc/text/bitmaps.htm#ssec-data-hdr" target="_blank">I will not put data in header files</a>. You should probably be using grit directly in your build process (it's included with devkitARM).<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176459 - MisterLogan - Fri Jul 29, 2011 8:59 pm</h4>
    <div class="postbody"><span class="postbody">Alright, I already know where everything is in libtonc so that's good to hear.
<br/>
<br/>
Ah, thanks.
<br/>
<br/>
Hehe, yeah, I keep seeing people talk about how its bad and I'm bad for doing it. I'll get it hooked up soon, I promise! I'm mostly having a hard time doing stuff like this because I have pretty much no knowledge of makefiles, but I guess that just comes with experience.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176472 - MisterLogan - Wed Aug 03, 2011 1:26 am</h4>
    <div class="postbody"><span class="postbody">Another small question for this thread, when doing background transparency, does it use the level of transparency you set in the actual bmp, or do you set it manually by the tile?
<br/>
<br/>
I was hoping to have a gradually more transparent edge to have a sort of nighttime effect but if it works by the tile I guess that won't work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176476 - gauauu - Wed Aug 03, 2011 4:12 pm</h4>
    <div class="postbody"><span class="postbody">Once again, <a class="postlink" href="http://www.coranac.com/tonc/text/objbg.htm" target="_blank">Tonc</a> is your best resource on learning this, but a basic answer:
<br/>
<br/>
Transparency in backgrounds is done by taking whatever color in your palette is color 0, and using that as the transparent color.  It does NOT use transparency information directly from the source image.  And there's no straightforward simple way (without more advanced tricks) of doing a gradual transparent edge to a background tile.
<br/>
<br/>
My recommendation is to use 16-color .png files for your source images, and use the ugly pinkish #FF00FF as your transparent color -- it's somewhat of a standard to use that, as it's not really often found naturally in background or sprite images.  Then use Cearn's Usenti to make sure your image's palette is arranged so that #FF00FF is the first color in the palette.  Then export/convert using grit.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176477 - MisterLogan - Wed Aug 03, 2011 8:30 pm</h4>
    <div class="postbody"><span class="postbody">I read through tonc but I didn't see anything referring to gradual transparency so I figured I would make sure here before throwing out the idea.
<br/>
<br/>
I should have waited until I was more well rested to post that question, I didn't really say what I meant to say. I was wondering about alpha blending at gradual intervals over one tile, but I'm guessing that's not easily done.
<br/>
<br/>
I know normal transparency stuff pretty well. I actually chose FF00FF without knowing it was any sort of standard, I just thought it was easy to remember and I wouldn't ever need it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176479 - Miked0801 - Wed Aug 03, 2011 11:23 pm</h4>
    <div class="postbody"><span class="postbody">You get 1 alpha channel.  You can use the hardware registers to say how much alpha is applied to that channel.  You can then overlay multiple textures to "darken" the alpha to get further alpha.
<br/>
<br/>
Or you HBlank change the alpha per scanline.
<br/>
<br/>
Or you ficker the image on and off at fixed rates per vblank.
<br/>
<br/>
Or you dither.
<br/>
<br/>
Or you use the DS with A3I5 or A5I3 in 3D mode :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176480 - MisterLogan - Thu Aug 04, 2011 12:10 am</h4>
    <div class="postbody"><span class="postbody">What do you mean by multiple textures? Backgrounds at different priorities or several sprites? I've read up on HBlank stuff but I don't understand how I could get the effect I'm looking for with that (unless I missed something majorly). The effect I'm trying to get is darkest in the corners and getting lighter as it moves out, so there's a sort of oval of light extending from the middle to just outside of the screens sides.
<br/>
<br/>
Flickering is a cool idea, do you know for sure that it works and isn't obnoxiously flickery?
<br/>
<br/>
I thought about dithering, it might work, but I don't want to effect a very large area for fear of it being annoying and dithering isn't great for things that small.
<br/>
<br/>
Maybe someday =) I rather like the older hardware right now, I would probably try the gameboy first if there was better documentation.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176481 - sverx - Thu Aug 04, 2011 11:00 am</h4>
    <div class="postbody"><span class="postbody">Using Hblank you could darken the top (and/or bottom) part of the screen, but I guess it won't be easy to darken the left/right borders.
<br/>
You could use a circular flickering window, even if I don't know if the effect will be good enough or it could result annoying for the eye.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176485 - Miked0801 - Thu Aug 04, 2011 7:18 pm</h4>
    <div class="postbody"><span class="postbody">Sorry - sprites.  5 (different shaded) sprites overlayed with 10% alpha should come out to about opaque, but YMMV.
<br/>
<br/>
Flickering works, as long as you keep it to 30hz or perhaps 2:1 or 1:2 for 66%/33%.  More than that and the effect breaks down and becomes annoying.
<br/>
<br/>
For HBlank, you could change the window and alpha blend level per line to do a darker to lighter effect, though this will be very CPU expensive.
<br/>
<br/>
Dithering also works, as long as you don't overlay 2 different dithers on top of each other.  We used this on GBC and it will work on later platforms as well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176487 - MisterLogan - Thu Aug 04, 2011 11:59 pm</h4>
    <div class="postbody"><span class="postbody">I think I'll try out a combination of flickering and dithering and see how it looks. =) Yay.
<br/>
<br/>
You wouldn't happen to know how many 16x16 256 color sprites you can hold in VRAM of the top of your head would you?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176488 - Miked0801 - Fri Aug 05, 2011 4:48 pm</h4>
    <div class="postbody"><span class="postbody">GBA has 32K of Obj RAM.  32K / (16*16*1) = 128 sprites.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
