<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>OAM copy? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > OAM copy?</h2>
<div id="posts">
<div class="post">
    <h4>#17566 - teezeCrost - Wed Mar 10, 2004 9:14 am</h4>
    <div class="postbody"><span class="postbody">Hey folks. Hoping someone can help a newbie out; I'm just trying to decipher what is happening in this tutorial I'm reading. Here's the code I'm reading:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//create an OAM variable and make it point to the address of OAM
<br/>
u16* OAM = (u16*)0x7000000;
<br/>
<br/>
//create the array of sprites (each one is a struct containing 4 attributes)
<br/>
OAMEntry sprites[128];
<br/>
<br/>
//Copy our sprite array to OAM
<br/>
void CopyOAM()
<br/>
{
<br/>
   u16 loop;
<br/>
   u16* temp;
<br/>
   temp = (u16*)sprites;
<br/>
   for(loop = 0; loop &lt; 128*4; loop++)
<br/>
   {
<br/>
      OAM[loop] = temp[loop];
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So I get that temp is a pointer to the 'sprites' array, and that each array element has 4 attributes.. but why loop (128*4) times? nothing in the temp array exists past [128]! How is temp[512] accessing anything?
<br/>
is that some way of accessing the next memory address? 
<br/>
 I'm new to C to, so please bear with me.<br/>_________________<br/>If you think you think outside the box, you're trapped in one.
<br/>
-teezeCrost</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17569 - Lupin - Wed Mar 10, 2004 12:24 pm</h4>
    <div class="postbody"><span class="postbody">you answered the question yourself...
<br/>
<br/>
It is just because OAMEntry is different size than u16... maybe you should use a 32 bit DMA copy, i think that would be faster.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17577 - poslundc - Wed Mar 10, 2004 3:31 pm</h4>
    <div class="postbody"><span class="postbody">Data types are extremely important in C.
<br/>
<br/>
Compare the size of a u16 to the size of an OAMEntry.
<br/>
<br/>
Then realize that your temp variable is a u16 pointer, not an OAMEntry pointer, even though they point to the same location in memory.
<br/>
<br/>
Lupin: There's no way he should be fussing around with the DMA before he understands how a basic memory transfer works. I don't know where you got this notion of yours that speed is so important that you should obfuscate the process.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17578 - Lupin - Wed Mar 10, 2004 3:36 pm</h4>
    <div class="postbody"><span class="postbody">this will copy with dma...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define REG_DMA3SAD               (*(vu32*)0x40000D4)
<br/>
#define REG_DMA3DAD               (*(vu32*)0x40000D8)
<br/>
#define REG_DMA3CNT               (*(vu32*)0x40000DC)
<br/>
<br/>
#define DMA_ENABLE               0x80000000
<br/>
#define DMA_TIMEING_IMMEDIATE      0x00000000
<br/>
#define DMA_32                  0x04000000
<br/>
<br/>
#define DMA_32NOW               DMA_ENABLE | DMA_TIMEING_IMMEDIATE |DMA_32 
<br/>
#define DMA_16NOW               DMA_ENABLE | DMA_TIMEING_IMMEDIATE |DMA_16 
<br/>
<br/>
#define DMACopyCH3(source,dest,wc,mode)      REG_DMA3SAD = (u32)source; \
<br/>
                                   REG_DMA3DAD = (u32)dest; \
<br/>
                                   REG_DMA3CNT = wc | mode;
<br/>
//Copy sprite array to OAM
<br/>
void CopyOAM() {
<br/>
   DMACopyCH3((u32*)sprites,OAM,256,DMA_32NOW);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I know what you mean pos, but he needs to learn dma anyway... I find the DMA way less confusing, this way it is obvious that you copy 256 32 bit values...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17588 - sajiimori - Wed Mar 10, 2004 7:30 pm</h4>
    <div class="postbody"><span class="postbody">You may find DMA less confusing, but iterating over arrays uses only standard C functionality, and is far more general.  If someone is going to develop in C, they'd better know the language first.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17593 - Lupin - Wed Mar 10, 2004 8:47 pm</h4>
    <div class="postbody"><span class="postbody">If someone is going to develop for the GBA, they'd better know the hardware first. ;P
<br/>
<br/>
he may choose what he find better by himself...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17595 - teezeCrost - Wed Mar 10, 2004 9:21 pm</h4>
    <div class="postbody"><span class="postbody">First of all, thanks for the responses!
<br/>
Now, in the following can someone solidify what exactly is being done? With the little experience I have, I would say that temp is pointing to a version of the sprites array that is being type casted as a pointer to an unsigned 16bit int.. How far off am I?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">temp = (u16*)sprites;</td> </tr></table><span class="postbody">
<br/>
<br/>
but then here
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">OAM[loop] = temp[loop];</td> </tr></table><span class="postbody">
<br/>
<br/>
it seems to access temp as if it were a different (than sprites[]) array altogether, which leads me to think that (u16*) is telling it to just point to 16bit chunks.
<br/>
<br/>
Obviously the copy of C for dummies that's been on my shelf for years isn't cutting it. Any suggestions for other newbie-friendly yet thorough books? possibly something that will also touch on c++?<br/>_________________<br/>If you think you think outside the box, you're trapped in one.
<br/>
-teezeCrost</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17597 - Lupin - Wed Mar 10, 2004 9:38 pm</h4>
    <div class="postbody"><span class="postbody">OAM is a 16 bit pointer, sprites is a custom structure. We need the typecast to transfer our custom structure to the 16bit values OAM is pointing to. That's why we need a typecast to temp.
<br/>
<br/>
I am using 32 bit pointers in my dma version because moving 32 bit is faster than moving 16 bit (you move twice the data in nearly the same time).
<br/>
<br/>
So, you were right with temp being a 16 bit pointer and OAM is a 16 bit pointer too.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17599 - teezeCrost - Wed Mar 10, 2004 10:14 pm</h4>
    <div class="postbody"><span class="postbody">Ok so when type casting a variable to a pointer of some number of bits, is the result always accessed as an array?
<br/>
Also, I'm pretty sure I know what the DMA stands for, but could you tell me anyway?<br/>_________________<br/>If you think you think outside the box, you're trapped in one.
<br/>
-teezeCrost</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17600 - Lupin - Wed Mar 10, 2004 10:39 pm</h4>
    <div class="postbody"><span class="postbody">DMA = direct memory access, very fast way to copy data (it is using the GBA hardware)
<br/>
<br/>
When you typecast to a pointer you can access it as you want, depending on how you type casted it. You can typecast to a pointer and then dereference by using the * operator...:
<br/>
<br/>
bla = foo*;
<br/>
<br/>
is the same as...
<br/>
<br/>
bla = foo[0];
<br/>
<br/>
where foo is some valid pointer</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17601 - poslundc - Wed Mar 10, 2004 10:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>teezeCrost wrote:</b></span></td> </tr> <tr> <td class="quote">Ok so when type casting a variable to a pointer of some number of bits, is the result always accessed as an array?</td> </tr></table><span class="postbody">
<br/>
<br/>
Pointers are pointers. They just point to a location in memory. Whether you have a pointer to a u32, a s16, or some other struct, it's just a number that says where in memory some data is located.
<br/>
<br/>
You dereference a pointer by using the dereference operator <span style="font-weight: bold">*</span>. This tells the compiler to go look up and access the value stored in the pointer. This is where the data type comes in: if it's a u16 then the data is interepreted as a 16-bit unsigned number. If it's a struct, it's interpreted as the fields of the struct.
<br/>
<br/>
You can also dereference a pointer by using square (array) brackets. Eg. *p is the same as p[0]. If I use p[1] instead of p[0], it uses the size of the type of "p" to figure out how many bytes further in memory to advance from the pointer "p".
<br/>
<br/>
What's important to understand is that typecasting from one type of pointer to another doesn't change that it is still fundamentally just a pointer to a location in memory. It just changes how the data located at that spot in memory is interpreted.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also, I'm pretty sure I know what the DMA stands for, but could you tell me anyway?</td> </tr></table><span class="postbody">
<br/>
<br/>
Please refer to <a class="postlink" href="http://thepernproject.com/English/tutorial_5.html" target="_blank">Day 5 of the Pern Project Tutorials</a>.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17617 - teezeCrost - Thu Mar 11, 2004 4:44 am</h4>
    <div class="postbody"><span class="postbody">Thanks for everyone's help! I think I actually get it now!<br/>_________________<br/>If you think you think outside the box, you're trapped in one.
<br/>
-teezeCrost</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17621 - sajiimori - Thu Mar 11, 2004 5:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If someone is going to develop for the GBA, they'd better know the hardware first. ;P
<br/>
</td> </tr></table><span class="postbody">
<br/>
I think it's ok to learn by doing as far as the hardware goes, but I agree with tepples that C is a prerequisite for GBA development (if that is to be your language).
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
he may choose what he find better by himself...
<br/>
</td> </tr></table><span class="postbody">
<br/>
Yes, and I agree that DMA is better in this circumstance, but that was not my point.
<br/>
<br/>
Anyway, quick note about the [] operator:  a[i] is merely shorthand for *(a + i).  They are interchangable in all circumstances, so the [] operator is only for readability.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17629 - Lupin - Thu Mar 11, 2004 3:31 pm</h4>
    <div class="postbody"><span class="postbody">sajimori, *(a+i) is not the same as a[i], only if a is a byte pointer (or am i wrong?!).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17631 - poslundc - Thu Mar 11, 2004 3:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">sajimori, *(a+i) is not the same as a[i], only if a is a byte pointer (or am i wrong?!).</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, you are wrong. (Try <a class="postlink" href="http://www.google.com/search?q=pointer+arithmetic" target="_blank">googling pointer arithmetic</a>.)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
