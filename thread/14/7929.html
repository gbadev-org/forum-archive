<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>needing to "make clean" too often - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > needing to "make clean" too often</h2>
<div id="posts">
<div class="post">
    <h4>#65033 - keldon - Thu Dec 29, 2005 6:26 pm</h4>
    <div class="postbody"><span class="postbody">I keep having weird things happen in my code which are solved only by running 'make clean'. Problem is that I am not changing anything out of the ordinary when this is happening. No changes in header files or extra header files included. It is mostly just small changes in some lines of code.
<br/>
<br/>
I have to do this for windows development every now and then after changes to header files but this is happening far too often. Is there any known reason for this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65037 - Peter - Thu Dec 29, 2005 7:53 pm</h4>
    <div class="postbody"><span class="postbody">I guess you can fix it by using header dependencies. I did experience something similar and fixed it with when I enabled header dependencies.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65042 - keldon - Thu Dec 29, 2005 9:14 pm</h4>
    <div class="postbody"><span class="postbody">Would that involve having the headers compiled by themselves too? Could you give me a sample from your makefile?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65102 - wintermute - Fri Dec 30, 2005 2:45 am</h4>
    <div class="postbody"><span class="postbody">Have a look at the devkitPro makefiles included in the examples, they autogenerate dependencies during the build process.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65118 - keldon - Fri Dec 30, 2005 10:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">define adjustdepends
<br/>
cp $(DEPSDIR)/$*.d $(DEPSDIR)/$*.P;
<br/>
<br/>
sed -e 's/#.*//' -e 's/^[^:]*: \+//' -e 's/^ *//' -e 's/ *\\$$//' -e '/^$$/ d' -e 's/$$/ :/' &lt; $(DEPSDIR)/$*.P &gt;&gt; $(DEPSDIR)/$*.d;
<br/>
rm $(DEPSDIR)/$*.P
<br/>
endef</td> </tr></table><span class="postbody">
<br/>
Is this a regular expression which searches header files for header includes? And does this mean I need a .d file listing headers dependencies?
<br/>
<br/>
Also I am guessing that DEPSDIR is the directory to my dependency files.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65125 - Touchstone - Fri Dec 30, 2005 1:48 pm</h4>
    <div class="postbody"><span class="postbody">There's a parameter you can pass to the C compiler in GCC that'll make it preprocess your .c file and generate a list of all the header files that your source file is dependant on.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65135 - Peter - Fri Dec 30, 2005 4:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">Could you give me a sample from your makefile?</td> </tr></table><span class="postbody">
<br/>
I'm using DevKitPro, but not its makefile system. I use the makefile-system from HAM instead. Here is the line to enable header dependencies (hope I found the right one, heh):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
ASFLAGS += -MD $(*D)/$(*F).d
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65143 - wintermute - Fri Dec 30, 2005 4:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">define adjustdepends
<br/>
cp $(DEPSDIR)/$*.d $(DEPSDIR)/$*.P;
<br/>
<br/>
sed -e 's/#.*//' -e 's/^[^:]*: \+//' -e 's/^ *//' -e 's/ *\\$$//' -e '/^$$/ d' -e 's/$$/ :/' &lt; $(DEPSDIR)/$*.P &gt;&gt; $(DEPSDIR)/$*.d;
<br/>
rm $(DEPSDIR)/$*.P
<br/>
endef</td> </tr></table><span class="postbody">
<br/>
Is this a regular expression which searches header files for header includes?
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
No, that expression parses the compiler generated dependency files and adds all the prerequisites as targets with no rules or prerequisites. This prevents errors when headers that are no longer used are deleted. See <a href="http://make.paulandlesley.org/autodep.html#norule" target="_blank">http://make.paulandlesley.org/autodep.html#norule</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
 And does this mean I need a .d file listing headers dependencies?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
No, the dependency files are generated as part of the compile process.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o: %.cpp
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(CXX) -MMD -MF $(DEPSDIR)/$*.d $(CXXFLAGS) -c $&lt; -o $@
<br/>
   @$(adjustdepends)
<br/>
   
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o: %.c
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(CC) -MMD -MF $(DEPSDIR)/$*.d $(CFLAGS) -c $&lt; -o $@
<br/>
   @$(adjustdepends)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o: %.s
<br/>
   @echo $(notdir $&lt;)
<br/>
   $(CC) -MMD -MF $(DEPSDIR)/$*.d -x assembler-with-cpp $(ASFLAGS) -c $&lt; -o $@
<br/>
   @$(adjustdepends)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o: %.S
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(CC) -MMD -MF $(DEPSDIR)/$*.d -x assembler-with-cpp $(ASFLAGS) -c $&lt; -o $@
<br/>
   @$(adjustdepends)
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
As it happens, the adjustdepends sed-fu is no longer required, gcc now provides the -MP option which does the same thing.
<br/>
<br/>
<a href="http://gcc.gnu.org/onlinedocs/gcc-4.0.2/gcc/Preprocessor-Options.html#Preprocessor-Options" target="_blank">http://gcc.gnu.org/onlinedocs/gcc-4.0.2/gcc/Preprocessor-Options.html#Preprocessor-Options</a>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Also I am guessing that DEPSDIR is the directory to my dependency files.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, this is defined in the main Makefile, it defaults to $BUILD in the templates.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65317 - keldon - Mon Jan 02, 2006 12:46 am</h4>
    <div class="postbody"><span class="postbody">Thanks; I will look into this later in the week.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
