<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Mode 0 backgrounds - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Mode 0 backgrounds</h2>
<div id="posts">
<div class="post">
    <h4>#14468 - WillyWonka - Wed Jan 07, 2004 5:07 am</h4>
    <div class="postbody"><span class="postbody">I'm having trouble trying to copy sonic where they use Mode 0 to display bitmap backgrounds with transparencies, but I can't seem to get the backgrounds displaying properly.  I think it's something to do with the char and screen base blocks but I'm not sure.  (I'm following the GBA Junkie tutorials)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   bg2.number = 2;
<br/>
   bg2.charBaseBlock = 0;
<br/>
   bg2.screenBaseBlock = 28;
<br/>
   bg2.colorMode = BG_COLOR_256;
<br/>
   bg2.size = TEXTBG_SIZE_512x256;
<br/>
   bg2.mosaic = 0;
<br/>
   bg2.x_scroll = 0;
<br/>
   bg2.y_scroll = 0;
<br/>
<br/>
   EnableBackground( &amp;bg2 );
<br/>
<br/>
   // Palette
<br/>
   for(loop = 0; loop &lt; 256; loop++) {
<br/>
      BGPaletteMem[loop] = eightlinesPalette[loop];
<br/>
   }
<br/>
<br/>
   // Tiles
<br/>
   for(loop = 0; loop &lt; eightlines_width * eightlines_height * 0.5; loop++)  {
<br/>
      bg2.tileData[loop] = eightlinesData[loop];
<br/>
   }
<br/>
<br/>
   temp = (u16*)eightlinesMap;
<br/>
   for(loop = 0; loop &lt; 16*16/2; loop++) {
<br/>
      bg2.mapData[loop] = temp[loop];
<br/>
   }
<br/>
<br/>
   while(1) {
<br/>
      GetInput();
<br/>
      WaitForVsync();
<br/>
      UpdateBackground(&amp;bg2);
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The palette is coming in fine.  I'm getting some of the tiles in (I'm not sure they're in the right order, but I can see them there).  The problem is all I'm seeing on the screen is tile #0.
<br/>
<br/>
I generated the map file and it looks like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const u8 eightlinesMap[ 64 * 32 ] = {
<br/>
0x00,0x01,...};</td> </tr></table><span class="postbody">
<br/>
<br/>
Anyone have any idea as to why I'm not seeing any tiles other then 0 on the screen?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14477 - sgeos - Wed Jan 07, 2004 5:47 am</h4>
    <div class="postbody"><span class="postbody">Have you copied your map "file" to the screen base block you want your bg to use?  There are a lot of functions that are called but not posted.
<br/>
<br/>
Will this help any?  temp is a pointer to u16, right?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">temp = (u16 *)(&amp;eightlinesMap[0]); </td> </tr></table><span class="postbody">
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14479 - WillyWonka - Wed Jan 07, 2004 6:03 am</h4>
    <div class="postbody"><span class="postbody">The functions that I'm calling are from the tutorial (I know they work).
<br/>
<br/>
These are the first couple lines of EnableBackground.  It's pointing bg2.mapData array to the background....
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void EnableBackground(Bg* bg)
<br/>
{
<br/>
   u16 temp;
<br/>
<br/>
   bg-&gt;tileData = (u16*)CharBaseBlock(bg-&gt;charBaseBlock);
<br/>
   bg-&gt;mapData = (u16*)ScreenBaseBlock(bg-&gt;screenBaseBlock);
<br/>
   temp = bg-&gt;size | (bg-&gt;charBaseBlock&lt;&lt;CHAR_SHIFT) | (bg-&gt;screenBaseBlock&lt;&lt;SCREEN_SHIFT)
<br/>
      | bg-&gt;colorMode | bg-&gt;mosaic | bg-&gt;wraparound;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The update function just updats the x, y offsets of the background every frame.
<br/>
<br/>
As for temp, yes it is a pointer to a u16, no that code didn't help.  I did try moving the enablebackground to below where the information is copied into it and now I get a white screen and no tiles in the tile memory.  I think the screen might be overwriting the tile data in this case... dunno.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14521 - sajiimori - Wed Jan 07, 2004 11:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The functions that I'm calling are from the tutorial (I know they work).
<br/>
</td> </tr></table><span class="postbody">
<br/>
It's not so much about whether they work, it's a matter of whether they will do what you expected given the code you posted.  If we can't see the actual work that is being done, there is no way for us to know what is wrong.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
temp = (u16 *)(&amp;eightlinesMap[0]); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
That code is exactly equivalent to the original.  '&amp;arrayname[0]' is the same as 'arrayname'.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I did try moving the enablebackground to below where the information is copied into it and now I get a white screen and no tiles in the tile memory.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Well sure, the pointers in the bg struct are garbage (or null) until you call EnableBackground(), so writing to those addresses wouldn't do anything useful.
<br/>
<br/>
How are you setting the video mode?  Are any other backgrounds enabled in REG_DISPCNT?  If BG0 or BG1 are enabled, you could get the result you describe.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14620 - WillyWonka - Fri Jan 09, 2004 11:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">How are you setting the video mode? Are any other backgrounds enabled in REG_DISPCNT? If BG0 or BG1 are enabled, you could get the result you describe.</td> </tr></table><span class="postbody">
<br/>
<br/>
The video mode is getting set fine.  Only background 2 is enabled.
<br/>
<br/>
Essentially it's this that is enabling it...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define BG2_ENABLE   0x400
<br/>
REG_DISPCNT |= BG2_ENABLE;</td> </tr></table><span class="postbody">
<br/>
<br/>
I've reworked things and I believe my problem lies with the format of the map files.  I can't seem to find a map editor that works.  They all seem to produce different code when outputting and I can't figure out what code works with any particular editor.
<br/>
<br/>
Anyone have a good map editor?  I tried that beta 4 one but it's buggy and I can't figure which mode to use 8x8 or 16x16
<br/>
[/quote]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14621 - dagamer34 - Fri Jan 09, 2004 11:37 pm</h4>
    <div class="postbody"><span class="postbody">This line...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(loop = 0; loop &lt; eightlines_width * eightlines_height * 0.5; loop++)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You are getting junk (and this is SOO SLOW) because it uses a floating point number. Actually, nothing is loaded (wow, I think I solved your problem), because the number is represented as 0. Maybe you tried to optimize this routine, but there is a reason why we all do this.
<br/>
<br/>
By the way, there is a certain way text backgrounds. It works in blocks... Check the Pern Project tutorials Day 4 and READ all of it. I think floating somewhere around here is the code.
<br/>
<br/>
You're welcome!!!!<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14624 - WillyWonka - Sat Jan 10, 2004 12:45 am</h4>
    <div class="postbody"><span class="postbody">Oh oh!  I got something!!!
<br/>
<br/>
Thank you!  I put * 0.5 because I heard that there was no divide in the gameboy and it made it slow. I guess decimal is worse to use then divide :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14625 - yaustar - Sat Jan 10, 2004 12:50 am</h4>
    <div class="postbody"><span class="postbody">I use Map editor by nessie...
<br/>
<br/>
<a href="http://nessie.gbadev.org/" target="_blank">http://nessie.gbadev.org/</a><br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14626 - sajiimori - Sat Jan 10, 2004 12:51 am</h4>
    <div class="postbody"><span class="postbody">Yeah, multiplying by 0.5 will require fp emulation, so you'll normally want to divide by 2 instead (which will compile to a bit shift).  Anyway, the speed is not really important here.
<br/>
<br/>
dagamer34, you're getting ahead of yourself (and full of yourself as usual).  What makes you think this expression evaluates to zero?  Of course I can't say it doesn't -- Willy never posted the definitions of those variables.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
eightlines_width * eightlines_height * 0.5
<br/>
</td> </tr></table><span class="postbody">
<br/>
Besides, the OP said the tiles were being loaded correctly.  It's just that the screen was being filled with tile 0.  Also, the fact that BG maps are paged cannot explain the problem because it looks like this map is only 16x16 characters.
<br/>
<br/>
WillyWonka, I can't tell what's wrong with your code unless you post more.  Until then, you can take your program apart and use VBA to find the code where things aren't happening the way you expected.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14628 - yaustar - Sat Jan 10, 2004 1:02 am</h4>
    <div class="postbody"><span class="postbody">How is the map a
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bg2.size = TEXTBG_SIZE_512x256;
<br/>
</td> </tr></table><span class="postbody">
<br/>
and 16x16
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(loop = 0; loop &lt; 16*16/2; loop++) {
<br/>
      bg2.mapData[loop] = temp[loop];
<br/>
   } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
at the same time?
<br/>
<br/>
;)
<br/>
<br/>
edit: is it also a rotation map as well?<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14707 - WillyWonka - Sun Jan 11, 2004 9:42 pm</h4>
    <div class="postbody"><span class="postbody">Well the background is set to 512x256 but I've found out that I can only draw 256 tiles (16 * 16).  I'm trying to change the CharBaseBlock so that I can draw the entire screen, but I wind up getting the 3rd set of tiles displayed 3 times on the screen.  Anyone know what I'm doing wrong this time?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   for (tileSet = 0; tileSet &lt; 3; tileSet++) {
<br/>
      bg2.charBaseBlock = tileSet;
<br/>
      updateCharBaseBlock( &amp;bg2 );
<br/>
      for(loop = 0; loop &lt; 16*16; loop++) {
<br/>
         bg2.mapData[(tileSet * 256) + loop] = temp[(tileSet * 256) + loop];
<br/>
      }
<br/>
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And here is my copy &amp; paste crap code (That could probably be cut down to 1 line) for updateCharBaseBlock
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void updateCharBaseBlock(Bg* bg) {
<br/>
   u16 temp;
<br/>
   bg-&gt;tileData = (u16*)CharBaseBlock(bg-&gt;charBaseBlock);
<br/>
   temp = bg-&gt;size | (bg-&gt;charBaseBlock&lt;&lt;CHAR_SHIFT) | (bg-&gt;screenBaseBlock&lt;&lt;SCREEN_SHIFT)
<br/>
                   | bg-&gt;colorMode | bg-&gt;mosaic | bg-&gt;wraparound;
<br/>
<br/>
   switch(bg-&gt;number) {
<br/>
      case 0:
<br/>
         {
<br/>
            REG_BG0CNT = temp;
<br/>
         } break;
<br/>
      case 1:
<br/>
         {
<br/>
            REG_BG1CNT = temp;
<br/>
         } break;
<br/>
      case 2:
<br/>
         {
<br/>
            REG_BG2CNT = temp;
<br/>
         } break;
<br/>
      case 3:
<br/>
         {
<br/>
            REG_BG3CNT = temp;
<br/>
         } break;
<br/>
<br/>
   default:break;
<br/>
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14708 - dagamer34 - Sun Jan 11, 2004 10:02 pm</h4>
    <div class="postbody"><span class="postbody">Full of myself??? That's a new one. So far I have helped about 10 people so give me some credit.
<br/>
<br/>
There isn't any need for the updateCharBaseBlock function. In Enablebackground (), all it does it set the correct location of memory for the pointer for you to copy data correctly.
<br/>
<br/>
This line:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(loop = 0; loop &lt; 16*16; loop++) { 
<br/>
         bg2.mapData[(tileSet * 256) + loop] = temp[(tileSet * 256) + loop]; 
<br/>
      } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not exactly sure what you are trying to do but I will help if possible. THe 256 should be changed to a 32 because you are working with tiles, not pixels. Otherwise, yeah, I think you are good to go!![/quote]<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14710 - WillyWonka - Sun Jan 11, 2004 10:12 pm</h4>
    <div class="postbody"><span class="postbody">I'm trying to display a photo that is full screen.  The problem is I can only use 256 tiles and then the charBaseBlock needs to be increased by one (At least that's what I understand).
<br/>
<br/>
To fill the screen with tiles it looks like I have to draw around 256 + 256 + 128 tiles.
<br/>
<br/>
When I setup the loop to draw 32 * 32 I wind up with the same 1/3rd of the image drawn on the screen 3 times.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14717 - yaustar - Sun Jan 11, 2004 11:55 pm</h4>
    <div class="postbody"><span class="postbody">First thing's first, we are in mode_0 so lets sort out the bg size
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bg2.size = TEXTBG_SIZE_256x256;</td> </tr></table><span class="postbody">
<br/>
Where are we calling
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for (tileSet = 0; tileSet &lt; 3; tileSet++) {
<br/>
      bg2.charBaseBlock = tileSet;
<br/>
      updateCharBaseBlock( &amp;bg2 );
<br/>
      for(loop = 0; loop &lt; 16*16; loop++) {
<br/>
         bg2.mapData[(tileSet * 256) + loop] = temp[(tileSet * 256) + loop];
<br/>
      }
<br/>
<br/>
   } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
in the while(1) loop or before?
<br/>
<br/>
The 256 unique tile restriction is when you are using rotation maps which is not the case here.
<br/>
<br/>
I have done a similar thing on my code and mine set out to
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
        str_bgLayer[0].charBaseBlock = 3;//tile data target block 3
<br/>
        str_bgLayer[0].bgPriority = 3;
<br/>
        str_bgLayer[0].colorMode = BG_COLOR_16;//colour mode is 16 colour tiles
<br/>
        str_bgLayer[0].mosaic = 0;//mosiac mode off
<br/>
        str_bgLayer[0].number = 0;//first layer (0)
<br/>
        str_bgLayer[0].screenBaseBlock = 0;//target block for map data. MUST be in 
<br/>
                                           //a different Char block to tile &amp; palette data
<br/>
        str_bgLayer[0].size = TEXTBG_SIZE_256x256;//size of map is 512x512
<br/>
        str_bgLayer[0].x_scroll = 0;
<br/>
        str_bgLayer[0].y_scroll = 0;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The char base block was enough to hold over 800 unique <span style="font-weight: bold">16</span> colour tiles.
<br/>
<br/>
Unless you have a reason for the loop, it should be possible to process it normally.
<br/>
<br/>
If I am wrong, give me a slap round the head and correct me please.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14718 - sajiimori - Mon Jan 12, 2004 12:00 am</h4>
    <div class="postbody"><span class="postbody">It seems like your code is only getting more complicated.  There is still no way to tell what you're doing wrong.
<br/>
<br/>
If you still have trouble, I'd say start over and try to do things as simply as possible, without trying to conform to somebody else's functions and data structures (like all that bg stuff).  Do some smaller experiments, and make sure you understand each concept before moving on.
<br/>
<br/>
I think you'll find that your task is much simpler than you think, and you can accomplish what you're going for with a fraction of the code -- which is a very satisfying feeling. =)
<br/>
<br/>
For starters, why don't you use a bitmap mode if you're displaying a bitmap?
<br/>
<br/>
dagamer34, it's a "new one" because, in my experience, people around here are very polite.  On the other hand, I'm not polite at all, so I don't mind telling you that considering how great you think you are, you're one of the least helpful and least informed people I've encountered on this board.
<br/>
<br/>
Cheers!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14719 - WillyWonka - Mon Jan 12, 2004 12:04 am</h4>
    <div class="postbody"><span class="postbody">I'm in 256 colour mode.  Not 16.  Is that a problem?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bg2.colorMode = BG_COLOR_256;</td> </tr></table><span class="postbody">
<br/>
<br/>
It's called before the while loop.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Unless you have a reason for the loop, it should be possible to process it normally. </td> </tr></table><span class="postbody">
<br/>
<br/>
Is there some way to copy the chunk of memory all at once?
<br/>
<br/>
<br/>
Mode 0
<br/>
Background 2
<br/>
  Colours 256
<br/>
CharBaseBlock 0
<br/>
  The loaded Tiles span over 3 base blocks
<br/>
  0x6000000, 0x6004000, and 0x6008000
<br/>
<br/>
I am trying to display all of the tiles on the one background layer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14720 - WillyWonka - Mon Jan 12, 2004 12:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It seems like your code is only getting more complicated.</td> </tr></table><span class="postbody">
<br/>
It's not really.  It's just got a lot of crap commented out now.  I think it just seems like it because I'm just posting portions of the program into this thread and it's changing over time.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">For starters, why don't you use a bitmap mode if you're displaying a bitmap? </td> </tr></table><span class="postbody">
<br/>
<br/>
Well, it's because I was looking at the intro screens on Sonic and they never go out of mode 0 &amp; 1.  They have what appear to be full screen images, but I just realized now that they actually aren't.  So what I'm trying to do might not actually be possible even though I thought sonic did it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14722 - yaustar - Mon Jan 12, 2004 12:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>WillyWonka wrote:</b></span></td> </tr> <tr> <td class="quote">I'm in 256 colour mode.  Not 16.  Is that a problem?
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bg2.colorMode = BG_COLOR_256;</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
It just means you have to use twice as much memory.
<br/>
<br/>
I am not sure but doesnt the Char base Blocks 'overflow' into the next if it gets 'full'?
<br/>
<br/>
edit: <a href="http://forum.gbadev.org/viewtopic.php?t=1896&amp;highlight=char+base" target="_blank">http://forum.gbadev.org/viewtopic.php?t=1896&amp;highlight=char+base</a> I thought I asked this some time ago.....<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14724 - dagamer34 - Mon Jan 12, 2004 1:05 am</h4>
    <div class="postbody"><span class="postbody">You're trying to mimic Sonic? One thing is that Sonic Advance was developed by a company not 1 person, who have access to official docs for the GBA (not that we can't get our hands on some).
<br/>
<br/>
How complex is your picture? Are you trying to mimic the "SEGA" screen because you have to realize that most of it is white space. There wasn't any need for more tiles than what you can cram in 1 char base block.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14725 - tepples - Mon Jan 12, 2004 1:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">For starters, why don't you use a bitmap mode if you're displaying a bitmap?</td> </tr></table><span class="postbody">
<br/>
Sure, a scrolling playfield in front of a bitmap background could be constructed with sprites, but then you're down to 16 KB of VRAM to store all the tiles for your playfield, and you'll probably have to use HDMA to OAM. Even then, what about displaying rot/scale stuff in front of the bitmap?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14726 - WillyWonka - Mon Jan 12, 2004 1:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You're trying to mimic Sonic?</td> </tr></table><span class="postbody">
<br/>
The video modes and techniques they use, yes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">How complex is your picture?</td> </tr></table><span class="postbody">
<br/>
It's a 240x160x256 photograph.  Every tile is different and it fills the full screen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14730 - LOst? - Mon Jan 12, 2004 1:48 am</h4>
    <div class="postbody"><span class="postbody">[quote="WillyWonka"]</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You're trying to mimic Sonic?</td> </tr></table><span class="postbody">
<br/>
The video modes and techniques they use, yes.
<br/>
<br/>
Me too :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14732 - sajiimori - Mon Jan 12, 2004 2:06 am</h4>
    <div class="postbody"><span class="postbody">Anybody else getting the impression that this thread is going nowhere?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "gba.h"
<br/>
<br/>
#define TILE_SHIFT     2
<br/>
#define TILE_BLOCK(n)  (((n)*0x4000)+0x6000000)
<br/>
#define MAP_BLOCK(n)   (((n)*0x800)+0x6000000)
<br/>
<br/>
#define DMACPY16(dst,src,len) \
<br/>
  REG_DM3SAD = (int)(src), \
<br/>
  REG_DM3DAD = (int)(dst), \
<br/>
  REG_DM3CNT = (len) | DMA_ENABLE
<br/>
<br/>
#define HWMAP_CHAR_W    32
<br/>
#define SCREEN_CHAR_W   (240/8)
<br/>
#define SCREEN_CHAR_H   (160/8)
<br/>
#define SCREEN_CHARS    (SCREEN_CHAR_W*SCREEN_CHAR_H)
<br/>
#define BYTES_PER_CHAR  32
<br/>
#define TILE_DATA_SIZE  (SCREEN_CHARS*BYTES_PER_CHAR)
<br/>
<br/>
extern u16 bg_palette[256];
<br/>
extern u8 tile_data[TILE_DATA_SIZE];
<br/>
<br/>
// last 2 map columns are offscreen
<br/>
extern u16 map_data[HWMAP_CHAR_W*SCREEN_CHAR_H];
<br/>
<br/>
main()
<br/>
{
<br/>
    DMACPY16(BG_PALETTE,
<br/>
             bg_palette,
<br/>
             256);
<br/>
    DMACPY16(TILE_BLOCK(2),
<br/>
             tile_data,
<br/>
             TILE_DATA_SIZE/2);
<br/>
    DMACPY16(MAP_BLOCK(0),
<br/>
             map_data,
<br/>
             SCREEN_CHARS);
<br/>
    REG_BG0CNT = 2 &lt;&lt; TILE_SHIFT;
<br/>
    REG_DISPCNT = BG0_ENABLE;
<br/>
<br/>
    while(1);
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14735 - WillyWonka - Mon Jan 12, 2004 2:49 am</h4>
    <div class="postbody"><span class="postbody">Sajimori, what are BG_PALETTE and DMA_ENABLE's values?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14736 - yaustar - Mon Jan 12, 2004 3:31 am</h4>
    <div class="postbody"><span class="postbody">looking at the mapdata that I asked for, your data refers to tile numbers 256 and beyond. The text background register only indexes 0-255. This means that I was incorrect before (sorry) the 256 UNIQUE tile limit refers to both types of backgrounds.
<br/>
<br/>
As how to fix it ......erm...<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14737 - dagamer34 - Mon Jan 12, 2004 3:41 am</h4>
    <div class="postbody"><span class="postbody">Actually, tile backgrounds have an extra 8 bits which allows you to have 1024 unique tiles. Rot backgrounds are only 8-bit. Text is 16-bit. Note that these limitations are for 16-color tiles. Divide by 2 for 256.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14738 - yaustar - Mon Jan 12, 2004 3:51 am</h4>
    <div class="postbody"><span class="postbody">*re-reading the pern tut* oops, I was right the rest time... &gt;.&lt; then I am at a complete lost. THe map data looks sound and the code is sound (i think)......<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14745 - yaustar - Mon Jan 12, 2004 6:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yaustar wrote:</b></span></td> </tr> <tr> <td class="quote">looking at the mapdata that I asked for, your data refers to tile numbers 256 and beyond. The text background register only indexes 0-255. This means that I was incorrect before (sorry) the 256 UNIQUE tile limit refers to both types of backgrounds.
<br/>
<br/>
As how to fix it ......erm...</td> </tr></table><span class="postbody">
<br/>
<br/>
I was partially right (frame of mind any how) it was nt the text register at fault. It was the map editer export
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u8 t1[ 32 * 32 ] = {
<br/>
.............
<br/>
0xE0,0xE1,0xE2,.......
<br/>
0x100,0x101,0x102,...........
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
I cant believe I didnt see it sooner......<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14778 - WillyWonka - Mon Jan 12, 2004 7:25 pm</h4>
    <div class="postbody"><span class="postbody">Yeah!  I got it working.
<br/>
<br/>
Switching to MapEd and then modifying the file format (That's a cool feature) to match GBAMapEditor Beta 4's output did the trick.  
<br/>
<br/>
(Well I have some image corruption on the last line of the image, but that's probably my fault)
<br/>
<br/>
WOO HOO!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14781 - yaustar - Mon Jan 12, 2004 7:53 pm</h4>
    <div class="postbody"><span class="postbody">or you can change map4 beta export from 'const u8' to const <span style="font-weight: bold">u16</span>....<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
