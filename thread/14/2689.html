<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DEVKIT ADVANCE - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > DEVKIT ADVANCE</h2>
<div id="posts">
<div class="post">
    <h4>#15115 - gbawiz - Sat Jan 17, 2004 3:40 pm</h4>
    <div class="postbody"><span class="postbody">Hello all,
<br/>
I have reached the point where I want to use GBA interrupts. I am using the devkit advance compiler and am having difficulty.
<br/>
Until now i have been using a batch file to compile my programs as follows:
<br/>
-------------------------------------------
<br/>
set path=C:\devkitadv\bin;%path%
<br/>
gcc -o main.elf main.c -lm
<br/>
objcopy -O binary main.elf main.gba
<br/>
pause
<br/>
------------------------------------------
<br/>
I know that in order to use interrupts then I will have to use my own vertsion of crto.s (crto.o bin)with the interrupts enabled as the devkit's own crto.o has them disabled.
<br/>
I used the '-nostartfiles' option and added the crtbegin.o crtend.o and crto.o files to my directory as well as in the command line options.
<br/>
as a test I used the crto.o from the devkit advance and compiled my old programs in this new way. (i.e tried disabling startfiles and then refering to them in my command line).
<br/>
They compile but dont seem to work.
<br/>
If i cant get my old programs working on this new method then I cant get my new interrupt enabled programs working when i include my own crto.s
<br/>
<br/>
can anyone help?
<br/>
Many thanks
<br/>
GbaWIZ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15120 - tepples - Sat Jan 17, 2004 4:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gbawiz wrote:</b></span></td> </tr> <tr> <td class="quote">I know that in order to use interrupts then I will have to use my own vertsion of crto.s (crto.o bin)with the interrupts enabled as the devkit's own crto.o has them disabled.</td> </tr></table><span class="postbody">
<br/>
No you don't. You can write your own ISR, compile it to ARM code, stick it in IWRAM, and handle interrupts from that. See the CowBite spec for more information on what an ISR needs to do.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15125 - poslundc - Sat Jan 17, 2004 5:23 pm</h4>
    <div class="postbody"><span class="postbody">Or you can just enable interrupts in the crt0.S that comes with devkitadvance.
<br/>
<br/>
Just open the file in a text editor - the comments expain everything.
<br/>
<br/>
(But tepples is correct that interrupts are not something that need to be associated with crt0.S, it's just done that way for convenience's sake in DKA.)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15190 - gbawiz - Sun Jan 18, 2004 8:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gbawiz wrote:</b></span></td> </tr> <tr> <td class="quote">I know that in order to use interrupts then I will have to use my own vertsion of crto.s (crto.o bin)with the interrupts enabled as the devkit's own crto.o has them disabled.</td> </tr></table><span class="postbody">
<br/>
No you don't. You can write your own ISR, compile it to ARM code, stick it in IWRAM, and handle interrupts from that. See the CowBite spec for more information on what an ISR needs to do.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks for replying,
<br/>
I have done some reading and found that when any interrupt occurs then the CPU will branch to the address 0x3007FFC then read the contents of that location as an address, then jump to that address which contains the start of the Interrupt service routine.
<br/>
Is that correct?
<br/>
Also you mentioned IWRAM for storing the ISR, why not ROM cartridge?
<br/>
Do you have an ISR example which i can use for testing.
<br/>
Another thing i was curious about is what instruction is used to indicate that the ISR has finished and should return to main program?
<br/>
<br/>
Thanks again :)
<br/>
GbaWIZ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15194 - tepples - Sun Jan 18, 2004 8:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gbawiz wrote:</b></span></td> </tr> <tr> <td class="quote">I have done some reading and found that when any interrupt occurs then the CPU will branch to the address 0x3007FFC then read the contents of that location as an address, then jump to that address which contains the start of the Interrupt service routine.</td> </tr></table><span class="postbody">
<br/>
Right.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also you mentioned IWRAM for storing the ISR, why not ROM cartridge?</td> </tr></table><span class="postbody">
<br/>
Two reasons:<ul><li>IWRAM is faster to access, and speed is critical in an ISR.</li><li>ROM will not be present if a "cart removed" interrupt has occurred.</li></ul>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Do you have an ISR example which i can use for testing.</td> </tr></table><span class="postbody">
<br/>
No warranty that you'll understand it, but <a class="postlink" href="http://www.pineight.com/gba/#tod" target="_blank">Tetanus On Drugs</a> has an ISR.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15206 - gbawiz - Mon Jan 19, 2004 1:58 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the advice,
<br/>
I had a look at the program you mentioned with the ISR and have noticed that there is an ISR function created in C and there is a pointer to that function created and stored in the address 0x03007FFC mentioned earlier.
<br/>
The pointer shows that the ISR function is stored at address 0x020060C8 which is in the onboard WRAM.
<br/>
<br/>
How is it possible to tell the program to place the ISR code into this address in the WRAM as I cant find any routine which copies the routine into that specific address 0x020060C8.
<br/>
I assume that the routine is copied from rom into the WRAM at this address somehow which is not stated in the source code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15209 - tepples - Mon Jan 19, 2004 3:02 am</h4>
    <div class="postbody"><span class="postbody">For one thing, TOD is a multiboot program, which automatically gets copied into 0x02000000 (EWRAM) either before it runs (if you're running it from PogoShell, Multiboot Menu, or over a cable) or first thing (if you're running it by itself or from a typical flash cart loader). DevKit Advance's standard crt0 startup code, based on Jeff F's, then proceeds to copy an audio mixer into IWRAM for speed.
<br/>
<br/>
I now notice that I did leave TOD's ISR in EWRAM. But for speed's sake, you will probably want your ISR to be in IWRAM. See <a class="postlink" href="http://www.devrs.com/gba/files/gbadevfaqs.php#IntRamCode" target="_blank">the relevant section of Jeff F's GBA Dev FAQ</a> to see how to do this. I may have made a mistake in neglecting to do this in TOD; I probably didn't notice it because it only ever uses one interrupt (VBlank).
<br/>
<br/>
Under DKA R5 beta 3 (the latest version, which does work well for me), you should compile an ISR like so:
<br/>
<br/>
gcc -Wall -O3 -marm -mthumb-interwork -c isr.c -o isr.iwram.o
<br/>
<br/>
Key points: <span style="font-weight: bold">-marm</span> instead of -mthumb and an object file name that ends in <span style="font-weight: bold">.iwram.o</span>, which the linker picks up as a cue to schedule it for copying to IWRAM once crt0 gets control. The -mthumb-interwork is strictly necessary only for an ISR that long-calls back to Thumb code in ROM, but in any case, it has little to no effect on the performance of leaf procedures such as many ISRs, and it helps keep the linker from female dogging about an interworking mismatch. You can replace -O3 by <span style="font-weight: bold">-Os</span> (optimize for size) should you start to run low on IWRAM.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
