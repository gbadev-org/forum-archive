<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Memory pointer - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Memory pointer</h2>
<div id="posts">
<div class="post">
    <h4>#35301 - WillyWonka - Wed Feb 02, 2005 8:01 pm</h4>
    <div class="postbody"><span class="postbody">I'm trying to load a level from Mappy into my code which uses <a href="http://devkit.tk" target="_blank">http://devkit.tk</a> libgba.
<br/>
<br/>
The mappy code says this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   DISPCNT = DISP_MODE (0);
<br/>
<br/>
   BG0CNT = BG_CHARBASE_0x06004000 | BG_COLOUR_256 | BG_TEXT_32x32 | BG_MAPBASE(0x0000);</td> </tr></table><span class="postbody">
<br/>
<br/>
And I'm trying to convert it.  This is what I have:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   SetMode( MODE_0 | BG0_ON | BG_256_COLOR | BG_SIZE_0 );
<br/>
   while (1) { VBlankIntrWait();}      // loop forever
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
VisualBoyAdv tells me that it's going into Mode 0 alright, BG0 is on (But the others appear to be on as well).  The map is 256x256.  It says that it's in 16 colour mode which is wrong.  And I can't figure out how to set the CHAR_BASE(m) properly so that it sets it to 0x6004000.  VBA says that it's 0x6000000.
<br/>
<br/>
In general, I'm confused :)  What should I have there?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#35302 - DekuTree64 - Wed Feb 02, 2005 8:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>WillyWonka wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   DISPCNT = DISP_MODE (0);
<br/>
<br/>
   BG0CNT = BG_CHARBASE_0x06004000 | BG_COLOUR_256 | BG_TEXT_32x32 | BG_MAPBASE(0x0000);</td> </tr></table><span class="postbody">
<br/>
<br/>
And I'm trying to convert it.  This is what I have:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   SetMode( MODE_0 | BG0_ON | BG_256_COLOR | BG_SIZE_0 );
<br/>
   while (1) { VBlankIntrWait();}      // loop forever
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Those are not the same thing. SetMode generally just puts the value you give it in REG_DISPCNT. 
<br/>
You'll need to either find a BG control setting function in whatever library you have, or do it the easy way and set the register directly. It should work fine to just copy/paste the top one into your project, and if your defines don't match perfectly, you can check GBATEK or the Cowbite spec to see how the BG control registers are layed out and create your own defines for the things you need.
<br/>
Then if all else fails, post your gba.h.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#35305 - WillyWonka - Wed Feb 02, 2005 9:15 pm</h4>
    <div class="postbody"><span class="postbody">I got it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    BGCTRL[0] = BG_256_COLOR | BG_SIZE_0 | SCREEN_BASE(0) | CHAR_BASE(5);
<br/>
   SetMode( MODE_0 | BG0_ON );</td> </tr></table><span class="postbody">
<br/>
<br/>
I just don't understand why CHARR_BASE(5) was the correct value (It outputted 0x6004000).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#35307 - DekuTree64 - Wed Feb 02, 2005 9:24 pm</h4>
    <div class="postbody"><span class="postbody">It should be CHAR_BASE(1). Each char base is 16KB, or 0x4000 bytes, and there is 64KB of BG VRAM, so the highest base block number is 3. 
<br/>
<br/>
Setting 5 in there will actually get you char block 1, but it will overflow into the bit above the char block field and set it too (which appearently doesn't cause any noticable problem).<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#35313 - WillyWonka - Wed Feb 02, 2005 11:07 pm</h4>
    <div class="postbody"><span class="postbody">Okay, thanks.  That would explain why at one point the mosaic flag was turned on.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
