<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Setting Pixels - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Setting Pixels</h2>
<div id="posts">
<div class="post">
    <h4>#168971 - Drovor - Sun Jun 07, 2009 1:17 am</h4>
    <div class="postbody"><span class="postbody">I'm trying to make a simple dynamic "minimap" type display for my 3D application on the DS (3D on main, minimap on sub).  The 3D hardware seems to be fairly independent of the memory so I've managed to get fairly far without getting into memory management (aside from mapping 1 VRAM bank as texture memory), the sub screen has basically been a debug console so far.
<br/>
<br/>
My goal is to be able to draw a large minimap on the sub screen dynamically (probably per-pixel) as needed based on a tile-based 2D array I have already created (and displayed on the 3D hardware).
<br/>
<br/>
Since it was my original plan to write the pixels directly going around the 2D hardware seemed to make sense so I was looking at some examples at <a class="postlink" href="http://dev-scene.com/NDS/Tutorials_Day_3" target="_blank">dev-scene</a> and <a class="postlink" href="http://www.double.co.nz/nintendo_ds/nds_develop2.html" target="_blank">here</a> which use the framebuffer directly in videoSetMode(MODE_FB0); but I haven't been able to get that to work on the sub screen at this point (also to future proof the code I suspect utilizing the 2D hardware at some point will be a good idea so...).
<br/>
<br/>
I began reading Pataters guide to try and get an idea for how the "videoSetMode" calls should be used.  I have integrated some of his code and have a PNG image displayed on the sub screen.  But I'm not sure how to modify the pixels directly after assigning while in this mode ( videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE); )
<br/>
The backgrounds are copied with a call to dmaCopyHalfWords at memory address BG_BMP_RAM( ... ), should I be able to assign values to that memory directly, or would it be best to create a temporary array and use dmaCopyHalfWords to write it into the BG ram?  
<br/>
Can I still access the framebuffer directly after the BG is drawn like with MODE_FB0?
<br/>
<br/>
Finally... maybe all of this is the wrong approach for what I'm trying to do, so any links or alternative ideas would be greatly appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168972 - Drovor - Sun Jun 07, 2009 5:16 am</h4>
    <div class="postbody"><span class="postbody">I think I found an answer in a recent post on the devkitpro forum:  <a class="postlink" href="http://forums.devkitpro.org/viewtopic.php?f=6&amp;t=1359" target="_blank">HERE</a>. I still have a lot reading and tinkering to do to figure out how I *should* utilize the 2D hardware to do my minimap, but this will give me a jumping point for a framebuffer-esque mode on the sub screen:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   videoSetModeSub(MODE_5_2D);
<br/>
   vramSetBankH(VRAM_H_SUB_BG);
<br/>
   vramSetBankI(VRAM_I_SUB_BG_0x06208000);
<br/>
   int SubPtr = bgInitSub(2, BgType_Bmp8, BgSize_B8_256x256, 0, 0);
<br/>
   for(int i=0; i &lt; 256; i++)
<br/>
   {
<br/>
      BG_PALETTE_SUB[i] = RGB15(i &amp; 0x1F, i &amp; 0x1F, i &amp; 0x1F);
<br/>
   }
<br/>
   u16 *SubData = bgGetGfxPtr(SubPtr);
<br/>
   for(int y=0; y &lt; 128; y++)
<br/>
   {
<br/>
      for(int x=0; x &lt; 192 / 2; x++)
<br/>
         SubData[x + y * 192 / 2] = ((x * 2) &amp; 0xFF) | (((x * 2 + 1) &lt;&lt; 8) &amp; 0xFF00);
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I hope I'll be able to put some sort of background image in there, and just draw in my minimap pixel-by-pixel over it. :)
<br/>
<br/>
edit:
<br/>
found another great example here: <a href="http://www.dev-scene.com/NDS/Tutorials_Day_3#Bitmap_on_the_sub_display" target="_blank">http://www.dev-scene.com/NDS/Tutorials_Day_3#Bitmap_on_the_sub_display</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168973 - samel - Sun Jun 07, 2009 10:44 am</h4>
    <div class="postbody"><span class="postbody">MODE_FB0 could only be used on the main screen.
<br/>
<br/>
videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE); give you a extended rotation background [which you can use as framebuffer].
<br/>
BG_BMP_RAM( ... ) return a pointer to the "framebuffer" memory.
<br/>
The pointer it's an unsigned short int * where each short int rappresent a pixel: bit15 it's alpha bit14-10 are blue bit9-5 are green bit4-0 are red.
<br/>
<br/>
The code you write it's the same as above but with a indexed framebuffer.
<br/>
You have a palette of color and in the "framebuffer" you have to put index of color in the palette.
<br/>
<br/>
from the link to dev-scene:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
BACKGROUND.bg3_rotation.xdy = 0;
<br/>
   BACKGROUND.bg3_rotation.xdx = 1 &lt;&lt; 8;
<br/>
   BACKGROUND.bg3_rotation.ydx = 0;
<br/>
   BACKGROUND.bg3_rotation.ydy = 1 &lt;&lt; 8;
<br/>
</td> </tr></table><span class="postbody">
<br/>
With these instruction you can scale and rotate the background [MODE5 BG3 in this case]
<br/>
<br/>
hope this will help, feel free to ask</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168977 - Drovor - Sun Jun 07, 2009 8:39 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, I think this part makes sense to me now.  Enough sense to be able to learn from the "all_in_one" background demo at least!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
