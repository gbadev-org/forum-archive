<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>I'm just plain stuck. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > I'm just plain stuck.</h2>
<div id="posts">
<div class="post">
    <h4>#168367 - penjuin - Sat Apr 25, 2009 1:21 pm</h4>
    <div class="postbody"><span class="postbody">Hey all,
<br/>
<br/>
This is my first foray into GBA programming, but it is not my first time at C (or embedded-style C either). I am trying to write code to display a sprite; I have read a multitude of tutorials and I just cannot get this to work. According to VBA, my palette is loaded fine, my tiles are loaded as well and the OAM viewer says that my object is visible at 5,5. The sprite in the OAM viewer is of the correct dimensions (8x32) but it shows up as a black square (not my sprite). Any help would be very much appreciated.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
#include &lt;gba.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
#include &lt;string.h&gt;
<br/>
#include &lt;pcx.h&gt;
<br/>
<br/>
// include sprites
<br/>
#include "black_pcx.h"
<br/>
#include "blue_pcx.h"
<br/>
#include "brown_pcx.h"
<br/>
#include "green_pcx.h"
<br/>
#include "purple_pcx.h"
<br/>
#include "red_pcx.h"
<br/>
#include "resistor_pcx.h"
<br/>
<br/>
OBJATTR sprites[128];      // Object Attribute memory, for manipulating the sprites
<br/>
<br/>
u16 PaletteBuffer[256];
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
// Program entry point
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void) {
<br/>
   //---------------------------------------------------------------------------------
<br/>
   
<br/>
   
<br/>
   // the vblank interrupt must be enabled for VBlankIntrWait() to work
<br/>
   // since the default dispatcher handles the bios flags no vblank handler
<br/>
   // is required
<br/>
   irqInit();
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
   REG_IME = 1; // Interrupt enable
<br/>
      
<br/>
   // set up sprites
<br/>
   DecodePCX(black_pcx, (u16*)VRAM , PaletteBuffer);
<br/>
    
<br/>
   u16 *palette_pointer;
<br/>
   palette_pointer = BG_COLORS;
<br/>
   u32 i=0;
<br/>
   for (i=0; i&lt;255; i++) 
<br/>
      *palette_pointer++ = PaletteBuffer[i];
<br/>
   
<br/>
    sprites[0].attr0 = ATTR0_COLOR_256 | (1&lt;&lt;15) | 5 ; // 8 width
<br/>
    sprites[0].attr1 = (1&lt;&lt;14) | 5; // 32 long
<br/>
    sprites[0].attr2 = 0;
<br/>
   
<br/>
   //Copy OAM
<br/>
   u16 *temp;
<br/>
   temp = (u16*)sprites;
<br/>
   u16 *temp2;
<br/>
   temp2 = (u16 *)OAM;
<br/>
   for (i=0;i&lt;4;i++)
<br/>
      *temp2++ = temp[i];
<br/>
    // screen mode &amp; background to display
<br/>
   SetMode( MODE_4 | BG0_ON | OBJ_ENABLE | 0x40);
<br/>
<br/>
   
<br/>
   while (1) {
<br/>
      VBlankIntrWait();
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168368 - DekuTree64 - Sat Apr 25, 2009 1:26 pm</h4>
    <div class="postbody"><span class="postbody">Try using mode 0. Mode 4 uses half of sprite VRAM for the BG, since the usual 64KB of BG VRAM isn't enough for 2 full screens of bitmap data. So in mode 4, you can only use sprite tiles 512 and above.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168369 - penjuin - Sat Apr 25, 2009 1:40 pm</h4>
    <div class="postbody"><span class="postbody">Thanks DekuTree64, that definitely changed something!
<br/>
<br/>
Now I get a weird pattern of basically my first tile spread all over the screen. I took a look at the VRAM and OAM and there is nothing unusual going on there either, but I guess I wouldn't really know what usual looks like because I have yet to get it working :P . The OAM viewer still can't detect my sprite. Do I just set attribute 2 to the first tile and it works out where the rest are?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168370 - eKid - Sat Apr 25, 2009 4:58 pm</h4>
    <div class="postbody"><span class="postbody">The array of tiles you are seeing is from the BG0 you enabled in the screen mode. You copied the sprite graphics into BG video ram, you want to decompress to the sprite vram which starts 64KB after the bg vram (i think the pointer is called SPRITE_GFX (or maybe thats only for libnds))
<br/>
You can remove BG0_ON since you're not using that layer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168377 - penjuin - Sun Apr 26, 2009 4:52 am</h4>
    <div class="postbody"><span class="postbody">Awesome! I had the sprites and palettes going into the BG locations instead of the sprite ones. thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168379 - sgeos - Sun Apr 26, 2009 8:30 am</h4>
    <div class="postbody"><span class="postbody">Visual Boy Advance allows you to view tiles, sprites and palettes.  This is very useful.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168383 - Dwedit - Sun Apr 26, 2009 2:51 pm</h4>
    <div class="postbody"><span class="postbody">It's not just very useful, it's extremely useful.  NO$GBA commercial version also has a similar feature, but it's not as good, since it forces you to use the palettes on the screen, and automatically assigns palettes based on what is displayed.  So if the graphics aren't displayed correctly, you might see black areas in vram, which are just areas that you're not displaying right now.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
