<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem with the Crash Course Tutorial - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Problem with the Crash Course Tutorial</h2>
<div id="posts">
<div class="post">
    <h4>#119676 - daxtsu - Sun Feb 25, 2007 6:50 am</h4>
    <div class="postbody"><span class="postbody">I'm trying to get the background from the Crash Course Tutorial(<a class="postlink" href="http://www.webbesen.dk/gba/default.asp" target="_blank">http://www.webbesen.dk/gba/default.asp</a>):
<br/>
<a href="http://www.webbesen.dk/gba/images/bg.gif">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
and it shows up like this:
<br/>
<a href="http://img176.imageshack.us/img176/5457/weirdsr8.gif">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
and I'm not sure why(I converted it myself using GFX2GBA 0.13 as: gfx2gba -f src bg.pcx).
<br/>
Here's my code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "gba.h"
<br/>
#include "testpicture.h"
<br/>
#define SCREEN_WIDTH 240
<br/>
#define SCREEN_HEIGHT 160
<br/>
#define COLOR_NUM 256
<br/>
#define MEM_VRAM 0x06000000
<br/>
#define PALETTE_RAM 0x05000000
<br/>
#define frontBuffer ((u16*)MEM_VRAM) //(screen in modes 3-5)
<br/>
#define palette_mem ((u16*)PALETTE_RAM)
<br/>
<br/>
int main(void)
<br/>
{
<br/>
    SetMode(MODE_4 | BG2_ENABLE);
<br/>
    for(int i = 0; i &lt; COLOR_NUM; i++)
<br/>
       palette_mem[i] = master_Palette[i];
<br/>
<br/>
    for(int i = 0; i &lt; SCREEN_WIDTH * SCREEN_HEIGHT; i++)
<br/>
        frontBuffer[i] = testpicture_Bitmap[i];
<br/>
    
<br/>
    // continuous loop
<br/>
    while(1) {}
<br/>
   
<br/>
    // end program
<br/>
    return 0;
<br/>
} 
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Contents in testpicture.h:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const unsigned char testpicture_Bitmap[38400] = {
<br/>
0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02,
<br/>
...
<br/>
0x02};
<br/>
<br/>
unsigned short master_Palette[256] = {
<br/>
0x0000, 0x0000, 0x7fff, 0x0000, 0x0000, 0x0000,
<br/>
...
<br/>
0x0000};
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
As my code mostly matches the tutorial's, I have no idea what's wrong. Any advice is appreciated.
<br/>
<br/>
EDIT: Wait a sec for the rest of this post, hit submit by accident. :P
<br/>
EDIT2: Fixed the weird picture to the right one. XD</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119699 - Cearn - Sun Feb 25, 2007 10:54 am</h4>
    <div class="postbody"><span class="postbody">testpicture_Bitmap is a byte array, frontBuffer is a halfword array. The mistmatch between source and destination is causing the gaps in the outcome. You can either a) cast to identical datatypes and then copy, or b) use a dedicated copy routine like memcpy, DMA or CpuFastSet. 
<br/>
<br/>
One potential problem with all of these: the data might be <a class="postlink" href="http://www.coranac.com/tonc/text/bitmaps.htm#ssec-data-align" target="_blank">misaligned</a> because you're <a class="postlink" href="http://www.coranac.com/tonc/text/bitmaps.htm#sec-data-hdr" target="_blank">#including the data</a> instead of compiling separately and linking later.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119711 - tepples - Sun Feb 25, 2007 2:37 pm</h4>
    <div class="postbody"><span class="postbody">Even compiling the data separately might still result in misalignment.
<br/>
<br/>
The only way to make a const char array and guarantee that it is aligned is to use a <a class="postlink" href="http://www.ohse.de/uwe/articles/gcc-attributes.html#type-aligned" target="_blank">GCC attribute</a> (or the equivalent in assembly language). As soon as I learned this, I started putting the relevant attributes in my own conversion program "bin2s", which wintermute has incorporated into the devkitARM distribution.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119721 - Cearn - Sun Feb 25, 2007 4:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Even compiling the data separately might still result in misalignment.</td> </tr></table><span class="postbody">
<br/>
You sure? According to the map-file, most of my files right now are word aligned. If I add a byte or two, file is padded (*fill*) until the next word-aligned address. Seems to work for C and asm files, so what am I missing? 
<br/>
Fair enough, inside those separate files things might be misaligned if you have non-multiples of four in the arrays somehow. But in nearly all cases, graphics conversions will use tile-sizes or screen-sizes, which are always multiples of four again. As long as you don't add single global bytes or halfwords, everything should be fine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119726 - daxtsu - Sun Feb 25, 2007 4:25 pm</h4>
    <div class="postbody"><span class="postbody">Old post: If it's not too much to ask, could either of you write a short example perhaps on both ways of doing it(with really small arrays perhaps, so it fits on the forum)? My C is a bit rusty, so I've been having a little trouble remembering all this stuff.
<br/>
<br/>
EDIT: I did manage to get it working with PCX2GBA output instead, but if I ever needed to use GFX2GBA, any help would be appreciated. Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119732 - Cearn - Sun Feb 25, 2007 6:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>daxtsu wrote:</b></span></td> </tr> <tr> <td class="quote">Old post: If it's not too much to ask, could either of you write a short example perhaps on both ways of doing it(with really small arrays perhaps, so it fits on the forum)? My C is a bit rusty, so I've been having a little trouble remembering all this stuff.</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const unsigned char testpicture_Bitmap[38400] = {
<br/>
0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02,
<br/>
...
<br/>
0x02}; 
<br/>
<br/>
// with casting (to u32 because it's faster):
<br/>
u32 *src= (u32*)testpicture_Bitmap, *dst= (u32*)frontBuffer;
<br/>
<br/>
for(int ii=0; ii&lt; sizeof(testpicture_Bitmap)/4; ii++)
<br/>
    dst[ii]= src[ii];
<br/>
<br/>
// with memcpy:
<br/>
memcpy(frontBuffer, testpicture_Bitmap, sizeof(testpicture_Bitmap));
<br/>
</td> </tr></table><span class="postbody">
<br/>
For other examples: see tonc's demos, like <a class="postlink" href="http://www.coranac.com/tonc/text/text.htm#ssec-demo-se2" target="_blank">this</a>. See tonc anyway, as the crash course teaches bad coding habits and is very much out of date.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>daxtsu wrote:</b></span></td> </tr> <tr> <td class="quote">EDIT: I did manage to get it working with PCX2GBA output instead, but if I ever needed to use GFX2GBA, any help would be appreciated. Thanks.</td> </tr></table><span class="postbody">
<br/>
There's also a tool called '<a class="postlink" href="http://www.coranac.com/projects.php#git" target="_blank">git</a>', which can all of the work of the former (and more),  and most of the work of the latter. It's also part of the latest version of devkitPro.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119735 - tepples - Sun Feb 25, 2007 6:29 pm</h4>
    <div class="postbody"><span class="postbody">I thought <a class="postlink" href="http://en.wikipedia.org/wiki/Git_%28software%29" target="_blank">git</a> was a revision control system used for the Linux kernel.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119751 - gauauu - Sun Feb 25, 2007 9:57 pm</h4>
    <div class="postbody"><span class="postbody">That too.  But Cearn's git is the best graphics tool for gba that I've used....it has all the power of Usenti and Wingit, but from a nice scriptable/makefile-able command line interface.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119756 - tepples - Sun Feb 25, 2007 11:29 pm</h4>
    <div class="postbody"><span class="postbody">But can a user who develops Linux and a user who develops GBA games both have their git installed on one machine?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119761 - keldon - Sun Feb 25, 2007 11:45 pm</h4>
    <div class="postbody"><span class="postbody">Git [according to the site] should be able to compile cross platform with a few changes to the makefile.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119766 - Cearn - Mon Feb 26, 2007 12:27 am</h4>
    <div class="postbody"><span class="postbody">About the name: yeah, wintermute already informed me of the clash with the Linux tool. We're still considering new names, possibly congit (console git), analogous to the gui tool, or grit (Graphics to Raw Image Transmogrifier). Feel free to provide other suggestions. Preferably by PM or mail, as this thread is about something else.
<br/>
<br/>
On the alignment of separate files, some additional testing reveals this: the alignment of a file is related to the largest datatype inside it. So if you have any ints (words) in there, it'll align to a 4-byte boundary. If there are no ints, but there are shorts, it'll align to a 2-byte boundary, and if there's only byte-sized elements, it's byte-aligned. These things are probably ordered by sections, rather than file items: a RAM int wouldn't affect the ROM alignment and such. 
<br/>
This type of alignment is much like the aggregate alignment that EABI uses; maybe older the devkits did align files to word boundaries, just not DKP r19 and onwards.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120045 - daxtsu - Wed Feb 28, 2007 4:04 pm</h4>
    <div class="postbody"><span class="postbody">I recently decided to move to Eclipse so I have an IDE to work with. However, whenever I try to use my testpicture header, it just says that my arrays are undefined references, even though they're clearly defined in the header(now in a C file! ;D). Why is this?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;gba.h&gt;
<br/>
#include "testpicture.h"
<br/>
<br/>
int main()
<br/>
{
<br/>
   for(int i = 0; i &lt; 256; i++)
<br/>
      palette_mem[i] = testpicturePal[i];
<br/>
      
<br/>
   while(1){}
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef __TESTPICTURE__
<br/>
#define __TESTPICTURE__
<br/>
<br/>
#define testpicturePalLen 512
<br/>
extern const unsigned short testpicturePal[256];
<br/>
<br/>
#define testpictureBitmapLen 38400
<br/>
extern const unsigned short testpictureBitmap[19200];
<br/>
<br/>
#endif // __TESTPICTURE__
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT: Nevermind. I forgot to include the header in the testpicture.cpp file. :)</span><span class="gensmall"><br/><br/>Last edited by daxtsu on Wed Feb 28, 2007 6:13 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#120059 - Cearn - Wed Feb 28, 2007 5:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>daxtsu wrote:</b></span></td> </tr> <tr> <td class="quote">I recently decided to move to Eclipse so I have an IDE to work with. However, whenever I try to use my testpicture header, it just says that my arrays are undefined references, even though they're clearly defined in the header(now in a C file! ;D). Why is this?
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;gba.h&gt;
<br/>
#include "testpicture.h"
<br/>
<br/>
int main()
<br/>
{
<br/>
   for(int i = 0; i &lt; 256; i++)
<br/>
      palette_mem[i] = testpicturePal[i];
<br/>
      
<br/>
   while(1){}
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef __TESTPICTURE__
<br/>
#define __TESTPICTURE__
<br/>
<br/>
#define testpicturePalLen 512
<br/>
extern const unsigned short testpicturePal[256];
<br/>
<br/>
#define testpictureBitmapLen 38400
<br/>
extern const unsigned short testpictureBitmap[19200];
<br/>
<br/>
#endif // __TESTPICTURE__
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
They're not defined in the header, they're <span style="font-style: italic">declared</span> in the header. Definitions and declarations are two different things. Declarations just indicate that something of a given name exists, either in that file or another. The definition is where the actual data is, in this case inside testpicture.c. 
<br/>
<br/>
The problem is probably that you're not compiling / linking testpicture.o to the project. Check your makefile to see it's included in the compilation and linking steps.
<br/>
<br/>
ETA:
<br/>
<br/>
In the makefile you should have a list of object files somewhere. something like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
OBJECTS := main.o
<br/>
</td> </tr></table><span class="postbody">
<br/>
with is then used in the project's compilation and link rules. All you 'd hav eto do is add testpictures.o to that list and it will (should) take care of things automatically. It's possible that Eclipse does things a little differently, but there should be something similar there.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120060 - daxtsu - Wed Feb 28, 2007 6:14 pm</h4>
    <div class="postbody"><span class="postbody">I figured it out, like I said in my edit: I forgot to #include the header file in the corresponding C file. Lol.
<br/>
<br/>
EDIT: Yet another problem now..the picture just shows up as a weird green on my screen, with nothing else. Is this an alignment issue?
<br/>
EDIT2: Man, I really need to read up on how this stuff works.. I fixed it..</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
