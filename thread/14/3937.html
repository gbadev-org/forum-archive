<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>software reset - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > software reset</h2>
<div id="posts">
<div class="post">
    <h4>#25387 - hakanyuksel - Sat Aug 21, 2004 10:12 pm</h4>
    <div class="postbody"><span class="postbody">I am trying to use the mbv2 cable. I just learned that i can reset the gba by an asm code like this
<br/>
<br/>
.GLOBL  software_reset
<br/>
<br/>
.ARM
<br/>
@.SECTION .iwram
<br/>
.ALIGN
<br/>
.TEXT
<br/>
<br/>
software_reset:
<br/>
    mov r0,#0x8c
<br/>
    bx r0
<br/>
<br/>
infin:
<br/>
b infin
<br/>
(this is in an .s file)
<br/>
<br/>
<br/>
and my code is like this
<br/>
MULTIBOOT
<br/>
extern void software_reset();
<br/>
<br/>
int main(void)
<br/>
{
<br/>
    software_reset();
<br/>
    init_game();
<br/>
    ....
<br/>
    ....
<br/>
    etc.
<br/>
<br/>
when i run the code a white screen appears an the emulator window. Is there any mistakes in my code. And can I make any unrecoverable damage to my gba by doing something by software like these(I mean asm)?<br/>_________________<br/>--------------------
<br/>
Hakan Yuksel
<br/>
3TE GAmes
<br/>
<a href="http://www.3tegames.com" target="_blank">www.3tegames.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25389 - Lord Graga - Sat Aug 21, 2004 10:27 pm</h4>
    <div class="postbody"><span class="postbody">To do a software reset, use a SWI call.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25404 - tepples - Sun Aug 22, 2004 1:21 am</h4>
    <div class="postbody"><span class="postbody">The problem is you're running it on an emulator. Most current GBA emulators for the PC use a technique called "high level emulation," where the function of a BIOS call is implemented in native PC code, rather than requiring the user to own a GBA, own a GBA to PC cable, and dump the GBA's BIOS himself. This assembly code you speak of jumps directly into the GBA's BIOS code.
<br/>
<br/>
In addition, I've read that it's best to run the software reset code from within an interrupt handler.
<br/>
<br/>
As for harming your GBA, it probably won't hurt under the current version of the BIOS used in the GBA, GBA SP, and Game Boy Player, but I can't guarantee anything, nor can I guarantee that it'll work on future GBA compatible game decks such as the Nintendo DS and the GBA II.
<br/>
<br/>
Lord Graga: IIRC, the SoftReset BIOS call doesn't display the logo.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25413 - DKL - Sun Aug 22, 2004 11:06 am</h4>
    <div class="postbody"><span class="postbody">Like Tepples said, it's never good to jump right into the bios code, for sake of forward compatibility.
<br/>
<br/>
To do a softreset, simply call the SWI 0 function. It seems you're using a GCC compiler, so simply do something like this :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define SOFT_RESET() asm volatile ("swi 0")
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
No need for an asm file. :)
<br/>
<br/>
If you know what you're doing, you could also set SP (the stack pointer register) to its initial value (__sp_usr if you're using Jeff Frohwein linker script) et jump to the appropriate part of code (0x2000000 or 0x8000000).
<br/>
But this a dirty way, since interrupt handlers, privileged mode registers, etc. won't be reset. SWI is easy and compatible, and I don't think you need speed for a reset. ;)
<br/>
<br/>
DKL</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25414 - hakanyuksel - Sun Aug 22, 2004 1:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
In addition, I've read that it's best to run the software reset code from within an interrupt handler.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I dont know much about the interrupts yet. So i cant understand why we're calling this macro in an interupt handler. I mean when i press the start button it will reset the GBA like this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
.....
<br/>
.....
<br/>
#define SOFT_RESET() asm volatile ("swi 0")
<br/>
<br/>
MULTIBOOT
<br/>
int main(void)
<br/>
{
<br/>
    init_game();
<br/>
    while(exit==0)
<br/>
    {
<br/>
            precess_keys();
<br/>
            if(start_pressed)
<br/>
            {
<br/>
                  SOFT_RESET()
<br/>
            }
<br/>
            ...........
<br/>
            ...........
<br/>
     }
<br/>
     return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
thanks for all the information.<br/>_________________<br/>--------------------
<br/>
Hakan Yuksel
<br/>
3TE GAmes
<br/>
<a href="http://www.3tegames.com" target="_blank">www.3tegames.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25415 - DKL - Sun Aug 22, 2004 1:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hakanyuksel wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
In addition, I've read that it's best to run the software reset code from within an interrupt handler.
<br/>
</td> </tr></table><span class="postbody">
<br/>
I dont know much about the interrupts yet. So i cant understand why we're calling this macro in an interupt handler. 
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
I don't see any reason for SWI 0 to be called from an interrupt handler. You can call it from anywhere. It will reset privileged regs (like privileged SP) and clean the IWRAM for you. It means that any information about a possible IRQ will be erased too. In other words, don't care about that. :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I mean when i press the start button it will reset the GBA like this</td> </tr></table><span class="postbody">
<br/>
<br/>
Yep, that's ok the way you did it.
<br/>
<br/>
DKL</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
