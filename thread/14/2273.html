<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Keypad : NULL? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Keypad : NULL?</h2>
<div id="posts">
<div class="post">
    <h4>#11967 - goro - Sat Oct 25, 2003 12:16 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
How do I make my character do something if no key is pressed.
<br/>
<br/>
I've tried:-
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if (!(*KEYS == NULL))
<br/>
   {
<br/>
      Stand_normally();
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
but it gives me :-
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">warning: NULL used in arithmetic</td> </tr></table><span class="postbody">
<br/>
<br/>
so, do I have to define NULL as 0 or something somewhere or
<br/>
change my key detect code? (_ Tried defining NULL as (u16) 0 in my main .cpp but it gave me an error : parse error before `__null'!
<br/>
<br/>
please help!!!</span><span class="gensmall"><br/><br/>Last edited by goro on Sat Oct 25, 2003 1:38 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#11970 - NoMis - Sat Oct 25, 2003 12:57 pm</h4>
    <div class="postbody"><span class="postbody">i have done it like this 
<br/>
<br/>
#define NULL 0 
<br/>
<br/>
and everywhere you write NULL the compiler puts 0 there instead. in c++ 0 is same as NULL but some compilers such as gcc don't understand NULL so you have to use 0. So you shouldn't use the (u16) stuff because NULL or 0 isn't a type. 
<br/>
<br/>
NoMis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11972 - goro - Sat Oct 25, 2003 1:30 pm</h4>
    <div class="postbody"><span class="postbody">Now he continuously 'Stands normally' and ignores the rest of the animations.
<br/>
<br/>
It's probably because....well... I don't know!!!!
<br/>
<br/>
_ Let me clarify...
<br/>
<br/>
I want him to stand normally, 
<br/>
then, when 'RIGHT' is pressed I want him to go into his walking animation, 
<br/>
then when 'RIGHT' is released, I want him to go back to 'Stand normally'.
<br/>
<br/>
<br/>
HELP!!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11976 - tepples - Sat Oct 25, 2003 3:28 pm</h4>
    <div class="postbody"><span class="postbody">Try this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define KEYS ((volatile unsigned short *)0x04000130)
<br/>
<br/>
/*...*/
<br/>
<br/>
unsigned int j = (*KEYS ^ 0x03ff) &amp; 0x03ff;  /* thanks Gopher for catching this */
<br/>
<br/>
if (j == 0)
<br/>
   {
<br/>
      Stand_normally();
<br/>
   }
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Sat Oct 25, 2003 7:41 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#11978 - Touchstone - Sat Oct 25, 2003 3:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>goro wrote:</b></span></td> </tr> <tr> <td class="quote">How do I make my character do something if no key is pressed.</td> </tr></table><span class="postbody">Well, I would recommend you do a state machine for your character, or anything but reading the keypad directly. When the user press right on they keypad you set the state for your character to move right, or whatever it's supposed to do when right is pressed. Just reading if a key is pressed or not is not necessarily wrong but it could give odd side effects. For instance, when SELECT or START is pressed and you just read the keypad, do you want your character to stand normally?
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>goro wrote:</b></span></td> </tr> <tr> <td class="quote">I've tried:-
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if (!(*KEYS == NULL))
<br/>
   {
<br/>
      Stand_normally();
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
but it gives me :-
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">warning: NULL used in arithmetic</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">First of all, NULL is defined as a pointer (<span style="font-weight: bold">#define NULL (void*)0</span>) and you are comparing it to an arithmetic variable, thats why you get that warning.
<br/>
<br/>
And also, you are checking if the value of *KEYS is 0, and if it is NOT zero (you have the exclamation-mark before the *KEYS == 0 statement), that might be your problem. :)<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11979 - goro - Sat Oct 25, 2003 4:16 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Tepples.
<br/>
<br/>
but I get </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">invalid operands of types `volatile 
<br/>
   u32*' and `int' to binary `operator^'</td> </tr></table><span class="postbody">
<br/>
<br/>
I also found out about checking for "No key pressed" here :-
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=1843&amp;highlight=key+press" target="_blank">http://forum.gbadev.org/viewtopic.php?t=1843&amp;highlight=key+press</a>
<br/>
<br/>
but I get different errors trying that stuff too.
<br/>
<br/>
PLEASE HELP!!!
<br/>
<br/>
Touchstone : true but aren't start &amp; select translated as keys? in any case, There must be a quick check to see i f we are in start/select/pause/intro mode...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11980 - Gopher - Sat Oct 25, 2003 6:58 pm</h4>
    <div class="postbody"><span class="postbody">Nobody seems to have stated this tho Tepples posted code that implied it, the bits in KEYS will be 1 if the key is NOT pressed, and 0 if it is. This is why you always see the tests being negated ( with ! ).
<br/>
When testing for no keys, tho, this means you must check for all the bits to be 1, not 0. KEYS will equal 0 only if ALL the keys are pressed, so !(KEYS==0) will be true if any key is not pressed, rather than if every key is not pressed.
<br/>
As has been posted in code already, you need to mask KEYS by the set of all keys - there are 10, so the mask is 10 bits.  10 1s in binary 111111111 converted to hex is 0x3ff. I won't explain hex/binary now, but here's a link to the first online explanation I found on Google 
<br/>
<a href="http://www.learn-c.com/data_lines.htm" target="_blank">http://www.learn-c.com/data_lines.htm</a>
<br/>
<br/>
Ok, enough of why Tepples was mostly right. Now for why it's not working for you. Tepples example defined KEYS this way
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define KEYS ((volatile unsigned short *)0x04000130) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
but tepples made one minor mistake. he defined KEYS as a pointer, but in his code later he used it thusly...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
unsigned int j = (KEYS ^ 0x03ff) &amp; 0x03ff; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
which won't work because KEYS was defined as a pointer. Simplest fix: add a dereference to one or the other. If you're writing mostly in C/C++ it makes the most sense to add it to the macro, since you'll never want the address, just the value stored at it
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define KEYS (*(volatile unsigned short *)0x04000130) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That should fix the problem. But I'd strongly encourage you to learn your hex/binary number systems and C's bitwise operations, as a strong grasp of them is essential when doing low-level optimized code like GBA programming requires. From the sound of it you might also want to study &amp; practice pointers more, too. Always strive to understand code, cutting and pasting other people's code without understanding it might help you make things faster, but when something goes wrong (like now) you end up with little hope of fixing it if you didn't understand why it worked in the first place.<br/>_________________<br/>"Only two things are infinite: the universe, and human stupidity. The first is debatable." -Albert Einstein</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11996 - goro - Sun Oct 26, 2003 11:05 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
Thanks Gopher, I try to understand all code that I write (or cut&amp;paste) by learning about it but sometimes the learning material isn't explained clearly so I ask here at the forum.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Tepples example defined KEYS this way 
<br/>
Code: 
<br/>
<br/>
#define KEYS ((volatile unsigned short *)0x04000130) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's also how it is defined in my gba.h &amp; when I tried to dereference it as you said i got :-
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">C:/devkitadv/GBA/1.cpp: In function `void GetInput()':
<br/>
C:/devkitadv/GBA/1.cpp:70: invalid type argument of `unary *'
<br/>
C:/devkitadv/GBA/1.cpp:80: invalid type argument of `unary *'
<br/>
C:/devkitadv/GBA/1.cpp:90: invalid type argument of `unary *'
<br/>
C:/devkitadv/GBA/1.cpp:133: invalid type argument of `unary *'
<br/>
C:/devkitadv/GBA/1.cpp:206: invalid type argument of `unary *'
<br/>
C:/devkitadv/GBA/1.cpp:212: invalid type argument of `unary *'
<br/>
C:/devkitadv/GBA/1.cpp:222: invalid type argument of `unary *'
<br/>
C:/devkitadv/GBA/1.cpp:232: invalid type argument of `unary *'
<br/>
C:/devkitadv/GBA/1.cpp:242: invalid type argument of `unary *'
<br/>
NMAKE : fatal error U1077: 'c:\devkitadv\bin\gcc' : return code '0x1'</td> </tr></table><span class="postbody">
<br/>
<br/>
To avoid these errors I need to dereference it at the other end i.e.
<br/>
by turning </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned int j = (KEYS ^ 0x03ff) &amp; 0x03ff;</td> </tr></table><span class="postbody"> into something like </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned int j = (*KEYS ^ 0x03ff) &amp; 0x03ff; </td> </tr></table><span class="postbody">
<br/>
but that makes he continuously 'Stands normally' and ignores the rest of the animations (even when I hold down 'LEFT' or 'RIGHT'). 
<br/>
<br/>
can you confirm that this is the correct way of dereferencing this and that my error lies elsewhere in my code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12007 - Gopher - Sun Oct 26, 2003 6:21 pm</h4>
    <div class="postbody"><span class="postbody">I should have guessed you were using the variable in other places,  so if I'd been thinking about it I would have at least pointed out that changing the macro would break everywhere that currently worked with it. The warnings just meant you were trying to dereference something that wasn't a pointer. 
<br/>
<br/>
You do seem do be dereferencing correctly; looking at what you gave me I'm not clear what the problem is exactly. Sorry.
<br/>
<br/>
Is the character actually moving around but just not showing the correct animation, or is it not responding at all?<br/>_________________<br/>"Only two things are infinite: the universe, and human stupidity. The first is debatable." -Albert Einstein</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12028 - goro - Mon Oct 27, 2003 12:06 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, he moves around which means attribute 0 &amp; 1 (his x + y positions are being updated) but he won't animate (attribute 2 isn't.)
<br/>
<br/>
Thanks for pointing out that I dereferenced properly, Now I'll trudge through the rest of the code to fix copying to oam or whatever else it could be.
<br/>
<br/>
-Edit : That's what it was : Although I was updating the hero_frame variable, I wasn't explicitly updating the </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sprites[0].attribute2 = hero_frame; </td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks again to Tepples, Touchstone, Gopher &amp; everybody else that helped...
<br/>
<br/>
...Much appreciated...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
