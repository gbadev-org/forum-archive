<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>question about mode5 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > question about mode5</h2>
<div id="posts">
<div class="post">
    <h4>#46414 - funkaster - Fri Jun 24, 2005 11:48 am</h4>
    <div class="postbody"><span class="postbody">If I remember correcly, mode5 is 160x128... so I'm trying to display a 160x128 image (a TGA file, wich is loaded fine). But for some reason, the file is displayed like if the screen where 240x160 (its in the upper left corner), this is the code I'm using:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    if ((img = load_tga (foot, &amp;ll)) != NULL)
<br/>
    {
<br/>
        SetMode(MODE_5 | BG2_ENABLE);
<br/>
        if (ll == 0)
<br/>
        {
<br/>
            int x, y;
<br/>
            for (y = SCREEN_HEIGHT-1; y &gt;= 0; y--)
<br/>
                for (x=0; x &lt; SCREEN_WIDTH; x++)
<br/>
                {
<br/>
                    /* TGA is 24 bit */
<br/>
                    unsigned char r = *img++;
<br/>
                    unsigned char g = *img++;
<br/>
                    unsigned char b = *img++;
<br/>
                    VB[x+y*SCREEN_WIDTH] = RGB8(r,g,b);
<br/>
                }
<br/>
        }
<br/>
        else
<br/>
        {
<br/>
            for (i=0; i &lt; SCREEN_WIDTH*SCREEN_HEIGHT; i++)
<br/>
            {
<br/>
                /* 16 bits tga: GGGBBBBB ARRRRRGG */
<br/>
                unsigned char r = *img++;
<br/>
                unsigned char g = *img++;
<br/>
                unsigned char b = *img++;
<br/>
                VB[i] = RGB8(r,g,b);
<br/>
            }
<br/>
        }
<br/>
        while (1) {}
<br/>
    }
<br/>
    return 0;
<br/>
</td> </tr></table><span class="postbody">
<br/>
Any idea why this could be happening?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46416 - tepples - Fri Jun 24, 2005 12:40 pm</h4>
    <div class="postbody"><span class="postbody">Because you're not scaling or moving the image. Use background 2's affine registers to do that. Common uses include centering the image, or <a class="postlink" href="http://www.gbadev.org/files/newmode.txt" target="_blank">rotating it by 90 degrees and stretching it by a factor of 2</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46420 - strager - Fri Jun 24, 2005 3:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>funkaster wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for (i=0; i &lt; SCREEN_WIDTH*SCREEN_HEIGHT; i++)</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Maybe changing the dementions should help.  Replace SCREEN_WIDTH*SCREEN_HEIGHT with 192*128.  That should help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46423 - funkaster - Fri Jun 24, 2005 4:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Because you're not scaling or moving the image. Use background 2's affine registers to do that. Common uses include centering the image, or <a class="postlink" href="http://www.gbadev.org/files/newmode.txt" target="_blank">rotating it by 90 degrees and stretching it by a factor of 2</a>.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yep, that showed the image *almost* at full screen. But I'm still using a 160x128 image... should I use different size? (this is how it looks now):
<br/>
<a class="postlink" href="http://www.rolando.cl/gba/vba.png" target="_blank">http://www.rolando.cl/gba/vba.png</a>
<br/>
Also, where's info about what this does:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
        REG_DISPCNT = 5+((page&amp;1)&lt;&lt;4)+(1&lt;&lt;10); /* mode 5, page, bg2 enable */
<br/>
        (&amp;REG_DISPCNT)[0x10] = 0;
<br/>
        (&amp;REG_DISPCNT)[0x11] = 256;
<br/>
        (&amp;REG_DISPCNT)[0x12] = 128;
<br/>
        (&amp;REG_DISPCNT)[0x13] = 0;
<br/>
</td> </tr></table><span class="postbody">
<br/>
(adapted from the code that  tepples suggested)
<br/>
thanks![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46425 - tepples - Fri Jun 24, 2005 4:38 pm</h4>
    <div class="postbody"><span class="postbody">The code sets up BG2's affine matrix to stretch the background <span style="font-style: italic">and</span> swap the X and Y axes. Here's a clearer version of the code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/* this goes in your header file */
<br/>
<br/>
typedef signed   short s16;
<br/>
typedef unsigned int   u32;
<br/>
<br/>
struct BGAFFINEREC
<br/>
{
<br/>
  s16 pa;  /* map_x increment per pixel */
<br/>
  s16 pb;  /* map_x increment per scanline */
<br/>
  s16 pc;  /* map_y increment per pixel */
<br/>
  s16 pd;  /* map_y increment per scanline */
<br/>
  u32 x_origin, y_origin;
<br/>
};
<br/>
<br/>
#define BGAFFINE ((volatile struct BGAFFINEREC *)0x04000000)
<br/>
<br/>
<br/>
<br/>
/* this goes somewhere in your code */
<br/>
<br/>
BGAFFINE[2].pa = 0;
<br/>
BGAFFINE[2].pb = 256;
<br/>
BGAFFINE[2].pc = 128;
<br/>
BGAFFINE[2].pd = 0;
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
