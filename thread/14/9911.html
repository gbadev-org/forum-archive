<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Newbie tutorial problems, macro's no longer found in libgba - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Newbie tutorial problems, macro's no longer found in libgba</h2>
<div id="posts">
<div class="post">
    <h4>#87566 - Spaceface - Wed Jun 14, 2006 4:06 pm</h4>
    <div class="postbody"><span class="postbody">Hey there.. Probably something very simple that I just can't seem to figure. I'm following the Pern tutorials. But they seem to be for DevKitAdvance or at least an older version of libgba, while I'm running the more recent DevKitPro from the updater. The libgba included with it doesn't seem compatible with about EVERY tutorial I found on the net.
<br/>
For instance this code, the most simplest one:
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;gba.h&gt; //everything you need for gba devving
<br/>
<br/>
#define VideoBuffer ((volatile u16*)0x6000000) 
<br/>
 
<br/>
///////////////// C code entry (main())/////////////////////
<br/>
int main()
<br/>
{
<br/>
    unsigned char x,y;  
<br/>
 
<br/>
    SetMode(MODE_3 | BG2_ENABLE);   
<br/>
 
<br/>
    for(x = 0; x &lt; SCREEN_WIDTH; x++)   
<br/>
        for(y = 0; y &lt; SCREEN_HEIGHT; y++)  
<br/>
            VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(31,0,0);  
<br/>
 
<br/>
    while(1){}  
<br/>
 }//end main 
<br/>
</td> </tr></table><span class="postbody">It comes with a list of certain errors:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">c:/devkitPro/projects/Smurfs/source/template.c:12: error: 'SCREEN_WIDTH' undeclared (first use in this function)
<br/>
c:/devkitPro/projects/Smurfs/source/template.c:12: error: (Each undeclared identifier is reported only once
<br/>
c:/devkitPro/projects/Smurfs/source/template.c:12: error: for each function it appears in.)
<br/>
c:/devkitPro/projects/Smurfs/source/template.c:13: error: 'SCREEN_HEIGHT' undeclared (first use in this function)
<br/>
c:/devkitPro/projects/Smurfs/source/template.c:14: warning: implicit declaration of function 'RGB16'</td> </tr></table><span class="postbody">
<br/>
They all point to undeclared macro's which do not mean anything in the current version of libgba.
<br/>
<br/>
However after viewing some older .h files via google I can fill in the macro's with values:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;gba.h&gt; //everything you need for gba devving
<br/>
<br/>
#define VideoBuffer ((volatile u16*)0x6000000) 
<br/>
<br/>
///////////////// C code entry (main())/////////////////////
<br/>
int main()
<br/>
{
<br/>
    unsigned char x,y;  
<br/>
 
<br/>
    SetMode(MODE_3 | BG2_ENABLE);   
<br/>
 
<br/>
    for(x = 0; x &lt; 240; x++)   
<br/>
        for(y = 0; y &lt; 160; y++)  
<br/>
            VideoBuffer [x+ y * 240] = 0x111110000000000;  
<br/>
 
<br/>
    while(1){}  
<br/>
 }//end main 
<br/>
</td> </tr></table><span class="postbody">But for one reason or another I keep getting a grey screen visualboy... 
<br/>
<br/>
Anyone here who can help me out?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87578 - Cearn - Wed Jun 14, 2006 5:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Spaceface wrote:</b></span></td> </tr> <tr> <td class="quote">Hey there.. Probably something very simple that I just can't seem to figure. I'm following the Pern tutorials. But they seem to be for DevKitAdvance or at least an older version of libgba, while I'm running the more recent DevKitPro from the updater. The libgba included with it doesn't seem compatible with about EVERY tutorial I found on the net.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Every tutorial that uses DevitAdvance predates devkitARM/Pro, and libgba by extension. That they'd use different #defines is to be expected. But more to the point, the names of the #defines don't really matter, the thing that counts is the values they stand for, whether the #define for enabling background 2 is called BG2_ENABLE (pern), BG2_ON (libgba), DCNT_BG2_ON (tonc) really isn't the issue, that they all stand for 0x0400 is. Look in the header files of the tutorials and either copy those defines or look the values up in libgba and use the proper replacement.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Spaceface wrote:</b></span></td> </tr> <tr> <td class="quote">However after viewing some older .h files via google I can fill in the macro's with values:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;gba.h&gt; //everything you need for gba devving
<br/>
<br/>
#define VideoBuffer ((volatile u16*)0x6000000) 
<br/>
<br/>
///////////////// C code entry (main())/////////////////////
<br/>
int main()
<br/>
{
<br/>
    unsigned char x,y;  
<br/>
 
<br/>
    SetMode(MODE_3 | BG2_ENABLE);   
<br/>
 
<br/>
    for(x = 0; x &lt; 240; x++)   
<br/>
        for(y = 0; y &lt; 160; y++)  
<br/>
            VideoBuffer [x+ y * 240] = 0x111110000000000;  
<br/>
 
<br/>
    while(1){}  
<br/>
 }//end main 
<br/>
</td> </tr></table><span class="postbody">But for one reason or another I keep getting a grey screen visualboy... 
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
You shouldn't get a grey screen, you should have a black screen. 0x111110000000000 is a hex constant, not binary. Because it's too large for a 32bit word, and will be truncated to the last 8 nybbles, i.e. 0x00000000. 
<br/>
<br/>
Also, don't use non-words as variables, and switch order of the loops (<span style="font-style: italic">x</span> in the inner loop). This saves you a factor 2 in speed*.
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">* depending on devkit, compile flags, etc, etc. With devkitPro 19, -mthumb -O2 I get a factor 2</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87588 - Spaceface - Wed Jun 14, 2006 6:03 pm</h4>
    <div class="postbody"><span class="postbody">OK, apparently now it's called MODE3_FB in the latest libgba. 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//---------------------------------------------------------------------------------
<br/>
// Framebuffers for mode 3 and 5
<br/>
//---------------------------------------------------------------------------------
<br/>
typedef u16 MODE3_LINE[240];
<br/>
typedef u16 MODE5_LINE[160];
<br/>
<br/>
#define MODE3_FB ((MODE3_LINE *)0x06000000)
<br/>
#define MODE5_FB ((MODE5_LINE *)0x06000000)
<br/>
#define MODE5_BB ((MODE5_LINE *)0x0600A000) </td> </tr></table><span class="postbody">
<br/>
However, I still don't get why I got the grey screen in my previous code. 
<br/>
<br/>
When I use this code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;gba.h&gt;
<br/>
<br/>
#define VideoBuffer ((u16*)0x6000000)
<br/>
<br/>
int main()
<br/>
{
<br/>
    unsigned char x,y; 
<br/>
 
<br/>
    SetMode(MODE_3 | BG2_ENABLE);   
<br/>
 
<br/>
    for(y = 0; y &lt; 160; y++){
<br/>
      for(x = 0; x &lt; 240; x++){
<br/>
            VideoBuffer[x+ y * 240] = 0x1F;
<br/>
      }
<br/>
   }
<br/>
    while(1){} 
<br/>
 }</td> </tr></table><span class="postbody">
<br/>
<br/>
I get this:
<br/>
<a href="http://img61.imageshack.us/img61/4493/gba27fm.png" target="_blank">http://img61.imageshack.us/img61/4493/gba27fm.png</a>
<br/>
<br/>
With this in on my VideoBuffer address:
<br/>
<a href="http://img61.imageshack.us/img61/8620/gba16og.png" target="_blank">http://img61.imageshack.us/img61/8620/gba16og.png</a>
<br/>
<br/>
Doesn't seem to make sense to me. Even if I change the for-loops with 	VideoBuffer[0] = 0x1F; it doesn't show in the Memory Viewer. Anyone has any idea what on earth I'm doing wrong here?
<br/>
<br/>
<span style="font-weight: bold">small update</span>:
<br/>
<br/>
<span style="color: red">I now used the includes provided by the Pern tutorials, which allowed me to run the exact original C file. Even now it compiles, but doesn't show anything in the Memory Viewer nor does it show anything onscreen. This keeps getting weirder and weirder...
<br/>
<br/>
Even if I view it in BoyCottAdvance I get a black screen, which pretty much indicates that nothing is written to the memory. But whenever I run the compiled version that Pern provides it DOES work and DOES write to the right address.
<br/>
<br/>
For some reason I begin to think this has to do something outside of my code and something with either the make file or the compilers. But that can't be it, right? Anyone has any idea?</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87594 - kusma - Wed Jun 14, 2006 6:42 pm</h4>
    <div class="postbody"><span class="postbody">add "-specs=gba.specs" to your linkerflags and try again...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87595 - Spaceface - Wed Jun 14, 2006 6:49 pm</h4>
    <div class="postbody"><span class="postbody">Tried it, but no result =(
<br/>
My makefile now has this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">CFLAGS   :=   -g -Wall -O3\
<br/>
      -mcpu=arm7tdmi -mtune=arm7tdmi\
<br/>
       -fomit-frame-pointer\
<br/>
      -ffast-math \
<br/>
      -specs=gba.specs \
<br/>
      $(ARCH)</td> </tr></table><span class="postbody">
<br/>
<br/>
Still no difference whatsoever...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87606 - tepples - Wed Jun 14, 2006 7:27 pm</h4>
    <div class="postbody"><span class="postbody">-specs=gba.specs goes in the LDFLAGS not the CFLAGS. Think of it as like a library.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87612 - Spaceface - Wed Jun 14, 2006 7:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">-specs=gba.specs goes in the LDFLAGS not the CFLAGS. Think of it as like a library.</td> </tr></table><span class="postbody">Ah OK.. that brings me a bit closer..
<br/>
However, I get this as an error:
<br/>
&gt; "make" 
<br/>
template.c
<br/>
arm-eabi-gcc -MMD -MP -MF /c/devkitPro/projects/Smurfs/build/template.d -g -Wall -O3 -mcpu=arm7tdmi -mtune=arm7tdmi -fomit-frame-pointer -ffast-math -mthumb -mthumb-interwork -I/c/devkitPro/projects/Smurfs/include -I/c/devkitPro/libgba/include -I/c/devkitPro/projects/Smurfs/build -c /c/devkitPro/projects/Smurfs/source/template.c -o template.o
<br/>
linking cartridge
<br/>
<span style="font-weight: bold">c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: warning: cannot find entry symbol cs=c:/devkitPro/devkitARM/arm-eabi/lib/gba.specs; defaulting to 08000234
<br/>
</span>built ... Smurfs.gba
<br/>
ROM fixed!
<br/>
--------------------
<br/>
<br/>
These are my LDFLAGS 
<br/>
LDFLAGS	=	-g $(ARCH) -Wl,-Map,$(notdir $@).map,<span style="font-weight: bold">-specs=$(DEVKITARM)/arm-eabi/lib/gba.specs</span>
<br/>
<br/>
However, if I change it to 
<br/>
LDFLAGS	=	-g $(ARCH) -Wl,-Map,$(notdir $@).map,<span style="font-weight: bold">-specs=gba.specs
<br/>
</span>
<br/>
<br/>
I get just the same error... Sorry for all these questions, but I don't have the slightest clue what's going on =(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87617 - Spaceface - Wed Jun 14, 2006 8:04 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">Small update:</span> it seems to be beyond the whole pern thing, when I try to compile the template file from DevKitPro I also get a blank screen. Anyone knows what that's about?
<br/>
<br/>
<span style="font-weight: bold">Final update:</span> apparently there was something wrong with the linkscripts in my version of DevKitPro. DevKitPro.org provides a solution on <a href="http://www.devkitpro.org/gba_linkscripts.zip" target="_blank">http://www.devkitpro.org/gba_linkscripts.zip</a>
<br/>
<br/>
Wow that was a day thrown away searching for silly stuff ;)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
