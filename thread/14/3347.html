<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Quadrant two askew - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Quadrant two askew</h2>
<div id="posts">
<div class="post">
    <h4>#20201 - CyberSlag5k - Tue May 04, 2004 6:24 pm</h4>
    <div class="postbody"><span class="postbody">I've been trying to get text backgrounds greater than 256x256 in size up and running. I have the basic theory and I've got 512x256 really close, however I am experiencing a bit of an anomaly. The left half of the map is fine, but the right half is shifted down one row, as seen here:
<br/>
<br/>
<a class="postlink" href="http://homepages.udayton.edu/~pateramj/1.bmp" target="_blank">http://homepages.udayton.edu/~pateramj/1.bmp</a>
<br/>
<br/>
I load the map data like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for(int i = 0; i &lt; 32; i++)
<br/>
      for(int j = 0; j &lt; 32; j++)
<br/>
         mapData1[j + i*32] = towerMap[j + i*64];
<br/>
<br/>
   for(int i = 0; i &lt; 32; i++)
<br/>
      for(int j = 32; j &lt; 64; j++)
<br/>
         mapData2[j + i*32] = towerMap[j + i*64];</td> </tr></table><span class="postbody">
<br/>
<br/>
towerMap is the map data and mapData 1 and 2 are pointers to screen base blocks. Just doing it by hand, everything looks fine to me. Then again, I am but a humble padawan learner when it comes to the art of gba dev. Might on of you jedi masters point out my mistake?<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20215 - DiscoStew - Tue May 04, 2004 9:49 pm</h4>
    <div class="postbody"><span class="postbody">Since you are working by hand (meaning the tile data is done manually), there will always be those little problems that will arise, such as this one. I don't know exactly the problem, but I will be asking a few questions.
<br/>
<br/>
1) Since you are editing it manually, have you made sure that the actual tile data (the towerMap array) is correctly aligned? Your code MAY be loading correctly, but the actual data could be off by a single vertical tile.
<br/>
<br/>
2) Is your mapData2 pointer correctly pointing to the correct place? Your mapData1 pointer could be pointing to the correct Screen Base Block, and being that you are working in 512x256 text mode, mapData2 should be pointing to mapData1 + 1024, because in 512x256 and 512x512 text modes, they are not linear (which I assume you know because of what your code is showing).
<br/>
<br/>
JFYI, check out <a class="postlink" href="http://www.thepernproject.com/index2.html" target="_blank">The Pern Project</a> at the link here about tile modes and working with 512x256 and 512x512 text modes. If that doesn't help, then you may have to post a little more code, because your loading code doesn't show us anything except that you are taking an array, and putting it into another.
<br/>
<br/>
(Final Fantasy IV, a great game, but those tiles look like they are shrunk by half on each axis)<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20217 - CyberSlag5k - Tue May 04, 2004 10:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Since you are working by hand (meaning the tile data is done manually), there will always be those little problems that will arise</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm sorry, I meant I was doing the math for the arrays by hand. Working out which indices I should use (namely j+i*64). My map data is exported by MapEd.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Is your mapData2 pointer correctly pointing to the correct place?</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, I think so. Then again, I totally just guessed and did this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   u16* mapData1 = (u16*)ScreenBaseBlock(screenBaseBlock);
<br/>
   u16* mapData2 = (u16*)ScreenBaseBlock(screenBaseBlock + 1);
<br/>
   u16* mapData3 = (u16*)ScreenBaseBlock(screenBaseBlock + 2);
<br/>
   u16* mapData4 = (u16*)ScreenBaseBlock(screenBaseBlock + 3);</td> </tr></table><span class="postbody">
<br/>
<br/>
*winces expecting verbal backlash*
<br/>
<br/>
Anyway, I'll give the mapDat1 + 1024 thing and see if that changes anything.
<br/>
<br/>
Thanks!<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20223 - DiscoStew - Tue May 04, 2004 11:28 pm</h4>
    <div class="postbody"><span class="postbody">You were setting mapData2 through mapData4 as part of ScreenBaseBlocks? One thing to remember is that the ScreenBaseBlocks is for setting the mapdata for each individual <span style="text-decoration: underline">background</span>, not individual areas of a 256x256, 512x256, etc, map area. I assume you are using the ScreenBaseBlock macro from your code.
<br/>
To properly use 512x256 and 512x512 text modes, imagine that the area is either 2 32x32 tile blocks side by side, or 4 32x32 tile blocks in an order like a "Z". To access these other blocks, add to the index of the mapData array with (n * 1024) where "n" equals the specific quadrant. Or in your circumstance, set mapData2 to "mapData1 + 1024", mapData3 to "mapData1 + 2048", and mapData4 to "mapData1 + 3072".
<br/>
<br/>
Try that, and see if it works.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20228 - sajiimori - Wed May 05, 2004 12:58 am</h4>
    <div class="postbody"><span class="postbody">Your math is wrong.  To prove it to yourself, consider:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(int i = 0; i &lt; 32; i++)
<br/>
   for(int j = 32; j &lt; 64; j++)
<br/>
      mapData2[j + i*32] = towerMap[j + i*64];
<br/>
</td> </tr></table><span class="postbody">
<br/>
What index of mapData2 do you want to access on the first iteration?  What index is actually accessed?
<br/>
<br/>
But despite DiscoStew's objection, you were right that each screen base block corresponds to a 32x32 tile area, and it's ok to handle each block seperately as you have done.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20230 - CyberSlag5k - Wed May 05, 2004 1:08 am</h4>
    <div class="postbody"><span class="postbody">Hahar! Good call Sajiimori. I also liked how you just gave me the question I needed to ask myself instead of its answer. I learn more when I do it for myself.
<br/>
<br/>
For anyone who experiences the same problem in the future, take a look at what I was doing:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for(int i = 0; i &lt; 32; i++) 
<br/>
      for(int j = 0; j &lt; 32; j++) 
<br/>
         mapData1[j + i*32] = towerMap[j + i*64]; 
<br/>
<br/>
   for(int i = 0; i &lt; 32; i++) 
<br/>
      for(int j = 32; j &lt; 64; j++) 
<br/>
         mapData2[j + i*32] = towerMap[j + i*64];</td> </tr></table><span class="postbody">
<br/>
<br/>
My indices for mapData1 were fine. The first few iterations would yield indices 1, 2, 3.... (1+(0)(32), 1+(1)(32), 1+(2)(32)), and as i was incremented 32, 33, 34 ...(0+(1)(32), 1+(1)(32), 2+(1)(32). This is ok. But take a look at mapData2. My first few iterations would have been 32, 33, and 34 (32+(0)(32), 33+(0)(32), 34+(0)(32)) which is just silly. To fix the problem I made the line:
<br/>
<br/>
mapData2[<span style="font-weight: bold">j-32 </span>+ i*32] = towerMap[j + i*64];
<br/>
<br/>
Hope this helps someone and thanks again to all who helped me!<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20232 - sajiimori - Wed May 05, 2004 2:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I also liked how you just gave me the question I needed to ask myself instead of its answer. I learn more when I do it for myself.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Oh don't overestimate my teaching skills -- I'm just too lazy to type the answer! :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20233 - DiscoStew - Wed May 05, 2004 2:44 am</h4>
    <div class="postbody"><span class="postbody">Looks to me like I need to get back on tiles, maps, and stuff. I've been working on my sprite handler for so long that even simple things like this with tiled backgrounds requires me to get back into it.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
