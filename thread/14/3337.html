<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Silly MapEd - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Silly MapEd</h2>
<div id="posts">
<div class="post">
    <h4>#20107 - CyberSlag5k - Sun May 02, 2004 4:42 am</h4>
    <div class="postbody"><span class="postbody">I've created a few maps with MapEd (I'm getting sooooo close to successfully completing a tile background after about a week of work), but for some reason when I export to a header file, the data is a little screwy.
<br/>
<br/>
My test map can be seen here:
<br/>
<br/>
<a class="postlink" href="http://homepages.udayton.edu/~pateramj/1.bmp" target="_blank">http://homepages.udayton.edu/~pateramj/1.bmp</a>
<br/>
<br/>
as you can see the top left corner provides a pretty easy way to make sure things are happening the way they should. There's a grass tile and then the dirt tiles set up in a formation like this:
<br/>
<br/>
GDG
<br/>
DDD
<br/>
GDG
<br/>
<br/>
where the G's are grass and the D's are dirt. However, the data MapEd creates looks like this:
<br/>
<br/>
const u16 towerMap[1024] = 
<br/>
{
<br/>
<span style="font-weight: bold">0x0000,0x2001,0x0000,</span>0x0000,0x0000,0x0000,0x1006,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,
<br/>
<span style="font-weight: bold">0x0000,0x0000,0x0000,</span>0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,
<br/>
<span style="font-weight: bold">0x2002,0x2003,0x2004</span>,0x0000,0x0000,0x0000,0x2008,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,
<br/>
<span style="font-weight: bold">0x0000,0x0000,0x0000</span>,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,
<br/>
<span style="font-weight: bold">0x0000,0x2005,0x0000</span>,0x0000,0x2001,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,
<br/>
0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,
<br/>
<br/>
Looking at the bolded indices, you can see that something kind of like
<br/>
<br/>
GDG
<br/>
GGG
<br/>
DDD
<br/>
GGG
<br/>
GDG
<br/>
<br/>
is going to be drawn, and in fact it is:
<br/>
<br/>
<a class="postlink" href="http://homepages.udayton.edu/~pateramj/2.bmp" target="_blank">http://homepages.udayton.edu/~pateramj/2.bmp</a>
<br/>
<br/>
Now I create my maps in unoptimized mode as suggested because I'm using a 256 color tiles which MapEd does not support. To get around this I create my palette and tile data, which appear to work as the tiles that are drawn all look correct, just kind of jumbled as you can see. I've also tried doing it in optimized mode, just in case. Same result. Can anyone see what's going on here? Something I"ve overlooked?
<br/>
<br/>
Thanks.<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20111 - NoMis - Sun May 02, 2004 9:12 am</h4>
    <div class="postbody"><span class="postbody">How are you copying the data into the VRAM. It seems to export correct because if you look close the map is 32 tiles wide wich isnt seen first in the header file.
<br/>
If you copy it with dma you can simply copy the whole array at one pice into the screen block you are using.
<br/>
It this doesn't work send the code block were you are copying the map please.
<br/>
<br/>
NoMis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20112 - yaustar - Sun May 02, 2004 9:30 am</h4>
    <div class="postbody"><span class="postbody">how big is the map?<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20117 - CyberSlag5k - Sun May 02, 2004 4:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It seems to export correct because if you look close the map is 32 tiles wide wich isnt seen first in the header file. </td> </tr></table><span class="postbody">
<br/>
<br/>
That's true, I guess I was thinking each row in the array is the first row in the map.
<br/>
<br/>
My map is 256x256 pixels, which should be 32x32 tiles, right?
<br/>
<br/>
I load the data like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   tempPtr = (u16*)towerTiles;
<br/>
   for(int i = 0; i &lt; 16448; i++)
<br/>
      tileData[i] = tempPtr[i];
<br/>
<br/>
   tempPtr = (u16*)towerMap;
<br/>
   for(int i = 0; i &lt; 512; i++)
<br/>
      mapData[i] = tempPtr[i];</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20135 - CyberSlag5k - Sun May 02, 2004 10:03 pm</h4>
    <div class="postbody"><span class="postbody">No luck so far but I did just notice something. The map data is still a little off. Look at that third row:
<br/>
<br/>
<span style="font-weight: bold">0x2002,0x2003,0x2004</span>,0x0000,0x0000,0x0000,0x2008,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000, 
<br/>
<br/>
and the tile set:
<br/>
<br/>
<a class="postlink" href="http://homepages.udayton.edu/~pateramj/tiles.bmp" target="_blank">http://homepages.udayton.edu/~pateramj/tiles.bmp</a>
<br/>
<br/>
0x2002 would be a grass tile on the left and a dirt tile to the right since they get read right to left (02 is grass, 20 is dirt). Why would it do that?<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20153 - NoMis - Mon May 03, 2004 7:20 am</h4>
    <div class="postbody"><span class="postbody">The copy method looks alright to me and i suppose you set the background to 256x256. 
<br/>
It may be a bug with 256 color mode because as far as i know it wasn't realy tested. Nessi may be able to help you.
<br/>
<br/>
NoMis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20159 - CyberSlag5k - Mon May 03, 2004 1:27 pm</h4>
    <div class="postbody"><span class="postbody">Yup, it's at 256x256. I thought the same about the 256 color thing but dagamer34 tells me it works. I sent an e-mail to Nessie last night.<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20160 - Cearn - Mon May 03, 2004 1:35 pm</h4>
    <div class="postbody"><span class="postbody">You're trying to use text-background data for a rotation background. For example, what you <span style="font-style: italic">think</span> are the first 3 map-entries
<br/>
<br/>
0x0000,0x2001,0x0000, etc, etc.
<br/>
<br/>
are interpreted by the GBA as the first 6 map-entries of your rotation map
<br/>
<br/>
0x00, 0x00, 0x01, 0x20, 0x00, 0x00, etc, etc.
<br/>
<br/>
Which naturally results in the map of 2.bmp.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20164 - CyberSlag5k - Mon May 03, 2004 2:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You're trying to use text-background data for a rotation background. </td> </tr></table><span class="postbody">
<br/>
<br/>
I wasn't aware that rotation backgrounds read data differently. What format would the data need to be in for a rotation background?<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20165 - Cearn - Mon May 03, 2004 2:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I wasn't aware that rotation backgrounds read data differently. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
Yes you were; sajimori said so in response to one of your <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=3324" target="_blank">earlier posts</a> :P
<br/>
<br/>
Anyway, map-entries in
<br/>
<br/>
a text background: 16 bits integer
<br/>
bits 0-9 : tile index
<br/>
bit 10 : horizontal flip
<br/>
bit 11: vertical flip
<br/>
bits 12-15 : sub-palette (for 16 color backgrounds)
<br/>
<br/>
a rotation background: 8 bits integer
<br/>
bits 0-7 : tile-index; no more, no less.
<br/>
<br/>
Confusing the two wreaks havoc on your maps (just like confusion between 4 and 8 bit data do for tiles).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20167 - NoMis - Mon May 03, 2004 3:56 pm</h4>
    <div class="postbody"><span class="postbody">Man! why i didn't see it *hit me*</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20169 - CyberSlag5k - Mon May 03, 2004 4:04 pm</h4>
    <div class="postbody"><span class="postbody">But the map data is still skewed, is it not?
<br/>
<br/>
<span style="font-weight: bold">0x2002,0x2003,0x2004,</span>0x0000,0x0000,0x0000,0x2008,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000, 
<br/>
<br/>
That is the third line of my array (which should be the second row of tiles). It will be read as such:
<br/>
<br/>
0x02 0x20 0x03 0x20 0x04 0x20
<br/>
grass dirt  grass dirt   grass dirt
<br/>
<br/>
Which is still wrong. It should be dirt dirt dirt grass<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20171 - CyberSlag5k - Mon May 03, 2004 4:09 pm</h4>
    <div class="postbody"><span class="postbody">ok, wait, i think i see it. tell me if I'm right here...I just wrote that the map was like this:
<br/>
<br/>
<span style="font-weight: bold">0x02</span> 0x20 <span style="font-weight: bold">0x03</span> 0x20 <span style="font-weight: bold">0x04</span> 0x20 
<br/>
grass dirt grass dirt grass dirt 
<br/>
<br/>
are the bold entries not tile locations, but information about the tiles themselves? Information that text backgrounds would use but rotation backgrounds would not? Those extra 8 bits, in other words?<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20172 - CyberSlag5k - Mon May 03, 2004 5:23 pm</h4>
    <div class="postbody"><span class="postbody">Haha! FINALLY! I finally have my tile background working as it should.
<br/>
<br/>
My problem was exactly as you said, Carn, I was using text background data for a rotation background.
<br/>
<br/>
Thank you to everyone!<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20344 - Cearn - Sat May 08, 2004 1:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>CyberSlag5k wrote:</b></span></td> </tr> <tr> <td class="quote">ok, wait, i think i see it. tell me if I'm right here...I just wrote that the map was like this:
<br/>
<br/>
<span style="font-weight: bold">0x02</span> 0x20 <span style="font-weight: bold">0x03</span> 0x20 <span style="font-weight: bold">0x04</span> 0x20 
<br/>
grass dirt grass dirt grass dirt 
<br/>
<br/>
are the bold entries not tile locations, but information about the tiles themselves? Information that text backgrounds would use but rotation backgrounds would not? Those extra 8 bits, in other words?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, almost.
<br/>
Starting with the tileset of tiles.bmp. This is a 256x256 pixel bitmap which , means it holds 32x32 tiles. The tiles are numbered linearly, just like the 1D mapping mode for sprites. Meaning that 0-3 are grass, 4-7 is dirt, 8-11 is road, then black tiles for the rest of the tile-row until we come to the second tile-row, which uses tile index 32 (0x20), which is <span style="font-style: italic">grass</span> again, not dirt.
<br/>
This indexing is used in the map-entries (and I do mean map-entries and <span style="font-style: italic">not</span> tiles. Tiles are image data). Although text backgrounds use 16bit map-entries and rotational bgs use 8bits, it is possible to use the lower byte of a text map for the entries of a rotational map, like you thought.
<br/>
<br/>
In summary, if we take a part of the 16bits text map:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
0x2002, 0x2003, 0x2004
<br/>
grass   grass   dirt
<br/>
</td> </tr></table><span class="postbody">
<br/>
The first nybble contains the palette-number, but that's only of interest in 16color maps.
<br/>
Now, since you're using a rotational map, which uses 8bits, the GBA sees this as
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
[b]0x02[/b]  0x20  [b]0x03[/b]  0x20  [b]0x04[/b]  0x20
<br/>
grass grass grass grass dirt  grass
<br/>
</td> </tr></table><span class="postbody">
<br/>
The reason the bytes are switch is because we are using a little-endian 
<br/>
system; the lowerst bytes of a type with &gt;8bits goes first. Now, the 
<br/>
<span style="font-weight: bold">bold</span> entries contain the tile-indices, so you could use those to form the map. The rest is indeed extra information.
<br/>
<br/>
Now, although this does work, you'll get into trouble again when you try bigger or smaller maps. The bigger text maps are divided into screen-blocks, while rotational maps aren't. This means that you'll have to do that conversion manually as well. And the fact that the range of sizes 
<br/>
are different for text and rotational bgs can cause problems as well, just like the fact that you only can use two of them at most. And you've already seen that MapEd (like most map editors) exports to text backgrounds, and that you can't write to VRAM in 8bit chunks.
<br/>
<br/>
Hmmm, can I suggest you use text backgrounds instead, and save yourself a heap of trouble?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20345 - CyberSlag5k - Sat May 08, 2004 4:51 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Cearn, that clears quite a bit up.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Hmmm, can I suggest you use text backgrounds instead, and save yourself a heap of trouble?</td> </tr></table><span class="postbody">
<br/>
<br/>
Indeed I already have and it has made my life a ton easier. I have my backgrounds working exactly the way I want them.
<br/>
<br/>
Thanks again!<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
