<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>A drawing anomaly. Update from previous problems. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > A drawing anomaly. Update from previous problems.</h2>
<div id="posts">
<div class="post">
    <h4>#177749 - Skalbe - Sun Jan 27, 2013 2:38 pm</h4>
    <div class="postbody"><span class="postbody">Hi guys. I`m trying to create a game on GBA that would resemble a classic D&amp;D adventure, but I`m already stuck.. just with the basic drawing part of my program. What I have and what I`m trying to do is:
<br/>
I got a class with variables, a member drawing function, a constructor and later in the main I initialize two objects off of this. I use the function to re-draw my object1 in the while loop and I use the constructor to initialize my both objects just outside of the while loop. The thing is I can`t initialize my variable values within the constructor as one usually would because I use it to draw my both objects, but then I use the function to `move` just one of them. I need to make it so that the function updates my initialized variable values of object1 and redraws it in a new position as I press the buttons. I feel like the problem resides in some faulty logic and I can`t figure it out. Yet I know it can be done. So far I have tried changing around the value increment/decrement with the draw function and also commenting out both FlipBuffers and ClearScreen, but nothing changes. Also the result of this code is my two objects are drawn at their starting positions and I can`t move them. Also hi Adam... if you are here for some reason I feel terribly ashamed for my stupidity, but at the same time I will feel more ashamed if I don`t go and try to understand this.
<br/>
**********
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;stdint.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
#include "gba.h"
<br/>
<br/>
// A class with variables for the characters.
<br/>
class CHARBOX
<br/>
{
<br/>
   public:
<br/>
   int init_;
<br/>
   int str_;
<br/>
   int health_;
<br/>
   int posx_;
<br/>
   int posy_;
<br/>
   int width_;
<br/>
   int height_;
<br/>
   int colour_;
<br/>
<br/>
   public:
<br/>
   // Constructor.
<br/>
   CHARBOX(int posx, int posy, int width, int height, int colour)
<br/>
        : init_(0), str_(0), health_(0), posx_(posx), posy_(posy), 
<br/>
          width_(width), height_(height), colour_(colour)
<br/>
   {
<br/>
      DrawBox();
<br/>
   }
<br/>
   
<br/>
   // Drawing functions.
<br/>
   void DrawBox()
<br/>
   {
<br/>
      for (int x = posx_; x &lt; posx_ + width_; x++)
<br/>
      {
<br/>
         for (int y = posy_; y &lt; posy_ + height_; y++)
<br/>
         {
<br/>
            PlotPixel8(x, y, colour_);
<br/>
         }
<br/>
      }
<br/>
   }
<br/>
};
<br/>
<br/>
// The entry point for the game.
<br/>
int main()
<br/>
{
<br/>
   // Put the display into bitmap mode 4, and enable background 2.
<br/>
   REG_DISPCNT = MODE4 | BG2_ENABLE;
<br/>
   
<br/>
   // Defining some colour palettes.
<br/>
   SetPaletteBG(1, RGB(90,0,0));
<br/>
   SetPaletteBG(2, RGB(0,90,0));
<br/>
   SetPaletteBG(3, RGB(0,0,90));
<br/>
   SetPaletteBG(4, RGB(90,90,0));
<br/>
   SetPaletteBG(5, RGB(90,0,90));
<br/>
   
<br/>
   // Draw the player dude-box at a starting location.
<br/>
   CHARBOX player(10, 24, 6, 8, 1);
<br/>
      
<br/>
   // Draw the enemy dude-box at a starting location.
<br/>
   CHARBOX enemy(80, 24, 6, 8, 2);
<br/>
   
<br/>
   while (true);
<br/>
   {
<br/>
      // Flip buffers to smoothen the drawing.
<br/>
      FlipBuffers();
<br/>
      
<br/>
      // Clear screen and paint background.
<br/>
      ClearScreen8(1);
<br/>
      
<br/>
      // Screen edges.
<br/>
      if (player.posx_ &gt; (SCREEN_WIDTH - 8))
<br/>
      {
<br/>
         player.posx_ = (SCREEN_WIDTH - 8);
<br/>
      }
<br/>
      if (player.posx_ &lt; 2)
<br/>
      {
<br/>
         player.posx_ = 2;
<br/>
      }
<br/>
      if (player.posy_ &gt; (SCREEN_HEIGHT - 6))
<br/>
      {
<br/>
         player.posy_ = (SCREEN_HEIGHT - 6);
<br/>
      }
<br/>
      if (player.posy_ &lt; 1)
<br/>
      {
<br/>
         player.posy_ = 2;
<br/>
      }
<br/>
   
<br/>
      // Redraw the player dude-box.
<br/>
      if ((REG_KEYINPUT &amp; KEY_LEFT) == 0)
<br/>
      {
<br/>
         player.DrawBox();
<br/>
         player.posx_--;
<br/>
      }
<br/>
      
<br/>
      if ((REG_KEYINPUT &amp; KEY_RIGHT) == 0)
<br/>
      {
<br/>
         player.DrawBox();
<br/>
         player.posx_++;
<br/>
      }
<br/>
      
<br/>
      if ((REG_KEYINPUT &amp; KEY_UP) == 0)
<br/>
      {
<br/>
         player.DrawBox();
<br/>
         player.posy_--;
<br/>
      }
<br/>
      
<br/>
      if ((REG_KEYINPUT &amp; KEY_DOWN) == 0)
<br/>
      {
<br/>
         player.DrawBox();
<br/>
         player.posy_++;
<br/>
      }
<br/>
   WaitVSync();
<br/>
   }
<br/>
return 0;
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by Skalbe on Mon Jan 28, 2013 12:36 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#177750 - elhobbs - Sun Jan 27, 2013 4:29 pm</h4>
    <div class="postbody"><span class="postbody">this is true when the key is not pressed
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">(REG_KEYINPUT &amp; KEY_LEFT) == 0</td> </tr></table><span class="postbody">
<br/>
<br/>
I think you probably only want to do something when a key is pressed
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">(REG_KEYINPUT &amp; KEY_LEFT) != 0</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177751 - Skalbe - Sun Jan 27, 2013 4:59 pm</h4>
    <div class="postbody"><span class="postbody">No, the key logic is fine. I was pointed to the fact that my code didn't actually get to my main loop... because I had a semi-colon after my while...
<br/>
<br/>
however now that the original problem is solved my drawing part still has some issues:
<br/>
The drawing is smooth, but it leaves a trail of the previous positions of the box. I am using the ClearScreen function to set the background once. I moved it out of my while to my main just before the object initialization and I`m using FlipBuffers just at the start of my while loop. I am following my tutorial guides and I believe this should work like this, but it does not.
<br/>
<br/>
Edit: To make the trail disappear I believe I should be redrawing the screen every time the loop runs, right? But if I move my ClearScreen function to my while(true) the objects do not appear at their starting positions at the start anymore, because the ClearScreen just clears them away.
<br/>
This is how the code is now:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;stdint.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
#include "gba.h"
<br/>
<br/>
// A class with variables for the characters.
<br/>
class CHARBOX
<br/>
{
<br/>
   public:
<br/>
   int init_;
<br/>
   int str_;
<br/>
   int health_;
<br/>
   int posx_;
<br/>
   int posy_;
<br/>
   int width_;
<br/>
   int height_;
<br/>
   int colour_;
<br/>
<br/>
   public:
<br/>
   // Constructor.
<br/>
   CHARBOX(int posx, int posy, int width, int height, int colour)
<br/>
        : init_(0), str_(0), health_(0), posx_(posx), posy_(posy), 
<br/>
          width_(width), height_(height), colour_(colour)
<br/>
   {
<br/>
      DrawBox();
<br/>
   }
<br/>
   
<br/>
   // Drawing functions.
<br/>
   void DrawBox()
<br/>
   {
<br/>
      for (int x = posx_; x &lt; posx_ + width_; x++)
<br/>
      {
<br/>
         for (int y = posy_; y &lt; posy_ + height_; y++)
<br/>
         {
<br/>
            PlotPixel8(x, y, colour_);
<br/>
         }
<br/>
      }
<br/>
   }
<br/>
};
<br/>
<br/>
// The entry point for the game.
<br/>
int main()
<br/>
{
<br/>
   // Put the display into bitmap mode 4, and enable background 2.
<br/>
   REG_DISPCNT = MODE4 | BG2_ENABLE;
<br/>
   
<br/>
   // Defining some colour palettes.
<br/>
   SetPaletteBG(1, RGB(90,0,0));
<br/>
   SetPaletteBG(2, RGB(0,90,0));
<br/>
   SetPaletteBG(3, RGB(0,0,90));
<br/>
   SetPaletteBG(4, RGB(90,90,0));
<br/>
   SetPaletteBG(5, RGB(90,0,90));
<br/>
   SetPaletteBG(6, RGB(0,0,0));
<br/>
   
<br/>
   // Clear screen and paint background.
<br/>
   ClearScreen8(4);
<br/>
<br/>
   // Draw the player dude-box at a starting location.
<br/>
   CHARBOX player(10, 24, 6, 8, 1);
<br/>
<br/>
   // Draw the enemy dude-box at a starting location.
<br/>
   CHARBOX enemy(80, 24, 6, 8, 3);
<br/>
   
<br/>
   while (true)
<br/>
   {
<br/>
      // Flip buffers to smoothen the drawing.
<br/>
      void FlipBuffers();
<br/>
      
<br/>
      // Screen edges.
<br/>
      if (player.posx_ &gt; (SCREEN_WIDTH - 6))
<br/>
      {
<br/>
         player.posx_ = (SCREEN_WIDTH - 6);
<br/>
      }
<br/>
      if (player.posx_ &lt; 0)
<br/>
      {
<br/>
         player.posx_ = 0;
<br/>
      }
<br/>
      if (player.posy_ &gt; (SCREEN_HEIGHT - 8))
<br/>
      {
<br/>
         player.posy_ = (SCREEN_HEIGHT - 8);
<br/>
      }
<br/>
      if (player.posy_ &lt; 0)
<br/>
      {
<br/>
         player.posy_ = 0;
<br/>
      }
<br/>
   
<br/>
      // Redraw the player dude-box.
<br/>
      if ((REG_KEYINPUT &amp; KEY_LEFT) == 0)
<br/>
      {
<br/>
         player.DrawBox();
<br/>
         player.posx_--;
<br/>
      }
<br/>
      
<br/>
      if ((REG_KEYINPUT &amp; KEY_RIGHT) == 0)
<br/>
      {
<br/>
         player.DrawBox();
<br/>
         player.posx_++;
<br/>
      }
<br/>
      
<br/>
      if ((REG_KEYINPUT &amp; KEY_UP) == 0)
<br/>
      {
<br/>
         player.DrawBox();
<br/>
         player.posy_--;
<br/>
      }
<br/>
      
<br/>
      if ((REG_KEYINPUT &amp; KEY_DOWN) == 0)
<br/>
      {
<br/>
         player.DrawBox();
<br/>
         player.posy_++;
<br/>
      }
<br/>
<br/>
   frames++;
<br/>
   WaitVSync();
<br/>
   }
<br/>
return 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
After this I came up with a solution where I basically put these three lines of code at the very top of my main above the FlipBuffers function:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ClearScreen8(4);
<br/>
      
<br/>
   player.DrawBox();
<br/>
   enemy.DrawBox();</td> </tr></table><span class="postbody">
<br/>
<br/>
This doesn`t feel like a good solution though because I feel like if I`m starting to draw my boxes there I might just as well just throw the constructor away. Also now when I move my player box to the upper part of the screen at one point it disappears kind of `behind` the screen which leads me to believe that some of my code makes the program draw something outside the screen although I have given it borders. This was not happening before my last `solution`.
<br/>
<br/>
Edit: After some more experiments I discovered that moving the ClearScreen function into my while loop is what creates the anomalies. I tried replacing the ClearScreen function with a manual draw the screen background function with a for within a for loop and that made the anomaly disappear, but the redrawing was happening incredibly slowly and the boxes were flickering.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177752 - elhobbs - Mon Jan 28, 2013 12:33 pm</h4>
    <div class="postbody"><span class="postbody">That's fine. The key logic looks weird since you are alway adding and subtracting the position each frame and drawing the player in all cases - 4 times each frame if no button is pressed. And not drawing when a key is pressed.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
