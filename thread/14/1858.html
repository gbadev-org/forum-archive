<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Messed up background in MODE 0 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Messed up background in MODE 0</h2>
<div id="posts">
<div class="post">
    <h4>#9538 - yaustar - Thu Aug 07, 2003 10:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Start main code
<br/>
int main(void)
<br/>
{
<br/>
    u16 loop;
<br/>
    u16 temp = 0;
<br/>
    u16* temp_map;
<br/>
       
<br/>
    // Put the lights in the right position on screen
<br/>
    for(int x=0; x&lt;5; x++)
<br/>
    {
<br/>
        for(int y=0; y&lt;5; y++)
<br/>
        {
<br/>
                allLights[x][y].y = y*32;
<br/>
                allLights[x][y].x = x*32;
<br/>
                allLights[x][y].activeFrame = OFF;
<br/>
                allLights[x][y].spriteFrame[0] = 0;
<br/>
                // 32x32 sprite uses 16 8x8 tiles
<br/>
                allLights[x][y].spriteFrame[1] = 16;
<br/>
                allLights[x][y].OAMSpriteNum = temp;
<br/>
                temp++;
<br/>
        }
<br/>
    }
<br/>
    
<br/>
    // Have the selector sprite by default on the top left of the 
<br/>
    // light array
<br/>
    selector.X = 0;
<br/>
    selector.Y = 0;
<br/>
    selector.x = 0;
<br/>
    selector.y = 0;
<br/>
    selector.OAMSpriteNum = 25;
<br/>
    selector.spriteFrame = 32;
<br/>
    
<br/>
    // Set screen mode to MODE 0, enable sprites using 1D mapping
<br/>
    SetMode(MODE_0 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
    
<br/>
    // Loading the palette into memory (16 colour palette)
<br/>
    for(loop = 0; loop &lt; 16; loop++)
<br/>
    {
<br/>
        OBJPaletteMem[loop] = palette[loop];
<br/>
    }
<br/>
    
<br/>
    InitialiseSprites();
<br/>
    
<br/>
    // Load Sprite data into memory
<br/>
    
<br/>
    // The OFF state of light
<br/>
    for(loop = 0; loop &lt; 256; loop++)
<br/>
    {
<br/>
        OAMData[loop] = g_OFF[loop];
<br/>
    }
<br/>
    // The ON state of light
<br/>
    for(loop = 256; loop &lt; 512; loop++)
<br/>
    {
<br/>
        OAMData[loop] = g_ON[loop - 256];
<br/>
    } 
<br/>
    
<br/>
    // The SELECTOR sprite
<br/>
    for(loop = 512; loop &lt; 768; loop++)
<br/>
    {
<br/>
        OAMData[loop] = g_SELECT[loop - 512];
<br/>
    }
<br/>
   
<br/>
    // Attribute stuff
<br/>
    for(int x = 0; x &lt; 5; x++)
<br/>
    {
<br/>
        for(int y = 0; y &lt; 5; y++)
<br/>
        {
<br/>
            SPRITES[allLights[x][y].OAMSpriteNum].attribute0 = 
<br/>
              COLOR_16 | SQUARE | allLights[x][y].y;
<br/>
                 
<br/>
            SPRITES[allLights[x][y].OAMSpriteNum].attribute1 =
<br/>
              SIZE_32 | allLights[x][y].x;
<br/>
                   
<br/>
            SPRITES[allLights[x][y].OAMSpriteNum].attribute2 = 
<br/>
              allLights[x][y].spriteFrame[allLights[x][y].activeFrame];
<br/>
        }
<br/>
    }
<br/>
    
<br/>
    SPRITES[selector.OAMSpriteNum].attribute0 =
<br/>
        COLOR_16 | SQUARE | selector.y;
<br/>
        
<br/>
    SPRITES[selector.OAMSpriteNum].attribute1 =
<br/>
        SIZE_32 | selector.x;
<br/>
    
<br/>
    SPRITES[selector.OAMSpriteNum].attribute2 =
<br/>
        selector.spriteFrame;
<br/>
                                                                                                                                              
<br/>
    bg_title.number = 0;            //background number 0-3
<br/>
    bg_title.charBaseBlock = 0;     //tile start position
<br/>
    bg_title.screenBaseBlock = 28;  //map position on 2Kb boundary
<br/>
    bg_title.colorMode = BG_COLOR_256; //colour mode of the tiles 16/256
<br/>
    bg_title.size = ROTBG_SIZE_256x256;//size of map
<br/>
    bg_title.mosaic = 0;            //disable mosiac property
<br/>
    bg_title.x_scroll = 0;
<br/>
    bg_title.y_scroll = 0;
<br/>
    
<br/>
    // enable background(s)
<br/>
    EnableBackground(&amp;bg_title);
<br/>
    
<br/>
    // Load all data of map into array
<br/>
    for(loop = 0; loop &lt; 256; loop++)
<br/>
      BGPaletteMem[loop] = g_bg_tilesPalette[loop];     //load the background palette into memory
<br/>
<br/>
   for(loop = 0; loop &lt; g_bg_tiles_WIDTH * g_bg_tiles_HEIGHT /2; loop++)  //load tile image data
<br/>
      bg_title.tileData[loop] = g_bg_tilesData[loop];
<br/>
<br/>
   //load the map image data
<br/>
   temp_map = (u16*)title1;
<br/>
   
<br/>
   for(loop = 0; loop &lt; 32*32/2; loop++) //32x32 tiles /2 because 16 bit copy
<br/>
      bg_title.mapData[loop] = temp_map[loop];
<br/>
    
<br/>
    while(1)
<br/>
    {
<br/>
        if(!(*KEYS &amp; KEY_START))        //if player presses start, thne exit title screen
<br/>
        {
<br/>
            exit_game = 0;
<br/>
            bg_title.x_scroll = 240;    //move bacground off screen
<br/>
            bg_title.y_scroll = 160;
<br/>
        }
<br/>
          
<br/>
        WaitForVSync();
<br/>
        UpdateBackground(&amp;bg_title);    
<br/>
          
<br/>
        while(exit_game == 0)
<br/>
        {
<br/>
            // Initialise the position of the selector
<br/>
            selector.X = 0;
<br/>
            selector.Y = 0;
<br/>
               
<br/>
            // Load the puzzle data
<br/>
            for(int x = 0; x &lt; 5; x++)
<br/>
            {
<br/>
                 for(int y = 0; y &lt; 5; y++)
<br/>
                 {
<br/>
                       // Just because the way that the array is defined
<br/>
                       allLights[x][y].activeFrame = test01[y][x];
<br/>
                 }
<br/>
            }
<br/>
            
<br/>
            UpdateDisplay();  // Update the lights display
<br/>
            
<br/>
            // Display loop
<br/>
            while(CheckWin() != 25)
<br/>
            {
<br/>
                    CheckUser();      // Check if user has pressed any buttins
<br/>
                    GetInput();       // Get input from the user
<br/>
                    UpdateDisplay();  // Update the lights display
<br/>
                    WaitForVSync();   // Wait for screen to stop drawing
<br/>
                    CopyOAM();        // Copy sprite data over
<br/>
                    
<br/>
                    counter_0++;      // Increment the counter every VSync/VBlank
<br/>
                    
<br/>
                    if(counter_0 == 30) counter_0 = 0;
<br/>
            }
<br/>
        }
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Here's the code. The background is completely messed up as it uses the tiles but sometimes they flipped and in the wrong places.
<br/>
<br/>
There is no problem with the data, just the code.
<br/>
<br/>
edit: I think that the gba is reading it as a text background hence why it thinks it is 512x256 instead of 256x256 and some of the tiles are flipped. Problem is I dont know how to fix it!!
<br/>
argghgh<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9543 - tepples - Fri Aug 08, 2003 4:19 am</h4>
    <div class="postbody"><span class="postbody">You need to use MODE 1 or MODE 2 instead of MODE 0 to get a rot/scale background to appear.  In MODE 1, a rot/scale background is BG2; in MODE 2, a rot/scale background is BG2 or BG3.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9546 - yaustar - Fri Aug 08, 2003 4:31 am</h4>
    <div class="postbody"><span class="postbody">so MODE 0 only displays plain text backgrounds?<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9548 - tepples - Fri Aug 08, 2003 6:13 am</h4>
    <div class="postbody"><span class="postbody">Correct. Please read the <a class="postlink" href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#Graphics%20Hardware%20Overview" target="_blank">CowBite spec's description of the GBA's display modes</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
