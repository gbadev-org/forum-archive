<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>display all background in mode 0 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > display all background in mode 0</h2>
<div id="posts">
<div class="post">
    <h4>#53179 - daygo - Tue Sep 06, 2005 4:36 pm</h4>
    <div class="postbody"><span class="postbody">hello, i'm a italian boy e i don't speak english very well.....
<br/>
<br/>
i have a problem, this code don't draw background 4...why?
<br/>
<br/>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;mygba.h&gt;
<br/>
MULTIBOOT
<br/>
<br/>
#include "image1.pal.c"
<br/>
#include "image1.map.c"
<br/>
#include "image1.raw.c"
<br/>
#include "image2.pal.c"
<br/>
#include "image2.map.c"
<br/>
#include "image2.raw.c"
<br/>
#include "image3.pal.c"
<br/>
#include "image3.map.c"
<br/>
#include "image3.raw.c"
<br/>
#include "image4.pal.c"
<br/>
#include "image4.map.c"
<br/>
#include "image4.raw.c"
<br/>
<br/>
#define REG_DMA3SAD *(volatile unsigned int*)0x40000D4
<br/>
#define REG_DMA3DAD *(volatile unsigned int*)0x40000D8
<br/>
#define REG_DMA3CNT *(volatile unsigned int*)0x40000DC
<br/>
#define DMA_ENABLE 0x80000000
<br/>
#define DMA_TIMING_IMMEDIAT 0x00000000
<br/>
#define DMA_16 0x00000000
<br/>
#define DMA_32 0x04000000
<br/>
#define DMA_16im (DMA_ENABLE | DMA_TIMING_IMMEDIAT | DMA_16)
<br/>
#define DMA_32im (DMA_ENABLE | DMA_TIMING_IMMEDIAT | DMA_32)
<br/>
<br/>
#define REG_KEYS *(volatile unsigned long*) 0x4000130
<br/>
#define REG_TOUCHES (~(REG_KEYS) &amp; 0x03FF)
<br/>
#define TOUCHE_DROITE 0x0010
<br/>
#define TOUCHE_GAUCHE 0x0020
<br/>
#define TOUCHE_HAUT 0x0040
<br/>
#define TOUCHE_BAS 0x0080
<br/>
<br/>
volatile unsigned short* scan = (volatile unsigned short*)0x4000006;
<br/>
<br/>
#define REG_DISPCNT *(volatile unsigned long*)0x4000000
<br/>
<br/>
#define VIDEO_MODE0 0x0
<br/>
#define VIDEO_MODE1 0x1
<br/>
#define VIDEO_MODE2 0x2
<br/>
#define VIDEO_MODE3 0x3
<br/>
#define VIDEO_MODE4 0x4
<br/>
#define VIDEO_MODE5 0x5
<br/>
<br/>
#define BG0_ENABLED 0x100
<br/>
#define BG1_ENABLED 0x200
<br/>
#define BG2_ENABLED 0x400
<br/>
#define BG3_ENABLED 0x800
<br/>
<br/>
#define BG_PRIORITE_0 0x0000
<br/>
#define BG_PRIORITE_1 0x0001
<br/>
#define BG_PRIORITE_2 0x0002
<br/>
#define BG_PRIORITE_3 0x0003
<br/>
<br/>
#define BG_CHARBLOCK_0 0x0000
<br/>
#define BG_CHARBLOCK_1 0x0004
<br/>
#define BG_CHARBLOCK_2 0x0008
<br/>
#define BG_CHARBLOCK_3 0x000C
<br/>
<br/>
#define BG_EFFET_MOSAIQUE 0x0040
<br/>
<br/>
#define BG_1_PALETTE 0x0080
<br/>
#define BG_16_PALETTES 0x0000
<br/>
<br/>
#define BG_WRAP 0x2000
<br/>
<br/>
#define BG_TEXTE_256x256 0x0000
<br/>
#define BG_TEXTE_512x256 0x4000
<br/>
#define BG_TEXTE_256x512 0x8000
<br/>
#define BG_TEXTE_512x512 0xC000
<br/>
<br/>
#define BG_ROTATION_128x128 0x0000
<br/>
#define BG_ROTATION_256x256 0x4000
<br/>
#define BG_ROTATION_512x512 0x8000
<br/>
#define BG_ROTATION_1024x1024 0xC000
<br/>
<br/>
#define REG_BG0CNT *(volatile unsigned short*) 0x4000008
<br/>
#define REG_BG1CNT *(volatile unsigned short*) 0x400000A
<br/>
#define REG_BG2CNT *(volatile unsigned short*) 0x400000C
<br/>
#define REG_BG3CNT *(volatile unsigned short*) 0x400000E
<br/>
<br/>
#define REG_BG0HOFS *(volatile unsigned short*) 0x4000010
<br/>
#define REG_BG0VOFS *(volatile unsigned short*) 0x4000012
<br/>
#define REG_BG1HOFS *(volatile unsigned short*) 0x4000014
<br/>
#define REG_BG1VOFS *(volatile unsigned short*) 0x4000016
<br/>
#define REG_BG2HOFS *(volatile unsigned short*) 0x4000018
<br/>
#define REG_BG2VOFS *(volatile unsigned short*) 0x400001A
<br/>
#define REG_BG3HOFS *(volatile unsigned short*) 0x400001C
<br/>
#define REG_BG3VOFS *(volatile unsigned short*) 0x400001E
<br/>
<br/>
#define CharBaseBlock(n) (((n)*0x4000)+0x6000000)
<br/>
#define ScreenBaseBlock(n) (((n)*0x0800)+0x6000000)
<br/>
<br/>
unsigned short int * Palette = (unsigned short int *) 0x5000000;
<br/>
<br/>
int main(void)
<br/>
{
<br/>
int x, y, c;
<br/>
<br/>
REG_DISPCNT = (VIDEO_MODE0|BG0_ENABLED|BG1_ENABLED|BG2_ENABLED|BG3_ENABLED);
<br/>
<br/>
REG_BG0CNT = BG_TEXTE_256x256 | BG_1_PALETTE | BG_WRAP | BG_CHARBLOCK_0 | 31&lt;&lt;8  ;
<br/>
REG_BG1CNT = BG_TEXTE_256x256 | BG_1_PALETTE | BG_WRAP | BG_CHARBLOCK_1 | 30&lt;&lt;8  ;
<br/>
REG_BG2CNT = BG_TEXTE_256x256 | BG_1_PALETTE | BG_WRAP | BG_CHARBLOCK_2 | 29&lt;&lt;8 ;
<br/>
REG_BG3CNT = BG_TEXTE_256x256 | BG_1_PALETTE | BG_WRAP | BG_CHARBLOCK_3 | 28&lt;&lt;8 ;
<br/>
<br/>
CopieDMA((void*)image1_Palette, (void*)Palette, 256, DMA_16im);
<br/>
<br/>
CopieDMA((void*)image1_Tiles, (void*)CharBaseBlock(0), 2816, DMA_16im);
<br/>
CopieDMA((void*)image1_Map,(void*)ScreenBaseBlock(31),1024, DMA_16im);
<br/>
<br/>
CopieDMA((void*)image2_Tiles, (void*)CharBaseBlock(1), 4096, DMA_16im);
<br/>
CopieDMA((void*)image2_Map,(void*)ScreenBaseBlock(30),1024, DMA_16im);
<br/>
<br/>
CopieDMA((void*)image3_Tiles, (void*)CharBaseBlock(2), 12928, DMA_16im);
<br/>
CopieDMA((void*)image3_Map,(void*)ScreenBaseBlock(29),1024, DMA_16im);
<br/>
<br/>
CopieDMA((void*)image4_Tiles, (void*)CharBaseBlock(3), 15104, DMA_32im);
<br/>
CopieDMA((void*)image4_Map,(void*)ScreenBaseBlock(28),1024, DMA_32im);
<br/>
<br/>
<br/>
   while(1)
<br/>
   {
<br/>
REG_BG0VOFS = y;
<br/>
REG_BG0HOFS = x;
<br/>
switch(REG_TOUCHES){
<br/>
case TOUCHE_HAUT:
<br/>
y--;
<br/>
break;
<br/>
case TOUCHE_BAS:
<br/>
y++;
<br/>
break;
<br/>
case TOUCHE_GAUCHE:
<br/>
x--;
<br/>
break;
<br/>
case TOUCHE_DROITE:
<br/>
x++;
<br/>
break;
<br/>
}
<br/>
//Attendre un peu avant la prochaine action
<br/>
for(c=0;c&lt;120;c++){
<br/>
while (*scan&lt;160);;
<br/>
}
<br/>
}
<br/>
return 0;
<br/>
}
<br/>
<br/>
void CopieDMA(void* source, void* dest, unsigned int nbval, unsigned int mode)
<br/>
{
<br/>
    if (mode == DMA_16im || mode == DMA_32im)
<br/>
    {
<br/>
        REG_DMA3SAD = (unsigned int)source;
<br/>
        REG_DMA3DAD = (unsigned int)dest;
<br/>
        REG_DMA3CNT = nbval | mode;
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#53232 - daygo - Tue Sep 06, 2005 10:54 pm</h4>
    <div class="postbody"><span class="postbody">i don't know where is the error....help me!!!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#53236 - DiscoStew - Tue Sep 06, 2005 11:33 pm</h4>
    <div class="postbody"><span class="postbody">Now, I'm not quite sure of why the 4th background is not showing up, but one thing that works for me when trying code that does the same thing over multiple pieces is to try each one individually (like have just the 1st layer show, then fix it to just show the 2nd, then 3rd, then 4th). When doing this, try not to have the other layers do anything. I'll try looking at it more when I can...
<br/>
<br/>
EDIT:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
CopieDMA((void*)image1_Tiles, (void*)CharBaseBlock(0), <span style="font-weight: bold">2816</span>, DMA_16im);
<br/>
<br/>
CopieDMA((void*)image2_Tiles, (void*)CharBaseBlock(1), <span style="font-weight: bold">4096</span>, DMA_16im);
<br/>
<br/>
CopieDMA((void*)image3_Tiles, (void*)CharBaseBlock(2), <span style="font-weight: bold">12928</span>, DMA_16im);
<br/>
<br/>
CopieDMA((void*)image4_Tiles, (void*)CharBaseBlock(3), <span style="font-weight: bold"><span style="text-decoration: underline">15104</span></span>, DMA_32im);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I haven't done much GBA programming in a while, but I have this idea. Now, I understand that the values in <span style="font-weight: bold">Bold</span> are the number of words to copy over (2 bytes per word), but the last one (for the last background 15104 words equals 30208 bytes, I believe) seems rather big, especially since you are copying the MapData for all 4 layers into the last 4 slots. That last line of code shown above would write over the information from MapData slots [24] to [31] of the 2kByte boundaries, as well as trying to write data way past the VRAM boundary. Because of this, I would imagine that you would be having trouble showing ALL the layers. Reduce those values to say 4000, just to check, and see if you are still having problems<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
