<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Mixing modes together - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Mixing modes together</h2>
<div id="posts">
<div class="post">
    <h4>#11684 - yaustar - Wed Oct 15, 2003 9:36 pm</h4>
    <div class="postbody"><span class="postbody">Would it be posible to have the screen display the map and sprites from MODE 0 and then a mini map in the corner using pixels from MODE 4?<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11686 - DekuTree64 - Wed Oct 15, 2003 10:35 pm</h4>
    <div class="postbody"><span class="postbody">Nope. You can switch modes on HBlank, but according to my experiments on hardware you get a few lines of garbage before it settles into the new mode. And even then you can't have one mode on the left and another on the right side of the screen so it wouldn't help anyway. 
<br/>
For a mini-map, I'd say just make a buffer in EWRAM, draw to that, and copy it to tile/sprite mem one tile at a time. Or if possible, draw in tiles to begin with. That's usually pretty confusing and/or slow though.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11687 - tepples - Wed Oct 15, 2003 10:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">Nope. You can switch modes on HBlank, but according to my experiments on hardware you get a few lines of garbage before it settles into the new mode.</td> </tr></table><span class="postbody">
<br/>
I can see how this might be true of switches involving bitmap modes (as the OP suggests), but <span style="font-style: italic">Mario Kart Super Circuit</span> seems to switch from mode 0 to mode 1 halfway down the screen just fine. Can you provide a test case that shows garbage on a switch among modes 0, 1, 2? Hint: Try setting up scroll registers and affine registers <span style="font-style: italic">before</span> you trigger the mode switch.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">For a mini-map, I'd say just make a buffer in EWRAM, draw to that, and copy it to tile/sprite mem one tile at a time.</td> </tr></table><span class="postbody">
<br/>
I agree. Several games for Super NES and Sega Genesis had mini-maps, and those systems didn't have a linear bitmap mode. Heck, <span style="font-style: italic">Qix</span> for Game Boy is entirely a pseudo-bitmap engine on top of tile hardware.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11691 - poslundc - Thu Oct 16, 2003 12:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">I can see how this might be true of switches involving bitmap modes (as the OP suggests), but <span style="font-style: italic">Mario Kart Super Circuit</span> seems to switch from mode 0 to mode 1 halfway down the screen just fine. Can you provide a test case that shows garbage on a switch among modes 0, 1, 2? Hint: Try setting up scroll registers and affine registers <span style="font-style: italic">before</span> you trigger the mode switch.</td> </tr></table><span class="postbody">
<br/>
<br/>
I've run into the same problem on hardware... it's been my observation that messing with REG_DISPCNT during VDraw (even just to enable/disable a background or window) usually garbles a couple of <b style="color:#FFA34F">scanlines</b> while the changes take hold, even if all of the other settings are in place.
<br/>
<br/>
Are you certain that Mario Cart Super Circuit switches modes? I haven't actually played the game, but from screenshots it seems to me that it could be done in Mode 1, with BGs 0 and 1 as the two parallax scrolling backgrounds and BG2 as the terrain, using a window to keep them separate. This is what the Mode 7 program I'm working on currently does (with only one backdrop, though).
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11701 - tepples - Thu Oct 16, 2003 5:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Are you certain that Mario Cart Super Circuit switches modes? I haven't actually played the game, but from screenshots it seems to me that it could be done in Mode 1, with BGs 0 and 1 as the two parallax scrolling backgrounds and BG2 as the terrain</td> </tr></table><span class="postbody">
<br/>
Then where would it have put the HUD?  Most of the sprite pixels seemed to be in use for rot/scale objects on the track.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">This is what the Mode 7 program I'm working on currently does (with only one backdrop, though).</td> </tr></table><span class="postbody">
<br/>
I dumped my <span style="font-style: italic">MKSC</span> Game Pak and ran it in VBA. I noticed strange different behavior in VBA's tile viewer; Auto Update seemed to use the mode settings from the <span style="font-style: italic">last</span> scanline (drawn in mode 1), while switching backgrounds with the radio buttons seemed to use the mode settings from the <span style="font-style: italic">first</span> scanline (drawn in mode 0).
<br/>
<br/>
Top half:
<br/>
BG0 HUD, BG1 front bg <b style="color:#FFA34F">layer</b>, BG2 mid bg <b style="color:#FFA34F">layer</b>, BG 3 back bg <b style="color:#FFA34F">layer</b>
<br/>
Bottom half:
<br/>
BG0 HUD, BG1 front bg <b style="color:#FFA34F">layer</b>, BG2 track
<br/>
<br/>
So perhaps the front bg <b style="color:#FFA34F">layer</b> covers up a line or two of BG2 garbage.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11713 - poslundc - Thu Oct 16, 2003 4:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Then where would it have put the HUD?  Most of the sprite pixels seemed to be in use for rot/scale objects on the track.</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, from the screenshots I would've assumed that they're done with sprites... if there's one thing I've learned from you it's that sprite pixels are not a definitive limitation, since they could be swapping other sprites into VRAM as necessary. Of course, picking it apart in VBA is bound to be more revelatory than mere speculation, so...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I dumped my <span style="font-style: italic">MKSC</span> Game Pak and ran it in VBA. I noticed strange different behavior in VBA's tile viewer; Auto Update seemed to use the mode settings from the <span style="font-style: italic">last</span> scanline (drawn in mode 1), while switching backgrounds with the radio buttons seemed to use the mode settings from the <span style="font-style: italic">first</span> scanline (drawn in mode 0).</td> </tr></table><span class="postbody">
<br/>
<br/>
I've had to kind of guess at your meanings here, since I'm running the Mac version of VBA, which doesn't have all of the cool tile/background/oam viewer features (sadly enough; they would be quite helpful in my debugging work).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Top half:
<br/>
BG0 HUD, BG1 front bg <b style="color:#FFA34F">layer</b>, BG2 mid bg <b style="color:#FFA34F">layer</b>, BG 3 back bg <b style="color:#FFA34F">layer</b>
<br/>
Bottom half:
<br/>
BG0 HUD, BG1 front bg <b style="color:#FFA34F">layer</b>, BG2 track
<br/>
<br/>
So perhaps the front bg <b style="color:#FFA34F">layer</b> covers up a line or two of BG2 garbage.</td> </tr></table><span class="postbody">
<br/>
<br/>
Maybe, assuming that they timed the switching of priorities so that it didn't happen until a couple of <b style="color:#FFA34F">scanlines</b> after the mode switch. Or perhaps it could be done with windows, using the fact that win0 takes priority over win1. I'm not sure...
<br/>
<br/>
Is that middle bg <b style="color:#FFA34F">layer</b> always visible? From the screenshots it only seemed to me like there were two backdrop levels, not three.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11719 - tepples - Thu Oct 16, 2003 6:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">if there's one thing I've learned from you it's that sprite pixels are not a definitive limitation, since they could be swapping other sprites into VRAM as necessary.</td> </tr></table><span class="postbody">
<br/>
Sprites != sprite pixels. The limit of 128 OAM entries isn't much of a limit given the sort of OAM-swapping that <span style="font-style: italic">Super Puzzle Fighter II</span> and many other GBA games do, but the 950 horizontal units per scanline limit is a real limit. A non-scaled sprite takes one unit per pixel of width, while a scaled sprite takes 26 units per 8 pixels, and a double-size sprite takes 52 (source: GBATEK by Martin Korth).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Maybe, assuming that they timed the switching of priorities so that it didn't happen until a couple of <b style="color:#FFA34F">scanlines</b> after the mode switch. Or perhaps it could be done with windows, using the fact that win0 takes priority over win1. I'm not sure...
<br/>
<br/>
Is that middle bg <b style="color:#FFA34F">layer</b> always visible?</td> </tr></table><span class="postbody">
<br/>
For example, in Peach Circuit, the front <b style="color:#FFA34F">layer</b> (BG1, visible at all times) is a <b style="color:#FFA34F">layer</b> of forest about 8px or so tall, the middle <b style="color:#FFA34F">layer</b> (BG2, visible on the top half) has the castle, and the back <b style="color:#FFA34F">layer</b> (BG3, visible on the top half) has a gradient and clouds.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11720 - poslundc - Thu Oct 16, 2003 7:14 pm</h4>
    <div class="postbody"><span class="postbody">[quote="tepples"]</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Sprites != sprite pixels. The limit of 128 OAM entries isn't much of a limit given the sort of OAM-swapping that <span style="font-style: italic">Super Puzzle Fighter II</span> and many other GBA games do, but the 950 horizontal units per scanline limit is a real limit. A non-scaled sprite takes one unit per pixel of width, while a scaled sprite takes 26 units per 8 pixels, and a double-size sprite takes 52 (source: GBATEK by Martin Korth).</td> </tr></table><span class="postbody">
<br/>
<br/>
Ah, ok. Well, from the screenshots on Nintendo's website it doesn't look like it would become a problem, but those aren't very telling I suppose.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">For example, in Peach Circuit, the front <b style="color:#FFA34F">layer</b> (BG1, visible at all times) is a <b style="color:#FFA34F">layer</b> of forest about 8px or so tall, the middle <b style="color:#FFA34F">layer</b> (BG2, visible on the top half) has the castle, and the back <b style="color:#FFA34F">layer</b> (BG3, visible on the top half) has a gradient and clouds.</td> </tr></table><span class="postbody">
<br/>
<br/>
So as long as BG1 is at least a few pixels tall in all courses, it should obscure any negative effects if the mode change is begun a few <b style="color:#FFA34F">scanlines</b> early. It would also seem to suggest that the graphical artifacts caused by modifying REG_DISPCNT only affect the layers that are altered by the new setting. So in the case of changing from Mode 0 to Mode 1, there would be no graphical artifacts on backgrounds 0 and 1, only backgrounds 1 and 2.
<br/>
<br/>
This is all still fairly hypothetical, of course. My tests were limited to turning backgrounds on and off in REG_DISPCNT; I didn't try changing modes at all.
<br/>
<br/>
I guess they must've really badly wanted four background layers for that top half.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11724 - yaustar - Thu Oct 16, 2003 9:08 pm</h4>
    <div class="postbody"><span class="postbody">Well, I have though t of A solution to the mini map.
<br/>
<br/>
I was thinking of using a 64x64 (something like that) and change the data directly in the program. This would almost be like a bitmap mode. i just dont have a clue how efficient it would be. Saying this, I am not sure how the data is converted. From what I can tell, it's in converts it into 8x8 blocks (this is in 256 colour mode) left to right.
<br/>
<br/>
edit: (also in 256 colour mode) each value in the array represents two pixels,  holding the colour number within the palette. Not sure about 16 colour modes though
<br/>
<br/>
Krom suggested that I use a window and use a layered (perhaps scaled down) and copy the VRAM over. Problem here is that I have already used all four layers (oops) for other things.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
