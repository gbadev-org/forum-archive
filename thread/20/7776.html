<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Loading backup SRAM sav onto Mario Kart DS EEPROM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS Misc > Loading backup SRAM sav onto Mario Kart DS EEPROM</h2>
<div id="posts">
<div class="post">
    <h4>#63527 - Killjoy42 - Wed Dec 14, 2005 12:43 am</h4>
    <div class="postbody"><span class="postbody">I have backup save file I've been trying like crazy to load onto my Mario Kart cartridge. I tried using Etool3 as well as EtoolSMS to no avail. I even tried using the Nintendogs Trainer save backup function (it of course failed).
<br/>
<br/>
When I use Etool3 it identifies the Mario Kart cartridge as "PassMe inserted" (I use FlashMe) and I can't copy from or write to the EEPROM. When I used EtoolSMS, it identifies the game properly, but it won't back up the EEPROM properly, and I when I write the save file from my computer to the gba card, EtoolSMS makes me reformat the card memory on bootup (I'm pretty sure I'm writing it wrong).
<br/>
<br/>
I've used these programs to back up and restore all my other DS games, including Nintendogs (2Mbit save) and my card (EZ-Flash 256 PS) has a 2MB save battery.
<br/>
<br/>
Can anyone help me? (I'd like to back up my save before I overwrite it with the new one too, but that's a lesser issue.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63557 - DsPet - Wed Dec 14, 2005 5:55 am</h4>
    <div class="postbody"><span class="postbody">&gt; I tried using Etool3 as well as EtoolSMS to no avail. 
<br/>
Don't know what the problem is there.
<br/>
MarioKart is a 256KB game save (like Nintendogs or AnimalCrossing).
<br/>
Much appears to be blank ($FF) so it should easily compress to fit in SRAM.
<br/>
It is mirrored (storing two copies of the game save), starting at 0x30f00
<br/>
<br/>
&gt; I even tried using the Nintendogs Trainer save backup function (it of course failed). 
<br/>
That program has a Nintendogs specific check at the start, so it shouldn't save other carts.
<br/>
<br/>
However the general compression approach used (simple run length encoding) should work for MarioKart. I use it for the (upcoming) Animal Crossing Trainer.
<br/>
Please send me an email if you want a simple test program based on the Nintendogs/AnimalCrossing SRAM save technology.
<br/>
Regardless, keep complaining to get ETool fixed.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63560 - MaHe - Wed Dec 14, 2005 7:58 am</h4>
    <div class="postbody"><span class="postbody">Try out <a class="postlink" href="http://nintendo-ds.dcemu.co.uk/rain.shtml" target="_blank">RAIN by SaTa</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63574 - cory1492 - Wed Dec 14, 2005 1:15 pm</h4>
    <div class="postbody"><span class="postbody">Im assuming you tried the latest ETool from my site (it was updated sometime in october to recognize a new DS card chip)?
<br/>
<br/>
Probably mis-identifying the game with the current cardme - this can be fixed  fairly simply, unless you have a GBA MP, M3 or SuperCard, in which case RAIN is the way to go...
<br/>
<a href="http://www.pat.hi-ho.ne.jp/sata68/nds.shtml" target="_blank">http://www.pat.hi-ho.ne.jp/sata68/nds.shtml</a>
<br/>
<br/>
Let me know if you dont have a RAIN compatible one, or try one of the older RAIN's which allowed the use of SRAM as an option (I think the link above has mirrors of those older ones) and I will make a quick app to give me the info I need to add MK to the FLASH type ID's... The MK saves I have compress enought to fit in SRAM so its not a problem with compression, just one with IDing the type of chip its using to store the saves (hopefully).
<br/>
<br/>
edit:/ ok, made a quick little app to test the type of your card and get the info I'd need if its not currently detected properly, give it a go and let me know the results
<br/>
<a href="http://nds.cmamod.com/files/EID_cardme.zip" target="_blank">http://nds.cmamod.com/files/EID_cardme.zip</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63589 - Killjoy42 - Wed Dec 14, 2005 6:28 pm</h4>
    <div class="postbody"><span class="postbody">My card is an EZ-Flash II 256 PS (aka not RAIN compatible, though I did get it to run by appending a homebrew loader)
<br/>
<br/>
I did try the latest versions of both Etools, and failing that, even tried some older versions.
<br/>
<br/>
I seem to remember the MK saves compressing enough to fit on my card's SRAM before too. This might have been before I updated to the latest version of FlashMe. (Wasn't there a revision of V5? If so, I definately had the older one before I updated. Also, I've had all versions of FlashMe on my DS from V3 on.)
<br/>
<br/>
I used the program you provided to test the card type, and after pressing "A" (as was prompted) I recieved the following result:
<br/>
<br/>
detected as: unknown
<br/>
c03 = ff
<br/>
c05 = ff
<br/>
c9f = ff
<br/>
c00 = ff
<br/>
<br/>
Hope this helps - if I can do anything else, let me know. ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63592 - Killjoy42 - Wed Dec 14, 2005 8:12 pm</h4>
    <div class="postbody"><span class="postbody">Okay, so I tested DsPet's Mario Kart Tool (It's set up the same as his Nintendogs trainer, minus the save hacks - I'll let him post the link in case he wants to control distribution.) and I've discovered something interesting.
<br/>
<br/>
When I first loaded the program and told it to read the cart, I recieved the following:
<br/>
<br/>
"Reading CART....
<br/>
-- Missing first tag
<br/>
Load failed - Not Mario Kart 1.0"
<br/>
<br/>
So I took a couple pictures, but they didn't come out right, so I went to take some more, and this time when I booted the program, it worked!
<br/>
<br/>
Well, it let me back up my save anyway. When I try to load the new save it says:
<br/>
<br/>
"Loaded, expanding-- dogsave bad tag
<br/>
<br/>
SRAM does not contain valid ANIMALSAVE"
<br/>
<br/>
<br/>
I got the save from <a href="http://l33t.spod.org/ratx/DS/SC/saves/" target="_blank">http://l33t.spod.org/ratx/DS/SC/saves/</a> and the saves there for my other games seemed to work, so I assumed these would be fine. I'm guessing the save isn't in the right format. Is there any way to fix that?
<br/>
<br/>
<span style="font-weight: bold">EDIT: I'm thinking one of two things here based on error messages:
<br/>
a) Nintendo released more than one version of Mario Kart DS - unlikely, but not unheard of. Is it possible I have a later version of the game?
<br/>
b) My original save came off my friend's Nintendogs cartridge (bad, I know, but I made him go buy the game so we could play together). I somehow loaded the save onto my Mario Kart cartridge (I think I used the nintendogs trainer to backup the save, and Etool to load it). Is it possible that when I copied the save from the Nintendogs cartridge, I copied both MK and Nintendogs data, and in transferring the save to my Mario Kart cartridge, somehow corrupted it with Nintendogs data?</span></span><span class="gensmall"><br/><br/>Last edited by Killjoy42 on Thu Dec 15, 2005 1:09 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#63593 - DsPet - Wed Dec 14, 2005 9:22 pm</h4>
    <div class="postbody"><span class="postbody">&gt; ...so I tested DsPet's Mario Kart Tool 
<br/>
If anyone else wants it:
<br/>
<a href="http://www.aibohack.com/nds/karttool_preview.zip" target="_blank">http://www.aibohack.com/nds/karttool_preview.zip</a>
<br/>
<br/>
Specific to MarioKart - backup and restore. Nothing else featurewise.
<br/>
<br/>
&gt; "Reading CART.... 
<br/>
&gt; -- Missing first tag 
<br/>
&gt; Load failed - Not Mario Kart 1.0" 
<br/>
&gt; ...when I booted the program, it worked! 
<br/>
If it fails to read the first time, try to Load again. If a problem remove and reinsert the Mario Kart cartridge and try again.
<br/>
<br/>
&gt; Well, it let me back up my save anyway.
<br/>
That's what it is for. It will compress the 256KB save to something much smaller. You can restore it later.
<br/>
&gt; When I try to load the new save it says: 
<br/>
&gt; "Loaded, expanding-- dogsave bad tag 
<br/>
&gt; SRAM does not contain valid ANIMALSAVE" 
<br/>
Minor typo - it should say "KARTSAVE". That's the compressed format.
<br/>
<br/>
However the problem is that you are trying to put a raw 256KB save into SRAM. That won't fit. You need to compress it on your PC first, save to SRAM and then expand it on the NDS.
<br/>
I have tools that do that, but at this point my recommendation is to get ETool working (its the general purpose tool)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63616 - Killjoy42 - Thu Dec 15, 2005 1:07 am</h4>
    <div class="postbody"><span class="postbody">Sorry, DsPet - I didn't mean to imply that the program didn't work well or anything, I just wanted to note my steps with as much detail as possible. It seems it didn't function properly the first time because of my excitement and in my haste, I didn't do a recheck. I'm very impressed by the program and am quite happy I was able to back my save up.
<br/>
<br/>
I had a feeling I wouldn't be able to just load the new saves on just by looking at the file size difference, but didn't know enough about the format to not give it a try.
<br/>
<br/>
I wouldn't ask you to do any more than you have, but if I still can't get ETool to work, where would you direct me to learn about how to compress the save as you indicated?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64018 - cory1492 - Sun Dec 18, 2005 4:27 pm</h4>
    <div class="postbody"><span class="postbody">OK, I added another test for the values you gave me above, let me know if it works good for you (there may be one other thing I need to change to allow ETool to write it properly).
<br/>
<br/>
<a href="http://nds.cmamod.com/files/MKEtoolTest.zip" target="_blank">http://nds.cmamod.com/files/MKEtoolTest.zip</a>  (see below for a full version)
<br/>
<br/>
Im still working on the PC side compression app for it, unfortunately the zlib PC library isnt giving me usable compressed stuff (Im sure I mistyped something, somewhere) - until I fix it there is no way to compress the 256K save files to use with ETool. I think I have the time to debug it this week, though.
<br/>
<br/>
OK, I found the bug and squashed it! PC side ETool save creation is now working most excellently.
<br/>
<a href="http://nds.cmamod.com/files/ETool_v3.13.zip" target="_blank">http://nds.cmamod.com/files/ETool_v3.13.zip</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
