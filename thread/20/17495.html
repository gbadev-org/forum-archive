<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>mp3 source? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS Misc > mp3 source?</h2>
<div id="posts">
<div class="post">
    <h4>#176015 - spinal_cord - Fri Mar 18, 2011 9:44 pm</h4>
    <div class="postbody"><span class="postbody">Is there any mp3 source around that will compile with a recent devkitarm/libnds?<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176016 - elhobbs - Sat Mar 19, 2011 4:41 am</h4>
    <div class="postbody"><span class="postbody">I am using helix for cquake. there is a link to the svn in my signature.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177408 - hacker013 - Thu May 31, 2012 12:05 pm</h4>
    <div class="postbody"><span class="postbody">@Elhobbs
<br/>
<br/>
I copied your code from cQuake (the mp3 &amp; helix part) but when I try to use it, it just does nothing, als hearing nothing either. But when I press the L+R+SELECT+START combination the ds shutdown so it isn't hanging. My arm7 is the same as yours and my arm9 is this:
<br/>
<br/>
Open and Play Mp3
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
iprintf("Init MP3 Streamer...");
<br/>
   if(!mp3_init())
<br/>
   {
<br/>
      iprintf("failed!");
<br/>
      while(1)
<br/>
      {
<br/>
         swiWaitForVBlank();
<br/>
      }
<br/>
   }
<br/>
   file=fopen("test.mp3", "rb");
<br/>
   if(file==NULL)
<br/>
   {
<br/>
      iprintf("failed!");
<br/>
      while(1)
<br/>
      {
<br/>
         swiWaitForVBlank();
<br/>
      }
<br/>
   }
<br/>
   iprintf("loaded!\nPlay MP3...");
<br/>
   if(!mp3_play_file(file, 1))
<br/>
   {
<br/>
      iprintf("failed!");
<br/>
      while(1)
<br/>
      {
<br/>
         swiWaitForVBlank();
<br/>
      }
<br/>
   }
<br/>
   iprintf("succes!\n");
<br/>
   iprintf("Set Volume to 127...");
<br/>
   mp3_set_volume(127);
<br/>
   iprintf("succes!\n");
<br/>
</td> </tr></table><span class="postbody">
<br/>
I swapped the return values from mp3_init &amp; mp3_play_file so it returns true on succes.
<br/>
<br/>
And after the swiWaitForVBlank(); this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//mp3_print();
<br/>
mp3_fill_buffer();
<br/>
</td> </tr></table><span class="postbody">[/code]<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177413 - elhobbs - Thu May 31, 2012 2:46 pm</h4>
    <div class="postbody"><span class="postbody">hard to say without looking at the complete project. anywhere I can see this along with your sample mp3? I can say that this does work in cquake with the current toolchains. so, there must be something with your code or with the encoding on your mp3.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177416 - hacker013 - Thu May 31, 2012 5:29 pm</h4>
    <div class="postbody"><span class="postbody">It is from some bigger project and I don't want to show the rest of it, but like, I already posted the relevant parts. I'm busy with a video library. So I'm testing things and trying to understand the way fifo and such works.
<br/>
<br/>
I just copied mp3_7.arm.s &amp; mp3_7.c &amp; mp3_9.c &amp; mp3_shared.h from your cQuake. I had helix already lying around. I copied your arm7 code &amp; checked in your CDAudio file how you did the arm9 side. And used that for the arm9 (see part in first post). I googled also on it and found out the specs needed for playing with your code. And if I use mp3_print the values printed never change.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177418 - elhobbs - Thu May 31, 2012 5:54 pm</h4>
    <div class="postbody"><span class="postbody">so, you have access to code that works in cquake. and you are unwilling to provide sample code... yet for some reason I am still going to try to help you.
<br/>
<br/>
create a new test project that just plays mp3s - and go from there. if that does not work then share what you have.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177419 - hacker013 - Thu May 31, 2012 6:14 pm</h4>
    <div class="postbody"><span class="postbody">I just don't like to share unfinished code, i like to provide finished projects =\
<br/>
<br/>
 - <a class="postlink" href="http://imetal.tk/data/ndsdev/SoundTest.zip" target="_blank">Download Source</a>
<br/>
<br/>
Contains your mp3 code, and some old ogg code laying around, also still not working :'(. I've tried both to get working, the mp3 code from your cQuake works in your cQuake and the ogg code did work in some old project of mine. I hope you can something with it ^^<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177420 - elhobbs - Thu May 31, 2012 6:41 pm</h4>
    <div class="postbody"><span class="postbody">I will take a look at this tonight. at quick glance the only issue I saw was that your code is looking for test.mp3 but the file in the archive is testNormal.mp3. also, I am not sure the mp3 is encoded at a rate that I recommended. looks like it is 128 kbps - I want to say I could only get 96 kbps to play successfully - without stuttering.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177421 - hacker013 - Thu May 31, 2012 6:48 pm</h4>
    <div class="postbody"><span class="postbody">I know, I forgot to add testRec.mp3 &gt;&lt; testNormal.mp3 is a normal mp3 and testRec.mp3 is the mp3 with the specifications for your code. And I renamed everytime one of the 2 to test.mp3 tot test my code.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177422 - elhobbs - Fri Jun 01, 2012 3:28 am</h4>
    <div class="postbody"><span class="postbody">ok. you need to change your makefile to optimize for size. change -O2 to -Os
<br/>
not enough memory otherwise.
<br/>
<br/>
you also need to make a few changes to the asm to mark the assembly as functions  - <a class="postlink" href="http://devkitpro.org/viewtopic.php?f=13&amp;t=3073#p8636" target="_blank">see here</a>
<br/>
in these files:
<br/>
mp3_7.arm.s - 1 function
<br/>
asmpoly_gcc.s - 2 functions
<br/>
(the code in the svn does not work with the current tools because these 3 changes were not commited - I was wrong when I said that it worked. sorry about that)
<br/>
you will need to do a full rebuild.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177426 - hacker013 - Fri Jun 01, 2012 10:17 am</h4>
    <div class="postbody"><span class="postbody">Thank you very much. It is working now ^^. I made an example with it for everybody else so they can enjoy it. 
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=17859" target="_blank">http://forum.gbadev.org/viewtopic.php?t=17859</a><br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177438 - hacker013 - Tue Jun 05, 2012 8:14 pm</h4>
    <div class="postbody"><span class="postbody">It has some wierd bug, on my nds pat it does work perfectly, but on my nds lite it will hang random at mp3_play_file and mp3_fill_buffer :S<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177440 - elhobbs - Tue Jun 05, 2012 9:34 pm</h4>
    <div class="postbody"><span class="postbody">are you using the same card on both or different cards? it may be a file system issue if you are using different cards.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
