<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Wifime Thoughts - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS Misc > Wifime Thoughts</h2>
<div id="posts">
<div class="post">
    <h4>#66689 - cloak - Thu Jan 12, 2006 11:32 pm</h4>
    <div class="postbody"><span class="postbody">I was wondering...
<br/>
<br/>
Currently wifime redirects the arm9 start address to that of the gba rom memory. Does this mean its possible to change that start address to any arbitrary location, like the memory of the DS?
<br/>
<br/>
Basically what I am asking, is would it be possible to send down wifime with some extra data appended (ie some arbitrary code), and set the wifime jump address to the beginning of said extra code?
<br/>
<br/>
My only thought is that the ds stops recieving data after wifime is recieved, stopping any extra data from being stored. 
<br/>
<br/>
Any thoughts? Or am I missing some crucial part of the picture that would make this not work?
<br/>
<br/>
Thanks,
<br/>
-Cloak</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66700 - tetsujin - Fri Jan 13, 2006 12:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cloak wrote:</b></span></td> </tr> <tr> <td class="quote">I was wondering...
<br/>
<br/>
Currently wifime redirects the arm9 start address to that of the gba rom memory. Does this mean its possible to change that start address to any arbitrary location, like the memory of the DS?
<br/>
<br/>
Basically what I am asking, is would it be possible to send down wifime with some extra data appended (ie some arbitrary code), and set the wifime jump address to the beginning of said extra code?
<br/>
<br/>
My only thought is that the ds stops recieving data after wifime is recieved, stopping any extra data from being stored. 
<br/>
<br/>
Any thoughts? Or am I missing some crucial part of the picture that would make this not work?</td> </tr></table><span class="postbody">
<br/>
<br/>
The main thread on WifiMe has a very low signal:noise ratio, but where there's good signal, you can get a lot of very useful information from it.  I'll give you a bit of a summary, but I still recommend reading the thread.
<br/>
<br/>
When the NDS loads a program it loads the header and the code to be loaded into main memory.  The header contains the jump addresses you mentioned, plus various other data, as well as cryptographic signatures for the program code, which for all practical purposes cannot be cracked.  WiFiMe and PassMe work by altering the header (which doesn't affect the crypto signature) to change the jump addresses - but they cannot alter the program code, because doing so would cause the crypto signature to no longer match.
<br/>
<br/>
The new firmware defeats this, IIRC, by treating the GBA ROM space as an invalid address in that context.  (I don't understand all the details of that, or how Passme2 gets around that.)
<br/>
<br/>
So there's really not much place you could put code inside of a modified WMB demo without breaking the crypto check.  Maybe you could put some code in the header itself, in that logo or the title text, I don't quite know.  It wouldn't be much code, and I'm not sure if you'd be able to jump to it.
<br/>
<br/>
Tepples made some posts about his ideas for a future WiFiMe that would work a little differently - but that was several months ago and I don't know if that's gone anywhere.  The basic idea was to take a game that first downloads its own program code via WMB, and then downloads other data (levels, 3-D models, maybe even program code, etc.) via a basic network connection to the host.  The theory was that, while the NDS firmware is strict about RSA signatures on the initial WMB transmission, security on transmissions <span style="font-style: italic">after</span> the program code is transferred might be more relaxed.  If so, it might be possible to take a WMB transmission captured from a game, and append other code in place of the official game data, such that the receiving DS running the game code will download that data, and either execute it intentionally (if program code is being sent) or unintentionally (by way of a buffer overrun, etc.)  But it seems he never found such a security hole in any of the code he examined.  If this approach could be found to work, the result would be an almost perfect security-bypassing WMB wrapper: a crypto-signed program which would run whatever code we insert.  As long as we had no qualms about endlessly copying and distributing that chunk of copyrighted game code we'd be able to use it to boot things on unmodified DSes.<br/>_________________<br/>---GEC
<br/>
I think that all the work that's been done by the homebrew community so far to support people who want to program for the GBA or DS is amazing.
<br/>
Thank you, everyone, I look forward to taking advantage of your work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66746 - tepples - Fri Jan 13, 2006 7:27 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tetsujin wrote:</b></span></td> </tr> <tr> <td class="quote">The new firmware defeats this, IIRC, by treating the GBA ROM space as an invalid address in that context.</td> </tr></table><span class="postbody">
<br/>
And, in the case of wifime, by using an entry point in the signed binary rather than the alternate entry point in the WMB header.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">(I don't understand all the details of that, or how Passme2 gets around that.)</td> </tr></table><span class="postbody">
<br/>
Three words: jump to SRAM.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Tepples made some posts about his ideas for a future WiFiMe that would work a little differently - but that was several months ago and I don't know if that's gone anywhere.</td> </tr></table><span class="postbody">
<br/>
What you describe I've called WiFiMe2. That and various other ideas that haven't seen any public work on them are described on <a class="postlink" href="http://www.pineight.com/ds/pass/" target="_blank">my passthrough page</a>.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But it seems he never found such a security hole in any of the code he examined.</td> </tr></table><span class="postbody">
<br/>
I never examined any code. I posted the ideas for other enterprising hackers such as dark* and olimar.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">As long as we had no qualms about endlessly copying and distributing that chunk of copyrighted game code we'd be able to use it to boot things on unmodified DSes.</td> </tr></table><span class="postbody">
<br/>
Under <span style="font-style: italic">Sega v. Accolade</span> and <span style="font-style: italic">Lexmark v. Static Control</span>, two copyright-related cases that were decided in favor of permitting copying that is necessary for interoperability, it would probably be legal to distribute the game code, at least in the United States.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66762 - pepsiman - Fri Jan 13, 2006 10:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cloak wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Currently wifime redirects the arm9 start address to that of the gba rom memory.
<br/>
</td> </tr></table><span class="postbody">
<br/>
No it doesn't.
<br/>
WifiMe redirects the <span style="font-weight: bold">arm7</span> start address to that of the gba rom memory (0x080000c0).
<br/>
It redirects the arm9 start address to within the copy of the NDS header in normal RAM.
<br/>
This part of the header has been replaced with some code to read from an address (0x027FFE24) and jump to it.
<br/>
The NDS loader run by the arm7 writes the real arm9 start address to this location after copying the binary into memory.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Basically what I am asking, is would it be possible to send down wifime with some extra data appended (ie some arbitrary code), and set the wifime jump address to the beginning of said extra code?
<br/>
</td> </tr></table><span class="postbody">
<br/>
WifiMe is running arbitrary code, there just isn't much space in the header to store code to do anything useful.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67295 - cloak - Mon Jan 16, 2006 7:55 pm</h4>
    <div class="postbody"><span class="postbody">I think I understand a little more now.
<br/>
<br/>
Thanks for all your replies..
<br/>
<br/>
-Cloak</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
