<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>M3 lite? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS Misc > M3 lite?</h2>
<div id="posts">
<div class="post">
    <h4>#104857 - bjoerngiesler - Tue Oct 03, 2006 11:25 am</h4>
    <div class="postbody"><span class="postbody">Anyone have an M3 lite and got DSFTP to work or at least can submit a sane problem description? I've had lots of people ask about that, but noone was able to supply specifics.
<br/>
<br/>
TIA!<br/>_________________<br/><a class="postlink" href="http://giesler.biz/~bjoern/en/sw_dsftp.html" target="_blank">DSFTP homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105018 - Dracker - Thu Oct 05, 2006 6:31 am</h4>
    <div class="postbody"><span class="postbody">M3 Lite user here.
<br/>
<br/>
DSFTP works, somewhat.
<br/>
<br/>
-The .ds.gba booted fine
<br/>
-I had to unhide the SSID for it to find my router (actual games use this router with SSID hidden).
<br/>
-logged in and got MOTD
<br/>
-read a file from the MicroSD card
<br/>
-wrote a file to MicroSD card
<br/>
<br/>
Everything I tried appeared to work.
<br/>
<br/>
However, there are a few quirks.  The file I wrote to the MicroSD was butchered.  It was a broken LC-3 ASM program (Please ignore the very bad coding, I didn't know what I was doing when I created this!)
<br/>
<br/>
Original: </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   .orig   x3000
<br/>
   ld   r0,COUNTER   ; Load the array counter into r0 
<br/>
   ldi   r1,PRIMES   ; PRIMES is the actual array
<br/>
AGAIN   add   PRIMES+r0,r0,#0   ; Fill the array with the number in r0
<br/>
   add   r0,r0,#-1   ; Decrement r0
<br/>
   brp   AGAIN      ; This fills the array from the top down
<br/>
   ld   r0,#1      ; Set offset to 1
<br/>
   and   PRIMES+r0,#0,#0   ; Make 1 not a prime number
<br/>
LOOP   add   r0,r0,#1   ; Increment the offset
<br/>
   brz   LOOP      ; Increment again if 0, otherwise infinite loop ensues
<br/>
   add   r3,r0,#-3000   ; Once r0 is &gt;3000 we are done
<br/>
   brp   FINISH      ; Exit if done
<br/>
   add   r2,r0,#0   ; Set r2 to r0
<br/>
LOOP2   add   r2,r2,r0   ; r2 stores the offset of the next NOT PRIME number
<br/>
   and   PRIMES+r2,#0,#0   ; r2 is not a prime number
<br/>
   add   r3,r2,#-3001   ; r3 tracks how close we are to finishing the array
<br/>
   brn   LOOP2      ; Get the next not prime number
<br/>
   brzp   LOOP      ; If no more multiples of r0, increment r0 and redo
<br/>
FINISH   .end         ; All done!
<br/>
<br/>
PRIMES   .blkw   3001      ; The array of primes
<br/>
COUNTER .fill   #3001      ; The counter to fill the array</td> </tr></table><span class="postbody">
<br/>
<br/>
What got written to the MicroSD</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">b0VIM 7.0      ?$E    d  Dracker                                 FERRARI                                 H:/data/settings/ftp.conf                                                                                                                                                                                                                                                                                                                                                                                           ; Exit if done
<br/>
   add   r2,r0,#0   ; Set r2 to r0
<br/>
LOOP2   add   r2,r2,r0   ; r2 stores the offset of the next NOT PRIME number
<br/>
   and   PRIMES+r2,#0,#0   ; r2 is not a prime number
<br/>
   add   r3,r2,#-3001   ; r3 tracks how close we are to finishing the array
<br/>
   brn   LOOP2      ; Get the next not prime number
<br/>
   brzp   LOOP      ; If no more multiples of r0, increment r0 and redo
<br/>
FINISH   .end         ; All done!
<br/>
<br/>
PRIMES   .blkw   3001      ; The array of primes
<br/>
COUNTER .fill   #3001      ; The counter to fill the array</td> </tr></table><span class="postbody">"Dracker" is the Windows username I am logged in as on the computer (I used "drack" in the config file for dsftp).  "ferrari" (lowercase!) is my computer's hostname.  H: is the drive letter the MicroSD card typically gets assigned to when reading it from the computer.  I find this odd because obviously the MicroSD card was in my DS when this file was written, so it should have no awareness of any drive letters. 
<br/>
<br/>
Also, the original filename was "sieve.asm" .. on the card it was "SIEVE.ASM"
<br/>
<br/>
ANYWAY, I redid the conf file with DOS line-endings, and saved in Notepad to make sure there weren't any weird headers or anything there (there weren't -- but I had previously done the conf file in vim 7 with unix line endings), and once again got the same messed up file.
<br/>
<br/>
<br/>
Has anything similar been reported from users of other flashcarts?
<br/>
<br/>
For reference, my config (default with minimal changes): </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">motd /ftp/motd.txt
<br/>
logfile /data/logs/ftp.log
<br/>
loglevel 4
<br/>
timeout 60
<br/>
portrangestart 9000
<br/>
portrangeend 9999
<br/>
screensaver 30
<br/>
wakeonlog false
<br/>
user drack
<br/>
  pass test
<br/>
  root /
<br/>
  home /
<br/>
  write true
<br/>
  boot true
<br/>
end user
<br/>
<br/>
user anonymous
<br/>
  root /ftp/anonymous
<br/>
  write false
<br/>
end user</td> </tr></table><span class="postbody">MOTD</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Heya!
<br/>
<br/>
FTP Server works!!!</td> </tr></table><span class="postbody">Really, I don't see anything weird in there.
<br/>
<br/>
For networking, I have my Windows computer connected to a Linksys WRT54G-L running OpenWRT, which my DS connects to over WEP-encrypted wifi.</span><span class="gensmall"><br/><br/>Last edited by Dracker on Thu Oct 05, 2006 6:49 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#105019 - bjoerngiesler - Thu Oct 05, 2006 6:48 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dracker wrote:</b></span></td> </tr> <tr> <td class="quote">Has anything similar been reported from users of other flashcarts?</td> </tr></table><span class="postbody">
<br/>
<br/>
Not for other flashcarts, but for M3(lite), indeed it has. Satoshikun reports file butchering in <a class="postlink" href="http://forums.maxconsole.net/showthread.php?t=31451&amp;page=2" target="_blank">http://forums.maxconsole.net/showthread.php?t=31451&amp;page=2</a>. I find the drive letter and Windows user name in there very strange as well.
<br/>
<br/>
What is even stranger is that Satoshikun reports everything to be working fine in DSFTP V2.1 (because the FAT code is completely identical between those two). Could you try that version as well?
<br/>
<br/>
Regards,
<br/>
Bj?rn<br/>_________________<br/><a class="postlink" href="http://giesler.biz/~bjoern/en/sw_dsftp.html" target="_blank">DSFTP homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105039 - HyperHacker - Thu Oct 05, 2006 12:31 pm</h4>
    <div class="postbody"><span class="postbody">Would there be any reason the computer's host/username would be stored on your card? Could be referencing the wrong sector.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105057 - Dracker - Thu Oct 05, 2006 3:23 pm</h4>
    <div class="postbody"><span class="postbody">Test run 2:  Boot from Knoppix disc.  This takes anything associated with running Windows out of the equation.  By the way, the client on the computer side I used was the command-line "ftp" both tests -- obviously the dos version on windows and the unix version on Knoppix.
<br/>
<br/>
The text was butchered again, but differently.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">???yp??????95???xz??jXOX7;7?0?????????p???5???u?xyyh8zkxo;??/?
<br/>
c????????????????hxX?C=;Xk????:%7????????????$??? ?zyxy??s?s?7????y?pp????9?55?XW8?x[hx????7377???????Ã´?T????IMxxzJx8?#7?? ???p???????5?????xkXO9{zw?/??w?????????????? ??? 9yyxz?x??3 7?x???????????u???Hxx?yxxX?777;7??????????????????y};yy??x??3w?M?c??????????u???? hxXwKyhz?7(??7???????? ?5??????Hjxox{9 ; ;9?s?$????????u ?? ???ixHxx?x?3?3?7 ?????????????????8yxx?{?y7?773'??????p???????u? h?x;GZXugq7w? ??p????f??5?u???xx9xz8?+73??3w ; Exit if done
<br/>
   add   r2,r0,#0   ; Set r2 to r0
<br/>
LOOP2   add   r2,r2,r0   ; r2 stores the offset of the next NOT PRIME number
<br/>
   and   PRIMES+r2,#0,#0   ; r2 is not a prime number
<br/>
   add   r3,r2,#-3001   ; r3 tracks how close we are to finishing the array
<br/>
   brn   LOOP2      ; Get the next not prime number
<br/>
   brzp   LOOP      ; If no more multiples of r0, increment r0 and redo
<br/>
FINISH   .end         ; All done!
<br/>
<br/>
PRIMES   .blkw   3001      ; The array of primes
<br/>
COUNTER .fill   #3001      ; The counter to fill the array</td> </tr></table><span class="postbody">
<br/>
<br/>
I forgot to say last time, files fetched *from* the MicroSD were copied to the computer exactly as they were on the card.  Also I have successfully deleted files as well.
<br/>
<br/>
Next test:  Using the 2.1 server</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105059 - Dracker - Thu Oct 05, 2006 3:51 pm</h4>
    <div class="postbody"><span class="postbody">Before I ran the next test, I thought I should check the filesystem.  It appears that writing files with DSFTP will damage the FS!  I fixed it back up and ran it again to double check, and this confirms it.
<br/>
<br/>
Screenshot and the file the "lost chain" converted to:
<br/>
<a href="http://www.cc.gatech.edu/~schapman/damage.zip" target="_blank">http://www.cc.gatech.edu/~schapman/damage.zip</a>
<br/>
This particular filesystem error corrupted part of DSLinux. Note that the top of the recovered "lost chain" file reads </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">b0VIM 7.0      ?"E    ?  Dracker                                 FERRARI                                 H:/linux/etc/rc.d/network</td> </tr></table><span class="postbody">
<br/>
<br/>
Note:  I used the "safe shutdown" keystroke to verify that it wasn't powering off the DS that caused this.
<br/>
<br/>
Don't apologize or anything, I have everything backed up.  I'll just format and reflash everything afterwards.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105079 - bjoerngiesler - Thu Oct 05, 2006 6:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dracker wrote:</b></span></td> </tr> <tr> <td class="quote">Before I ran the next test, I thought I should check the filesystem.  It appears that writing files with DSFTP will damage the FS!</td> </tr></table><span class="postbody">
<br/>
<br/>
Well yes. I'm very certain DSFTP doesn't butcher the file in the uploading process (works very well on other cards), so it's most probably the FS driver's fault. And that in turn makes it very likely that file butcherage is in effect file system butcherage.<br/>_________________<br/><a class="postlink" href="http://giesler.biz/~bjoern/en/sw_dsftp.html" target="_blank">DSFTP homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105128 - HyperHacker - Fri Oct 06, 2006 8:00 am</h4>
    <div class="postbody"><span class="postbody">Yeah, I've had a lot of homebrew occasionally stomp the filesystem to pieces.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105186 - Dracker - Fri Oct 06, 2006 5:15 pm</h4>
    <div class="postbody"><span class="postbody">Test 3 - DSFTP 2.1, same configs and everything as used in test 1.
<br/>
<br/>
There were no problems.  Files read from or written to the MicroSD were byte-for-byte identical through the transfers. The only change was that the NAMES of the files written to the MicroSD became ALL CAPS.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
