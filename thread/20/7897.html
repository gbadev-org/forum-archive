<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Convert Moonshell Video under Linux - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS Misc > Convert Moonshell Video under Linux</h2>
<div id="posts">
<div class="post">
    <h4>#64817 - JaJa - Tue Dec 27, 2005 1:55 am</h4>
    <div class="postbody">Ok then. I have finished a method for creating .dpg files on linux (and so mac os x) and worked out the header as well.<br/>
<br/>
This way is long winded. Juhees is working on a utility to generate a header and a shell script to perform the conversion.<br/>
<br/>
<strong class="text-strong">Method</strong><br/>
You will need Mplayer, mencoder, sox, cat and a hex editor.<br/>
The first step is to create a plain mpg1 video file. I did this using :
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>mencoder foo.avi  -o foo.mpg -ovc lavc -lavcopts vcodec=mpeg1video&amp;#58;vbitrate=160000 -nosound -ofps 25 -vf scale=256&amp;#58;192</code></pre></div> <br/>
This creates an mpeg1 (named foo.mpg) file with a bitrate of 160000 bps and resolution of 256 x 192 (a little high for the DS i think).<br/>
Now we create a pcm (wav) file from the avi.
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>mplayer foo.avi -dumpaudio -dumpfile output.dmp
mplayer output.dmp -ao pcm&amp;#58;file=output.wav</code></pre></div>
This wav will have the same sample rate and bitrate of the original file.<br/>
Now we convert the wav into the format expected by moonshell (WAV or wav49 or WAV GSM 6.01 call it what you want). I did this by 
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>sox output.wav -r 44100 -g -c 1 output.gsm.wav</code></pre></div>
Replace 44100 with the sample rate of your audio file.<br/>
You can check this is the correct format by running
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>mplayer output.gsm.wav</code></pre></div>
The codec should read "Selected audio codec: [msgsm] afm:msgsm (MS GSM)" if correct.<br/>
Now create a file which is 36 bytes long. This forms you header, which i'll talk about in a minute. Now to create you movie file you do 
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>cat 36byteheader output.gsm.wav foo.mpg &gt; my.dpg</code></pre></div>
<strong class="text-strong">The header</strong> <br/>
Without this the file won't play. It tells moonshell where the sound starts and ends and where the video starts and ends.<br/>
The first 4 bytes in the header are <span style="color:red">DPG0</span> (44 50 47 30). This is the same in all .dpg files. The next two bytes tell moonshell <span style="color:blue">the number of frames in your movie</span>. Then there are two spacing bytes (00 00). The next two bytes tells moonshell <br/>
 (fps). The next two are again spacing bytes (00 00). So the first 12 bytes are something like <span style="color:red">44 50 47 30</span> <span style="color:blue">e8 03</span> 00 00<span style="color:orange"> 00 19</span> 00 00. In this example the video has 1000 frames and is played at 25 fps.<br/>
The next bytes tell moonshell about the audio in the file. The 13th and 14 bytes of the header (44 ac) tell moonshell <span style="color:green">the sample rate of the audio</span>. Then there are two spacing bytes (00 00). The next two bytes tell moonshell the <span style="color:indigo">number of channels in the audio</span>. In this example (and i think always because of the format) there is only one channel. There are again two spacing bytes (00 00). So  <span style="color:green">44 ac</span> 00 00 <span style="color:indigo">01 00</span> 00 00. This example is 44100 sample rate and one channel. The next bytes tell moonshell the start and end of the audio and video. The 21st and 22nd byte tell moonshell <span style="color:brown">the start of the wav file</span>. This is always 36 bytes into the file (24 00). There are another pair of spaces (00 00). These are followed by 4 bytes that tell <span style="color:darkblue">the end byte of the audio file</span>. This is the length of the audio file + 36. The next 4 bytes are <span style="color:violet">the start of the video file</span>. This is the end of the audio file + 36 (i think there's a header there). The last 4 bytes in the header are the <span style="color:olive">end of the video file</span>. This is the filesize (or the start of the video + the number of bytes in the video). So the last bytes in the header are something like <span style="color:brown">24 00</span> 00 00 <span style="color:darkblue">50 92 05 00</span> <span style="color:violet">74 92 05 00</span> <span style="color:olive">1a 90 ea 00</span><br/>
<br/>
My example complete header reads:<br/>
44 50 47 30 e8 03 00 00  00 19 00 00 44 ac 00 00 01 00 00 00 24 00 00 00  50 92 05 00 74 92 05 00  1a 90 ea 00<br/>
<br/>
To sumise the header:<br/>
<span style="color:red">DPG0</span><br/>
<span style="color:blue">the number of frames in your movie</span> = 1000<br/>
<span style="color:orange">the number of frames every second</span> = 25<br/>
<span style="color:green">the sample rate of the audio</span> = 41000<br/>
<span style="color:indigo">number of channels in the audio</span> = 1<br/>
<span style="color:brown">the start of the wav file</span> = 36<br/>
<span style="color:darkblue">the end byte of the audio file</span> = 365136<br/>
<span style="color:violet">the start of the video file</span> = 365172<br/>
<span style="color:olive">end of the video file</span> = 15372314<br/>
<br/>
<span style="color:red">44 50 47 30</span> <span style="color:blue">e8 03</span> 00 00<span style="color:orange"> 00 19</span> 00 00 <span style="color:green">44 ac</span> 00 00 <span style="color:indigo">01 00</span> 00 00 <span style="color:brown">24 00</span> 00 00 <span style="color:darkblue">50 92 05 00</span> <span style="color:violet">74 92 05 00</span> <span style="color:olive">1a 90 ea 00</span><br/>
<br/>
Tip: To find the number of bytes in your files use ls -la in the directory. You would be looking for the number of bytes on foo.mpg and output.gsm.wav in this example.</div>    
</div>
<div class="post">
    <h4>#64827 - juhees - Tue Dec 27, 2005 4:23 am</h4>
    <div class="postbody"><blockquote><div><cite>JaJa wrote:</cite>
This way is long winded. Juhees is working on a utility to generate a header and a shell script to perform the conversion.
</div></blockquote>

And here it is! Writen at 4AM in the morning, so don't expact a miracle ;-)<br/>
It's far from being perfect, but it's faster than messing around with a hexeditor.<br/>
<br/>
First thing is a little program to produce the header:<br/>
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>#include &lt;stdio.h&gt;

void putint&amp;#40;int i, FILE* outfile&amp;#41; &amp;#123;
	fputc&amp;#40;i%256, outfile&amp;#41;;
	i /= 256;
	fputc&amp;#40;i%256, outfile&amp;#41;;
	i /= 256;
	fputc&amp;#40;i%256, outfile&amp;#41;;
	i /= 256;
	fputc&amp;#40;i%256, outfile&amp;#41;;
&amp;#125;

int main&amp;#40;int argc, char* argv&amp;#91;&amp;#93;&amp;#41; &amp;#123;
	int frames;
	int fps;
	int samples;
	int audiosize;
	int videosize;
	
	//char* filename = "header",0;
	FILE* outfile;
	
	if &amp;#40;argc != 7&amp;#41; &amp;#123;
		printf&amp;#40;"usage&amp;#58; headermaker &lt;#frames&gt; &lt;fps&gt; &lt;samples&gt; &lt;audiosize&gt; &lt;videosize&gt; &lt;filename&gt;\n"&amp;#41;;
		return -1;
	&amp;#125;
	
	// read our parameters
	frames	= atoi&amp;#40;argv&amp;#91;1&amp;#93;&amp;#41;;
	fps	= atoi&amp;#40;argv&amp;#91;2&amp;#93;&amp;#41;;
	samples	= atoi&amp;#40;argv&amp;#91;3&amp;#93;&amp;#41;;
	audiosize = atoi&amp;#40;argv&amp;#91;4&amp;#93;&amp;#41;;
	videosize = atoi&amp;#40;argv&amp;#91;5&amp;#93;&amp;#41;;
	
	outfile = fopen&amp;#40;argv&amp;#91;6&amp;#93;, "wb"&amp;#41;;
	
	// magic number&amp;#58;
	fputc&amp;#40;0x44, outfile&amp;#41;;
	fputc&amp;#40;0x50, outfile&amp;#41;;
	fputc&amp;#40;0x47, outfile&amp;#41;;
	fputc&amp;#40;0x30, outfile&amp;#41;;
	
	// #frames
	putint&amp;#40;frames, outfile&amp;#41;;
	
	// fps
	fputc&amp;#40;0x00, outfile&amp;#41;;
	fputc&amp;#40;fps%256, outfile&amp;#41;;
	
	fputc&amp;#40;0x00, outfile&amp;#41;;
	fputc&amp;#40;0x00, outfile&amp;#41;;
	
	// samples
	putint&amp;#40;samples, outfile&amp;#41;;
	
	// channels
	putint&amp;#40;1, outfile&amp;#41;;
	
	// begin and end audio
	putint&amp;#40;36, outfile&amp;#41;;
	putint&amp;#40;36+audiosize, outfile&amp;#41;;
	
	// begin and end video
	putint&amp;#40;36+36+audiosize, outfile&amp;#41;;
	putint&amp;#40;36+audiosize+videosize, outfile&amp;#41;;
	
	fclose&amp;#40;outfile&amp;#41;;
	
	return 0;
&amp;#125;</code></pre></div>

Secound is a script, that works for me, but i don't like it, some spots are not robust enought :-(<br/>
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>#!/bin/bash

if &amp;#91; $# -eq 3 &amp;#93;; then
  IF=$1
  OF=$2
  FPS=$3
  VTMP=temporary_video.mpg
  DMP=temporary_audio.dmp
  ATMP=temporary_audio.wav
  GSM=temporary.gsm.wav
  TMP=temporary.text
  HEADERTMP=temporary.head
  SAMPLES=44100
else
  echo "usage&amp;#58; "
  echo "mpg2dpg &lt;inputfile&gt; &lt;outputfile&gt; &lt;fps&gt;"
  exit 1;
fi

mencoder $IF -o $VTMP -ovc lavc -lavcopts vcodec=mpeg1video&amp;#58;vbitrate=160000 -nosound -ofps $FPS -vf scale=256&amp;#58;192 2&gt; $TMP &amp;&amp;

# this doesn't work for me &amp;#58;-&amp;#40;
#mplayer $IF -dumpaudio -dumpfile $DMP
#mplayer $DMP -ao pcm&amp;#58;file=$ATMP

# this is why i use&amp;#58;

ATMP=audiodump.wav
mplayer $IF -ao pcm&amp;#58;file=$ATMP &amp;&amp;
sox $ATMP -r $SAMPLES -g -c 1 $GSM

AUDIOSIZE=`wc -c $GSM | cut -d " " -f 1`
VIDEOSIZE=`wc -c $VTMP | cut -d " " -f 1`

# this is so ugly...
NUM_FRAMES=`cat $TMP | grep frames | grep -v Flushing | cut -d " " -f 17`
headermaker $NUM_FRAMES $FPS $SAMPLES $AUDIOSIZE $VIDEOSIZE $HEADERTMP
cat $HEADERTMP $GSM $VTMP &gt; $OF

rm $VTMP $TMP $DMP $ATMP $GSM $HEADERTMP</code></pre></div>

I had problems with framerates other that 25 (at encoding), but it's too late see whats wrong ;-)<br/>
As you can see, i had to go an other way to produce the wav, but it works. Hope it helps,<br/>
<br/>
juhees</div>    
</div>
<div class="post">
    <h4>#64828 - norvan - Tue Dec 27, 2005 5:09 am</h4>
    <div class="postbody">nicely done.</div>    
</div>
<div class="post">
    <h4>#64829 - tepples - Tue Dec 27, 2005 5:23 am</h4>
    <div class="postbody"><blockquote><div><cite>juhees wrote:</cite>First thing is a little program to produce the header:<br/>
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>void putint&amp;#40;int i, FILE* outfile&amp;#41; &amp;#123;
	fputc&amp;#40;i%256, outfile&amp;#41;;
	i /= 256;
	fputc&amp;#40;i%256, outfile&amp;#41;;
	i /= 256;
	fputc&amp;#40;i%256, outfile&amp;#41;;
	i /= 256;
	fputc&amp;#40;i%256, outfile&amp;#41;;
&amp;#125;
</code></pre></div>
</div></blockquote>
The following may be faster and more reliable, especially with 2's complement negative numbers:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>void putint&amp;#40;unsigned int i, FILE* outfile&amp;#41; &amp;#123;
	fputc&amp;#40;i &amp; 0xff, outfile&amp;#41;;
	i &gt;&gt;= 8;
	fputc&amp;#40;i &amp; 0xff, outfile&amp;#41;;
	i &gt;&gt;= 8;
	fputc&amp;#40;i &amp; 0xff, outfile&amp;#41;;
	i &gt;&gt;= 8;
	fputc&amp;#40;i &amp; 0xff, outfile&amp;#41;;
&amp;#125;
</code></pre></div>
<blockquote class="uncited"><div>Secound is a script, that works for me, but i don't like it, some spots are not robust enought :-(<br/>
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>SAMPLES=44100</code></pre></div></div></blockquote>
Does the sample rate have to be 44100? I'd guess that 32000 might work better on the DS hardware.</div>    
</div>
<div class="post">
    <h4>#64832 - brian33x51 - Tue Dec 27, 2005 7:28 am</h4>
    <div class="postbody">Thanks a ton for all the work.  I probably would have written everything in ruby if I had my choice but I didn't do the work.<br/>
<br/>
Thanks to you all and thanks to moonshell.  I'll test this tomorrow.</div>    
</div>
<div class="post">
    <h4>#64840 - JaJa - Tue Dec 27, 2005 10:32 am</h4>
    <div class="postbody"><blockquote class="uncited"><div><blockquote class="uncited"><div><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>SAMPLES=44100</code></pre></div></div></blockquote>
Does the sample rate have to be 44100? I'd guess that 32000 might work better on the DS hardware.</div></blockquote>

The moonshell samples use 48000.<br/>
It's only 44100 here because that was the sample rate on my test file and i suppose Juhees has copied it.<br/>
<br/>
BTW Juhees, that was an awesome piece of coding for a couple of hours worth of work. It need a few changes for me (just #include <stdlib.h> at the beginning) but otherwise works great.</div>    
</div>
<div class="post">
    <h4>#64846 - juhees - Tue Dec 27, 2005 1:46 pm</h4>
    <div class="postbody"><blockquote class="uncited"><div>Secound is a script, that works for me, but i don't like it, some spots are not robust enought :-(<br/>
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>SAMPLES=44100</code></pre></div></div></blockquote>
Does the sample rate have to be 44100? I'd guess that 32000 might work better on the DS hardware.[/quote]<br/>
<br/>
I have only have testet it so far with that sample rate, i don't know, which rate will be the best...<br/>
<br/>
juhees</div>    
</div>
<div class="post">
    <h4>#64850 - JaJa - Tue Dec 27, 2005 3:58 pm</h4>
    <div class="postbody">Bit of expirimentation today shows that 22050 is best for DS speakers with 41000 for headphones.<br/>
<br/>
sox output.wav -r 22050 -g -c 1 output.gsm.wav for speakers<br/>
sox output.wav -r 41000 -g -c 1 output.gsm.wav for headphones.</div>    
</div>
<div class="post">
    <h4>#64855 - brian33x51 - Tue Dec 27, 2005 6:18 pm</h4>
    <div class="postbody">Update:<br/>
<br/>
integrated the c code and shell script together in a ruby script.<br/>
<br/>
Currently defaults to 22050Hz mono.<br/>
<br/>
And a link to the ruby script<br/>
<br/>
<a class="postlink" href="http://traeak.dyndns.org/~bolsen/mpg2dpg.rb.txt">http://traeak.dyndns.org/~bolsen/mpg2dpg.rb.txt</a><br/>
<br/>
And a sample encoded file:<br/>
<a class="postlink" href="http://traeak.dyndns.org/~bolsen/fire_emblem_rekka_no_ken.dpg">http://traeak.dyndns.org/~bolsen/fire_e ... no_ken.dpg</a><br/>
880k<br/>
<br/>
Original:<br/>
MPEG1  320x240  29.970 fps<br/>
MPEG3 48000 Hz, 2 ch, s16le, 192.0 kbit<br/>
<br/>
<a class="postlink" href="http://traeak.dyndns.org/~bolsen/fire_emblem_rekka_no_ken.mpg">http://traeak.dyndns.org/~bolsen/fire_e ... no_ken.mpg</a><br/>
9.4M<br/>
<br/>
One thing that bothers me aobut the header encode is that the "fps" portion i had to encode as a big endian uint16 followed by 2 null bytes.  Everything else I was able to encode as little endian uint32.<br/>
<br/>
The current version of the script uses mencode for mpeg1 conversion, ffmpeg for audio extraction and sox for gsm conversion.<br/>
<br/>
Not pretty.<br/>
<br/>
The fire emblem demo encodes pretty well actually.  I tried to encode a music video and well, that stuttered very badly.<br/>
<br/>
It seems that both ffmpeg & meconder can only encode at "standard" mpeg1 rates.<br/>
<br/>
UPDATE: just found the flag that allows arbitrary fps.  Works great.<br/>
<br/>
ffmpeg video output has tons of block artifacts at any fps or bitrate.</div>    
</div>
<div class="post">
    <h4>#64909 - juhees - Wed Dec 28, 2005 1:18 pm</h4>
    <div class="postbody"><blockquote><div><cite>brian33x51 wrote:</cite>Update:<br/>
<br/>
integrated the c code and shell script together in a ruby script.<br/>
<br/>
Currently defaults to 22050Hz mono.
</div></blockquote>

I'm going to install ruby to test it, but from a short look at your source, i'd say it's a better solution than my script. <br/>
<blockquote><div><cite>brian33x51 wrote:</cite>UPDATE: just found the flag that allows arbitrary fps.  Works great.<br/>
<br/>
ffmpeg video output has tons of block artifacts at any fps or bitrate.</div></blockquote>

For the one, who don't have ruby and are using still my version: you have to call mencoder with<br/>
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>mencoder $IF -o $VTMP -ovc lavc -lavcopts vcodec=mpeg1video&amp;#58;vstrict=-1&amp;#58;vbitrate=160000 -nosound -ofps $FPS -vf scale=256&amp;#58;192</code></pre></div>

instead of 
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>mencoder $IF -o $VTMP -ovc lavc -lavcopts vcodec=mpeg1video&amp;#58;vbitrate=160000 -nosound -ofps $FPS -vf s
cale=256&amp;#58;192</code></pre></div>

nice work,<br/>
juhees<br/>
<br/>
UPDATE: Well, the audio was only noise :-( I had to grep the audio with mplayer again and then change the sox options to resample the audio, but not it works :-)<br/>
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>	# extract audio as wav
	
	#audioArgs = &amp;#91; "ffmpeg", "-y",
	#		"-i", infilename,
	#		"-vn",
	#		"-ar", ASAMPLES, 
	#		"-ac", ACHANNELS,
	#		ATMP &amp;#93;

	tmp = "-ao pcm&amp;#58;file="+ATMP
	audioArgs = &amp;#91; "mplayer", infilename, tmp &amp;#93;
	
	if ! Kernel.system&amp;#40;audioArgs.join&amp;#40;" "&amp;#41;&amp;#41;
		$stderr.puts "Error extracting audio"
		exit 1
	end

	# convert audio to gsm
	soxArgs = &amp;#91; "sox", ATMP, "-r", ASAMPLES, "-g -c 1", GTMP &amp;#93;
	if ! Kernel.system&amp;#40;soxArgs.join&amp;#40;" "&amp;#41;&amp;#41;
		$stderr.puts "Error converting audio to gsm"
		exit 1
	end</code></pre></div>

greetings<br/>
juhees</div>    
</div>
<div class="post">
    <h4>#64924 - brian33x51 - Wed Dec 28, 2005 4:01 pm</h4>
    <div class="postbody"><blockquote><div><cite>juhees wrote:</cite>
<br/>
For the one, who don't have ruby and are using still my version: you have to call mencoder with<br/>
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>mencoder $IF -o $VTMP -ovc lavc -lavcopts vcodec=mpeg1video&amp;#58;vstrict=-1&amp;#58;vbitrate=160000 -nosound -ofps $FPS -vf scale=256&amp;#58;192</code></pre></div>

instead of 
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>mencoder $IF -o $VTMP -ovc lavc -lavcopts vcodec=mpeg1video&amp;#58;vbitrate=160000 -nosound -ofps $FPS -vf s
cale=256&amp;#58;192</code></pre></div>

nice work,<br/>
juhees<br/>
<br/>
UPDATE: Well, the audio was only noise :-( I had to grep the audio with mplayer again and then change the sox options to resample the audio, but not it works :-)<br/>
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>	# extract audio as wav
	
	#audioArgs = &amp;#91; "ffmpeg", "-y",
	#		"-i", infilename,
	#		"-vn",
	#		"-ar", ASAMPLES, 
	#		"-ac", ACHANNELS,
	#		ATMP &amp;#93;

	tmp = "-ao pcm&amp;#58;file="+ATMP
	audioArgs = &amp;#91; "mplayer", infilename, tmp &amp;#93;
	
	if ! Kernel.system&amp;#40;audioArgs.join&amp;#40;" "&amp;#41;&amp;#41;
		$stderr.puts "Error extracting audio"
		exit 1
	end

	# convert audio to gsm
	soxArgs = &amp;#91; "sox", ATMP, "-r", ASAMPLES, "-g -c 1", GTMP &amp;#93;
	if ! Kernel.system&amp;#40;soxArgs.join&amp;#40;" "&amp;#41;&amp;#41;
		$stderr.puts "Error converting audio to gsm"
		exit 1
	end</code></pre></div>

greetings<br/>
juhees</div></blockquote>

Unfortunately I'm unable to use mplayer to extract the audio still on my athlon64 machine.  It just dumps tons of errors and crashes still.<br/>
<br/>
Seem my card reader at home is flakey so I couldn't test on the DS last night.  Will test that today.  I'll start cleaning things up.<br/>
<br/>
I'm on gentoo, both ~x86 and ~amd64 so I have the luxury of easily grabbing packages if need be (for testing other encoders).  Why is it so hard to extract number of frames?</div>    
</div>
<div class="post">
    <h4>#64941 - JaJa - Wed Dec 28, 2005 7:54 pm</h4>
    <div class="postbody">Heheheh.<br/>
For for some reason i prefer doing commands myself rather than using either your shell script (juhees) or the ruby script.<br/>
To get the number of frames i look at the final line of mencoder.<br/>
<br/>
Also mplayer sometimes has trouble working out the type of audio you have dumped. If you just get <br/>
playing output.dmp<br/>
in mplayer run the original file and look at what the audio format is.<br/>
Then change .dmp to the appropriate file type (e.g. output.ac3 or output.mp3)</div>    
</div>
<div class="post">
    <h4>#64961 - brian33x51 - Wed Dec 28, 2005 10:41 pm</h4>
    <div class="postbody"><blockquote><div><cite>JaJa wrote:</cite>Heheheh.<br/>
For for some reason i prefer doing commands myself rather than using either your shell script (juhees) or the ruby script.<br/>
To get the number of frames i look at the final line of mencoder.<br/>
<br/>
Also mplayer sometimes has trouble working out the type of audio you have dumped. If you just get <br/>
playing output.dmp<br/>
in mplayer run the original file and look at what the audio format is.<br/>
Then change .dmp to the appropriate file type (e.g. output.ac3 or output.mp3)</div></blockquote>

ffmpeg's audio dumper is far more robust than mencoder's.<br/>
<br/>
I'll grant you that the scripts aren't that great right now, but I figure the script actually documents what's being done.  I may get off my duff and maybe even consider hacknig together some scripted gui to do this with a few basic selections.<br/>
<br/>
If someone were to give you an mpeg1video and you didn't know the frames...well...<br/>
<br/>
"mpeg_ps_info" from the mpeg4ip package gets you fps & number of seconds in the mpeg which can be used to compute the number of frames.</div>    
</div>
<div class="post">
    <h4>#65239 - LunarCrisis - Sun Jan 01, 2006 8:00 am</h4>
    <div class="postbody">The problem with ffmpeg is that it won't play all the types of files mplayer can. In particular, it won't recognize .ogm files. I succeeded in using the ruby script by changing 
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>audioArgs = &amp;#91; "ffmpeg", "-y",
			"-i", infilename,
			"-vn",
			"-ar", ASAMPLES, 
			"-ac", ACHANNELS,
			ATMP &amp;#93;</code></pre></div>
to
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>audioArgs = &amp;#91; "mplayer", infilename, "-ao", 'pcm&amp;#58;file="' + ATMP + '"' &amp;#93;</code></pre></div>
Unfortunately in this case you have to put in the values for ASAMPLES and ACHANNELS which correspond to your video. (or should ACHANNELS always be 1?) (EDIT: looks like it should always be 1, since it appears that sox converts it to 1 channel anyways)<br/>
<br/>
This also has the annoying side effect that mplayer opens and plays through the video silently and quickly while it's extracting the sound. The fact that it's decoding the video as well must be slowing it down, but I don't know a command line option to prevent this happening.</div>    
</div>
<div class="post">
    <h4>#65244 - JaJa - Sun Jan 01, 2006 11:57 am</h4>
    <div class="postbody">To stop it "playing" the video:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>mplayer output.mp3 -ao pcm&amp;#58;file=output.wav -vc dummy -vo null</code></pre></div>
although i think mplayer just ignore the video stream anyway.<br/>
<br/>
And yes achannels is always one.<br/>
At least in the 3 sample dpg's i had to work with.<br/>
It might support stereo, but i'm unsure.</div>    
</div>
<div class="post">
    <h4>#65257 - brian33x51 - Sun Jan 01, 2006 4:35 pm</h4>
    <div class="postbody"><span class="postbody">I've updated my script for the mplayer args and moved the audio rate, channels, video rate and size to variables at the top.
<br/>
<br/>
I also added in support for embedded spaces in the input and output file names.  I have to yet play more with widescreen movies.  I'm sure we'll need a config file or gui to handle all the options.
<br/>
<br/>
I personally still have ffmpeg for the audio extract.  Every single time I use mplayer for  this I get these messages in plenty and end up with an mplayer crash:
<br/>
<br/>
big_values too large! 95%                                                       
<br/>
big_values too large!
<br/>
big_values too large!
<br/>
Blocktype == 0 and window-switching == 1 not allowed.
<br/>
big_values too large!
<br/>
mpg123: Can't rewind stream by 908 bits!
<br/>
Blocktype == 0 and window-switching == 1 not allowed.                           
<br/>
big_values too large! 93%                                                       
<br/>
Blocktype == 0 and window-switching == 1 not allowed.
<br/>
big_values too large! 93%                                                       
<br/>
mpg123: Can't rewind stream by 801 bits!
<br/>
big_values too large!
<br/>
mpg123: Can't rewind stream by 2536 bits!
<br/>
big_values too large!
<br/>
mpg123: Can't rewind stream by 1737 bits!
<br/>
big_values too large! 92%                                                       
<br/>
mpg123: Can't rewind stream by 1071 bits!
<br/>
big_values too large! 90%                                                       
<br/>
Blocktype == 0 and window-switching == 1 not allowed.
<br/>
.
<br/>
.
<br/>
.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65308 - LunarCrisis - Sun Jan 01, 2006 11:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>brian33x51 wrote:</b></span></td> </tr> <tr> <td class="quote">I've updated my script for the mplayer args and moved the audio rate, channels, video rate and size to variables at the top.
<br/>
<br/>
I also added in support for embedded spaces in the input and output file names.  I have to yet play more with widescreen movies.  I'm sure we'll need a config file or gui to handle all the options.
<br/>
</td> </tr></table><span class="postbody">It should be possible to get the audio rate directly from the source video somehow by looking at mplayer's output, though I don't know enough ruby to figure it out =(. I'm told that mplayer can resize automatically to within a certain size (256x192 in this case) while keeping the same aspect, and I'm told that it has something to do with the -vf dsize parameter, but I'm not quite sure how. But yeah, configurable size would be useful to use 192x144 and such =p. It would also be convenient to have a choice of subtitle (-sid #) and audio tracks (-aid #).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I personally still have ffmpeg for the audio extract.  Every single time I use mplayer for  this I get these messages in plenty and end up with an mplayer crash:
<br/>
<br/>
big_values too large! 95%                                                       
<br/>
big_values too large!
<br/>
. . .</td> </tr></table><span class="postbody"> Does this happen with all videos or just some? Maybe you should try updating your version of mplayer.<br/>_________________<br/>If a tree falls in the forest and no one is there to hear it, why the heck do you care?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65329 - brian33x51 - Mon Jan 02, 2006 2:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LunarCrisis wrote:</b></span></td> </tr> <tr> <td class="quote">Does this happen with all videos or just some? Maybe you should try updating your version of mplayer.</td> </tr></table><span class="postbody">
<br/>
<br/>
gentoo ~amd64
<br/>
<br/>
I reemerged mplayer this morning again just tomake sure.
<br/>
<br/>
Just tried something else and found out that the problem is directly related to the 64bit version of mplayer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65446 - LunarCrisis - Tue Jan 03, 2006 9:43 am</h4>
    <div class="postbody"><span class="postbody">I'm not sure that this is new, but I just thought I'd share something I've observed about sound syncronization. I've found that sound synchronization can be improved by correcting the sound frequency to match the change in video frequency. The videos I were converting were in the standard 23.97 fps form (or 24000/1001 exactly), but when it's converted into a dpg the fps gets changed to 24. This doesn't seem like such a huge change, but over something like 20 minutes the sound can be a whole second out of sync. This can be corrected by multiplying the sound frequency by 1.001 ( 24/(24000/1001) ). If the sound still gets out of sync tapping left or right re-syncs it. =D<br/>_________________<br/>If a tree falls in the forest and no one is there to hear it, why the heck do you care?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68842 - SeanMon - Fri Jan 27, 2006 1:28 am</h4>
    <div class="postbody"><span class="postbody">I have been looking for this for a really long time!<br/>_________________<br/>null</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91472 - WereWolf - Fri Jul 07, 2006 11:51 am</h4>
    <div class="postbody"><span class="postbody">I cannot play videos encoded with that instructions. The .dpg test movie that someone upload to that thread didn't run too. I suppose that something is bad. I don't know if you can play your old encoded videos with the new moonshell version, can you confirm that? Is it only my fault? 
<br/>
<br/>
Sorry for my english! Thanku!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91478 - JaJa - Fri Jul 07, 2006 12:37 pm</h4>
    <div class="postbody"><span class="postbody">Whilst the header has remained the same I believe the latest moonshell uses a different audio codec.
<br/>
You may need to enable support for old dpg files in the .ini file.
<br/>
(I think that's an option anyway)<br/>_________________<br/>LAWL HOOGE
<br/>
<a class="postlink" href="http://www.pageofrandom.wordpress.com/" target="_blank">My Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91480 - WereWolf - Fri Jul 07, 2006 1:10 pm</h4>
    <div class="postbody"><span class="postbody">JaJa thx for your reply! Iep the error is the audio codec! yes!
<br/>
<br/>
I looked up a dpgenc windows encoded file, and extracted audio from it. It seems that audio is now encoded with mpg audio (mp2) i think.Someone can contrast it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91506 - WereWolf - Fri Jul 07, 2006 5:04 pm</h4>
    <div class="postbody"><span class="postbody">After more testing I can play dpg files with the latest moonshell. Audio must to be encoded with mpeg audio (mp2), and the number of channels must to be 0 in the dpg header(?). 
<br/>
<br/>
I have problems with videos encoded with ffmpeg, videos doesn't play ok with mooshell, some square blocks artifacts appears at the screen and video  is not being decoded ok... With mencoder I have no problems... Do you know how to encode the video with ffmpeg?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109707 - theli - Mon Nov 20, 2006 4:55 pm</h4>
    <div class="postbody"><span class="postbody">i'm sorry for reviving such old thread.. but i have a question:
<br/>
what should be the byte order of different header sections?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109820 - theli - Tue Nov 21, 2006 2:00 pm</h4>
    <div class="postbody"><span class="postbody">anyway ... if anyone is interested..
<br/>
i've managed to create a python script which i use ofr encoding videos to DPG format on my linux box ...
<br/>
is supports common set of options 
<br/>
and automatically embeds subtitle with matched filename
<br/>
(can be turned off)
<br/>
also font and subtitle encoding can be specified
<br/>
and so on .... 
<br/>
<br/>
the script can be found here:
<br/>
<a href="http://theli.ho.com.ua/dpgconv/" target="_blank">http://theli.ho.com.ua/dpgconv/</a>
<br/>
any feedback appreciated ...
<br/>
<br/>
and i have one more question:
<br/>
i experience a/v sync loss everytime i try to seek in dpg file ...
<br/>
anyone know a possible reason of this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109853 - bugmenot! - Tue Nov 21, 2006 7:29 pm</h4>
    <div class="postbody"><span class="postbody">theli, I just used your script to transcode a clip, and it worked flawlessly! Finally converting video on this platform is as easy as it is when using the Windows tools, if not actually easier, because it doesn't get much easier than typing in what file to convert!
<br/>
<br/>
I'll be using it a lot.
<br/>
<br/>
Edit: Got an error while converting from a Real Media file, but it's not like I've got more than one of them anyway.
<br/>
<br/>
Debug if you wish to do something about it:
<br/>
Traceback (most recent call last):
<br/>
  File "dpgconv-0.1.py", line 195, in ?
<br/>
    conv_file(file)
<br/>
  File "dpgconv-0.1.py", line 159, in conv_file
<br/>
    write_header(frames)
<br/>
  File "dpgconv-0.1.py", line 140, in write_header
<br/>
    headerValues = [ "DPG0", int(frames), options.fps, 0, options.hz , 0 ]
<br/>
ValueError: invalid literal for int():</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109881 - dude1 - Wed Nov 22, 2006 7:18 am</h4>
    <div class="postbody"><span class="postbody">what is the most idiot proof way of encoding dpg's on osx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109887 - theli - Wed Nov 22, 2006 9:58 am</h4>
    <div class="postbody"><span class="postbody">i've figured out what was causing a/v sync loss on seeking and   put a new version of script... now audio and video stay in sync on seeking :D
<br/>
<a href="http://theli.ho.com.ua/dpgconv/" target="_blank">http://theli.ho.com.ua/dpgconv/</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bugmenot! wrote:</b></span></td> </tr> <tr> <td class="quote">Got an error while converting from a Real Media file</td> </tr></table><span class="postbody">
<br/>
can you actually play that rm file in mplayer?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dude1 wrote:</b></span></td> </tr> <tr> <td class="quote">what is the most idiot proof way of encoding dpg's on osx</td> </tr></table><span class="postbody">
<br/>
i do not know of any tools for encoding on MACs but i'm sure my script can do this 
<br/>
(you'll need to install mplayer package too)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109910 - oofrab - Wed Nov 22, 2006 6:41 pm</h4>
    <div class="postbody"><span class="postbody">theli, nice little tool, was looking for something like this! Unfortunately, my mencoder does not seem to support the option "-of rawaudio" :( (Fedora Core 5)
<br/>
<br/>
Also, a suggestion would be to show some sort of progress output during the encoding process.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109939 - theli - Thu Nov 23, 2006 8:38 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">theli, nice little tool, was looking for something like this! Unfortunately, my mencoder does not seem to support the option "-of rawaudio" :( (Fedora Core 5)
<br/>
</td> </tr></table><span class="postbody">
<br/>
what does running
<br/>
mencoder -of help
<br/>
outputs?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Also, a suggestion would be to show some sort of progress output during the encoding process.</td> </tr></table><span class="postbody">
<br/>
i'm thinking of it</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109941 - oofrab - Thu Nov 23, 2006 9:19 am</h4>
    <div class="postbody"><span class="postbody">Ok, this was a half PICNIC error...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
what does running 
<br/>
mencoder -of help
<br/>
outputs?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
My version of mencoder was 1.0pre7, i.e., pretty old. This version does not support rawaudio
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Available output formats:
<br/>
   avi      - Microsoft Audio/Video Interleaved
<br/>
   mpeg     - MPEG-1/2 system stream format
<br/>
   rawvideo - (video only, one stream only) raw stream, no muxing
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Somehow this was blocking yum (update manager in Fedora) resulting in me not having the latest version of mencoder. Manually deleteing the old version of mencoder and then installing the version 1.0pre8 (from the livna repository), I now have
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Available output formats:
<br/>
   avi      - Microsoft Audio/Video Interleaved
<br/>
   mpeg     - MPEG-1/2 system stream format
<br/>
   lavf     - FFmpeg libavformat muxers
<br/>
   rawvideo - (video only, one stream only) raw stream, no muxing
<br/>
   rawaudio - (audio only, one stream only) raw stream, no muxing
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This should fix my problem! A suggestion, if you want to make the program a bit more user friendly(or idiot proof :) ), you could maybe check that rawaudio is an available output format.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109944 - theli - Thu Nov 23, 2006 10:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">This should fix my problem! A suggestion, if you want to make the program a bit more user friendly(or idiot proof :) ), you could maybe check that rawaudio is an available output format.</td> </tr></table><span class="postbody">
<br/>
actually these are work-in-progress versions and i'll add errors checking next....
<br/>
<br/>
in the meantime  you can get 0.3 version which outputs progress indication :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110040 - oofrab - Fri Nov 24, 2006 4:26 pm</h4>
    <div class="postbody"><span class="postbody">Nice, now I see how far i have progressed...
<br/>
<br/>
I have some more suggestions, if you want. How about trapping the signal SIGINT so that when I press Ctrl-C dpgconv removes any temporary files?
<br/>
For this, you need to import the module signal and set up the callback using "signal.signal(signal.SIGINT, cleanup_callback)" and define a function "def cleanup_callback(signal, frame):" removing the files. (Maybe also trap more signals, such as SIGTERM etc.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110041 - theli - Fri Nov 24, 2006 5:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">I have some more suggestions, if you want. How about trapping the signal SIGINT so that when I press Ctrl-C dpgconv removes any temporary files?
<br/>
For this, you need to import the module signal and set up the callback using "signal.signal(signal.SIGINT, cleanup_callback)" and define a function "def cleanup_callback(signal, frame):" removing the files. (Maybe also trap more signals, such as SIGTERM etc.)</td> </tr></table><span class="postbody">
<br/>
thanx!
<br/>
(btw - it's actually my second python programming experience :) )
<br/>
<br/>
today i've noticed that total frames calculation is not good for any file .. this once again leads to a/v desync on seeking ...
<br/>
<br/>
well.. mencoder outputs bad, duplicated and skipped frames ...
<br/>
transcoding one file today i've got that skipped frames number was lower than "bad frames"
<br/>
and as i use
<br/>
original_frames + duplicated_frames - skipped_frames
<br/>
moonshell that created file has more frames than it actually has ...
<br/>
but using
<br/>
original_frames + duplicated_frames - bad_frames
<br/>
fixed this ...
<br/>
and now i'm confused how to calculate output file total frames :/
<br/>
maybe just obtain ID_LENGTH from 
<br/>
mplayer -identify 
<br/>
output and multiply this with fps?
<br/>
for example:
<br/>
(now in my sciprt)
<br/>
Original file total frames:61439
<br/>
Skipped 18664 frames
<br/>
Duplicated 0 frames
<br/>
23001 bad  frames
<br/>
Output file total frames:38438
<br/>
<br/>
possible solution:
<br/>
ID_LENGTH=2562.52
<br/>
fps=15
<br/>
2562.52*15=38437.80
<br/>
<br/>
<br/>
what you think whould be better to use?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112021 - theli - Tue Dec 12, 2006 2:54 pm</h4>
    <div class="postbody"><span class="postbody">anyone knows about new dpg format used in moonshell 1.5 ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112051 - oofrab - Tue Dec 12, 2006 9:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">anyone knows about new dpg format used in moonshell 1.5 ?</td> </tr></table><span class="postbody">
<br/>
<br/>
I saw some info on DPG2 in the new BatchDPG thread: <a class="postlink" href="http://gbatmw.net/index.php?topic=2266" target="_blank">http://gbatmw.net/index.php?topic=2266</a>
<br/>
<br/>
Is there no place, like a wiki, where one can put information like this? Stuff like  the DPG1 format DPG2 format, different graphic formats specific to the DS etc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112105 - theli - Wed Dec 13, 2006 8:04 am</h4>
    <div class="postbody"><span class="postbody">somthnig like that is here 
<br/>
<a href="http://en.wikipedia.org/wiki/NDs-mPeG" target="_blank">http://en.wikipedia.org/wiki/NDs-mPeG</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112121 - oofrab - Wed Dec 13, 2006 1:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">somthnig like that is here 
<br/>
<a href="http://en.wikipedia.org/wiki/NDs-mPeG" target="_blank">http://en.wikipedia.org/wiki/NDs-mPeG</a></td> </tr></table><span class="postbody">
<br/>
<br/>
Hmm, oki, not optimal since it is very hard to find other related info, but still I guess it's better than nothing.
<br/>
<br/>
So, shall we start documenting the DPG2 format there (I don't know if it even qualifies as a 'new' format).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112129 - tepples - Wed Dec 13, 2006 3:06 pm</h4>
    <div class="postbody"><span class="postbody">Format details don't belong in an encyclopedia.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112138 - oofrab - Wed Dec 13, 2006 4:50 pm</h4>
    <div class="postbody"><span class="postbody">So, what existent alternatives are there for format documentation?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112139 - Lick - Wed Dec 13, 2006 4:55 pm</h4>
    <div class="postbody"><span class="postbody">TXT documents. XD<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112141 - oofrab - Wed Dec 13, 2006 5:08 pm</h4>
    <div class="postbody"><span class="postbody">Well, from the posts above, it seems as if the best way to RE the 'new' DPG format is to start a thread and try to submit findings along the way. Then if we finally reach our goal of understanding the format we write it in a TXT file and send it floating around the internet! Hmm...
<br/>
<br/>
Somehow, this doesn't strike me as an effective strategy, although it is nice way of having it forgotten or 'lost'. In my opinion, a DS wiki with all kinds of information (yes, even formats) is a lot more effective.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112144 - Firon - Wed Dec 13, 2006 5:53 pm</h4>
    <div class="postbody"><span class="postbody">Maybe you can stick it onto the wiki of some piracy-related site?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112150 - tepples - Wed Dec 13, 2006 7:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Firon wrote:</b></span></td> </tr> <tr> <td class="quote">Maybe you can stick it onto the wiki of some piracy-related site?</td> </tr></table><span class="postbody">
<br/>
Bad idea, when there exist <a class="postlink" href="http://www.tobw.net/dswiki/index.php?title=Main_Page" target="_blank">non-pirate DS-oriented wikis</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112330 - oofrab - Fri Dec 15, 2006 8:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">anyone knows about new dpg format used in moonshell 1.5 ?</td> </tr></table><span class="postbody">
<br/>
<br/>
After a look at the source code to dpgtools (Moonshell sources), the new format seems to add a GOP ("Group Of Pictures" is a video encoding term) list to the DPG file. The header has increased by 8 bytes to 48 bytes in total. The changes to the header are that "pixel format" at offset 36 in the DPG1 file has moved to  offset 44 and that, in the new DPG2 header, the two dwords at offset 36 and 40 contain the offset and the size of the GOP list in the DPG file.
<br/>
<br/>
The GOP list is appended at the end of the DPG file. I have not yet had time to check the format of the GOP list. It seems as if the GOP list has been added to enable seeking during playback.
<br/>
<br/>
The thing I do not understand is why the new header does not  append the extra info about the offset and size of the GOP list at the end of the header. Instead the choice was made to move the offset of the "pixel format" field by 8 bytes and insert the GOP data before this field.
<br/>
<br/>
Also the header description of the DPG header in wikipedia (linked above) seems to be wrong. Way too many padding zeros, making the total size wrong.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112331 - theli - Fri Dec 15, 2006 8:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">Also the header description of the DPG header in wikipedia (linked above) seems to be wrong. Way too many padding zeros, making the total size wrong.</td> </tr></table><span class="postbody">
<br/>
may be.. i haven't looked at it closely .. i was reffering to makeheader.c source from batchdpg when i was writing my python script :)
<br/>
<br/>
too bad i cannot test new format as moonshell doesn't work on G6 yet</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112371 - Firon - Fri Dec 15, 2006 8:00 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://ls5.cydonianknight.com/index.php?download=BatchDPG_v1.3_alpha_A.rar" target="_blank">http://ls5.cydonianknight.com/index.php?download=BatchDPG_v1.3_alpha_A.rar</a>
<br/>
<br/>
mpeg_stat is also available as a *nix program (BatchDPG is using it for the m1v parsing for the GOP list creation) <a href="http://bmrc.berkeley.edu/ftp/pub/multimedia/mpeg/stat/" target="_blank">http://bmrc.berkeley.edu/ftp/pub/multimedia/mpeg/stat/</a>
<br/>
<br/>
Note that the DPG2s produced aren't technically valid: they go out of sync. The GOP list generation is correct (output was identical between this and dpgenc), as is the header creation, but something else is messed up.
<br/>
<br/>
I know BatchDPG is a Windows program, but you can examine it to figure out the GOP list structure. Also, 1.3a has an updated headermaker.c which supports DPG2.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112605 - oofrab - Mon Dec 18, 2006 3:14 pm</h4>
    <div class="postbody"><span class="postbody">Some info I gathered on the DPG[012] file format. Please comment if you find anything wrong.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
The DPG format is a video and audio container used by the popular
<br/>
Moonshell homebrew program on the Nintendo DS.
<br/>
<br/>
There are currently (December 2006) three versions of the DPG format,
<br/>
identified by the initial four bytes of in the DPG file, namely DPG0,
<br/>
DPG1 and DPG2.
<br/>
<br/>
[DPG file structure]
<br/>
Each DPG file consists of three (DPG0,DPG1) or four (DPG2) sections: a
<br/>
header, the audio stream, the video stream and for the DPG2 format an
<br/>
additional GOP (Group Of Pictures) list used for seeking during
<br/>
playback. All these sections are concatenated in the above mentioned
<br/>
order when creating the DPG file.
<br/>
<br/>
[Header]
<br/>
The first section of the DPG file is the header with the following
<br/>
fields: (all fields are read by Moonshell 1.5 as a 32 bit unsigned
<br/>
number)
<br/>
<br/>
Offset                  Description
<br/>
0     DPG[012]          Identifier. One of the strings: DPG0 (0x30475044),
<br/>
                        DPG1 (0x31475044) or DPG2 (0x32475044).
<br/>
4     DPG[012]          Number of frames in video.
<br/>
8     DPG[012]          Frames per second (FPS). Fixed point 8.8 format, i.e.
<br/>
                        25 fps is multiplied by 100h (FPS&lt;&lt;8) to 6400.
<br/>
12    DPG[012]          Sampling rate of audio data (e.g. 32000)
<br/>
16    DPG[012]          Number of audio channels. If MP2 audio, this is zero.
<br/>
20    DPG[012]          Offset in file to audio stream
<br/>
24    DPG[012]          Size of audio stream.
<br/>
28    DPG[012]          Offset in file to video stream
<br/>
32    DPG[012]          Size of video stream.
<br/>
36    DPG[1]            Pixel format type
<br/>
<br/>
36    DPG[2]            Offset in file to GOP list.
<br/>
40    DPG[2]            Size of GOP list.
<br/>
44    DPG[2]            Pixel format type
<br/>
<br/>
Note: dpgtools 1.2 reads all values except the identifier as a signed
<br/>
32 bit value. Moonshell 1.5, on the other hand, reads them as unsigned
<br/>
32 bit values. This should not pose any problem, at least not until we
<br/>
reach 2GB files.
<br/>
<br/>
<br/>
[Pixel Formats]
<br/>
DPG0 only supports the RGB24 pixel format. DPG1 and DPG2 know the
<br/>
following pixel formats,
<br/>
<br/>
Type     Description
<br/>
0        RGB15
<br/>
1        RGB18
<br/>
2        RGB21
<br/>
3        RGB24
<br/>
<br/>
<br/>
[GOP List]
<br/>
The Group Of Pictures (GOP) list of a DPG2 file is the last section of
<br/>
a DPG file. It consists of an array of a "FrameIndex" and "Offset"
<br/>
pair, both are read as an unsigned 32 bit value from within Moonshell.
<br/>
<br/>
The use of the GOP list, within Moonshell 1.5, is when requesting a
<br/>
jump to a certain frame. In the case when a GOP list exists, it is
<br/>
searched in order to find the frame within the GOP list lower than or
<br/>
equal to the requested frame. (The search in Moonshell requires the
<br/>
GOP list to be ordered. Also a trivial optimization was omitted,
<br/>
namely to break out of the search loop once the GOP frame number is
<br/>
larger than the requested one.)
<br/>
<br/>
So, to get clean seeks, I would put I-frames from the MPEG stream in
<br/>
the GOP list.
<br/>
<br/>
[Audio Format]
<br/>
The audio format can be one of two types: GSM or MP2. The type used in
<br/>
a DPG file is distinguished by the number of audio channels. If audio
<br/>
channels is zero, an MP2 stream is assumed, otherwise the audio is GSM.
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112625 - Firon - Mon Dec 18, 2006 8:08 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://ls5.cydonianknight.com/index.php?download=BatchDPG_v1.3_beta_3.exe" target="_blank">http://ls5.cydonianknight.com/index.php?download=BatchDPG_v1.3_beta_3.exe</a>
<br/>
<a href="http://ls5.cydonianknight.com/index.php?download=BatchDPG_v1.3_beta_3_source.rar" target="_blank">http://ls5.cydonianknight.com/index.php?download=BatchDPG_v1.3_beta_3_source.rar</a>
<br/>
<br/>
DPG2 is now working properly.
<br/>
<br/>
oofrab: your description of the header is spot on.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112937 - oofrab - Thu Dec 21, 2006 8:15 pm</h4>
    <div class="postbody"><span class="postbody">Firon: Nice to see that BatchDPG works. Does the dpg still go out of sync?
<br/>
<br/>
But, I was still curious as to what was in the GOP list, so here comes some more info I have found:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">The GOPList contains a frame number and offset within the video stream
<br/>
(offset 0 is at beginning of the video stream). The question is what
<br/>
within the video stream do we give the offset of. It turns out to be
<br/>
the offset to the "sequence header code" and NOT the "group start
<br/>
code" (identifies the GOP) or the "picture start code" (identifies a
<br/>
frame). These start codes are unique and byte-aligned(!) within the
<br/>
video stream.
<br/>
<br/>
The "sequence header code" is identified by the value 0x000001B3 (big
<br/>
endian). So to find the offset to put in the, so called, GOP list,
<br/>
search the video stream for a byte aligned value of 0x000001B3 and
<br/>
these will be the offsets to write into the dpg file.
<br/>
<br/>
The GOP list also holds a frame index. This can be calculated by
<br/>
counting how many frames (or pictures) have been seen in the video
<br/>
stream up until the current "sequence header code". This means that
<br/>
the first "sequence header code" has a frame index of zero. Pictures
<br/>
(i.e. I-, P-, B-frames ...), can be identified by the "picture start
<br/>
code", which is also unique. This code is 0x00000100 and also
<br/>
byte-aligned.
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112963 - LS5 - Fri Dec 22, 2006 12:20 am</h4>
    <div class="postbody"><span class="postbody">To generate the GOP list for BatchDPG, I used the above mentioned mpeg_stat and scanned its output using this piece of code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">$stats = FileOpen($temp &amp; ".off", 0)
<br/>
$gopList = FileOpen($temp &amp; ".gop", 2)
<br/>
$frames = 0
<br/>
While 1
<br/>
   $line = StringSplit(FileReadLine($stats), " ")
<br/>
   If $line[0] &lt; 2 Then ExitLoop
<br/>
   If $line[1] = "picture" Then $frames += 1
<br/>
   If $line[1] = "gop" Then
<br/>
      FileWrite($gopList, BinaryString($frames))
<br/>
      FileWrite($gopList, BinaryString(Number(String($line[2] / 8 - 140))))
<br/>
   EndIf
<br/>
WEnd
<br/>
FileClose($stats)
<br/>
FileClose($gopList)</td> </tr></table><span class="postbody">
<br/>
Why substract 140? That's exactly the value that was needed to make the output equal to dpgenc's output. Thanks to your documentation I now know why this was necessary; I searched for the 'gop' lines when I actually had to search for 'sequence'. Thanks again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113008 - oofrab - Fri Dec 22, 2006 9:59 am</h4>
    <div class="postbody"><span class="postbody">Glad that you could use the info!
<br/>
<br/>
Technically, you can have several <span style="font-style: italic">GOP</span>s within a <span style="font-style: italic">sequence</span>. I believe that the choice to use a sequence was done because GOPs can be "open", meaning they can reference data within other GOPs. This would make it difficult to jump to a certain GOP in the video stream if data was needed from a previous, skipped, GOP. This seems to be rarely the case, though, since in my two short examples, I only saw one GOP for each sequence.
<br/>
<br/>
Now if only this made it to a linux converter... (hehe)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113288 - brian33x51 - Tue Dec 26, 2006 3:30 am</h4>
    <div class="postbody"><span class="postbody">Sort of off topic...how do you guys install moonshell?
<br/>
It's a damn shame it's a windows setup program.  Under wine all I get is a black window.
<br/>
<br/>
Answered my own question:  changing from winxp to win98 emulation made it work properly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113653 - theli - Fri Dec 29, 2006 1:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">Now if only this made it to a linux converter... (hehe)</td> </tr></table><span class="postbody">
<br/>
as i have now moonshell 1.6b working on my G6 i'll implement this .. though adding another dependancy on mpeg_stat doesn't looks nice to me :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113654 - Firon - Fri Dec 29, 2006 2:08 pm</h4>
    <div class="postbody"><span class="postbody">Well, mpeg_stat is also a *nix program, so at least you won't need to use wine to run it. :P The -offset option has the most useful information.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113656 - theli - Fri Dec 29, 2006 2:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Firon wrote:</b></span></td> </tr> <tr> <td class="quote">Well, mpeg_stat is also a *nix program, so at least you won't need to use wine to run it. :P The -offset option has the most useful information.</td> </tr></table><span class="postbody">
<br/>
yeah .. actually now (as i already depend on it) i can use mpeg_stat for getting frame count ... and not using (original frames - bad frames) :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113705 - oofrab - Fri Dec 29, 2006 10:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">as i have now moonshell 1.6b working on my G6 i'll implement this .. though adding another dependancy on mpeg_stat doesn't looks nice to me :(</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, as I see it you do not actually have to depend on mpeg_stat. All information needed to find the 'sequence' offset for the GOP list and also the offsets to the picture frames for the total number of frames was given in my previous post. Then again, searching the binary stream in your python script might make it a tad bit larger. (I also now assume that all frames in the stream are displayed, which I do not know for sure is the case in mpeg.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113755 - theli - Sat Dec 30, 2006 9:20 am</h4>
    <div class="postbody"><span class="postbody">well ... anyway .. this is a version which depends on mpeg_stat ... and adds support for DPG1 and DPG2 ....
<br/>
<br/>
<a href="http://theli.ho.com.ua/dpgconv/" target="_blank">http://theli.ho.com.ua/dpgconv/</a>
<br/>
<a href="http://theli.ho.com.ua/dpgconv/dpgconv-0.4.py" target="_blank">http://theli.ho.com.ua/dpgconv/dpgconv-0.4.py</a>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">	dpgconv 0.4
<br/>
		Added support for DPG1 and DPG2.
<br/>
		Pixel format setting for DPG1 and DPG2.
<br/>
		Now using mpeg_stat for calculating frame count and GOPs.
<br/>
		Cleanup on SIGINT and SIGTERM.</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115248 - relaxed - Sun Jan 14, 2007 4:17 am</h4>
    <div class="postbody"><span class="postbody">You can get the frame count by running:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mencoder movie.mpg -oac copy -ovc copy -o /dev/null</td> </tr></table><span class="postbody">
<br/>
<br/>
This will output:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Video stream:  722.069 kbit/s  (90258 B/s)  size: 62518457 bytes  692.659 secs  20759 frames</td> </tr></table><span class="postbody">
<br/>
<br/>
20759 frames. Hope this helps.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115293 - theli - Sun Jan 14, 2007 8:24 pm</h4>
    <div class="postbody"><span class="postbody">i CAN get frame count postprocessing temporary raw mpeg stream with mencoder/mplayer ... the main reason for depending on mpeg_stat is GOPlist creating for DPG2.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115295 - relaxed - Sun Jan 14, 2007 8:42 pm</h4>
    <div class="postbody"><span class="postbody">@theli
<br/>
Ahh, I see. Well the current solution works well. 
<br/>
<br/>
I searched for some info on best encoding options for the ds and was wondering if you might know. I'm looking for high quality settings and I noticed your script in "-q" mode use a vbitrate of 256 where the windows program batchdpg does 384. Is there any reason to use a lower vbitrate? I'm aware you can change it but didn't know myabe you've found the sweet spot is 256.
<br/>
<br/>
Is there anyway to play dpg files with mplayer? All I get is audio and -identify doesn't list anything about mpeg1. 
<br/>
<br/>
Thanks again for your time and the great transcoder. :)
<br/>
<br/>
-- 
<br/>
relaxed</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115296 - theli - Sun Jan 14, 2007 9:10 pm</h4>
    <div class="postbody"><span class="postbody">normal/low/high quality settings do not affect video or audio bitrate settings..
<br/>
they affect other things .. dithering for example ...
<br/>
<br/>
there are aeparate settings for video/audio bitrate though:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">	-v,--vbps xxx
<br/>
		sets video stream bps in kb/s(default: 256)
<br/>
	-a,--abps xxx
<br/>
		sets audio stream bps kb/s (default: 128)</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115879 - steveox28 - Fri Jan 19, 2007 10:30 pm</h4>
    <div class="postbody"><span class="postbody">Say, I want to encode right from a DVD, will this work using a vob which was ripped as a source file?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115880 - Firon - Fri Jan 19, 2007 10:36 pm</h4>
    <div class="postbody"><span class="postbody">Assuming he's using mplayer/mencoder to handle things, yes, actually.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115882 - theli - Fri Jan 19, 2007 10:40 pm</h4>
    <div class="postbody"><span class="postbody">yes
<br/>
you can also use transcoding from dvd
<br/>
something like
<br/>
dpgconv <a href="dvd://02" target="_blank">dvd://02</a>
<br/>
(for a particular (second here) chapter)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116144 - steveox28 - Mon Jan 22, 2007 2:15 pm</h4>
    <div class="postbody"><span class="postbody">I tried encoding an mpeg4 file and was able to do it with BatchDPG v1.2
<br/>
<a href="http://utorrent.com/BatchDPG_v1.2.7z" target="_blank">http://utorrent.com/BatchDPG_v1.2.7z</a>
<br/>
<br/>
However I needed DPG2 support so I installed BatchDPG v1.3 beta 3 in a different location.  When it gets to encoding the video I get a message it couldn't find the proper codec.
<br/>
<br/>
I didn't change anything, I have the K-Lite Codec Pack 2.82 Full installed without any changes for the first one.
<br/>
<br/>
I have the same Video setting except the Resizer, which is new.
<br/>
<br/>
Any Idea what I am missing?
<br/>
<br/>
Thank you,
<br/>
<br/>
Steve</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116169 - steveox28 - Mon Jan 22, 2007 8:50 pm</h4>
    <div class="postbody"><span class="postbody">Theli,
<br/>
<br/>
Using your python script I get the following.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
dpgconv-0.4.py home/harry_potter_chamber_of_secrets-001.avi hp_chamber_secrets.avi
<br/>
Converting home/harry_potter_chamber_of_secrets-001.avi
<br/>
Transcoding video:   done
<br/>
Transcoding audio:   done
<br/>
Creating header
<br/>
Creating harry_potter_chamber_of_secrets-001.dpg
<br/>
Removing temporary files
<br/>
Done converting "home/harry_potter_chamber_of_secrets-001.avi" to "harry_potter_chamber_of_secrets-001.dpg"
<br/>
Converting hp_chamber_secrets.avi
<br/>
Transcoding video:   done
<br/>
Transcoding audio:   done
<br/>
Traceback (most recent call last):
<br/>
  File "/usr/local/bin/dpgconv-0.4.py", line 321, in ?
<br/>
    conv_file(file)
<br/>
  File "/usr/local/bin/dpgconv-0.4.py", line 273, in conv_file
<br/>
    frames = mpeg_stat()
<br/>
  File "/usr/local/bin/dpgconv-0.4.py", line 253, in mpeg_stat
<br/>
    frames = m.group(1)
<br/>
AttributeError: 'NoneType' object has no attribute 'group'</td> </tr></table><span class="postbody">
<br/>
<br/>
The resulting .dpg is about 420mb and when I play it in mplayer it says no video and plays the audio.
<br/>
<br/>
I tried playing with moonshell and my NDS just locks up.
<br/>
<br/>
I did download mpeg_stat and installed it in /usr/local/bin along with dpgconv-0.4.py
<br/>
<br/>
I have tried doing it straight from my dvd, as well as an mpeg4 file.
<br/>
<br/>
Thank you,
<br/>
<br/>
Steve</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116214 - theli - Tue Jan 23, 2007 6:23 am</h4>
    <div class="postbody"><span class="postbody">as for mplayer ... it behaves in such way (playing only audio) with any dpg file...
<br/>
as for lockup - are you using latest stable 1.6 moonshell?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116268 - sinclair44 - Tue Jan 23, 2007 10:56 pm</h4>
    <div class="postbody"><span class="postbody">I'm having a few sound issues... moonshell will play the video fine, but the sound is about 2x too fast and eventually it locks up after about 5 seconds. Encoding the audio myself with twolame works fine.
<br/>
<br/>
I'd much appreciate a twolame-audio option, or even a "here's the audio track, I encoded it myself external to the script, use it" option. Come to think of it, I could probably make the changes to the script myself and submit a patch to you or something.
<br/>
<br/>
In any case, the script is awesome if the audio would work!<br/>_________________<br/>Inter arma enim silent leges</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116284 - steveox28 - Wed Jan 24, 2007 2:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">as for mplayer ... it behaves in such way (playing only audio) with any dpg file...
<br/>
as for lockup - are you using latest stable 1.6 moonshell?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, I am using the latest stable 1.6 moonshell.  I have a regular DS an M3 Game Player 3rd and a passcard.
<br/>
<br/>
I have tried converting several types of movies but nothing plays.  I am not even sure the moonshell is working properly as only the touch screen is on.  Whereas the howto's I have seen and pictures show the top screen on as well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116297 - HyperHacker - Wed Jan 24, 2007 7:04 am</h4>
    <div class="postbody"><span class="postbody">The top screen should be showing a file browser or if nothing else some debug text. You'd have to have edited the configuration to put the file browser on the bottom for that, so you'd probably know if that was the case.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116307 - theli - Wed Jan 24, 2007 8:32 am</h4>
    <div class="postbody"><span class="postbody">so, steveox28, i assume you have problems running moonshell itself ... and not with videos</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116330 - steveox28 - Wed Jan 24, 2007 1:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">so, steveox28, i assume you have problems running moonshell itself ... and not with videos</td> </tr></table><span class="postbody">
<br/>
<br/>
I am able to play mp3's with moonshell.
<br/>
<br/>
The top screen goes off when the passcard is booted.  I get into moonshell by selecting extended from the menu.  Is the ds supposed to boot into moonshell directly?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116332 - theli - Wed Jan 24, 2007 1:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>steveox28 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">so, steveox28, i assume you have problems running moonshell itself ... and not with videos</td> </tr></table><span class="postbody">
<br/>
<br/>
I am able to play mp3's with moonshell.
<br/>
<br/>
The top screen goes off when the passcard is booted.  I get into moonshell by selecting extended from the menu.  Is the ds supposed to boot into moonshell directly?</span></td> </tr></table><span class="postbody">
<br/>
MultiMedia Extended built in some M3 and G6 flashcarts is not moonshell but their own clone ... it doesn't support dpg2 ...
<br/>
you can try to convert video for it passing 
<br/>
--dpg 0 
<br/>
to the script
<br/>
like
<br/>
dpgconv.py --dpg 0 video.avi</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116346 - Firon - Wed Jan 24, 2007 5:59 pm</h4>
    <div class="postbody"><span class="postbody">You have to install the real Moonshell and load the appropriate NDS. You cannot use "Extend".</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117574 - jjlawren - Mon Feb 05, 2007 9:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>steveox28 wrote:</b></span></td> </tr> <tr> <td class="quote">Theli,
<br/>
<br/>
Using your python script I get the following.
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
dpgconv-0.4.py home/harry_potter_chamber_of_secrets-001.avi hp_chamber_secrets.avi
<br/>
Converting home/harry_potter_chamber_of_secrets-001.avi
<br/>
Transcoding video:   done
<br/>
Transcoding audio:   done
<br/>
Creating header
<br/>
Creating harry_potter_chamber_of_secrets-001.dpg
<br/>
Removing temporary files
<br/>
Done converting "home/harry_potter_chamber_of_secrets-001.avi" to "harry_potter_chamber_of_secrets-001.dpg"
<br/>
Converting hp_chamber_secrets.avi
<br/>
Transcoding video:   done
<br/>
Transcoding audio:   done
<br/>
Traceback (most recent call last):
<br/>
  File "/usr/local/bin/dpgconv-0.4.py", line 321, in ?
<br/>
    conv_file(file)
<br/>
  File "/usr/local/bin/dpgconv-0.4.py", line 273, in conv_file
<br/>
    frames = mpeg_stat()
<br/>
  File "/usr/local/bin/dpgconv-0.4.py", line 253, in mpeg_stat
<br/>
    frames = m.group(1)
<br/>
AttributeError: 'NoneType' object has no attribute 'group'</td> </tr></table><span class="postbody">
<br/>
<br/>
The resulting .dpg is about 420mb and when I play it in mplayer it says no video and plays the audio.
<br/>
<br/>
I tried playing with moonshell and my NDS just locks up.
<br/>
<br/>
I did download mpeg_stat and installed it in /usr/local/bin along with dpgconv-0.4.py
<br/>
<br/>
I have tried doing it straight from my dvd, as well as an mpeg4 file.
<br/>
<br/>
Thank you,
<br/>
<br/>
Steve</span></td> </tr></table><span class="postbody">
<br/>
Has anyone found a fix for this issue?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117636 - theli - Tue Feb 06, 2007 5:57 am</h4>
    <div class="postbody"><span class="postbody">what issue?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117637 - mobad - Tue Feb 06, 2007 6:15 am</h4>
    <div class="postbody"><span class="postbody">this error 
<br/>
<br/>
Traceback (most recent call last):
<br/>
  File "/usr/local/bin/dpgconv-0.4.py", line 321, in ?
<br/>
    conv_file(file)
<br/>
  File "/usr/local/bin/dpgconv-0.4.py", line 273, in conv_file
<br/>
    frames = mpeg_stat()
<br/>
  File "/usr/local/bin/dpgconv-0.4.py", line 253, in mpeg_stat
<br/>
    frames = m.group(1)
<br/>
AttributeError: 'NoneType' object has no attribute 'group'
<br/>
<br/>
i have it too and i have mpeg_stat mencoder and mplayer installed
<br/>
it worked before but now its not :/ at least for me
<br/>
i doubt its a problem on your part just i have no idea hot to get it to work probably just a package install
<br/>
<br/>
UPDATE:
<br/>
reinstalled mpeg_stat and mpeg_stat.1 in /usr/local/bin and /usr/bin and now  
<br/>
it seems to work!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117647 - theli - Tue Feb 06, 2007 10:04 am</h4>
    <div class="postbody"><span class="postbody">with such errors (when needed executables are not in path)
<br/>
just edit this lines in script with full paths:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">MENCODER="mencoder"
<br/>
MPLAYER="mplayer"
<br/>
MPEG_STAT="mpeg_stat"
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117674 - jjlawren - Tue Feb 06, 2007 2:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mobad wrote:</b></span></td> </tr> <tr> <td class="quote">this error 
<br/>
<br/>
Traceback (most recent call last):
<br/>
  File "/usr/local/bin/dpgconv-0.4.py", line 321, in ?
<br/>
    conv_file(file)
<br/>
  File "/usr/local/bin/dpgconv-0.4.py", line 273, in conv_file
<br/>
    frames = mpeg_stat()
<br/>
  File "/usr/local/bin/dpgconv-0.4.py", line 253, in mpeg_stat
<br/>
    frames = m.group(1)
<br/>
AttributeError: 'NoneType' object has no attribute 'group'
<br/>
<br/>
i have it too and i have mpeg_stat mencoder and mplayer installed
<br/>
it worked before but now its not :/ at least for me
<br/>
i doubt its a problem on your part just i have no idea hot to get it to work probably just a package install
<br/>
<br/>
UPDATE:
<br/>
reinstalled mpeg_stat and mpeg_stat.1 in /usr/local/bin and /usr/bin and now  
<br/>
it seems to work!</td> </tr></table><span class="postbody">
<br/>
Looks like my problem the whole time was that I read the instructions as "dpgconv.py &lt;source&gt; &lt;destination&gt;". Since the destination was always an empty file, everyone would complain.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117677 - theli - Tue Feb 06, 2007 3:16 pm</h4>
    <div class="postbody"><span class="postbody">hm .. i suppose i should check all needed tools' and files' existance ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117683 - steveox28 - Tue Feb 06, 2007 4:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Firon wrote:</b></span></td> </tr> <tr> <td class="quote">You have to install the real Moonshell and load the appropriate NDS. You cannot use "Extend".</td> </tr></table><span class="postbody">
<br/>
<br/>
I have been looking but can't seem to find how to do this.  Do you have a link that might describe how to do this?
<br/>
<br/>
I followed the tutorial at <a href="http://www.m3wiki.com/index.php?title=TheStick" target="_blank">http://www.m3wiki.com/index.php?title=TheStick</a>'s_MoonShell_Tutorial:_How_to_install%2C_customize%2C_use%2C_and_more
<br/>
<br/>
It doesn't say how you are supposed to launch Moonshell.  Probably because it is supposed to be so obvious that I should know.  For some reason I am missing this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117687 - Firon - Tue Feb 06, 2007 5:55 pm</h4>
    <div class="postbody"><span class="postbody">Once it's installed properly, launch the NDS as you would for any other ROM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119617 - oofrab - Sat Feb 24, 2007 8:26 pm</h4>
    <div class="postbody"><span class="postbody">Today, I had a problem with a video I created, containing duplicate frames. It seems as if though dpgconv-0.4.py produces dpgs which were completely out of sync. 
<br/>
<br/>
My solution was to add the 'harddup' filter to the call to mencoder in dpgconv, to actually duplicate these frames and it seems to fix this problem,
<br/>
<br/>
mencoder ... -vf ...,harddup ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119628 - theli - Sat Feb 24, 2007 9:47 pm</h4>
    <div class="postbody"><span class="postbody">hm ...i wonder... what was the fps of your input video and what fps settings you used for transcode?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119630 - Firon - Sat Feb 24, 2007 10:09 pm</h4>
    <div class="postbody"><span class="postbody">You shouldn't be setting the output FPS as higher than the source.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119631 - theli - Sat Feb 24, 2007 10:11 pm</h4>
    <div class="postbody"><span class="postbody">maybe i should add some warning when output fps set higher than input ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119632 - Firon - Sat Feb 24, 2007 10:43 pm</h4>
    <div class="postbody"><span class="postbody">You actually should just not allow it. It's a waste.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119720 - oofrab - Sun Feb 25, 2007 3:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">hm ...i wonder... what was the fps of your input video and what fps settings you used for transcode?</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, I had created a video from a bunch of pictures. The framerate was pretty low, something like 10-15 fps. Then I edited the video in Cinelerra, and finally added sound using ffmpeg to put it all together.  I'm no expert on video editing or processing, but the final xvid video with mp3 sound played fine in mplayer(no warnings) and had a framerate of 29.970 fps. Taking this and converting it into dpg with 15 fps, moonshell played the video at a faster rate and the music was out of sync with the video. haddup fixed that for me, indicating that moonshell must be skipping empty duplicate frames, since harddup duplicates these.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Firon wrote:</b></span></td> </tr> <tr> <td class="quote">You actually should just not allow it. It's a waste.</td> </tr></table><span class="postbody">
<br/>
<br/>
In this case, I prefer a synced video. Size is not an issue... ;P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119759 - Firon - Sun Feb 25, 2007 11:34 pm</h4>
    <div class="postbody"><span class="postbody">I meant not allowing a higher output FPS than the source FPS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#127405 - Sigma83 - Wed May 02, 2007 7:22 am</h4>
    <div class="postbody"><span class="postbody">I just caught up with this thread and would really appreciate any direction in how to go about doing a DPG convert in linux.  I grabbed the version 4.0 of the script back on page 3 or 4ish, but really am too noob to know what to do with it.  I have just been using linux for about a week now, using Debian with KDE file manager.  I understand how to get packages etc but just not how to use this script.
<br/>
<br/>
Any help and direction would be incredibly appreciated.
<br/>
<br/>
Thank you very much.
<br/>
<br/>
Sigma</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#127452 - oofrab - Wed May 02, 2007 4:46 pm</h4>
    <div class="postbody"><span class="postbody">Well, the script you got is a python script (version 0.4 of dpgconv by theli). You need to use this from the command line in a terminal, there is no graphical user interface unfortunately. For example, in KDE you can start 'Konsole'. The steps you will need to take are:
<br/>
<br/>
1. Save script to a file
<br/>
2. Make file executable
<br/>
3. Run file from the command line in a terminal (e.g. Konsole)
<br/>
<br/>
You will also need some programs installed:
<br/>
mplayer
<br/>
mencoder
<br/>
mpeg_stat (this dependency could be removed, but the script would have to be changed)
<br/>
<br/>
All of this is off the top of my head, so I may have missed some things. But ask and someone will surely answer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#127535 - Sigma83 - Thu May 03, 2007 3:30 am</h4>
    <div class="postbody"><span class="postbody">thank you for your reply.  I downloaded dpgconv.py and dropped that into /usr/bin and chmod 777'd the file.  I dropped the mpeg_stat and mpeg_stat1 files in there as well.  It seems mencoder is already a part of mplayer?  (just the impression I got).  I then tried...
<br/>
<br/>
dpgconv.py ./myavifile.avi ./myaviconvert.avi
<br/>
<br/>
and received the following error:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Converting ./24422.avi
<br/>
Transcoding video:   done
<br/>
Transcoding audio:   done
<br/>
Traceback (most recent call last):
<br/>
  File "/usr/bin/dpgconv.py", line 321, in ?
<br/>
    conv_file(file)
<br/>
  File "/usr/bin/dpgconv.py", line 273, in conv_file
<br/>
    frames = mpeg_stat()
<br/>
  File "/usr/bin/dpgconv.py", line 253, in mpeg_stat
<br/>
    frames = m.group(1)
<br/>
AttributeError: 'NoneType' object has no attribute 'group'
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
If anyone has any suggestions I'd really appreciate it as I'm really trying to get comfortable in the linux environment.
<br/>
<br/>
Thanks again.
<br/>
<br/>
Greg</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#127550 - Sigma83 - Thu May 03, 2007 6:05 am</h4>
    <div class="postbody"><span class="postbody">I managed to find a source that provides mencoder and now it's working very well.  It seems only the resolution needs adjustment so I'm hoping I can just adjust the script file to account for this.  
<br/>
<br/>
Thank you for this awesome script.  Any tips on adjusting for resolution would be great as well, but i'll take a look at the script myself.
<br/>
<br/>
:)
<br/>
<br/>
Greg
<br/>
<br/>
<br/>
EDIT:  This is such a fantastic script!!!!!!!!!   I have nothing but appreciation for the open source community producing quality stuff like this.  Thanks again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#127557 - theli - Thu May 03, 2007 7:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sigma83 wrote:</b></span></td> </tr> <tr> <td class="quote">and received the following error:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Converting ./24422.avi
<br/>
Transcoding video:   done
<br/>
Transcoding audio:   done
<br/>
Traceback (most recent call last):
<br/>
  File "/usr/bin/dpgconv.py", line 321, in ?
<br/>
    conv_file(file)
<br/>
  File "/usr/bin/dpgconv.py", line 273, in conv_file
<br/>
    frames = mpeg_stat()
<br/>
  File "/usr/bin/dpgconv.py", line 253, in mpeg_stat
<br/>
    frames = m.group(1)
<br/>
AttributeError: 'NoneType' object has no attribute 'group'
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
this just means that it can't find mpeg_stat to run ...
<br/>
also this proves that i'm to lazy to add at least minimal error checking :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#127558 - theli - Thu May 03, 2007 7:35 am</h4>
    <div class="postbody"><span class="postbody">btw.. i remember that moonshell supports ogg for audio streams in DPG...
<br/>
i wonder should i add support for ogg or it is not worth it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#127687 - Sigma83 - Fri May 04, 2007 1:39 am</h4>
    <div class="postbody"><span class="postbody">I don't know if there's much of an advantage to use ogg.  This is working great.  If anything, I'd just throw together a simple gui for this :)....or package all these programs into one bundle.  Had a hard time finding mencoder.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#127722 - oofrab - Fri May 04, 2007 9:19 am</h4>
    <div class="postbody"><span class="postbody">mencoder should be installable through your linux distributions' package system.
<br/>
The dependency on mpeg_stat can, as I said earlier, be removed, but this requires some more code in dpgconv.
<br/>
<br/>
Now, theli, if you want to support ogg, the differences in the file format of DPG3 , compared to DPG2, according to the Moonshell 1.71 source are:
<br/>
- New 'Identifier' (offset 0 in header) with value 0x33475044
<br/>
- Put an ogg audio stream instead of mp2
<br/>
- Change 'Number of audio channels' (at offset 16 in header) to 3 (?!?)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#127752 - theli - Fri May 04, 2007 2:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote"> if you want to support ogg</td> </tr></table><span class="postbody">
<br/>
i just wonder if it needed .. does it brings some advantages ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#127755 - oofrab - Fri May 04, 2007 4:00 pm</h4>
    <div class="postbody"><span class="postbody">Well apart from licensing and patent issues, I believe that the ogg audio support of dpg in Moonshell is suboptimal and that MP2 is currently the better format in dpg used with Moonshell. So, no, I see no reason to implement it yet, unless you want to support the DPG3 format.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128699 - shadowofdarkness - Mon May 14, 2007 6:12 am</h4>
    <div class="postbody"><span class="postbody">I have a question about the dpg output from this script. How come the output is not always capable of being viewed with mplayer. I would think with the same settings they should turn capable of being viewed with mplayer.
<br/>
<br/>
I converted 3 files (all played in mplayer fine)
<br/>
a flv from youtube (cp'd .flv from /tmp after the file finished downloading in browser)
<br/>
a dvd complient mpg (made myself from dv camcorder)
<br/>
a avi (video from net )
<br/>
<br/>
after converting to dpg
<br/>
the dvd complient mpg showed video but no sound in mplayer
<br/>
both the flv and avi played sound but no video
<br/>
<br/>
all worked in moonshell
<br/>
<br/>
I would like to test all output before taking the time to copy to my microsd card.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129136 - JaJa - Sat May 19, 2007 2:09 pm</h4>
    <div class="postbody"><span class="postbody">You can't check a file with mplayer.
<br/>
Mplayer doesn't understand the DPG container format.
<br/>
<br/>
Sometimes it will find a stream it understands and play it (normally the video stream).
<br/>
<br/>
There is a tool under windows dpgview.exe iirc that plays them. Maybe it would work under wine?<br/>_________________<br/>LAWL HOOGE
<br/>
<a class="postlink" href="http://www.pageofrandom.wordpress.com/" target="_blank">My Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130654 - Mr. Picklesworth - Wed Jun 06, 2007 5:03 am</h4>
    <div class="postbody"><span class="postbody">The site hosting mpeg_stat appears to be dead, and everything talking about it just links to the original (currently dead) web site. Just to rub it in, I guess, it was available in the Ubuntu repos (sudden glimmer of hope), but only for the ancient Warty release, and every single mirror was therefore a broken link! :(
<br/>
<br/>
Could someone please post that file here?
<br/>
<br/>
Great script, by the way! It was much faster than DPGEncode on Windows all the way up until I realized I didn't have mpeg_stat.
<br/>
I've been looking for a Linux CLI vs. Windows GUI comparison that makes my choice OS look good, and this seems to be it!
<br/>
<br/>
Edit:
<br/>
Found it on this ugly web site: <a href="http://hpux.cs.utah.edu/hppd/hpux/Development/Tools/mpeg_stat-2.2b/" target="_blank">http://hpux.cs.utah.edu/hppd/hpux/Development/Tools/mpeg_stat-2.2b/</a><br/>_________________<br/>Thanks!
<br/>
<span style="font-size: 9px; line-height: normal">MKDS Friend Code: 511165-679586
<br/>
MP:H Friend Code: 2105 2377 6896</span></span><span class="gensmall"><br/><br/>Last edited by Mr. Picklesworth on Wed Jun 06, 2007 6:26 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#130655 - theli - Wed Jun 06, 2007 5:19 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://www.google.com.ua/search?q=mpeg_stat-2.2b-src.tar.gz&amp;sourceid=opera&amp;num=%i&amp;ie=utf-8&amp;oe=utf-8" target="_blank">http://www.google.com.ua/search?q=mpeg_stat-2.2b-src.tar.gz&amp;sourceid=opera&amp;num=%i&amp;ie=utf-8&amp;oe=utf-8</a>
<br/>
<br/>
as i can see mpeg_stat is availible in freebsd mirrors :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130658 - Mr. Picklesworth - Wed Jun 06, 2007 7:21 am</h4>
    <div class="postbody"><span class="postbody">Okay, I have a few DPGs created with this script now and the video part is fine. However, for audio all it has is a constant, unrelenting <span style="font-style: italic">noise</span>... a lot like that from a very bad TV / radio connection.
<br/>
<br/>
This is playibg in Moonshell 1.7. (I think that's the number? Latest one, anyway).
<br/>
<br/>
I wish I could help more with this, but I don't know what else to tell you...
<br/>
Help, please? :)<br/>_________________<br/>Thanks!
<br/>
<span style="font-size: 9px; line-height: normal">MKDS Friend Code: 511165-679586
<br/>
MP:H Friend Code: 2105 2377 6896</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130665 - oofrab - Wed Jun 06, 2007 9:11 am</h4>
    <div class="postbody"><span class="postbody">Do all your DPGs result in bad audio?
<br/>
<br/>
Do you have (or can create) a <span style="font-weight: bold">small</span> sample of either the source file or the resulting DPG showing the problem and post it somewhere? That would enable someone who has this working to see if there is a problem with the files or the script.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130669 - theli - Wed Jun 06, 2007 12:25 pm</h4>
    <div class="postbody"><span class="postbody">yeah .. cause i have no idea what is wrong :(
<br/>
<br/>
edit: btw, what script are you talking about? ones from the first pages or the one written in python (dpgconv) ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130674 - Mr. Picklesworth - Wed Jun 06, 2007 3:42 pm</h4>
    <div class="postbody"><span class="postbody">I can't send you the ones that messed up because they are huge files and it would be illegal to distribute them, but I will try to find a small video to do this with.
<br/>
<br/>
This is with the DPGConv Python script.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">python dpgconv-0.4.py 'myVideo' -f 20 --hq</td> </tr></table><span class="postbody">
<br/>
<br/>
One incredible discovery: It does not happen when there is no audio in the file to begin with! (Okay, not much of a revelation, but it's something).
<br/>
<br/>
Yes, every DPG encoded so far that has audio does this. They are all like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Duration: 44 minutes
<br/>
<br/>
Video codec: DivX Mpeg-4 Version 5
<br/>
Framerate: 24 Frames per second
<br/>
<br/>
Audio bitrate: 96 kbps
<br/>
Codec: Mpeg-1 Layer 3
<br/>
Sample Rate: 32000 Hz
<br/>
Channels: 2</td> </tr></table><span class="postbody">The reason I started doing this via Linux was because of something wrong with DivX, using DPGEncode in Windows, that caused the system to die at a certain point near the end of encoding the video.
<br/>
This video plays fine, with working audio, using mplayer.<br/>_________________<br/>Thanks!
<br/>
<span style="font-size: 9px; line-height: normal">MKDS Friend Code: 511165-679586
<br/>
MP:H Friend Code: 2105 2377 6896</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131549 - weux - Sun Jun 17, 2007 4:50 am</h4>
    <div class="postbody"><span class="postbody">I have a video about 20 minutes long and at the begining the audio and video are synced, but then if you skip to the end the video becomes later than the audio.  Is this just how dpgs are or is there a fix for this.  Any help would be appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131634 - maya - Mon Jun 18, 2007 9:46 am</h4>
    <div class="postbody"><span class="postbody">I was converting some clips to dpg and some videos converted unexpectedly. The video is okay although audio sounds wrong.
<br/>
<br/>
Here is an example, I used default options
<br/>
<br/>
Source <a class="postlink" href="http://dylema.maya.googlepages.com/pianovictim2.mpeg" target="_blank">http://dylema.maya.googlepages.com/pianovictim2.mpeg</a>
<br/>
Converted <a class="postlink" href="http://dylema.maya.googlepages.com/pianovictim2.dpg" target="_blank">http://dylema.maya.googlepages.com/pianovictim2.dpg</a>
<br/>
<br/>
Yes, the video shows almost pitch black.
<br/>
<br/>
Can anyone convert this clip and see you have the same problem?
<br/>
<br/>
I am using the following versions
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
MEncoder 2:1.0~rc1-0ubuntu9.1 (C) 2000-2006 MPlayer Team
<br/>
CPU: AMD Athlon(tm)  (Family: 6, Model: 6, Stepping: 2)
<br/>
CPUflags: Type: 6 MMX: 1 MMX2: 1 3DNow: 1 3DNow2: 1 SSE: 1 SSE2: 0
<br/>
Compiled with runtime CPU detection.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
MPlayer 2:1.0~rc1-0ubuntu9.1 (C) 2000-2006 MPlayer Team
<br/>
CPU: AMD Athlon(tm)  (Family: 6, Model: 6, Stepping: 2)
<br/>
CPUflags:  MMX: 1 MMX2: 1 3DNow: 1 3DNow2: 1 SSE: 1 SSE2: 0
<br/>
Compiled with runtime CPU detection.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
mpeg_stat -- MPEG Analyzer for MPEG I video streams (version 2.2b)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
dpgconv.py 0.4
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131649 - oofrab - Mon Jun 18, 2007 7:28 pm</h4>
    <div class="postbody"><span class="postbody">I played your dpg file and hear the problem with the sound. Then I did my own conversion using dpgconv and the end result was good. I would imagine that the mplayer/mencoder version is to blame. Can you upgrade and retry converting?
<br/>
<br/>
My program versions that work converting the file:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
MPlayer SVN-r23545 rpm.livna.org (C) 2000-2007 MPlayer Team
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
MEncoder SVN-r23545 (C) 2000-2007 MPlayer Team
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
mpeg_stat -- MPEG Analyzer for MPEG I video streams (version 2.2)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
By the way, excellent info. Makes it much easier to debug.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131717 - maya - Tue Jun 19, 2007 10:48 am</h4>
    <div class="postbody"><span class="postbody">I checked out the latest dev version, MPlayer dev-SVN-r23581-4.1.2, but the problem still occurs. I twisted the dpgconv.py so I could see temp files.
<br/>
<br/>
I played mp2tmp.mp2 file with normal mpeg player and it worked okay. Also I checked mpgtmp.mpg and it was okay too.
<br/>
<br/>
So I assume there is some error around header?
<br/>
<br/>
Here is some more info. (if i convert the above file to dpg)
<br/>
<br/>
gop.tmp
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
0000000: 0000 0000 c280 c3bf c3bf c3bf c3ba 0000  ................
<br/>
0000010: 0074 c3a0 0100 c3b4 0100 007e c38e 0300  .t.........~....
<br/>
0000020: c3ae 0200 00c2 92c2 bb05 00c3 a803 0000  ................
<br/>
0000030: 2cc2 ac07 00c3 a204 0000 c3b6 c2a4 0900  ,...............
<br/>
0000040: 0a                                       .
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
header.tmp
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
0000000: 4450 4732 c2b1 0500 0000 0f00 0000 7d00  DPG2..........}.
<br/>
0000010: 0000 0000 0030 0000 0000 c2bb 1700 30c2  .....0........0.
<br/>
0000020: bb17 00c3 8d52 0b00 c3bd 0d23 0030 0000  .....R.....#.0..
<br/>
0000030: 0003 0000 000a                           ......
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
oofrab, can you please compare these files with yours?
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131723 - theli - Tue Jun 19, 2007 2:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>weux wrote:</b></span></td> </tr> <tr> <td class="quote">I have a video about 20 minutes long and at the begining the audio and video are synced, but then if you skip to the end the video becomes later than the audio.  Is this just how dpgs are or is there a fix for this.  Any help would be appreciated.</td> </tr></table><span class="postbody">
<br/>
if you used dpgconv 
<br/>
this may be caused by source file having lower fps than value specified to script (default is 15)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131726 - theli - Tue Jun 19, 2007 2:23 pm</h4>
    <div class="postbody"><span class="postbody">hm ... i have this issue with above file too ... 
<br/>
dpg and mp2tmp.mp2 sound different in moonshell ....
<br/>
though both report correct frequency ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131736 - oofrab - Tue Jun 19, 2007 4:20 pm</h4>
    <div class="postbody"><span class="postbody">Hmm, I am currently at work so I cannot fully test this, but here are the two headers of the dpg files. The first from your supplied dpg and the other from my coversion of the mpeg file.
<br/>
<br/>
Header from mayas dpg file from above:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
00000000  44 50 47 32 b1 05 00 00  00 0f 00 00 00 7d 00 00  |DPG2.........}..|
<br/>
00000010  00 00 00 00 30 00 00 00  40 d8 17 00 70 d8 17 00  |....0...@...p...|
<br/>
00000020  d8 50 0b 00 48 29 23 00  40 00 00 00 03 00 00 00  |.P..H)#.@.......|
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Header from my conversion of mayas mpeg file from above:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
00000000  44 50 47 32 b1 05 00 00  00 0f 00 00 00 7d 00 00  |DPG2.........}..|
<br/>
00000010  00 00 00 00 30 00 00 00  00 bb 17 00 30 bb 17 00  |....0.......0...|
<br/>
00000020  cd 52 0b 00 fd 0d 23 00  30 00 00 00 03 00 00 00  |.R....#.0.......|
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
They don't seem to match your header though. Your header seems to be much bigger than 48 bytes? Why?
<br/>
<br/>
Look at the header description:
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=7897&amp;start=48" target="_blank">http://forum.gbadev.org/viewtopic.php?t=7897&amp;start=48</a>
<br/>
<br/>
What type of machine do you have? Is this a 64-bit problem?
<br/>
<br/>
I'll look into this in more detail later.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131802 - theli - Wed Jun 20, 2007 7:37 am</h4>
    <div class="postbody"><span class="postbody">strange ...
<br/>
i and maya both got 1562688 audiosize ... but you got 1555200 ...
<br/>
<br/>
though i can't see  a problem .. mp2tmp (at least my) is really 1562688 bytes ....
<br/>
these causes  the differences in headers
<br/>
also sizes of video streams are also different</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131807 - theli - Wed Jun 20, 2007 8:48 am</h4>
    <div class="postbody"><span class="postbody">there is something wrong either with input file or mencoder
<br/>
<br/>
oofrab, can you, please, post mencoder output when converting audio?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131868 - oofrab - Wed Jun 20, 2007 9:30 pm</h4>
    <div class="postbody"><span class="postbody">Ok, there seems to be some confusion here and several files mencoder versions etc. 
<br/>
<br/>
The header I posted above was from a Fedora Core 6 distribution with mplayer/mencoder from the livna repository and the version stated in my previous mail. This produced a different sized file than what you two had. Let us for the sake of clarity forget this file, even though it works fine! I believe that the newer mplayer handles the errors in the original stream slightly differently.
<br/>
<br/>
I want to also disregard the second post by maya, where the gop and header is shown. Since the header doesn't make sense to me, it is too long, I'll ignore it for now.
<br/>
<br/>
At home, I reinstalled my system very recently and now I run Ubuntu. Converting the original mpeg file gives me the EXACT SAME header and file size (2304392) as the first post from maya, BUT there are still differences! The header is the same, the gop-list is the same and the video stream is the same in the dpg files. The only difference is the audio stream! My dpg file works, and maya's above does not. So the question is, what corrupts the audio for maya?
<br/>
<br/>
Theli, does your converted dpg file sound like maya's? (Don't be fooled by the same length and header or even the music(?) :) ). The output from the audioconversion is a bit long, so I'll spare you. This is the audio command at least:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
mencoder "pianovictim2.mpeg" -v -of rawaudio -oac lavc -ovc copy -lavcopts acodec=mp2:abitrate=128 -o mp2tmp.mp2 -af channels=2,resample=32000:1:2
<br/>
</td> </tr></table><span class="postbody">
<br/>
with audio data (mp2tmp.mp2) beginning with
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
00000000  ff fd 88 04 55 33 33 44  22 44 33 22 33 33 33 6d  |....U33D"D3"333m|
<br/>
00000010  b6 e3 6c 90 00 00 00 00  00 00 ff f0 0f ff f0 f0  |..l.............|
<br/>
00000020  fa af f9 46 94 68 09 80  98 cc 8c c9 12 3e 44 8f  |...F.h.......&gt;D.|
<br/>
</td> </tr></table><span class="postbody">
<br/>
The difference from maya's audio can already be seen in this excerpt if one compares the audio stream from the dpg in maya's post.
<br/>
<br/>
Oh, and maya? Are you sure you haven't done something to the script to produce the "incorrect" headers? What did you change between first posting your files and after upgrading mplayer/mencoder, posting the gop and header?
<br/>
<br/>
(One sidenote. Having a fresh system _without_ mencoder and trying to convert the mpeg file, the script seemed to pass the video and audio encoding states, but complained in the mpeg_stat state. This had me confused for a while and  it was not obvious that the error was a missing mencoder. Oh, and theli, the mpeg_stat link on the webpage of dpgconv does not work.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131905 - maya - Thu Jun 21, 2007 8:10 am</h4>
    <div class="postbody"><span class="postbody">As I stated earlier mp2 file works okay in Moonshell
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
0000000: fffd 8804 5533 3344 2244 3322 3333 336d  ....U33D"D3"333m
<br/>
0000010: a6e4 6c90 0000 0000 0000 fff0 0fff f005  ..l.............
<br/>
0000020: ffaf f946 9468 0980 98cc 8cc9 123e 448f  ...F.h.......&gt;D.
<br/>
0000030: 9d56 2755 8c18 c18b 9bb9 bbdd bddb 61b6  .V'U..........a.
<br/>
0000040: 1c6a 9f1a a7e3 7cb8 df2d 73d7 3d72 d72d  .j....|..-s.=r.-
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and my linux system is
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Linux calvin-ubuntu 2.6.20-15-generic #2 SMP Sun Apr 15 07:36:31 UTC 2007 i686 GNU/Linux
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
only thing that i have changed after installing dev version of mencoder and mplayer is the following
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
MP2TMP="/tmp/mp2tmp.mp2"
<br/>
MPGTMP="/tmp/mpgtmp.mpg"
<br/>
HEADERTMP="/tmp/header.tmp"
<br/>
GOPTMP="/tmp/gop.tmp"
<br/>
STATTMP="/tmp/stat.tmp"
<br/>
<br/>
MENCODER="/usr/local/bin/mencoder"
<br/>
MPLAYER="/usr/local/bin/mplayer"
<br/>
MPEGSTAT="/usr/local/bin/mpeg_stat"
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and i just converted the file again, it works lol
<br/>
the header is
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
0000000: 4450 4732 b105 0000 000f 0000 007d 0000  DPG2.........}..
<br/>
0000010: 0000 0000 3000 0000 00bb 1700 30bb 1700  ....0.......0...
<br/>
0000020: cd52 0b00 fd0d 2300 3000 0000 0300 0000  .R....#.0.......
<br/>
</td> </tr></table><span class="postbody">
<br/>
which is exactly same as oofrab's
<br/>
<br/>
*sigh*</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131922 - theli - Thu Jun 21, 2007 12:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Theli, does your converted dpg file sound like maya's? (Don't be fooled by the same length and header or even the music(?) :) ).
<br/>
</td> </tr></table><span class="postbody">
<br/>
it does.. however the same stream played separatly with the same moonshell sounds fine
<br/>
<br/>
however that DPG result i got on windows in cygwin ... 
<br/>
i forgot to check it on my home linux system
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
 The output from the audioconversion is a bit long, so I'll spare you. This is the audio command at least:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
mencoder "pianovictim2.mpeg" -v -of rawaudio -oac lavc -ovc copy -lavcopts acodec=mp2:abitrate=128 -o mp2tmp.mp2 -af channels=2,resample=32000:1:2
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
i meant ... did mencoder spit any errors .. cause mine did.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
(One sidenote. Having a fresh system _without_ mencoder and trying to convert the mpeg file, the script seemed to pass the video and audio encoding states, but complained in the mpeg_stat state. This had me confused for a while and  it was not obvious that the error was a missing mencoder.</td> </tr></table><span class="postbody">
<br/>
i know dpgconv misses some checks and errors reporting in some places ... just too lazy to fix it ... patches are welcome :D
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
 Oh, and theli, the mpeg_stat link on the webpage of dpgconv does not work.)
<br/>
</td> </tr></table><span class="postbody">
<br/>
but do you know some other mpeg_stat's homepage?
<br/>
<br/>
<br/>
anyway it seems maya's problem is "solved" now .... somehow ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131931 - oofrab - Thu Jun 21, 2007 1:13 pm</h4>
    <div class="postbody"><span class="postbody">Good to hear that it works.
<br/>
<br/>
As I wrote in my previous post, your initial dpg file was almost correct, but with a bad audio stream. Extracting the stream from the file, I could not get it to play in mplayer. I do not know why Moonshell would play it fine though. Are you sure? (I cannot test it right now.) You could try extracting it from the dpg
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
dd ibs=1 skip=48 count=1562688 if=pianovictim2.dpg of=audioStream
<br/>
</td> </tr></table><span class="postbody">
<br/>
and try playing the audiostream in mplayer. It sounds awful.
<br/>
<br/>
Theli, yeah mencoder shows many errors during the conversion. Strange that you also get bad audio. Does the audio stream sound ok when player through mplayer?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131941 - theli - Thu Jun 21, 2007 1:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">Theli, yeah mencoder shows many errors during the conversion. Strange that you also get bad audio. Does the audio stream sound ok when player through mplayer?</td> </tr></table><span class="postbody">
<br/>
audio stream extracted from mine dpg (which doesn't sound good in moonshell) sounds fine with mplayer ... a pure magic ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131958 - oofrab - Thu Jun 21, 2007 5:27 pm</h4>
    <div class="postbody"><span class="postbody">Bah! I'll give up until someone has a problem with this again.
<br/>
<br/>
Butchered highlights:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">[Maya]I played your dpg file and hear the problem with the sound. Then I did my own conversion using dpgconv and the end result was good.</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>maya wrote:</b></span></td> </tr> <tr> <td class="quote">I played mp2tmp.mp2 file with normal mpeg player and it worked okay.</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>maya wrote:</b></span></td> </tr> <tr> <td class="quote">As I stated earlier mp2 file works okay in Moonshell</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">Theli, does your converted dpg file sound like maya's?[i.e. bad]</td> </tr></table><span class="postbody">it does.. however the same stream played separatly with the same moonshell sounds fine</span></td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oofrab wrote:</b></span></td> </tr> <tr> <td class="quote">Extracting the stream from the file, I could not get it to play in mplayer.</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">audio stream extracted from mine dpg (which doesn't sound good in moonshell) sounds fine with mplayer ... a pure magic ;)</td> </tr></table><span class="postbody">
<br/>
<br/>
Honestly, can all this info be correct at the same time? :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132615 - Mr. Picklesworth - Thu Jun 28, 2007 5:27 am</h4>
    <div class="postbody"><span class="postbody">I am on an Ubuntu Feisty system as well, so presumably I have the same version as Maya started with here. (Will double check. Just have to reboot).
<br/>
<br/>
For me, every video I have encoded (even completely unrelated ones) has come out with the garbled audio.
<br/>
<br/>
If there is anything I can do to provide you with more information here, I will happily do so :)<br/>_________________<br/>Thanks!
<br/>
<span style="font-size: 9px; line-height: normal">MKDS Friend Code: 511165-679586
<br/>
MP:H Friend Code: 2105 2377 6896</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132653 - oofrab - Thu Jun 28, 2007 12:51 pm</h4>
    <div class="postbody"><span class="postbody">I think we can begin with a sample source file and the resulting dpg. Then someone can maybe try to reproduce the audio problem. I myself have not yet managed to reproduce the bad audio, but have seen it in maya's dpg above.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132809 - Mr. Picklesworth - Fri Jun 29, 2007 6:02 pm</h4>
    <div class="postbody"><span class="postbody">Okay, just looking for a smaller video that causes a problem...
<br/>
<br/>
The one I just tried is an mp4 file, with Mpeg-4 AAC Audio, 2 channels, 48000 Hz. It worked out right, though!
<br/>
<br/>
The two others that have gone wrong have been:
<br/>
- MPEG-1 layer 3, 2 channels, 96 kbps, 32000 Hz
<br/>
- MPEG-1 layer 3, 2 channels, 104 kbps, 48000 Hz<br/>_________________<br/>Thanks!
<br/>
<span style="font-size: 9px; line-height: normal">MKDS Friend Code: 511165-679586
<br/>
MP:H Friend Code: 2105 2377 6896</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138107 - techforumz - Sun Aug 19, 2007 10:28 pm</h4>
    <div class="postbody"><span class="postbody">My  movie file has about 170,000 frames while only a 16-bit frame counter exists in the header. Any way to get around this without splitting the file?
<br/>
Also the audio is scrambled. Not noise but its skipping and distorted. I played the file in VLC and it works fine.
<br/>
<br/>
Edit: Juhees code won't compile on my box and I don't know how to fix or make c++ code. It has the following errors:
<br/>
headermaker.cpp: In function ?int main(int, char**)?:
<br/>
headermaker.cpp:29: error: ?atoi? was not declared in this scope</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138172 - oofrab - Mon Aug 20, 2007 6:49 pm</h4>
    <div class="postbody"><span class="postbody">The number of frames is a 32-bit number (see <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=7897&amp;start=48" target="_blank">header</a>). No problem there.
<br/>
<br/>
About the audio being scrambled, I have no clue. Some have had trouble with this, as you can read above, but no conclusions can be drawn with the available information.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Edit: Juhees code won't compile on my box and I don't know how to fix or make c++ code. It has the following errors:
<br/>
headermaker.cpp: In function ?int main(int, char**)?:
<br/>
headermaker.cpp:29: error: ?atoi? was not declared in this scope</td> </tr></table><span class="postbody">
<br/>
<br/>
It is actually plain C code and you need to include the stdlib header to get the atoi function:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;stdlib.h&gt;
<br/>
</td> </tr></table><span class="postbody">
<br/>
(in C++ the library is cstdlib instead of stdlib.h)
<br/>
<br/>
Also you may want to take a look at theli's python script, dpgconv: <a class="postlink" href="http://theli.ho.com.ua/dpgconv" target="_blank">http://theli.ho.com.ua/dpgconv</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138456 - Thanatos-Drive - Fri Aug 24, 2007 9:08 am</h4>
    <div class="postbody"><span class="postbody">Are people still working on these problems? I'm on Ubuntu Feisty, I could help test. I don't know much about mencoder/ffmpeg/dpg files though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138638 - techforumz - Mon Aug 27, 2007 3:39 am</h4>
    <div class="postbody"><span class="postbody">thanks oofrab I will try that. One last question, is there any tool that will automatically convert decimal numbers to hexadecimal numbers?
<br/>
<br/>
Thanatos-Drive, I'm on feisty too and I'll let you know what works for me.
<br/>
<br/>
Edit: Oh, I tried the python script but I can't compile python, dont know how and cant find the right tools, I will stick with the C version or the manual version for now.
<br/>
<br/>
Edit: tried the header code. Compiled fine. Won't run though.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
headermaker.out: 1: Syntax error: "(" unexpected
<br/>
</td> </tr></table><span class="postbody">
<br/>
I used:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gcc headermaker.c</td> </tr></table><span class="postbody">[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138643 - Mr. Picklesworth - Mon Aug 27, 2007 5:00 am</h4>
    <div class="postbody"><span class="postbody">Techforumz, Python does not need compiling. It is an interpreted language. (Though just-in-time compiling does happen in some experimental interpreters, but that's another story).
<br/>
<br/>
Just run the script with "python myscript.py" in the terminal to execute the Python interpreter with the script.<br/>_________________<br/>Thanks!
<br/>
<span style="font-size: 9px; line-height: normal">MKDS Friend Code: 511165-679586
<br/>
MP:H Friend Code: 2105 2377 6896</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138698 - techforumz - Tue Aug 28, 2007 12:48 am</h4>
    <div class="postbody"><span class="postbody">I tried the python script with 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">python dpgconv 0.4.py foo.ogm out.dpg</td> </tr></table><span class="postbody">
<br/>
Works fine.
<br/>
Thanatos-Drive, try this it may work for you.
<br/>
Edit: Will transcode but starts acting up at header.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138755 - theli - Tue Aug 28, 2007 7:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>techforumz wrote:</b></span></td> </tr> <tr> <td class="quote">I tried the python script with 
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">python dpgconv.py foo.ogm out.dpg</td> </tr></table><span class="postbody">
<br/>
Works fine.
<br/>
Thanatos-Drive, try this it may work for you.
<br/>
Edit: Will transcode but starts acting up at header.</span></td> </tr></table><span class="postbody">
<br/>
?
<br/>
<br/>
by the way ... ( i think i should really change help of dpgconv ...)
<br/>
you shouldn't run 
<br/>
python dpgconv.py foo.ogm out.dpg
<br/>
<br/>
but just
<br/>
<br/>
python dpgconv.py foo.ogm 
<br/>
<br/>
or 
<br/>
<br/>
python dpgconv.py file1 file2 file3 file4 file5 ... fileN
<br/>
<br/>
you shouldn't specify output filename</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138794 - techforumz - Wed Aug 29, 2007 4:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>techforumz wrote:</b></span></td> </tr> <tr> <td class="quote">I tried the python script with 
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">python dpgconv.py foo.ogm out.dpg</td> </tr></table><span class="postbody">
<br/>
Works fine.
<br/>
Thanatos-Drive, try this it may work for you.
<br/>
Edit: Will transcode but starts acting up at header.</span></td> </tr></table><span class="postbody">
<br/>
?
<br/>
<br/>
by the way ... ( i think i should really change help of dpgconv ...)
<br/>
you shouldn't run 
<br/>
python dpgconv.py foo.ogm out.dpg
<br/>
<br/>
but just
<br/>
<br/>
python dpgconv.py foo.ogm 
<br/>
<br/>
or 
<br/>
<br/>
python dpgconv.py file1 file2 file3 file4 file5 ... fileN
<br/>
<br/>
you shouldn't specify output filename</span></td> </tr></table><span class="postbody">
<br/>
tried that too:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Traceback (most recent call last):
<br/>
  File "dpgconv-0.4.py", line 321, in &lt;module&gt;
<br/>
    conv_file(file)
<br/>
  File "dpgconv-0.4.py", line 273, in conv_file
<br/>
    frames = mpeg_stat()
<br/>
  File "dpgconv-0.4.py", line 253, in mpeg_stat
<br/>
    frames = m.group(1)
<br/>
AttributeError: 'NoneType' object has no attribute 'group'</td> </tr></table><span class="postbody">
<br/>
Edit: I installed python2.4 to see if that helped.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138795 - theli - Wed Aug 29, 2007 5:05 am</h4>
    <div class="postbody"><span class="postbody">it seems  it can't find mpeg_stat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138801 - RoxBahamut - Wed Aug 29, 2007 7:17 am</h4>
    <div class="postbody"><span class="postbody">I am new to this, and I am wondering if someone could post a link for mpeg_stat, as I cant find it any where.
<br/>
<br/>
Or if possible, could someone write a python script with a basic gui, for feisty, that could do batches of files.
<br/>
<br/>
If thats not possible, what about a port of BatchDPG?
<br/>
<br/>
Please help, I really need this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138838 - theli - Wed Aug 29, 2007 6:00 pm</h4>
    <div class="postbody"><span class="postbody">you can get mpeg_stat at any FreeBSD mirror ... like
<br/>
<a href="ftp://ftp.riken.go.jp/pub/FreeBSD/distfiles/mpeg_stat-2.2b-src.tar.gz" target="_blank">ftp://ftp.riken.go.jp/pub/FreeBSD/distfiles/mpeg_stat-2.2b-src.tar.gz</a>
<br/>
<br/>
and this file can do batches of files
<br/>
<br/>
just run
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">dpgconv file1 file2 file3 ... fileN</td> </tr></table><span class="postbody">
<br/>
i can't see any reason for gui version :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139023 - techforumz - Fri Aug 31, 2007 8:28 pm</h4>
    <div class="postbody"><span class="postbody">mpeg_stat wont compile for me, is there a deb file?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139151 - oofrab - Sun Sep 02, 2007 8:59 pm</h4>
    <div class="postbody"><span class="postbody">If you really, really want a solution without mpeg_stat, here is a patch to dpgconv v0.4. This is going to be slow, very slow, but it will give you a dpg without mpeg_stat. After the two transcoding steps for video and audio, the program will seem to hang, but it is just stepping though the mpeg video stream in search of the start codes to put in the GOP list.
<br/>
<br/>
My python skills are not good and I would gladly take suggestions to optimizing this. One solution would be to write a small C program for the start code search, a little like a bare bones mpeg_stat. 
<br/>
<br/>
Here is the patch, but beware, it has not been tested much:
<br/>
(Add the lines begining with '+' and remove the ones begining with a '-')
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
+# Find start codes in mpeg stream
<br/>
+def findNextStartCode(file):
<br/>
+
<br/>
+       r  = file.read(4)
<br/>
+       sc = struct.unpack('!L',r)[0]
<br/>
+
<br/>
+        while True:
<br/>
+               if (sc &gt;= 0x00000100) and (sc &lt;= 0x000001FF):
<br/>
+                       return sc;
<br/>
+               else:
<br/>
+                       new = file.read(1)
<br/>
+                       if len(new) == 0:
<br/>
+                               break
<br/>
+                       r = r[1] + r[2] + r[3] + new
<br/>
+                       sc = struct.unpack('!L',r)[0]
<br/>
+
<br/>
+        return 0
<br/>
+
<br/>
+
<br/>
+# Find number of frames and sequence start codes in mpeg stream
<br/>
+def analyze_mpeg():
<br/>
+
<br/>
+       frameCnt = 0
<br/>
+       mpgFile = open(MPGTMP,'rb');
<br/>
+       gopFile  = open(GOPTMP, 'wb')
<br/>
+
<br/>
+       while True:
<br/>
+               startCode = findNextStartCode(mpgFile)
<br/>
+               offset    = mpgFile.tell() - 4
<br/>
+
<br/>
+               if startCode == 0:
<br/>
+                       break
<br/>
+               elif startCode == 0x00000100: # Picture start code
<br/>
+                       frameCnt += 1
<br/>
+               elif startCode == 0x000001B3: # Sequence header code
<br/>
+                       if options.dpg == 2 :
<br/>
+                               gopFile.write (struct.pack ( "&lt;l" , frameCnt ))
<br/>
+                               gopFile.write (struct.pack ( "&lt;l" , offset   ))
<br/>
+
<br/>
+       gopFile.close()
<br/>
+       mpgFile.close()
<br/>
+       return frameCnt
<br/>
+
<br/>
 
<br/>
 def conv_file(file):
<br/>
        print "Converting " + file
<br/>
        conv_vid (file)
<br/>
        conv_aud(file)
<br/>
-       frames = mpeg_stat()
<br/>
+       frames = analyze_mpeg()
<br/>
        write_header(frames)
<br/>
        dpgname = os.path.basename ( os.path.splitext ( file )[0] ) + ".dpg"
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139877 - techforumz - Tue Sep 11, 2007 3:43 am</h4>
    <div class="postbody"><span class="postbody">I can handle the encoding that's easy linux CLI. I just need something that will generate a header for me. Why won't the header code work anyways? What am I not doing?
<br/>
Edit: I created a debian package from the source-code for those who don't know how to compile C code.
<br/>
<a class="postlink" href="http://www.freewebs.com/techforumz/mpeg%2Dstat%5F1%2D1%5Fall.deb" target="_blank">http://www.freewebs.com/techforumz/mpeg%2Dstat%5F1%2D1%5Fall.deb</a>
<br/>
Edit: I tried installing mpeg_stat (and it worked) <span style="font-style: italic">and</span> I tried v0.3 which gave a similar error:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Traceback (most recent call last):
<br/>
  File "dpgconv-0.3.py", line 220, in &lt;module&gt;
<br/>
    conv_file(file)
<br/>
  File "dpgconv-0.3.py", line 182, in conv_file
<br/>
    frames = conv_vid (file)
<br/>
  File "dpgconv-0.3.py", line 116, in conv_vid
<br/>
    origframes = int(m.group(1))
<br/>
AttributeError: 'NoneType' object has no attribute 'group'
<br/>
</td> </tr></table><span class="postbody">[/i]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139888 - theli - Tue Sep 11, 2007 6:14 am</h4>
    <div class="postbody"><span class="postbody">soo... it worked with 0.4+mpeg_stat and is not working with 0.3 for you?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139949 - techforumz - Tue Sep 11, 2007 11:53 pm</h4>
    <div class="postbody"><span class="postbody">no it doesn't work in 0.4 or 0.3 (or 0.2/0.1 for that matter). I installed the debian that I posted, but it still won't recognize mpeg_stat. I tried a non-mpeg_stat version and that doesn't work either. About the patch, I'm not sure what to add. You said it was C code but you want me to add and remove stuff. And where do I add and remove that stuff anyways?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140005 - theli - Wed Sep 12, 2007 5:56 pm</h4>
    <div class="postbody"><span class="postbody">open dpgconv-0.4 in some editor and edit this line
<br/>
MPEG_STAT="mpeg_stat"
<br/>
so that it points to your mpeg_stat binary ...
<br/>
something like
<br/>
MPEG_STAT="/usr/local/bin/mpeg_stat"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140012 - theli - Wed Sep 12, 2007 7:18 pm</h4>
    <div class="postbody"><span class="postbody">techforumz, please, try
<br/>
<a href="http://theli.ho.com.ua/dpgconv/dpgconv-0.41.py" target="_blank">http://theli.ho.com.ua/dpgconv/dpgconv-0.41.py</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140038 - nornagon - Wed Sep 12, 2007 11:33 pm</h4>
    <div class="postbody"><span class="postbody">I tried converting a .flv to a .dpg the other day and the end result was a wickedly skewed video -- the sound kept on drifting way behind the video. I'm running Debian unstable and dpgconv-0.4.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140072 - theli - Thu Sep 13, 2007 5:41 am</h4>
    <div class="postbody"><span class="postbody">norangon, try updating mencoder .. or maybe ffmpeg ..i think mencoder uses ffmpeg for decoding flv</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140180 - ninjalj - Fri Sep 14, 2007 2:37 am</h4>
    <div class="postbody"><span class="postbody">Here's a patch which allows encoding files with no audio:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
--- dpgconv-0.41.py   2007-09-13 19:16:44.000000000 +0200
<br/>
+++ dpgconv-0.41_noaudio.py   2007-09-14 02:06:45.000000000 +0200
<br/>
@@ -8,7 +8,7 @@
<br/>
 dpgconv.py file1 file2 file3 ... fileN
<br/>
 command line options:
<br/>
    --dpg
<br/>
-      0,1,2 sets DPG version.. default is DPG2
<br/>
+      0,1,2,3 sets DPG version.. default is DPG2
<br/>
    
<br/>
    --pf
<br/>
       sets pixel format, default is 3
<br/>
@@ -27,6 +27,10 @@
<br/>
       sets video stream bps in kb/s(default: 256)
<br/>
    -a,--abps xxx
<br/>
       sets audio stream bps kb/s (default: 128)
<br/>
+   --noaudio
<br/>
+      create a DPG with no audio
<br/>
+      (this option really encodes a dummy,
<br/>
+      highly compressible file with no audio)
<br/>
    -f,--fps xx
<br/>
       sets video frames per second (default:15)
<br/>
    -z,--hz
<br/>
@@ -79,6 +83,8 @@
<br/>
 MENCODER="mencoder"
<br/>
 MPLAYER="mplayer"
<br/>
 MPEG_STAT="mpeg_stat"
<br/>
+OGGENC="oggenc"
<br/>
+DD="dd"
<br/>
 
<br/>
 
<br/>
 
<br/>
@@ -159,7 +165,7 @@
<br/>
 
<br/>
    print "Transcoding video:   done"
<br/>
 
<br/>
-def conv_aud(file):
<br/>
+def conv_mp2(file):
<br/>
    a_cmd = ( MENCODER + " \"" +file + "\" -v -of rawaudio -oac lavc -ovc copy -lavcopts acodec=mp2:abitrate=" + `options.abps` + " -o " + MP2TMP )
<br/>
    identify = commands.getoutput( MPLAYER + " -frames 0 -vo null -ao null -identify \"" + file + "\" | grep -E \"^ID|VIDEO|AUDIO\"")
<br/>
    p = re.compile ("([0-9]*)( ch)")
<br/>
@@ -191,13 +197,42 @@
<br/>
    print "Transcoding audio:   done"
<br/>
 
<br/>
 
<br/>
+def conv_noaudio(file):
<br/>
+   if options.dpg != 3:
<br/>
+      print "no audio requires DPG3\n"
<br/>
+      cleanup_callback (0,0)
<br/>
+      exit(0)
<br/>
+
<br/>
+   frames = mpeg_stat()
<br/>
+   length = options.hz * 1 * 2 * int(frames)
<br/>
+   a_cmd = ( DD + " if=/dev/zero count=1 bs="+`length`+" | " + OGGENC + " --raw --raw-bits=16 -o " + MP2TMP + " --raw-rate="+`options.hz`+" --raw-chan=1 -q -1 - ")
<br/>
+
<br/>
+   proc = subprocess.Popen(a_cmd,shell=True,stdout=subprocess.PIPE,universal_newlines=True,stderr=subprocess.STDOUT)
<br/>
+
<br/>
+   v_out = ""
<br/>
+   
<br/>
+   p = re.compile ("Encoding \[(.*)\]")
<br/>
+   for line in proc.stdout:
<br/>
+      m = p.search( line )
<br/>
+      if m:
<br/>
+         print "Transcoding audio: " + m.group(1) + "\r" ,
<br/>
+   print "Transcoding audio:   done"
<br/>
+
<br/>
+
<br/>
+def conv_aud(file):
<br/>
+   if options.noaudio:
<br/>
+      return conv_noaudio(file)
<br/>
+   else:
<br/>
+      return conv_mp2(file)
<br/>
+
<br/>
+
<br/>
 def write_header(frames):
<br/>
    print "Creating header"
<br/>
 
<br/>
    audiostart=36
<br/>
    if options.dpg == 1:
<br/>
       audiostart += 4
<br/>
-   elif options.dpg == 2:
<br/>
+   elif options.dpg &gt;= 2:
<br/>
       audiostart += 12
<br/>
    
<br/>
    audiosize = os.stat(MP2TMP)[stat.ST_SIZE]
<br/>
@@ -206,7 +241,11 @@
<br/>
    videoend = videostart + videosize
<br/>
    f=open(HEADERTMP, 'wb')
<br/>
    DPG = "DPG" + `options.dpg`
<br/>
-   headerValues = [ DPG, int(frames), options.fps, 0, options.hz , 0 ,int(audiostart), int(audiosize), int(videostart), int(videosize) ]
<br/>
+   if options.noaudio:
<br/>
+      channels = 3
<br/>
+   else:
<br/>
+      channels = 0
<br/>
+   headerValues = [ DPG, int(frames), options.fps, 0, options.hz , channels ,int(audiostart), int(audiosize), int(videostart), int(videosize) ]
<br/>
    
<br/>
    f.write (struct.pack( "4s" , headerValues[0]))
<br/>
    f.write (struct.pack ( "&lt;l" , headerValues[1]))
<br/>
@@ -221,7 +260,7 @@
<br/>
 
<br/>
    if options.dpg == 0:
<br/>
       f.write (struct.pack ( "&lt;l" , options.pf ))
<br/>
-   if options.dpg == 2:
<br/>
+   if options.dpg &gt;= 2:
<br/>
       gopsize = os.stat(GOPTMP)[stat.ST_SIZE]
<br/>
       f.write (struct.pack ( "&lt;l" , videoend ))
<br/>
       f.write (struct.pack ( "&lt;l" , gopsize))
<br/>
@@ -235,7 +274,7 @@
<br/>
    m = p.search( s_out )
<br/>
    if m:
<br/>
       frames = m.group(1)
<br/>
-      if options.dpg == 2:
<br/>
+      if options.dpg &gt;= 2:
<br/>
          gop=open(GOPTMP, 'wb')
<br/>
          stat=open(STATTMP, 'rb')
<br/>
          frame = 0
<br/>
@@ -270,7 +309,7 @@
<br/>
    
<br/>
    print "Creating " + dpgname
<br/>
    commands.getoutput( "cat \"" + HEADERTMP + "\" \"" + MP2TMP + "\" \"" + MPGTMP + "\" &gt; \"" + dpgname + "\"")
<br/>
-   if options.dpg == 2:
<br/>
+   if options.dpg &gt;= 2:
<br/>
       commands.getoutput( "cat \"" + GOPTMP + "\" &gt;&gt; \"" + dpgname + "\"")
<br/>
    
<br/>
    cleanup_callback (0,0)
<br/>
@@ -285,6 +324,7 @@
<br/>
 parser.add_option("-l","--lq",action="store_true", dest="lq", default=False)
<br/>
 parser.add_option("-v","--vbps", type="int", dest="vbps", default=256)
<br/>
 parser.add_option("-a","--abps", type="int", dest="abps", default=128)
<br/>
+parser.add_option("--noaudio", action="store_true", dest="noaudio")
<br/>
 parser.add_option("--height", type="int", dest="height", default=192)
<br/>
 parser.add_option("--width", type="int", dest="width", default=256)
<br/>
 parser.add_option("-z","--hz", type="int", dest="hz", default=32000)
<br/>
@@ -306,7 +346,7 @@
<br/>
 signal.signal(signal.SIGTERM, cleanup_callback)
<br/>
 
<br/>
 import commands,re,stat,struct,subprocess
<br/>
-if options.dpg &gt; 2:
<br/>
+if options.dpg &gt; 3:
<br/>
    options.dpg = 2
<br/>
 if options.dpg &lt; 0:
<br/>
    options.dpg = 2
<br/>
@@ -336,6 +376,15 @@
<br/>
    print "Error:"
<br/>
    print test
<br/>
    exit (0)
<br/>
+if options.noaudio:
<br/>
+   test = commands.getoutput( OGGENC + " -v" )
<br/>
+   m = re.compile ("OggEnc (.*)").search(test)
<br/>
+   if m:
<br/>
+      print m.group(0)
<br/>
+   else:
<br/>
+      print "Error:"
<br/>
+      print test
<br/>
+      exit (0)
<br/>
 print "It seems we found all programs :)...continuing"
<br/>
 print "______________________________________________"
<br/>
 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
In fact, it creates a dummy ogg with no sound, which compresses quite well.
<br/>
<br/>
I've had mixed results with the video quality depending on the audio sampling rate (I've used either 4000 or 32000 Hz, each of my 3 test videos works well in 4000 Hz XOR 32000 Hz). So if you have trouble, try with -z xxx, where xxx is the sampling rate.
<br/>
<br/>
<br/>
P.S.: DPG, just what the world needed, pr0n for the DS :)
<br/>
<br/>
P.S.S.: Spain's gonna win the Eurobasket.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140218 - theli - Fri Sep 14, 2007 8:00 am</h4>
    <div class="postbody"><span class="postbody">ninjalj, that's nice ... but can you update it so it doesn't use oggenc... because adding another dependacy just for creating dummy audio file :D....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140230 - nornagon - Fri Sep 14, 2007 2:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">norangon, try updating mencoder .. or maybe ffmpeg ..i think mencoder uses ffmpeg for decoding flv</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm getting my mencoder/ffmpeg from <a href="http://www.debian-multimedia.org," target="_blank">http://www.debian-multimedia.org,</a> that's ffmpeg 20070903 and mencoder 1.0-rc1svn20070903. Are those new enough?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140261 - theli - Fri Sep 14, 2007 9:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">I'm getting my mencoder/ffmpeg from <a href="http://www.debian-multimedia.org," target="_blank">http://www.debian-multimedia.org,</a> that's ffmpeg 20070903 and mencoder 1.0-rc1svn20070903. Are those new enough?</td> </tr></table><span class="postbody">
<br/>
i have no idea ... i only suggested :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140266 - oofrab - Fri Sep 14, 2007 9:57 pm</h4>
    <div class="postbody"><span class="postbody">Here is a small patch to fix a somewhat incorrect GOP-list created by dpgconv-0.41.py (and previous versions too).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
--- dpgconv-0.41.py     2007-09-14 22:28:46.000000000 +0200
<br/>
+++ dpgconv-0.41.py.patched     2007-09-14 22:47:16.000000000 +0200
<br/>
@@ -243,9 +243,9 @@
<br/>
                                sline = line.split()
<br/>
                                if sline[0] == "picture" :
<br/>
                                        frame += 1
<br/>
-                               elif sline[0] == "gop":
<br/>
+                               elif sline[0] == "sequence":
<br/>
                                        gop.write (struct.pack ( "&lt;l" , frame ))
<br/>
-                                       gop.write (struct.pack ( "&lt;l" , int(sline[1])/8 - 140 ))
<br/>
+                                       gop.write (struct.pack ( "&lt;l" , int(sline[1])/8 )) # mpeg_stat shows bit offsets
<br/>
                        gop.close()
<br/>
                        stat.close()
<br/>
        else:
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140292 - ninjalj - Sat Sep 15, 2007 1:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">ninjalj, that's nice ... but can you update it so it doesn't use oggenc... because adding another dependacy just for creating dummy audio file :D....</td> </tr></table><span class="postbody">
<br/>
<br/>
The other options are using MP2 (big file, constant bitrate) and avoiding audio at all (moonshell crashes with DPGs with no audio <a href="http://mdxonline.dyndns.org/archives/2007/03/moonshell_1.shtml" target="_blank">http://mdxonline.dyndns.org/archives/2007/03/moonshell_1.shtml</a>)
<br/>
<br/>
In fact, I add another dependency (dd), but I didn't add a test for it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140293 - tepples - Sat Sep 15, 2007 1:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ninjalj wrote:</b></span></td> </tr> <tr> <td class="quote">In fact, I add another dependency (dd), but I didn't add a test for it.</td> </tr></table><span class="postbody">
<br/>
dd(1) is covered by the dependency on an environment implementing POSIX utilities.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140322 - theli - Sat Sep 15, 2007 9:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ninjalj wrote:</b></span></td> </tr> <tr> <td class="quote">The other options are using MP2 (big file, constant bitrate) and avoiding audio at all (moonshell crashes with DPGs with no audio </td> </tr></table><span class="postbody">
<br/>
i mean't why not encode dummy ogg with mencoder :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140388 - ninjalj - Sun Sep 16, 2007 12:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">i mean't why not encode dummy ogg with mencoder :)</td> </tr></table><span class="postbody">
<br/>
<br/>
Uh? My mencoder doesn't  support vorbis output. It supports copy, pcm, mp3lame, faac and lavc (mp2, mp3, ac3, adpcm_ima_wav, sonic).
<br/>
<br/>
Oh! Apparently they added "preliminary vorbis encoder" on 1.0rc1. My mencoder is 1.0pre8. I guess I should update and test that encoder.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140428 - theli - Sun Sep 16, 2007 9:49 am</h4>
    <div class="postbody"><span class="postbody">hm .. and won't encoding a dummy mp3 work?
<br/>
actually ... i don't that's a big deal depending on oggenc .. i think most users already have it installed (or not?)
<br/>
<br/>
btw , oofrab, thanks for patch :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144006 - techforumz - Sun Oct 28, 2007 3:42 am</h4>
    <div class="postbody"><span class="postbody">Yippy! I manually converted my first Full-length Movie into DPG! I couldn't get any converter working so I just used the power of the linux command line. That and some insight on the header code. A better model for the header code is available:
<br/>
<a class="postlink" href="http://www.howforge.com/how-to-convert-avi-to-dpg-in-linux" target="_blank">http://www.howforge.com/how-to-convert-avi-to-dpg-in-linux</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144010 - techforumz - Sun Oct 28, 2007 4:11 am</h4>
    <div class="postbody"><span class="postbody">I wrote my own guide. For practical purposes I added it to my website instead of here. 
<br/>
<a class="postlink" href="http://www.freewebs.com/techforumz/computernewz.htm" target="_blank">http://www.freewebs.com/techforumz/computernewz.htm</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144027 - oofrab - Sun Oct 28, 2007 10:48 am</h4>
    <div class="postbody"><span class="postbody">Those links only cover the old DPG0 format. More recent versions of Moonshell also support DPG1 and DPG2 (and DPG3) file formats.
<br/>
<br/>
For a more complete header description, look at posts earlier in this thread.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157202 - HyperHacker - Tue May 20, 2008 9:25 am</h4>
    <div class="postbody"><span class="postbody">So...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">hyperhacker@Mercury:~/Desktop/junk$ mplayer output.dmp -ao pcm:file=output.wav
<br/>
MPlayer 1.0rc2-4.2.3 (C) 2000-2007 MPlayer Team
<br/>
CPU: AMD Sempron(tm) Processor 2800+ (Family: 15, Model: 28, Stepping: 0)
<br/>
CPUflags:  MMX: 1 MMX2: 1 3DNow: 1 3DNow2: 1 SSE: 1 SSE2: 1
<br/>
Compiled with runtime CPU detection.
<br/>
mplayer: could not connect to socket
<br/>
mplayer: No such file or directory
<br/>
Failed to open LIRC support. You will not be able to use your remote control.
<br/>
<br/>
Playing output.dmp.
<br/>
libavformat file format detected.
<br/>
[mp3 @ 0x8804034]Could not find codec parameters (Audio: mp1, 64 kb/s)
<br/>
LAVF_header: av_find_stream_info() failed
<br/>
<br/>
<br/>
Exiting... (End of file)</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">hyperhacker@Mercury:~/Desktop/junk$ python dpgconv.py smw.mp4
<br/>
Converting smw.mp4
<br/>
Transcoding video:   done
<br/>
Transcoding audio:   done
<br/>
Traceback (most recent call last):
<br/>
  File "dpgconv.py", line 321, in &lt;module&gt;
<br/>
    conv_file(file)
<br/>
  File "dpgconv.py", line 273, in conv_file
<br/>
    frames = mpeg_stat()
<br/>
  File "dpgconv.py", line 253, in mpeg_stat</td> </tr></table><span class="postbody">
<br/>
<br/>
I'd guess the script doesn't work because it depends on mpeg_stat which as I understand no longer exists or something? It's not in the package manager at any rate.
<br/>
<br/>
Also, on this step:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mencoder foo.avi  -o foo.mpg -ovc lavc -lavcopts vcodec=mpeg1video:vbitrate=160000 -nosound -ofps 25 -vf scale=256:192</td> </tr></table><span class="postbody">It says "skipping frame" after every line, but the resulting mpg file plays fine... O_o<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157206 - ninjalj - Tue May 20, 2008 11:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I'd guess the script doesn't work because it depends on mpeg_stat which as I understand no longer exists or something? It's not in the package manager at any rate.
<br/>
</td> </tr></table><span class="postbody">
<br/>
There's a link to mpeg_stat on this thread somewhere.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
Also, on this step:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mencoder foo.avi  -o foo.mpg -ovc lavc -lavcopts vcodec=mpeg1video:vbitrate=160000 -nosound -ofps 25 -vf scale=256:192</td> </tr></table><span class="postbody">It says "skipping frame" after every line, but the resulting mpg file plays fine... O_o
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
I think that's because mencoder detects duplicated frames or something like that, sth about pulldown/telecine ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160953 - Cartman! - Thu Jul 24, 2008 9:46 pm</h4>
    <div class="postbody"><span class="postbody">Hi people, my first post here :)
<br/>
<br/>
I am busy with the dpgconv script and it works like a charm. But i do get problems with short movies and i dont know why... i am converting some flv movies to dpg and the ones that are a few MB are working fine but i tried some short movies (&gt;30sec) which result in movies under 1MB. And when I try to play them... moonshell just hangs. Next boot it looks for that movie again, and hangs. I have to remove the file from the SD card and then moonshell will work again. Is this a common problem, or is there any way i can fix it? The file itself is allright, it works when i try to watch it with a dpg player on windows. It drives me nuts... anyone knows what is wrong?
<br/>
<br/>
btw, i tried an R4DS and Cyclo DS Evo with 1.41 menu, i dont think any other card will have a good result on it (i am not going to try all my other cards since they use mostly the same version of moonshell).
<br/>
<br/>
update:
<br/>
i just figured it out :) the video not working is an .flv without audio in it. So..i will need to make a fix for it, think i saw it in this topic already so i'll have to edit the python script for it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162108 - D_S - Mon Aug 25, 2008 11:37 pm</h4>
    <div class="postbody"><span class="postbody">Hey all,
<br/>
<br/>
I've been trying to create a small script to convert video files to dpg on my mac. I realise that the python script above can be run on my mac, but i'm keen to try and sort my own solution out.
<br/>
<br/>
Anyway I'm having real problems even doing the conversion manually at the moment. I can create the header (dpg0 for the time being), the audio file (mp2) and the video file (m1v) using a combination of mencoder and ffmpegx and a hex editor, and cat them all together to a dpg file. When I try and run this on my DS however, it plays, but really jerky, as in pauses every second or so, even though the quality of the video itself seems pretty good.
<br/>
<br/>
My first thought was that there was a problem with my header, but I'm pretty sure it fits the DPG0 specification. Tried all sorts of ways of creating the video but this doesn't help. Also I know the mp2 file works fine because I transfered one to the DS and it plays fine. The video files also play fine when I play them through VLC.
<br/>
<br/>
Does anyone have any suggestions as to what's causing the video to skip? Sorry if I left out any important information.
<br/>
<br/>
Thanks
<br/>
<br/>
D_S
<br/>
<br/>
edit: after weeks of trying, i finally managed to get a working dpg about an hour or so after making this post, trying now to figure out what setting changes made the difference
<br/>
<br/>
thanks anyway
<br/>
<br/>
D_S</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163668 - NorQue - Wed Oct 08, 2008 1:05 pm</h4>
    <div class="postbody"><span class="postbody">Does anyone else have sync issues with dpgconv encoded DPGs? Because I'm really wondering now, I've encoded several files to DPGs with different framerate, bitrate and quality settings and it always loses sync after a while and I have no idea why.
<br/>
<br/>
Here's some info from one of the original videos:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ID_DEMUXER=avi
<br/>
ID_VIDEO_FORMAT=XVID
<br/>
ID_VIDEO_BITRATE=851312
<br/>
ID_VIDEO_WIDTH=640
<br/>
ID_VIDEO_HEIGHT=352
<br/>
ID_VIDEO_FPS=25.000
<br/>
ID_VIDEO_ASPECT=0.0000
<br/>
ID_AUDIO_FORMAT=85
<br/>
ID_AUDIO_BITRATE=127336
<br/>
ID_AUDIO_RATE=0
<br/>
ID_AUDIO_NCH=0
<br/>
ID_LENGTH=2946.04</td> </tr></table><span class="postbody">
<br/>
I assume the videos audio might be in variable bitrate MP3, I remember that generated some problems back in the days when I used TMPGEnc to encode to MPEG1... might that be part of the problem?
<br/>
<br/>
And, on a sidenote, I've added 2-pass encoding support to dpgenc, will post the patch here once I got a not out-of-sync video. I assume that doesn't have anything to do with my problem though, as video and audio isn't in synch with --lq and --hq settings, either.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163677 - ninjalj - Wed Oct 08, 2008 5:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NorQue wrote:</b></span></td> </tr> <tr> <td class="quote">Does anyone else have sync issues with dpgconv encoded DPGs?</td> </tr></table><span class="postbody">
<br/>
<br/>
Happens also to me. Not on all DPGs, tough. Normally after ~15 mins, I think mostly on high motion videos. Probably it's moonshell being unable to cope with the video realtime and losing sync.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163680 - NorQue - Wed Oct 08, 2008 6:42 pm</h4>
    <div class="postbody"><span class="postbody">I don't think Moonshell is the bottleneck, especially not at 256/128 constant bitrate - back when I encoded with BatchDPG I remember Moonshell decoding variable average bitrates of up to 300 kBit/s with maximum bitrate set to 450 at 25 FPS in a 256*144 Video without problem. I assume something else is causing these sync problems.
<br/>
<br/>
I've just set up an experiment involving encoding audio differently. I'll report back how it went...
<br/>
<br/>
[EDIT]
<br/>
K, my little theory that involved variable bitrate audio being the culprit turned out to be wrong. Decoding to WAV and reencoding to MP2 manually didn't help at all. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163952 - theli - Thu Oct 16, 2008 4:04 pm</h4>
    <div class="postbody"><span class="postbody">about ot-of-sync-question
<br/>
ninjalj, NorQue
<br/>
could this be the same issue? :
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?p=119617#119617" target="_blank">http://forum.gbadev.org/viewtopic.php?p=119617#119617</a>
<br/>
<br/>
cause i just had the same issue myself ... and that was not the same issue as when input file had lower fps than dpgconv's default 15 ... i've tried to encode an rm file (mplayer reported 30fps) without harddup filter - i had an out-f-sync issue ... i've reencoded the same file with harddup filter - issue gone :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163961 - theli - Thu Oct 16, 2008 7:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NorQue wrote:</b></span></td> </tr> <tr> <td class="quote">And, on a sidenote, I've added 2-pass encoding support to dpgenc, will post the patch here once I got a not out-of-sync video. I assume that doesn't have anything to do with my problem though, as video and audio isn't in synch with --lq and --hq settings, either.</td> </tr></table><span class="postbody">
<br/>
as i read/understand multi-pass encoding doesn't make any sense with cbr video... don't we get cbr here?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163962 - NorQue - Thu Oct 16, 2008 7:39 pm</h4>
    <div class="postbody"><span class="postbody">No, unfortunately it's not that problem. :(
<br/>
<br/>
Mencoder does indeed show <span style="font-style: italic">some</span> dupe frames, but with one every odd hundred encoded frames that's nowhere enough to cause the sync issues I get. And the files I want to encode definitely are 25 FPS and I'm also encoding them to 25 FPS.
<br/>
<br/>
I wanted to try if changing the pixel format helps today, but it looks like --pf doesn't work, or does it just not work how I think it does?
<br/>
<br/>
The mencoder command line I get with --hq is
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mencoder  "myvideo.avi" -v -ofps 25 -sws 9 -vf format=rgb18,scale=256:144:::3 -nosound -ovc lavc -lavcopts vcodec=mpeg1video:vstrict=-2:mbd=2:trell:cbp:mv0:cmp=6:subcmp=6:precmp=6:dia=3:predia=3:last_pred=3:vbitrate=256 -o mpgtmp.mpg -of rawvideo</td> </tr></table><span class="postbody">which leads to this mencoder output:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">MEncoder 2:1.0~rc2-0ubuntu13+medibuntu1 (C) 2000-2007 MPlayer Team
<br/>
CPU: Genuine Intel(R) CPU           T2400  @ 1.83GHz (Family: 6, Model: 14, Stepping: 8)
<br/>
CPUflags: Type: 6 MMX: 1 MMX2: 1 3DNow: 0 3DNow2: 0 SSE: 1 SSE2: 1
<br/>
Compiled with runtime CPU detection.
<br/>
Option fmt: unknown format name: 'rgb18'
<br/>
Option vf: Error while parsing format parameter fmt (rgb18)
<br/>
<br/>
Exiting... (error parsing command line)</td> </tr></table><span class="postbody"><span style="font-style: italic">mencoder -vf format=fmt=help</span> also doesn't know this colorspace, setting rgb15 or 16 yields output that is, well, a little bit to long to quote.
<br/>
<br/>
Would providing a sample file be of any help?
<br/>
<br/>
[EDIT]
<br/>
Sorry, hit "Submit" before I saw your second post...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">as i read/understand multi-pass encoding doesn't make any sense with cbr video... don't we get cbr here?</td> </tr></table><span class="postbody">We get CBR with the original mencoder options from your dpgconv, yes... but with changed options and a second pass we get variable bitrates. :D
<br/>
<br/>
Not <span style="font-style: italic">that</span> much difference in picture quality, though. Just a very tiny little bit less artifacting. :(
<br/>
<br/>
[Even moar EDIT]
<br/>
<a class="postlink" href="http://www.ueberbewertet.de/files/dpgconv-0.43_tp.py" target="_blank">Here's</a> what I got so far... but I get sync issues with both, cbr and vbr files.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163963 - theli - Thu Oct 16, 2008 7:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NorQue wrote:</b></span></td> </tr> <tr> <td class="quote">what I got so far... but I get sync issues with both, cbr and vbr files.</td> </tr></table><span class="postbody">
<br/>
please, try this version and tell me if it fixes your sync issues
<br/>
<a href="http://theli.ho.ua/dpgconv/dpgconv-8.py" target="_blank">http://theli.ho.ua/dpgconv/dpgconv-8.py</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163965 - NorQue - Thu Oct 16, 2008 8:04 pm</h4>
    <div class="postbody"><span class="postbody">Nooo waaay, you're kidding me... it works! In sync! So it <span style="font-style: italic">were</span> the dupe frames after all? Damn!
<br/>
<br/>
Thanks! :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163966 - theli - Thu Oct 16, 2008 8:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NorQue wrote:</b></span></td> </tr> <tr> <td class="quote">I wanted to try if changing the pixel format helps today, but it looks like --pf doesn't work, or does it just not work how I think it does?</td> </tr></table><span class="postbody">
<br/>
errm... i really do not remember anything about it :D
<br/>
it seems i blindly took supported in dpg1/2 pixel formats into script not looking into whether mencoder supports them
<br/>
<br/>
i, actually, do not use moonshell/dpgconv .... :)
<br/>
<br/>
though... my mencoder knows at least rgb15,rgb16,rgb24(and do not know about rgb18 and rgb21 :-/ ) formats... and i just tried format=rgb15 and mencoder refused to transcode :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163984 - NorQue - Fri Oct 17, 2008 3:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NorQue wrote:</b></span></td> </tr> <tr> <td class="quote">I wanted to try if changing the pixel format helps today, but it looks like --pf doesn't work, or does it just not work how I think it does?</td> </tr></table><span class="postbody">
<br/>
errm... i really do not remember anything about it :D
<br/>
it seems i blindly took supported in dpg1/2 pixel formats into script not looking into whether mencoder supports them</span></td> </tr></table><span class="postbody">Haha. :P
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">i, actually, do not use moonshell/dpgconv .... :)</td> </tr></table><span class="postbody">You really should, it works pretty good. I love watching an episode of a TV series on my DS before sleeping.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">though... my mencoder knows at least rgb15,rgb16,rgb24(and do not know about rgb18 and rgb21 :-/ ) formats... and i just tried format=rgb15 and mencoder refused to transcode :(</td> </tr></table><span class="postbody">Same here. MPlayer man page says that -format combined with scale filter should actually do colorspace conversion. No idea why that doesn't work either, I already experimented with different sws/scale/spp settings but I'm completely out of ideas currently.
<br/>
<br/>
Anyways, I've now borrowed all the high quality settings for 2-pass encoding from BatchDPG and created a mod of your original script. <a class="postlink" href="http://www.ueberbewertet.de/files/dpgconv-8_tp.py" target="_blank">Here's</a> the download and <a class="postlink" href="http://www.ueberbewertet.de/files/dpgconv-8_tp_diff.txt" target="_blank">here's</a> the diff to your version if you want to integrate the changes (can't put it in code tags, it breaks the layout of the forum :( ).
<br/>
<br/>
So, and now I'm going to find out how BatchDPG manages to encode MP2s with the original DS DAC samplerate of 32768 Hz with twolame... it's incredible how much better that sounds.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164076 - ninjalj - Mon Oct 20, 2008 10:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">about ot-of-sync-question
<br/>
ninjalj, NorQue
<br/>
could this be the same issue? :
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?p=119617#119617" target="_blank">http://forum.gbadev.org/viewtopic.php?p=119617#119617</a>
<br/>
<br/>
cause i just had the same issue myself ... and that was not the same issue as when input file had lower fps than dpgconv's default 15 ... i've tried to encode an rm file (mplayer reported 30fps) without harddup filter - i had an out-f-sync issue ... i've reencoded the same file with harddup filter - issue gone :)</td> </tr></table><span class="postbody">
<br/>
<br/>
It works OK with harddup. Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164094 - theli - Mon Oct 20, 2008 5:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NorQue wrote:</b></span></td> </tr> <tr> <td class="quote"><a class="postlink" href="http://www.ueberbewertet.de/files/dpgconv-8_tp.py" target="_blank">Here's</a> the download and <a class="postlink" href="http://www.ueberbewertet.de/files/dpgconv-8_tp_diff.txt" target="_blank">here's</a> the diff to your version if you want to integrate the changes (can't put it in code tags, it breaks the layout of the forum :( ).</td> </tr></table><span class="postbody">
<br/>
with your patch i get segfault with 
<br/>
[mpeg1video @ 0xa7f49e0]MPEG1/2 does not support 15/1 fps</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164100 - NorQue - Mon Oct 20, 2008 6:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">with your patch i get segfault with 
<br/>
[mpeg1video @ 0xa7f49e0]MPEG1/2 does not support 15/1 fps</td> </tr></table><span class="postbody">
<br/>
I also get that when encoding with such weird framerates. Try it with something closer to the original, 25 FPS for PAL and 24 FPS for NTSCfilm works for me. Or if you insist on that framerate you could leave out vb_strategy=2 for pass 1.
<br/>
<br/>
btw, I found out how BatchDPG does its 32768 Hz samplerate trick. It converts audio to 32768 Hz, pretends the rate is 32kHz straight to twolame, which happily encodes all the samples at the slower speed and tells Moonshell the real samplerate via the DPG header afterwards.
<br/>
<br/>
[EDIT]
<br/>
Maybe I should tell, too, that encoding with true stereo (-m s) instead of joint stereo (-m j) improved audio much more than the samplerate, for my ears. No idea why, since joint stereo should yield much better results... most likely I'm just imagining that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165617 - gspawn - Tue Dec 30, 2008 3:55 am</h4>
    <div class="postbody"><span class="postbody">I'm also getting some minor out of sync issues, and i'm using the latest v8 of dpgconv.
<br/>
<br/>
I originally used 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">$ ./dpgconv-8.py --height 144 filename.avi</td> </tr></table><span class="postbody">
<br/>
<br/>
Which fixed my problem with the 16:9 aspect ratio, but the audio is just slightly ahead of the video, and the video was a little choppy for my tastes, so I tried this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">$ ./dpgconv-8.py --height 144 --fps 24 filename.avi</td> </tr></table><span class="postbody">
<br/>
<br/>
Which made the video run perfect, but now the sound is almost a second out of sync with the video. Is there some setting I can use to fix this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165621 - theli - Tue Dec 30, 2008 10:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gspawn wrote:</b></span></td> </tr> <tr> <td class="quote">[skipped]
<br/>
the audio is just slightly ahead of the 
<br/>
[skipped]
<br/>
but now the sound is almost a second out of sync with the video
<br/>
</td> </tr></table><span class="postbody">
<br/>
that is strange...
<br/>
i've recently used dpgconv to watch some anime episodes and had no sync issues at all ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165623 - gspawn - Tue Dec 30, 2008 10:43 am</h4>
    <div class="postbody"><span class="postbody">What setting did you use?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165631 - ninjalj - Tue Dec 30, 2008 10:41 pm</h4>
    <div class="postbody"><span class="postbody">Have you tried the harddup option mentioned above? If that doen't work, maybe mplayer's -delay option will work. If that also doesn't work, maybe you can do some manual correction adding/cutting from the audio stream with dd.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165632 - gspawn - Wed Dec 31, 2008 12:51 am</h4>
    <div class="postbody"><span class="postbody">No, I haven't tried that. At the risk of sounding totally newbish, how do I use the harddup option with dpgconv? I haven't seen any reference to it in the documentation.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165634 - ninjalj - Wed Dec 31, 2008 2:58 am</h4>
    <div class="postbody"><span class="postbody">My bad. The harddup fix is already applied to 0.8. You could still try the -delay thingie adding it to the options dpgconv passes to mplayer (v_cmd variable).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165635 - gspawn - Wed Dec 31, 2008 6:04 am</h4>
    <div class="postbody"><span class="postbody">Will that work if the audio is ahead of the video?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165637 - theli - Wed Dec 31, 2008 9:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gspawn wrote:</b></span></td> </tr> <tr> <td class="quote">What setting did you use?</td> </tr></table><span class="postbody">
<br/>
default
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gspawn wrote:</b></span></td> </tr> <tr> <td class="quote">Will that work if the audio is ahead of the video?</td> </tr></table><span class="postbody">
<br/>
is original video running without any sync issues?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165641 - gspawn - Wed Dec 31, 2008 6:01 pm</h4>
    <div class="postbody"><span class="postbody">Yes, there are no sync issues in the original video. Here's another interesting thing. These 2 videos Are the only ones that I have this problem with, and it's only really bad in the one. All other videos I've made are perfectly fine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170455 - theli - Sun Sep 27, 2009 10:32 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://theli.is-a-geek.org/files/dpgconv/dpgconv-9.py.bz2" target="_blank">http://theli.is-a-geek.org/files/dpgconv/dpgconv-9.py.bz2</a>
<br/>
--keep-aspect for keeping aspect ratio
<br/>
--volnorm for volume normalization
<br/>
DPG4+preview thumbnail by Guillaume Bedot
<br/>
doublepass encoding by NorQue</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170635 - Hatta - Fri Oct 09, 2009 1:59 am</h4>
    <div class="postbody"><span class="postbody">I am having trouble with dpgconv.  Here is the output:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">hatta@iblis:~/dpgconv$ ./dpgconv-0.43.py test.avi
<br/>
mpeg_stat -- MPEG Analyzer for MPEG I video streams (version 2.2)
<br/>
MPlayer SVN-r29746 (C) 2000-2009 MPlayer Team
<br/>
Error:
<br/>
MPlayer SVN-r29746 (C) 2000-2009 MPlayer Team
<br/>
No file given
<br/>
<br/>
Exiting... (error parsing command line)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
When I try to encode manually with mencoder using the <a class="postlink" href="http://en.wikipedia.org/wiki/NDs-mPeG#Video_Encoding" target="_blank">example</a> on Wikipedia, I get the following error:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">hatta@iblis:~/dpgconv$ mencoder test.avi  -o out.mpg -nosound -ovc lavc -lavcopts vcodec=mpeg1video:vrc_buf_size=327:vrc_maxrate=512:vbitrate=256:vstrict=-1 -ofps 18 -vf scale=256:192 -of mpeg
<br/>
MPlayer SVN-r29746 (C) 2000-2009 MPlayer Team
<br/>
success: format: 0  data: 0x0 - 0xae2c800
<br/>
AVI file format detected.
<br/>
[aviheader] Video stream found, -vid 0
<br/>
[aviheader] Audio stream found, -aid 1
<br/>
VIDEO:  [XVID]  512x384  12bpp  29.970 fps  988.8 kbps (120.7 kbyte/s)
<br/>
[V] filefmt:3  fourcc:0x44495658  size:512x384  fps:29.970  ftime:=0.0334
<br/>
PACKET SIZE: 2048 bytes, deltascr: 245760
<br/>
Opening video filter: [expand osd=1]
<br/>
Expand: -1 x -1, -1 ; -1, osd: 1, aspect: 0.000000, round: 0
<br/>
Opening video filter: [scale w=256 h=192]
<br/>
==========================================================================
<br/>
Opening video decoder: [ffmpeg] FFmpeg's libavcodec codec family
<br/>
Selected video codec: [ffodivx] vfm: ffmpeg (FFmpeg MPEG-4)
<br/>
==========================================================================
<br/>
Limiting audio preload to 0.4s.
<br/>
Increasing audio density to 4.
<br/>
[mpeg4 @ 0x263be90]Invalid and inefficient vfw-avi packed B frames detected
<br/>
Movie-Aspect is 1.33:1 - prescaling to correct movie aspect.
<br/>
[swscaler @ 0x269b840]BICUBIC scaler, from yuv420p to yuv420p using MMX2
<br/>
videocodec: libavcodec (256x192 fourcc=3167706d [mpg1])
<br/>
[mpeg1video @ 0x263b240]MPEG1/2 does not support 18/1 fps
<br/>
Could not open codec.
<br/>
FATAL: Cannot initialize video driver.
<br/>
<br/>
Exiting...
<br/>
hatta@iblis:~/dpgconv$ 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
What am I doing wrong?  The file plays fine in mplayer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170641 - theli - Fri Oct 09, 2009 6:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Hatta wrote:</b></span></td> </tr> <tr> <td class="quote">I am having trouble with dpgconv.  Here is the output:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">hatta@iblis:~/dpgconv$ ./dpgconv-0.43.py test.avi
<br/>
mpeg_stat -- MPEG Analyzer for MPEG I video streams (version 2.2)
<br/>
MPlayer SVN-r29746 (C) 2000-2009 MPlayer Team
<br/>
Error:
<br/>
MPlayer SVN-r29746 (C) 2000-2009 MPlayer Team
<br/>
No file given
<br/>
<br/>
Exiting... (error parsing command line)
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
try to delete the follogwing code from dpgconv (near the end of file) :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">test = commands.getoutput ( MPEG_STAT + " --" )
<br/>
m = re.compile ("mpeg_stat --(.*)").search(test)
<br/>
if m:
<br/>
        print m.group(0)
<br/>
else:
<br/>
        print "Error:"
<br/>
        print test
<br/>
        exit (0)
<br/>
test = commands.getoutput ( MPLAYER )
<br/>
m = re.compile ("^MPlayer.*").search(test)
<br/>
if m:
<br/>
        print m.group(0)
<br/>
else:
<br/>
        print "Error:"
<br/>
        print test
<br/>
        exit (0)
<br/>
test = commands.getoutput ( MENCODER)
<br/>
m = re.compile ("^MEncoder.*").search(test)
<br/>
if m:
<br/>
        print m.group(0)
<br/>
else:
<br/>
        print "Error:"
<br/>
        print test
<br/>
        exit (0)
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171877 - WalterCool! - Wed Dec 30, 2009 11:03 pm</h4>
    <div class="postbody"><span class="postbody">Some method using only ffmpeg??
<br/>
<br/>
I dont wanna use mplayer due licencing issues.
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172443 - xukosky - Sat Feb 06, 2010 12:12 pm</h4>
    <div class="postbody"><span class="postbody">Hi everyone,
<br/>
<br/>
I know I am late, so I wonder if anyone would be still interested on this topic.
<br/>
<br/>
Some months ago, when I was encoding my videos with the great dpgconv, I though it would be great to include some more features. Mainly a GUI. So I started my own project, and here is the result:
<br/>
<br/>
<a href="https://sourceforge.net/projects/dpg4x/" target="_blank">https://sourceforge.net/projects/dpg4x/</a>
<br/>
<br/>
It uses a lot of code from dpgconv, and some of the new code is also based on this topic, I just joined them. Thank you.
<br/>
<br/>
The most important new features are:
<br/>
- GUI based on wxwidgets (looks like gtk).
<br/>
- Can replace mpeg_stat with it's own code, but mpeg_stat is still used if present (as it's faster).
<br/>
- Audio is encoded in a different thread for better performance.
<br/>
- Multilanguage based on gettext.
<br/>
- Replaces the PIL dependency with wxwidgets code.
<br/>
- Fixes the header problems with DPG1, at least in my DS.
<br/>
<br/>
It's only the first version, it works for me, but won't be surprised if it's full of bugs. You can use the tracker to submit them :)
<br/>
<br/>
Best regards.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172578 - theli - Tue Feb 16, 2010 12:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>WalterCool! wrote:</b></span></td> </tr> <tr> <td class="quote">Some method using only ffmpeg??
<br/>
<br/>
I dont wanna use mplayer due licencing issues.
<br/>
<br/>
Thanks.</td> </tr></table><span class="postbody">i wonder why is that ..
<br/>
mplayer relies on ffmpeg for audio/video codecs</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172841 - hramrach - Mon Mar 08, 2010 2:59 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the dpgconv script.
<br/>
<br/>
It makes converting videos so much easier.
<br/>
<br/>
There were some issues with the script on my system but after some patching and getting the mpeg_stat which I could not find in Debian nor Debian Multimedia I can now convert videos nearly automagically.
<br/>
<br/>
Edit:
<br/>
<br/>
I talked with theli on icq and was able to resolve my issue with subtitles. To encode a mkv file which contains subtitles just extract them to a separate file and explicitly specify that file to dpgconv. Check which track to extract with mkvinfo.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mkvextract video.mkv 3:video.mkv.ssa
<br/>
dpgconv video.mkv -s video.mkv.ssa</td> </tr></table><span class="postbody">
<br/>
<br/>
For some reason my mencoder hates subtitles inside mkv files or there is something else I missed.
<br/>
<br/>
Theli says he is no longer converting videos for the DS and no longer works on dpgconv so I post a link to the updated script below.
<br/>
<br/>
I fixed these issues in dpgconv
<br/>
 * My mencoder says it is mplayer which makes dpgconv fail. Added a pattern for that.
<br/>
 * When PIL is not installed the video is encoded and then dpgconv fails while creating the thmbnail. Check for PIL on the start.
<br/>
 * Add a 1px black stripe at the bottom of wedescreen videos to prevent the video from "pouring" over the bottom of screen in Moonshell
<br/>
 * Added an option to expand widescreen videos to make room for subtitles.
<br/>
<br/>
The remaining issue is that with some older mplayer version dpgconv cannot create the thumbnail and fails. As the thumbnail is created from the encoded video it fails after encoding. Fixing this requires more Python skill than I have.
<br/>
<br/>
Here is the updated <a class="postlink" href="http://paste.lisp.org/display/96183/raw" target="_blank">dpgconv-9.1.py</a> and for those who are wondering <a class="postlink" href="http://hpux.connect.org.uk/ftp/hpux/Development/Tools/mpeg_stat-2.2b/mpeg_stat-2.2b-src-11.00.tar.gz" target="_blank">mpeg_stat-2.2b.tar.gz</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
