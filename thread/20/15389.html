<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>TCP/IP Loader - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS Misc > TCP/IP Loader</h2>
<div id="posts">
<div class="post">
    <h4>#154514 - Lazy1 - Thu Apr 17, 2008 4:13 am</h4>
    <div class="postbody"><span class="postbody">What features would you look for in a TCP/IP loader?
<br/>
I have been working on one today and so far it is able to save to "download.nds" in the root of a flash card.
<br/>
<br/>
I'm thinking of expanding it though, maybe GBA binary support and auto booting of downloaded nds applications.
<br/>
The nds binaries can be sent easily using netcat:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
nc -n -q 1 192.168.x.x 2000 &lt; file.nds
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154516 - Sektor - Thu Apr 17, 2008 5:04 am</h4>
    <div class="postbody"><span class="postbody">If the binary is less than 4MB then optionally download into RAM instead of writing to flash.  You would of course need to add auto booting from RAM.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://gtamp.com/DS" target="_blank">GTAMP.com/DS</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154521 - dsl_andy - Thu Apr 17, 2008 8:10 am</h4>
    <div class="postbody"><span class="postbody">the facility to configure your wireless settings (SSID, IP, DNS etc..) so you don't have to load up a game with wifi before you do a transfer ?<br/>_________________<br/>Andy..
<br/>
____________________________________
<br/>
M3DSReal GBAexp NDSLite</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154529 - silent_code - Thu Apr 17, 2008 2:01 pm</h4>
    <div class="postbody"><span class="postbody">and support for single rom burn for older slot2 carts. well, if that's possible.
<br/>
anyway, thanks! ;^D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154540 - Lazy1 - Thu Apr 17, 2008 7:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sektor wrote:</b></span></td> </tr> <tr> <td class="quote">If the binary is less than 4MB then optionally download into RAM instead of writing to flash.  You would of course need to add auto booting from RAM.</td> </tr></table><span class="postbody">
<br/>
<br/>
All the nds booting examples I looked at booted from FAT, is there one that I'm missing?
<br/>
If that is possible maybe it's better to just boot from ram instead of saving the file, thoughts?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dsl_andy wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
the facility to configure your wireless settings (SSID, IP, DNS etc..) so you don't have to load up a game with wifi before you do a transfer ?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It's only meant to be a loader, this will not be added in unfortunately.
<br/>
Isn't there already an application out there to modify wifi settings?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
and support for single rom burn for older slot2 carts. well, if that's possible.
<br/>
anyway, thanks! ;^D
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Maybe, if there is good documentation on how to do it but I do not have one of those carts.
<br/>
GBA Should be able to be saved if you have ram in slot-2.
<br/>
<br/>
I'm thinking of adding zlib support as well to cut down on transfer time.
<br/>
Oddly enough I'm testing newer versions of the loader by using it to download newer versions of itself :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154554 - Fling - Fri Apr 18, 2008 1:00 am</h4>
    <div class="postbody"><span class="postbody">I wrote <a class="postlink" href="http://files.blarg.ca/projects/httpexec_v1.2.tar.bz2" target="_blank">something similar</a> a while back. Downloads a nds program via HTTP, writes it to your card and boots it. I haven't been developing it all since the 1.2 release, as it now does everything I want and makes for much less painful development test cycles for me.
<br/>
<br/>
Anyway, don't know if you'd seen it before, but maybe the source will be of some help to you.
<br/>
<br/>
Looking forward to seeing what you come up with anyway!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154558 - silent_code - Fri Apr 18, 2008 3:32 am</h4>
    <div class="postbody"><span class="postbody">doesn't libfat's default driver support writing to nand (?) carts? that's where i would check first.
<br/>
<br/>
basically, i'm developping on a neoflash slot 2 512Mb + mk4 passme. it's a pain, because i have to burn the cart with another pc, as neoflash team won't bother supporting amd-based PCs (i wrote them many times about this issue, no response, yet). one has to use an intel based system... that's why i was asking. it would be easing development with this kit a big deal. unfortunately, i don't have much money and none to spend on new (slot1) hw. enough whining.
<br/>
<br/>
no matter if you'll support slot2 or not, this is a great idea. also, i'll try to have a look at the other, older project. :^)
<br/>
<br/>
well, after all, i read slot 2 kits are very unpopular these days (there were no slot1s when i got the kit) and very few people develop using them. at least most people trying out my shadow volume demo complained about the incompatibility with slot1 kits due to gbfs.
<br/>
<br/>
would this be possible: load the rom to ram and then use libreset (or at least the functionality it offers) to "soft boot" from the rom in ram? next time you would need to boot another rom, you simply restart the system, booting from cart and then wifi the new rom (that would not require to leave a stup in memory for reentry to the wifi loader after a soft reset.)
<br/>
at least for me, that would be more than enough, even without permanent cart storage of the rom! loading assets from the slot2 would be "impossible" (not worth implementing - i doublt it's easy without special knowledge), but that's a minor problem. that can be still done with "big" builds, wifiing just smal test builds bundeled with all needed data would be sufficient enough and already a better solution than now.
<br/>
<br/>
i hate wasting power by running another pc (which is highly unstable due to old and partially broken hardware, so it's not usable as a primary dev system in the first place!) for just copying stuff. ;^D
<br/>
<br/>
okays, then.
<br/>
<br/>
happy coding!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154578 - Lynx - Fri Apr 18, 2008 2:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">one has to use an intel based system..</td> </tr></table><span class="postbody">
<br/>
<br/>
Hmm.. All of my systems are AMD based and I never had a problem with NeoFlash's crap..  Then again, I haven't touched it since they initially released.<br/>_________________<br/><a class="postlink" href="http://www.ndshb.com" target="_blank">NDS Homebrew Roms &amp; Reviews</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154587 - silent_code - Fri Apr 18, 2008 4:27 pm</h4>
    <div class="postbody"><span class="postbody">&lt;OT&gt;
<br/>
me, too - all software that shipped with the kit - neo max flash writer software, or what ever it is called. works like a charm on intels.
<br/>
i have tested it on different amd (sempron 3200+, turion)/intel (celeron 400, 1000) laptops and desktop computers (athlon 3400+, different p3s and 4s). non of the amd based systems worked, whereas all intels worked well.
<br/>
i can't write the gba cart with usb slim loader 3 on amds. ???
<br/>
my primary system is the turion 64X2.
<br/>
<br/>
what software are you using?
<br/>
&lt;/OT&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154929 - Lazy1 - Wed Apr 23, 2008 12:16 am</h4>
    <div class="postbody"><span class="postbody">I need some input on implementation:
<br/>
Would it be better to write a PC application to send over the application data?
<br/>
<br/>
I've been using netcat for now but I realize that there is no way to verify the incoming data is good.
<br/>
<br/>
One thing that bothers me though is I haven't seen any examples for booting .nds applications from ram.
<br/>
All the ones I saw loaded from disk but I would like that to be optional, except for .gba files which can only be booted from slot-2.
<br/>
<br/>
EDIT:
<br/>
Also, is there a way to increase the transfer rate with dswifi?
<br/>
I get anywhere from 40-70 KB/s which is good but faster would be nice :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154932 - silent_code - Wed Apr 23, 2008 12:42 am</h4>
    <div class="postbody"><span class="postbody">feedback: yes, a pc side server program would be really nice. :^)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154937 - 0xtob - Wed Apr 23, 2008 1:04 am</h4>
    <div class="postbody"><span class="postbody">I would very much like to see a decent wifi loader because most of us are probably still doing the ol' switcheroo to test their code on hardware. In order to be useful for coding, the server side app should be useable from the command line, so we can add a "make wifi" target to the makefile.<br/>_________________<br/><a class="postlink" href="http://blog.dev-scene.com/0xtob" target="_blank">http://blog.dev-scene.com/0xtob</a> | <a class="postlink" href="http://nitrotracker.tobw.net" target="_blank">http://nitrotracker.tobw.net</a> | <a class="postlink" href="http://dsmi.tobw.net" target="_blank">http://dsmi.tobw.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154938 - Lazy1 - Wed Apr 23, 2008 1:15 am</h4>
    <div class="postbody"><span class="postbody">I guess to boot nds files I would need to have code running in vram download  to main ram.
<br/>
Does anyone know how the download play loader works?
<br/>
<br/>
I have code running in vram now thanks to a few modifications to chishm's exec stub linkscripts.
<br/>
Maybe the main application should just copy the vram loader, execute it and do nothing else.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154940 - tepples - Wed Apr 23, 2008 1:18 am</h4>
    <div class="postbody"><span class="postbody">I think that's what DSFTP was <span style="font-style: italic">supposed</span> to be for. The intended use case was that an "exit" command in the program would start an FTP server, and then a program on the PC would copy the new .nds, load it, and run it. But I never really got even the DSFTP demo program to work on my hardware.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154951 - theli - Wed Apr 23, 2008 6:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">I think that's what DSFTP was <span style="font-style: italic">supposed</span> to be for. The intended use case was that an "exit" command in the program would start an FTP server, and then a program on the PC would copy the new .nds, load it, and run it. But I never really got even the DSFTP demo program to work on my hardware.</td> </tr></table><span class="postbody">
<br/>
hm ... i got and that's where i have 'make put' in my makefile :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154990 - Lazy1 - Wed Apr 23, 2008 6:56 pm</h4>
    <div class="postbody"><span class="postbody">Any suggestions on how to go about this?
<br/>
GBATek says download play sends the arm7 and arm9 binaries separately so maybe that's what my loader needs to do.
<br/>
<br/>
The question is how do I download if my application is already running in main ram?
<br/>
What do I do with the arm7?
<br/>
<br/>
I have code running from vram except the irq functions won't link because libnds puts them in itcm and any printf code will only work in an emulator.
<br/>
I really like the idea of a TCP/IP download play client but I'm beginning to fear that this goes way over my head.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155019 - HyperHacker - Wed Apr 23, 2008 11:20 pm</h4>
    <div class="postbody"><span class="postbody">Your code has to contain itself to a small download function in VRAM or (better) at the end of RAM, and let the rest of the binary get overwritten by the download. ARM7 runs out of its own dedicated memory, but many unofficial cartridges such as Action Replay have their ARM7 binary copied there, and the firmware loads them fine, so I'd guess ARM7 is also running from the end of RAM during this time. I'm not sure if WMB is allowed to do this. If you're not using the WMB protocol, then that's no problem, and if this is for developing apps, then you should be fine running from VRAM and just writing your apps to properly set up VRAM for themselves at startup.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155028 - Lazy1 - Thu Apr 24, 2008 1:55 am</h4>
    <div class="postbody"><span class="postbody">So basically:
<br/>
<br/>
1) Copy arm9 stub to vram
<br/>
2) Copy arm7 stub to vram
<br/>
3) Download arm9 binary to ewram
<br/>
4) Download arm7 binary
<br/>
5) ???
<br/>
6) Profit
<br/>
<br/>
Unfortunately newlib does not like running from vram and libnds's interrupt functions will not link with the vram linkscripts.
<br/>
I wonder how dswifi will like running from vram...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155032 - silent_code - Thu Apr 24, 2008 2:20 am</h4>
    <div class="postbody"><span class="postbody">what about the two 16kb shared work memory banks? (03000000h / mirrored at 37F8000h)
<br/>
<br/>
ps: are these even two "banks"? gbatek says that either 0, 16 or 32 kb can be allocated to each processor (obviously 32kb in total), although, i haven't used them yet, so idon't know how to configure them. ;^)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155035 - HyperHacker - Thu Apr 24, 2008 5:41 am</h4>
    <div class="postbody"><span class="postbody">I remember finding the official client would reject binaries that came too close to the end of RAM, so I would guess it has a stub there.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155393 - dantheman - Tue Apr 29, 2008 2:27 am</h4>
    <div class="postbody"><span class="postbody">There is <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=11665" target="_blank">Wifiloader</a> which doesn't write to disk (I use the 1.5 Beta version often), but since it comes in versions for specific homebrew devices, I'm guessing it merely downloads the file to the slot-2 device's RAM and executes from there.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155779 - Lazy1 - Sun May 04, 2008 3:35 am</h4>
    <div class="postbody"><span class="postbody">I haven't given up on this yet, instead of messing around with code in vram I just modified the linkscripts to put everything in the last 512k of ewram and that seems to work so far.
<br/>
<br/>
Still, what do I do when it's time to send the arm7 binary?
<br/>
I cannot just download it to the arm7's work ram since the arm9 cannot access it.
<br/>
I just thought up a horrible idea though, what if:
<br/>
<br/>
1) Download arm7 binary to vram
<br/>
2) Give vram bank to arm7</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155794 - silent_code - Sun May 04, 2008 11:25 am</h4>
    <div class="postbody"><span class="postbody">again: shared ram?
<br/>
you would still need a way to "activate" code execution on the arm7 though. i'm wondering how that could possibly be done... that would need something like a jump to shared ram... (????)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155953 - Lazy1 - Tue May 06, 2008 1:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GBATek wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Shared-RAM
<br/>
Even though Shared WRAM begins at 3000000h, programs are commonly using mirrors at 37F8000h (both ARM9 and ARM7). At the ARM7-side, this allows to use 32K Shared WRAM and 64K ARM7-WRAM as a continous 96K RAM block.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The only thing I can think of is increasing the download size limit and download both binaries to ewram then copy the arm7 binary from there or download to vram and give access to the arm7.
<br/>
<br/>
Can anyone more experienced with this stuff provide some ideas/information?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156001 - HyperHacker - Tue May 06, 2008 5:53 am</h4>
    <div class="postbody"><span class="postbody">What if you do the download on the ARM7, constraining ARM9 to a small loop at the end of RAM? Then you'd have full access to main RAM and ARM7 work RAM.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156013 - Cydrak - Tue May 06, 2008 8:44 am</h4>
    <div class="postbody"><span class="postbody">HH: Yeah, the ARM7 BIOS has this advantage. Since you're not running from BIOS, you can use VRAM, which is what Chism's loader does (just loading from FAT, not over the network).
<br/>
<br/>
If VRAM is too much trouble, one of the "wifiloader"s linked uses another method:
<br/>
1) Download .NDS (to EWRAM or SLOT-2)
<br/>
2) Place a tiny loader "stub" somewhere convenient
<br/>
3) Patch it with any needed arguments
<br/>
4) ARM7 swiSoftReset()s to the stub
<br/>
5) ARM9 swiSoftReset()s to an uncached loop
<br/>
6) Loader stub moves ARM7/ARM9 binaries to the correct place
<br/>
7) ..then rewrites the loop to unstick ARM9
<br/>
<br/>
(4) and (5) need to be well enough synchronized, that the ARM9 doesn't get its code pulled out from under it before it gets to the loop. (Shh. Yes, I am silly, and had this happen.)
<br/>
<br/>
If you have both CPUs in EWRAM, I would be even more careful! I never looked in depth, but it might be possible to deadlock that way. I had a situation where sending the ARM9 into that loop made my reboot hang. I had to ensure the ARM7 (running in IWRAM, and then SLOT-2), was given EWRAM priority via EXMEMCNT beforehand.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
