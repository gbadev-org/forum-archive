<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Compressing ROMs on the card? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS Misc > Compressing ROMs on the card?</h2>
<div id="posts">
<div class="post">
    <h4>#151481 - nczempin - Wed Feb 27, 2008 6:21 pm</h4>
    <div class="postbody"><span class="postbody">Perhaps this has already been done, but it occurred to me that:
<br/>
<br/>
.nds roms take up around 1/3 of the space if compressed with 7-zip. Currently I am storing the .nds files directly.
<br/>
<br/>
Wouldn't it make sense to store them compressed, and decompress them on load?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151489 - Cydrak - Wed Feb 27, 2008 8:03 pm</h4>
    <div class="postbody"><span class="postbody">For *some* homebrew it could be possible (self-extractor sorta thing?), though maybe not as a beginner's project. Note that an *.nds is not just a binary, it can have embedded files, too. So this would NOT work for programs such as mine, which, being too large for RAM, load such data at runtime.
<br/>
<br/>
With what I paid for my 1gb microSD, and the size of most said homebrew, I'd have to ask if it's worth the effort. If you had other intentions, you might take a second look at the rules here.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151499 - Devil_Spawn - Thu Feb 28, 2008 12:22 am</h4>
    <div class="postbody"><span class="postbody">compression takes up precious cpu cycles... 
<br/>
<br/>
also... homebrew is tiny! how can you fill a 1gb card with homebrew?
<br/>
<br/>
(without excessive amounts)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151502 - Cydrak - Thu Feb 28, 2008 1:21 am</h4>
    <div class="postbody"><span class="postbody">For extraction on startup, I doubt cycles would matter. If anything it might load even faster (gzip over wifi really bumps my transfer speed... dunno about card i/o).
<br/>
<br/>
And, that was kinda the point... I can't. :-) *shrug* I could maybe see it if you have zero budget and you're stuck with a 32 or 64mb card...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151505 - tepples - Thu Feb 28, 2008 3:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Devil_Spawn wrote:</b></span></td> </tr> <tr> <td class="quote">also... homebrew is tiny! how can you fill a 1gb card with homebrew?</td> </tr></table><span class="postbody">
<br/>
MoonShell and DSOrganize, for starters. A lot of people toss high-bitrate MP3 files onto their card without recompressing them to low-bitrate Vorbis, which won't sound much worse due to the DS's 10-bit DAC. Does anyone want to see a batch file that I used to convert a folder full of MP3s?
<br/>
<br/>
But compressing the ARM9 segment might come in handy for liblobby games once someone makes WiFiMe2 by cracking one of the commercial games' second-stage WMB loaders.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151526 - nczempin - Thu Feb 28, 2008 11:31 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Devil_Spawn wrote:</b></span></td> </tr> <tr> <td class="quote">compression takes up precious cpu cycles... 
<br/>
<br/>
also... homebrew is tiny! how can you fill a 1gb card with homebrew?
<br/>
<br/>
(without excessive amounts)</td> </tr></table><span class="postbody">
<br/>
<br/>
Umm... who says I was talking about homebrew (is it against the charter to talk about anything else)? While I am here in the forum for homebrew purposes, i cannot help noticing technical solutions to other problems...
<br/>
<br/>
I agree that for most of the homebrew it wouldn't be necessary, and "large" homebrew can always homebrew its individual compression mechanism.
<br/>
<br/>
But using uncompressed roms just presses a button of ...must...make...smaller... in me. Even though starting with 2GB cards, at least for the M3 the process of finding the rom is already pretty unwieldy, with only 4 roms per slow-scrolling page. It leads me to another idea: Would it be feasible to start some kind of open-source unification-of-card-firmware effort? Having to wait for some Chinese to fix their broken firmware when I could do it myself is a little against my hacker genes.
<br/>
<br/>
You'll need some reserved space on the card so you can always uncompress one rom. Or even some more generic LRU-based caching mechanism.
<br/>
<br/>
<br/>
(plus of course the compression can take as many cycles as it wants, it's the decompression we should be worried about ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151527 - nczempin - Thu Feb 28, 2008 11:34 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">For extraction on startup, I doubt cycles would matter. If anything it might load even faster (gzip over wifi really bumps my transfer speed... dunno about card i/o).
<br/>
<br/>
And, that was kinda the point... I can't. :-) *shrug* I could maybe see it if you have zero budget and you're stuck with a 32 or 64mb card...</td> </tr></table><span class="postbody">
<br/>
<br/>
It's more like, one could fit all the available roms on one 16GB card. I know it's silly, you're never going to play them all, but even for just a 1GB card wouldn't it be nice to be able to fit twice the roms on it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151530 - tepples - Thu Feb 28, 2008 1:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nczempin wrote:</b></span></td> </tr> <tr> <td class="quote">Umm... who says I was talking about homebrew (is it against the charter to talk about anything else)?</td> </tr></table><span class="postbody">
<br/>
Yes, it's against the charter to talk about running "backup" copies of commercial games. Please read the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=9484" target="_blank">forum rules</a>. Some people like to <a class="postlink" href="http://en.wikipedia.org/wiki/Wikipedia:Assume_good_faith" target="_blank">assume good faith</a> and jokingly phrase their responses as if they had forgotten that piracy even exists. Talking about demos ripped from DS Download Station has been tolerated, as Nintendo wants those distributed at no charge in a sense anyway.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I agree that for most of the homebrew it wouldn't be necessary, and "large" homebrew can always homebrew its individual compression mechanism.</td> </tr></table><span class="postbody">
<br/>
The trouble with that is that a lot of people with creative ideas for applications don't know enough of the inner workings of the .nds format to make a UPX clone.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But using uncompressed roms just presses a button of ...must...make...smaller... in me.</td> </tr></table><span class="postbody">
<br/>
Someone told me that most of Nintendo's DS Download Station demos are already compressed.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151534 - Devil_Spawn - Thu Feb 28, 2008 5:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Devil_Spawn wrote:</b></span></td> </tr> <tr> <td class="quote">also... homebrew is tiny! how can you fill a 1gb card with homebrew?</td> </tr></table><span class="postbody">
<br/>
MoonShell and DSOrganize, for starters. A lot of people toss high-bitrate MP3 files onto their card without recompressing them to low-bitrate Vorbis, which won't sound much worse due to the DS's 10-bit DAC. Does anyone want to see a batch file that I used to convert a folder full of MP3s?
<br/>
<br/>
But compressing the ARM9 segment might come in handy for liblobby games once someone makes WiFiMe2 by cracking one of the commercial games' second-stage WMB loaders.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
if his card was full of mp3s, why would he want to compress the few mb used up by his homebrew? wouldnt it make more sense to compress the mp3s? ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151545 - HtheB - Thu Feb 28, 2008 7:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Devil_Spawn wrote:</b></span></td> </tr> <tr> <td class="quote">wouldnt it make more sense to compress the mp3s? ;)</td> </tr></table><span class="postbody">MP3's are already compressed :P<br/>_________________<br/>check out my projects:
<br/>
<a class="postlink" href="http://www.HtheB.com" target="_blank">http://www.HtheB.com</a>
<br/>
Donations are welcome ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151546 - tepples - Thu Feb 28, 2008 8:52 pm</h4>
    <div class="postbody"><span class="postbody">There are several issues that could be conflated in this topic:
<br/>
<ol type="a"><li>lossless compression of .gba programs, to be expanded to SLOT-2 RAM </li><li>lossless compression of .nds ARM9 programs, to be expanded to DS internal RAM </li><li>lossless compression of data inside GBFS, NitroFS, or EFS, to be expanded by file system code </li><li>efficient lossy compression of digital signals such as music or video </li></ol>
<br/>
I think nczempin was thinking of b and c, but Devil_Spawn and I started taking it into a separate direction related to d. I'll clarify my position on d in a separate topic, leaving this topic for b and c.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151552 - dantheman - Fri Feb 29, 2008 12:26 am</h4>
    <div class="postbody"><span class="postbody">If DSCompress is any indication, the amount of time needed to uncompress a file on the DS itself would outweigh any benefits gained from the compression in the first place.  Plus you would have to recompress it afterwards in order to gain back enough space to extract a second file.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151567 - nczempin - Fri Feb 29, 2008 10:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dantheman wrote:</b></span></td> </tr> <tr> <td class="quote">If DSCompress is any indication, the amount of time needed to uncompress a file on the DS itself would outweigh any benefits gained from the compression in the first place.</td> </tr></table><span class="postbody">
<br/>
<br/>
I guess I may be spoilt by MIPS, but a max-compression 7-zip of a 64 MB .nds takes about 4 seconds to decompress on my PC. If that means 40 seconds on the DS, then it's obviously not worth it. But perhaps one can get a better size/speed ratio by using a smaller compression ratio. I also don't know how much of that time depends on I/O. I'll have a look at DSCompress.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">  Plus you would have to recompress it afterwards in order to gain back enough space to extract a second file.</td> </tr></table><span class="postbody">
<br/>
<br/>
Not in the scheme I was proposing, where you leave just enough space of n decompressed files (and not remove the compressed files), a kind of cache (the simplest being n==1, where you'd decompress just one file, and when you want to use another one, you can delete the decompressed one (since you still have the compressed one). And by increasing n, you have another ratio you can optimize, depending on how many times the "in use" .nds changes. Eventually, as n approaches infinity (or the maximum number of compressed files on your card), it will start to become very sub-optimal.
<br/>
<br/>
The next step would be to actually use your scheme of really uncompressing in the file system, and not keeping the original compressed file (like in e. g. Windows compressed folders). Eventually as you go towards more uncompressed files, you'll reach the normal state where  everything is uncompressed.
<br/>
<br/>
But it is all for naught if decompressing one file takes too long compared to using it. Yet I still think it very much depends on the usage what any one person will deem to long.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151568 - nczempin - Fri Feb 29, 2008 10:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">There are several issues that could be conflated in this topic:
<br/>
<ol type="a"><li>lossless compression of .gba programs, to be expanded to SLOT-2 RAM </li><li>lossless compression of .nds ARM9 programs, to be expanded to DS internal RAM </li><li>lossless compression of data inside GBFS, NitroFS, or EFS, to be expanded by file system code </li><li>efficient lossy compression of digital signals such as music or video </li></ol>
<br/>
I think nczempin was thinking of b and c, but Devil_Spawn and I started taking it into a separate direction related to d. I'll clarify my position on d in a separate topic, leaving this topic for b and c.</td> </tr></table><span class="postbody">
<br/>
<br/>
I was thinking of b and c, more or less:
<br/>
<br/>
1. select .nds via menu
<br/>
2. is .nds uncompressed? -&gt; done, use.
<br/>
3. uncompress
<br/>
4. [optional] put a copy on the FS (so 2. happens more often), possibly clearing LRU-uncompressed copies
<br/>
5. done, use.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151573 - nanou - Fri Feb 29, 2008 11:44 am</h4>
    <div class="postbody"><span class="postbody">Gah, it's *really* hard to pretend that this topic is about anything other than commercial roms.
<br/>
<br/>
Anyway, to generalize the idea in a useful way, you could forget self-extraction and use a librarian app to manage a collected volume of compressed apps. 
<br/>
<br/>
The idea is that you should be able to pack anything into there, and extract it into a scratch area (if not already present in scratch) and run it from there. This makes most efficient use of the on-disk model, doesn't add extra requirements or overhead(afaict), and can be <span style="font-style: italic">applied usefully to homebrew in general</span>.<br/>_________________<br/>- nanou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151574 - Dwedit - Fri Feb 29, 2008 11:50 am</h4>
    <div class="postbody"><span class="postbody">I've written a ridiculously fast LZ-style decompressor.  The smallest unit used is a 32 bit word.  It either reads raw data from the input, or reads previously appearing data from the output.  It uses memcpy-like code to do the dirty work, so it's just as fast as memcpy.
<br/>
Compression rate isn't that great though.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
