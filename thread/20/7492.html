<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>heres a little demo for doing 3d on both screens! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS Misc > heres a little demo for doing 3d on both screens!</h2>
<div id="posts">
<div class="post">
    <h4>#60759 - ninogenio - Mon Nov 14, 2005 3:21 pm</h4>
    <div class="postbody"><span class="postbody">heres a demo for anyone interested it does a software rendered 3d texture mapped cube on the sub screen(double buffered) and a hardware rendered one on the main screen all at really fast speed.theres a bit of warping on the sub screen cube but thats because its affinely mapped and im currently working on perspective correct mapping.
<br/>
<br/>
<a href="http://dc3.4shared.com/download/466280/a9e873a0/both_screens_3d.html" target="_blank">http://dc3.4shared.com/download/466280/a9e873a0/both_screens_3d.html</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60760 - revo - Mon Nov 14, 2005 4:05 pm</h4>
    <div class="postbody"><span class="postbody">I'll take a look at it later, interesting ;)
<br/>
<br/>
Anyone made demo of hardware 3D on both screens?
<br/>
<br/>
edit:
<br/>
tested, works fine ;)<br/>_________________<br/>[ sorry for all mistakes, but my english isn't as good as I wish it to be ]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60793 - bahnhof - Mon Nov 14, 2005 10:14 pm</h4>
    <div class="postbody"><span class="postbody">Gah.. Misleading title</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60859 - lambi1982 - Tue Nov 15, 2005 1:56 pm</h4>
    <div class="postbody"><span class="postbody">Good job :)
<br/>
<br/>
Looks great.
<br/>
<br/>
Is something like this possible ( to be ported) to the DS
<br/>
<br/>
used on the touch screen ????
<br/>
<a class="postlink" href="http://download.nvidia.com/downloads/nZone/demos/nvidia/Bubble.zip" target="_blank">http://download.nvidia.com/downloads/nZone/demos/nvidia/Bubble.zip</a><br/>_________________<br/>Who, Me?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60880 - SevenString - Tue Nov 15, 2005 8:46 pm</h4>
    <div class="postbody"><span class="postbody">One could do 2 passes on a double-buffered 3D screen:
<br/>
<br/>
1) Do a HW render pass to the backbuffer
<br/>
2) Blit that back buffer to the 2D screen
<br/>
3) Clear the backbuffer and HW render a second pass with different content
<br/>
4) buffer swap
<br/>
<br/>
voila!  3D on two screens.
<br/>
<br/>
My current engine does 3D on one screen and 2D on the other, but I think I'll try to do something like this tonight...<br/>_________________<br/><span style="font-style: italic">"Artificial Intelligence is no match for natural stupidity."</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60885 - ecurtz - Tue Nov 15, 2005 9:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SevenString wrote:</b></span></td> </tr> <tr> <td class="quote">One could do 2 passes on a double-buffered 3D screen:
<br/>
<br/>
1) Do a HW render pass to the backbuffer
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Ummm, does anyone know how to do this, and I just missed it? This is required for doing 30 fps double pass 3d with more triangles, which I would like to try.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60886 - dovoto - Tue Nov 15, 2005 9:53 pm</h4>
    <div class="postbody"><span class="postbody">The DS does not have a 3D framebuffer (well it has a single scan line worth of one if you want to get technical)
<br/>
<br/>
What you can do is direct the output of the 3D raster into memory instead of to the LCD controller (vram and possibly main memory) then use that to display to either screen.  This allows you to gitter and blend two frames together or to display alternate frames on alternate displays...
<br/>
<br/>
I do not know how to do this at the moment though, and only believe this is possible from talking to a few people.  Perhaps i will look into it if no one has figured it out by the time finals are over.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60900 - ninogenio - Wed Nov 16, 2005 12:26 am</h4>
    <div class="postbody"><span class="postbody">im really glad this has spurred the some thought about how 3d hardware can be done on both screens it was just ment as a little demo to show how this might be done what i was really impressed by though was the speed of the ds when i used it correctly it a mean pixel pusher indeed.in most surcomestances it keeps on par with my pc when running similar double buffer based demos :)
<br/>
<br/>
cheers for the comments btw.;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60907 - SevenString - Wed Nov 16, 2005 12:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">What you can do is direct the output of the 3D raster into memory instead of to the LCD controller (vram and possibly main memory)</td> </tr></table><span class="postbody">
<br/>
<br/>
Sounds like there is more to it than I was talking about, otherwise everybody would be doing it, eh?
<br/>
<br/>
But maybe if one can direct to vram, then there's a good workaround... if it exists.<br/>_________________<br/><span style="font-style: italic">"Artificial Intelligence is no match for natural stupidity."</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60914 - tepples - Wed Nov 16, 2005 2:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SevenString wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">What you can do is direct the output of the 3D raster into memory</td> </tr></table><span class="postbody">
<br/>
Sounds like there is more to it than I was talking about, otherwise everybody would be doing it, eh?</span></td> </tr></table><span class="postbody">
<br/>
First off, as I've been saying for months, there has to be a commercial game that uses the technique so that we can disassemble it in order to know what address to set as the source for DMA.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60946 - ecurtz - Wed Nov 16, 2005 5:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
First off, as I've been saying for months, there has to be a commercial game that uses the technique so that we can disassemble it in order to know what address to set as the source for DMA.</td> </tr></table><span class="postbody">
<br/>
<br/>
Metroid Prime Demo? Or did it run at 60 fps?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60948 - Lino - Wed Nov 16, 2005 5:51 am</h4>
    <div class="postbody"><span class="postbody">its very ingenious...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60953 - chishm - Wed Nov 16, 2005 6:57 am</h4>
    <div class="postbody"><span class="postbody">Well StoneCypher gave me some info last night on IRC:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>StoneCyqh wrote:</b></span></td> </tr> <tr> <td class="quote">capture register is 0x04000064
<br/>
ram blend EVA is bits 0..4
<br/>
graphics blend evb is 8..12
<br/>
vram bank select is 16-17
<br/>
write offset is 18-19
<br/>
capture data write size is 20-21
<br/>
capture source is 24-25
<br/>
capture source offset is 26-27
<br/>
29-30 does something but nobody knows what yet
<br/>
31 is enable
<br/>
29-30 seems to have something to do with the blending
<br/>
blending only seems to work when 29-30 is 10 or 11
<br/>
when it's 00 or 01 only one of the two sources shows
<br/>
i can't get 10 and 11 to do anything different
<br/>
but it doesn't shut down on 11, where most things with a prohibited mode do, so it's probably two distinct things, i just don't know what</td> </tr></table><span class="postbody">
<br/>
Apparently the info was on one of <a class="postlink" href="http://patatersoft.info/links.html" target="_blank">Patater's links</a>.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60957 - bluescrn - Wed Nov 16, 2005 9:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Well StoneCypher gave me some info last night on IRC:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>StoneCyqh wrote:</b></span></td> </tr> <tr> <td class="quote">capture register is 0x04000064
<br/>
ram blend EVA is bits 0..4
<br/>
graphics blend evb is 8..12
<br/>
vram bank select is 16-17
<br/>
write offset is 18-19
<br/>
capture data write size is 20-21
<br/>
capture source is 24-25
<br/>
capture source offset is 26-27
<br/>
29-30 does something but nobody knows what yet
<br/>
31 is enable
<br/>
29-30 seems to have something to do with the blending
<br/>
blending only seems to work when 29-30 is 10 or 11
<br/>
when it's 00 or 01 only one of the two sources shows
<br/>
i can't get 10 and 11 to do anything different
<br/>
but it doesn't shut down on 11, where most things with a prohibited mode do, so it's probably two distinct things, i just don't know what</td> </tr></table><span class="postbody">
<br/>
Apparently the info was on one of <a class="postlink" href="http://patatersoft.info/links.html" target="_blank">Patater's links</a>.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
hmmm... blending to ram?...  sounds interesting...  have we got a way to implement full-screen blur/glow effects?...  :)
<br/>
<br/>
Although I'd be more interested in knowing how to do standard alpha blending on 3D polys... that seems to be another of the few remaining mysteries of DS homebrew...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60966 - Lino - Wed Nov 16, 2005 10:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Apparently the info was on one of <a class="postlink" href="http://patatersoft.info/links.html" target="_blank">Patater's links</a>.</td> </tr></table><span class="postbody">
<br/>
<br/>
What link?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60973 - chishm - Wed Nov 16, 2005 11:16 am</h4>
    <div class="postbody"><span class="postbody">I don't know, I couldn't be bothered going through them all :). I just passed on the info I was given.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61014 - dovoto - Wed Nov 16, 2005 7:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bluescrn wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Although I'd be more interested in knowing how to do standard alpha blending on 3D polys... that seems to be another of the few remaining mysteries of DS homebrew...</td> </tr></table><span class="postbody">
<br/>
<br/>
Alpha blending works fine.  Although there are two issues remaining: One is I need to move control of alpha to the material property setters (right now it is done via glPolyFormat());  The second is the 3D hardware appears to suffer from the same alpha blending limitations that plague 2D. It does not blend more than one polygon against one other non-blended polygon.  In short, you can not blend a poly against another blended poly (so a completely translucent cube would not work).
<br/>
<br/>
There is an alpha blending example in the nehe section of the libnds examples (lesson 8 maybe) <a class="postlink" href="http://sourceforge.net/project/showfiles.php?group_id=114505&amp;package_id=159894" target="_blank">http://sourceforge.net/project/showfiles.php?group_id=114505&amp;package_id=159894</a> .  It should demonstrate both how to do it as well as how limited it is compared to the normal gl polygon blending (just try making more than one side of the cube translucent).  Lesson 9 gives a much more blatant demonstration of the limitations as that demo could barely be considered functional.  To compare to the actual nehe demos run these: <a class="postlink" href="http://nehe.gamedev.net" target="_blank">http://nehe.gamedev.net</a> lessons 8 and 9.
<br/>
<br/>
It is possible I have missed some blending settings that will make these limitations magically disappear but I have yet been able to locate anything of the sort<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61019 - dovoto - Wed Nov 16, 2005 7:55 pm</h4>
    <div class="postbody"><span class="postbody">It only took a couple of minutes but someone has pointed out a solution.  I will test this out when i get home.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61122 - bluescrn - Thu Nov 17, 2005 2:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Alpha blending works fine.  Although there are two issues remaining: One is I need to move control of alpha to the material property setters (right now it is done via glPolyFormat());  
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Cool... might have to give that another look...   It's a few months since I had a play with 3D stuff on the DS, and my current project is very much 2D. But as that's on hold waiting for wi-fi, I might have another go at something 3D :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The second is the 3D hardware appears to suffer from the same alpha blending limitations that plague 2D. It does not blend more than one polygon against one other non-blended polygon.  In short, you can not blend a poly against another blended poly (so a completely translucent cube would not work).
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's strange... as it looks like both in Mario64 and definitely in Nanostray, there's overlapping blended polys that seem to work (I suppose they could potentially be doing it in software, but it seems a bit unlikely?)
<br/>
<br/>
Maybe it's something to do with those poly IDs, like the outlining?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61162 - dovoto - Thu Nov 17, 2005 7:27 pm</h4>
    <div class="postbody"><span class="postbody">Yes it has to do with poly IDs. I was told that they will blend as long as they dont have the same poly ID.  I have not tried this yet though.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61250 - M3d10n - Fri Nov 18, 2005 1:41 pm</h4>
    <div class="postbody"><span class="postbody">Ah, so this (polygon IDs) might be the problem the guy from Castlevania (sorry, I had bad memory for names) was referring to in an interview.
<br/>
<br/>
He said something about transparencies being a bit harder to do in the DS than in the PSOne. They had to find ways to assign different IDs to each transparent poly so they could blend against each other properly, otherwise the motion trail left by the main character and Alucard, as example, would've sucked hard.
<br/>
<br/>
And it was probably by abusing this that they made that room with the invisible maze, where you can only see the maze walls when a ghost is over them.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61356 - The 9th Sage - Sat Nov 19, 2005 4:49 am</h4>
    <div class="postbody"><span class="postbody">Hm...someone was asking about games that do 3D on two screens...I think Feel the Magic and Mario (in some of the minigames) do it, I know for a fact that Viewtiful Joe does it (and quite handily I might add).<br/>_________________<br/>Now with 20% More Old Man from Zelda 1 than ever before!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61412 - M3d10n - Sat Nov 19, 2005 9:32 pm</h4>
    <div class="postbody"><span class="postbody">Mario Kart does it too. I haven't got the game yet, but in the vids I saw, you get a 2-screen view of the camera showing the track (probably at halved framerate - in the videos all over the net you can't tell if it's 30fps or 60fps, since the videos themselves are in 30fps, somethings less).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61426 - ecurtz - Sun Nov 20, 2005 1:12 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="ftp://ftp.nuprometheus.com/pub/Display_Capture.zip" target="_blank">Work in progress</a>
<br/>
<br/>
Here's some code for playing around with dual screen 3D. It doesn't really work yet, but it's close. If anybody gets it finished, please let me know. I'll keep playing around with it as well.
<br/>
<br/>
[edit] Better version up in the same spot. Are there any other VRAM banks that can be used for Sub Background besides C? I think it would work at that point, at the expense of using up a ton of our video RAM. [/edit]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61637 - ecurtz - Tue Nov 22, 2005 6:38 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="ftp://ftp.nuprometheus.com/pub/Display_Capture.zip" target="_blank">Dual 3D</a>
<br/>
<br/>
OK, at the cost of 2 banks of VRAM, here's an example with dual hardware 3D.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61640 - gladius - Tue Nov 22, 2005 7:19 am</h4>
    <div class="postbody"><span class="postbody">Cool!  Nice job ecurtz.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61737 - revo - Tue Nov 22, 2005 11:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ecurtz wrote:</b></span></td> </tr> <tr> <td class="quote"><a class="postlink" href="ftp://ftp.nuprometheus.com/pub/Display_Capture.zip" target="_blank">Dual 3D</a>
<br/>
<br/>
OK, at the cost of 2 banks of VRAM, here's an example with dual hardware 3D.</td> </tr></table><span class="postbody">
<br/>
<br/>
thx! great job :) I have tried before, but without results... But now with working capture, it should be possible to make motion blur demo, or making some screenshots from apps :)<br/>_________________<br/>[ sorry for all mistakes, but my english isn't as good as I wish it to be ]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61741 - lambi1982 - Wed Nov 23, 2005 12:28 am</h4>
    <div class="postbody"><span class="postbody">great job :)<br/>_________________<br/>Who, Me?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61757 - ninogenio - Wed Nov 23, 2005 3:04 am</h4>
    <div class="postbody"><span class="postbody">that absouloty rocks dude!
<br/>
<br/>
im really glad i posted my demo up now as its led to this congrats.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61893 - ecurtz - Thu Nov 24, 2005 5:32 pm</h4>
    <div class="postbody"><span class="postbody">Glad I could get it working, but real thanks go to the person who originally posted the register info.
<br/>
<br/>
Now, has anybody had any luck with two passes on the same screen? It really seems like it should be possible to do with only one VRAM bank, but I haven't managed it yet.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62040 - ninogenio - Sat Nov 26, 2005 7:16 pm</h4>
    <div class="postbody"><span class="postbody">your right its strange that everything has to be rendered to the two screen from the sub 2d core its kind of like the capturing code isnt working quite as it should.ive spent most of 2 day playing with this trying to get it going and for the most part it does ive managed to render from one vram bank but the top display is ever so slightly faded.
<br/>
<br/>
the way i though this would have worked would have been to render to the main screen directly from the 3d core and inbtween frames to screen capture the object you want to display on the sub screen to to blit it to the sub bg.
<br/>
<br/>
any ideas any one!!!!!!!!!!!! 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> 
<br/>
/****************************************
<br/>
 *       Display Capture Test
<br/>
 *       Author: eli
<br/>
 *       (basically just one the DrunkenCoders demos by Dovoto)
<br/>
 ****************************************/
<br/>
 #define REG_CAPTURE (*(vu32*)0x04000064)
<br/>
<br/>
 #include &lt;nds.h&gt;
<br/>
 #include "teapot_bin.h"
<br/>
 #include "cafe_bin.h"
<br/>
<br/>
 void SetRegCapture(bool enable, uint8 srcBlend, uint8 destBlend, uint8 bank, uint8 offset, uint8 size, uint8 source, uint8 srcOffset);
<br/>
 int LoadGLTextures();
<br/>
 int DrawTeapot();
<br/>
 int cafe_texid;
<br/>
 int texture[1];
<br/>
 int teapotX,teapotY;
<br/>
<br/>
 int main()
<br/>
 {   
<br/>
   powerON(POWER_ALL);
<br/>
<br/>
        irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
<br/>
   videoSetMode(MODE_0_3D);
<br/>
    videoSetModeSub(MODE_5_2D | DISPLAY_BG2_ACTIVE | DISPLAY_BG3_ACTIVE);
<br/>
      vramSetBankA(VRAM_A_TEXTURE);
<br/>
      vramSetBankC(VRAM_C_SUB_BG);
<br/>
      
<br/>
      SUB_BG2_CR = BG_BMP16_256x256;
<br/>
      SUB_BG2_XDX = 256;
<br/>
      SUB_BG2_XDY = 0;
<br/>
      SUB_BG2_YDX = 0;
<br/>
      SUB_BG2_YDY = 256;
<br/>
      SUB_BG2_CY = 0;
<br/>
      SUB_BG2_CX = 0;
<br/>
      
<br/>
      SUB_BG3_CR = BG_BMP16_256x256;
<br/>
      SUB_BG3_XDX = 256;
<br/>
      SUB_BG3_XDY = 0;
<br/>
      SUB_BG3_YDX = 0;
<br/>
      SUB_BG3_YDY = 256;
<br/>
      SUB_BG3_CY = 0;
<br/>
      SUB_BG3_CX = 0;
<br/>
<br/>
      glViewPort(0,0,255,191);
<br/>
<br/>
      glClearColor(0,0,0);
<br/>
      glClearDepth(0x7FFF);
<br/>
   
<br/>
      LoadGLTextures();
<br/>
<br/>
      uint32 frameCount = 0;
<br/>
      while (1) 
<br/>
     {
<br/>
         glReset();
<br/>
         scanKeys();
<br/>
<br/>
             if (frameCount &amp; 1)
<br/>
             {  
<br/>
                          vramSetBankC(VRAM_C_LCD);
<br/>
                          SetRegCapture(true, 0, 15, 2, 0, 3, 0, 0);
<br/>
                          DrawTeapot();
<br/>
             }
<br/>
             else
<br/>
             {
<br/>
                          vramSetBankC(VRAM_C_SUB_BG);
<br/>
                          DrawTeapot();
<br/>
                           
<br/>
             }
<br/>
<br/>
             glFlush();
<br/>
             frameCount++;
<br/>
             lcdSwap();
<br/>
             swiWaitForVBlank();
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
 }
<br/>
<br/>
 //------------------------------------------------------------------------------------------
<br/>
 //                                   START OF FUCTIONS
<br/>
 //------------------------------------------------------------------------------------------
<br/>
 int DrawTeapot()
<br/>
 {
<br/>
              gluPerspective(35, 256.0 / 192.0, 0.1, 40);
<br/>
<br/>
              glMatrixMode(GL_TEXTURE);
<br/>
         glIdentity();
<br/>
         vector tex_scale = { 64&lt;&lt;16, -64&lt;&lt;16, 1&lt;&lt;16 };
<br/>
              glScalev( &amp;tex_scale );
<br/>
         glRotateXi(teapotX);      
<br/>
         glRotateYi(teapotX);
<br/>
<br/>
              glMatrixMode(GL_MODELVIEW);
<br/>
         glIdentity();
<br/>
              glTranslate3f32(0, 0, floatof32(-3));
<br/>
         glRotateXi(teapotX);
<br/>
         glRotateYi(teapotY);glColor3f(1,1,1);
<br/>
      
<br/>
         glLight(0, RGB15(31,31,31),0,floatov10(-3.0),0);
<br/>
         glLight(1, RGB15(31,31,31),0,0,floatov10(-3.0));
<br/>
         glLight(2, RGB15(31,31,31),0,0,floatov10(3.0));
<br/>
<br/>
              glMaterialf(GL_AMBIENT, RGB15(16,16,16));
<br/>
         glMaterialf(GL_DIFFUSE, RGB15(16,16,16));
<br/>
         glMaterialf(GL_SPECULAR, BIT(15) | RGB15(8,8,8));
<br/>
         glMaterialf(GL_EMISSION, RGB15(16,16,16));
<br/>
              glMaterialf(GL_EMISSION, RGB15(31,31,31));
<br/>
<br/>
              if(!(keysHeld() &amp; KEY_R))
<br/>
              {
<br/>
               glPolyFmt(POLY_ALPHA(31) | POLY_CULL_BACK  | POLY_FORMAT_LIGHT0| POLY_FORMAT_LIGHT1| POLY_FORMAT_LIGHT2);
<br/>
<br/>
              }
<br/>
        else
<br/>
              {
<br/>
               glPolyFmt(POLY_ALPHA(31) | POLY_CULL_BACK  | POLY_FORMAT_LIGHT0| POLY_FORMAT_LIGHT1| POLY_FORMAT_LIGHT2);
<br/>
<br/>
              }
<br/>
<br/>
              teapotX -= 1;
<br/>
         teapotY += 1;
<br/>
             
<br/>
              glBindTexture( 0, cafe_texid );
<br/>
              glCallList((u32*)teapot_bin);   
<br/>
             
<br/>
         return TRUE;                   
<br/>
 }
<br/>
<br/>
<br/>
 void SetRegCapture(bool enable, uint8 srcBlend, uint8 destBlend, uint8 bank, uint8 offset, uint8 size, uint8 source, uint8 srcOffset)
<br/>
 {
<br/>
                   uint32 value = 0;
<br/>
                   if (enable)
<br/>
                   value |= 1 &lt;&lt; 31; 
<br/>
                   value |= 3 &lt;&lt; 29; 
<br/>
                   value |= (srcOffset &amp; 0x3) &lt;&lt; 26; 
<br/>
                   value |= (source &amp; 0x3) &lt;&lt; 24;
<br/>
                   value |= (size &amp; 0x3) &lt;&lt; 20;
<br/>
                   value |= (offset &amp; 0x3) &lt;&lt; 18; 
<br/>
                   value |= (bank &amp; 0x3) &lt;&lt; 16; 
<br/>
                   value |= (srcBlend &amp; 0xF) &lt;&lt; 8;
<br/>
                   value |= (destBlend &amp; 0xF) &lt;&lt; 0; 
<br/>
   
<br/>
                   REG_CAPTURE = value;
<br/>
 }
<br/>
<br/>
 int LoadGLTextures() 
<br/>
 {
<br/>
                glGenTextures( 1, &amp;cafe_texid );
<br/>
                glBindTexture( 0, cafe_texid );
<br/>
                glTexImage2D( 0, 0, GL_RGB, TEXTURE_SIZE_128 , TEXTURE_SIZE_128, 0, GL_TEXTURE_WRAP_S|GL_TEXTURE_WRAP_T|TEXGEN_NORMAL, (u8*)cafe_bin );
<br/>
<br/>
                return TRUE;
<br/>
 }
<br/>
 //-----------------------------------------
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62099 - Darkflame - Sun Nov 27, 2005 12:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>The 9th Sage wrote:</b></span></td> </tr> <tr> <td class="quote">Hm...someone was asking about games that do 3D on two screens...I think Feel the Magic and Mario (in some of the minigames) do it, I know for a fact that Viewtiful Joe does it (and quite handily I might add).</td> </tr></table><span class="postbody">
<br/>
<br/>
Mario Kart does it spectacularly. ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62195 - lambi1982 - Mon Nov 28, 2005 6:06 am</h4>
    <div class="postbody"><span class="postbody">Mario Kart does so it very well :)
<br/>
<br/>
Now a Question: If a developer was to disable one of the screens, would it be possible to boost the graphic power to the one screen, or is it going to be the same (less stress on arm9)?<br/>_________________<br/>Who, Me?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62203 - chishm - Mon Nov 28, 2005 6:57 am</h4>
    <div class="postbody"><span class="postbody">There are 3 separate graphics cores, 2D main, 2D sub, and 3D. The rendering capabilities of the cores are separate, and not combinable, with the exception of 2D main using 3D rendered layers, or either 2d core using captured 3D data. This is what is done for the 2 screen 3D. They do share VRAM, so if one core is only doing simple stuff, more VRAM can be allocated to another core. Also, reducing the amount of detail on one screen will mean the CPU has to process less objects for it (in the sense of characters, menu buttons, etc) and this extra time can be put into making the scene on the other screen more complex. 
<br/>
<br/>
However, the way things are currently done in many games (3D main world on top screen, 2D control / map interface on touch screen) already dedicates most of the CPU power and VRAM to the main screen anyway, and there would be no significant gain to be had by disabling the other screen.
<br/>
<br/>
Of course, I am just talking out of my a**e here, so please correct me if I'm wrong.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63350 - Marill - Mon Dec 12, 2005 5:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ecurtz wrote:</b></span></td> </tr> <tr> <td class="quote"><a class="postlink" href="ftp://ftp.nuprometheus.com/pub/Display_Capture.zip" target="_blank">Work in progress</a>
<br/>
[edit] Better version up in the same spot. Are there any other VRAM banks that can be used for Sub Background besides C? I think it would work at that point, at the expense of using up a ton of our video RAM. [/edit]</td> </tr></table><span class="postbody">
<br/>
<br/>
how about trying the rest like E, F, G...? i think it should work</span><span class="gensmall"><br/><br/>Last edited by Marill on Mon Dec 12, 2005 6:15 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#63351 - Marill - Mon Dec 12, 2005 6:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ninogenio wrote:</b></span></td> </tr> <tr> <td class="quote">your right its strange that everything has to be rendered to the two screen from the sub 2d core its kind of like the capturing code isnt working quite as it should.ive spent most of 2 day playing with this trying to get it going and for the most part it does ive managed to render from one vram bank but the top display is ever so slightly faded.
<br/>
<br/>
the way i though this would have worked would have been to render to the main screen directly from the 3d core and inbtween frames to screen capture the object you want to display on the sub screen to to blit it to the sub bg.
<br/>
<br/>
any ideas any one!!!!!!!!!!!! 
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
what about a method to do some "double bufferer"-ish  kinda thing....
<br/>
<br/>
like instead of using only 1 bank, use 2.
<br/>
<br/>
so, for example, 
<br/>
<br/>
this frame you capture to VRAM C and at the same time, display as 2D the contents of VRAM D.
<br/>
<br/>
next frame, capture to VRAM D and at the same time, display as 2D the contents of VRAM C.
<br/>
<br/>
I think your output looks slightly faded coz you can't display and capture to the same bank at the same time, so the display is disabled in that frame. So you could use 2 banks instead of 1 and probbly it will work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63425 - ninogenio - Tue Dec 13, 2005 12:56 am</h4>
    <div class="postbody"><span class="postbody">i tried a ton of stuff with this your right atm you need two banks to make it work and i tried E F G but the only area of memory that worked was oam which is strange.
<br/>
<br/>
they way i thought this would work would only need one vram bank and thats what i was aming for would be to display to the main screen using the 3d chip  and to the sub screen through main screen capture on the 2d core.
<br/>
<br/>
but the way it works is to use the sub 2d core to draw to both screens and it just lcd flips.
<br/>
<br/>
its strange and not quite right but hey its damn close</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70339 - Lino - Sun Feb 05, 2006 7:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>StoneCyqh wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
.
<br/>
.
<br/>
capture source is 24-25
<br/>
capture source offset is 26-27
<br/>
.
<br/>
.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
What is the source? A memory bank? Or other form
<br/>
Do you know it? Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100660 - iainprice - Tue Aug 29, 2006 11:39 am</h4>
    <div class="postbody"><span class="postbody">I want to display a 3d model in vram, get the touch screen coords, index into vram to find the colour of the pixel, then draw the 3d model into the screen.
<br/>
<br/>
I assume I enable setregcapture using 5 for bank F which is setup for LCD.
<br/>
<br/>
I draw my model.
<br/>
<br/>
I disable setregcapture.
<br/>
<br/>
I draw my model.
<br/>
<br/>
If this is all OK, how do I index into vram? Is it just stored 1 bit for each pixel....
<br/>
<br/>
Cheers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100664 - Payk - Tue Aug 29, 2006 12:45 pm</h4>
    <div class="postbody"><span class="postbody">As far as i know the reg just allows u to capture to vram a-d.
<br/>
When its in vram A as a 256x192 pic it should be ordered like x+(y*256)
<br/>
so if vramA is main bg u could just grap right pixel like:
<br/>
u16 color=(u16*)BG_GFX[x+(y*256)]...
<br/>
but this method would mean that this BG is displayed...better use Vram_A instead...not shure if and how that works exactly...didnt tried it...but should work.
<br/>
<br/>
The reg disables it self automatically after succesfully capturing...that takes till next frame as far as i know. so capture it. after next swiwaitforvlb u can grap the color and make with it what u would want.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
