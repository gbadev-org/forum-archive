<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Strings and Pointers - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS Misc > Strings and Pointers</h2>
<div id="posts">
<div class="post">
    <h4>#175789 - MichaelMossman - Mon Feb 07, 2011 1:10 pm</h4>
    <div class="postbody"><span class="postbody">I am going round and round in circles, trying to create a String and then work my way through it with a pointer.
<br/>
<br/>
Either string to char pointer has been deprecated or else conversion from constant char to char is not allowed.
<br/>
<br/>
Surely, it can't be this difficult just to be able to create a string  (say "TestString") and then create a pointer ( of one type or another) and then go through the string, one character at a time.
<br/>
<br/>
Can somebody please get me out of this loop.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175795 - Rexhunter99 - Tue Feb 08, 2011 3:00 am</h4>
    <div class="postbody"><span class="postbody">I can see why sometimes, this is why most tutorials/books these days argue why not to use C-Style strings and will tell you to use the C++ STD strings.
<br/>
<br/>
if you want to create a cstring and go through it a character at a time, I can suggest a few ways.  It all depends on your code style and preference though.
<br/>
<br/>
First of all you can dynamically allocate memory for your string like so:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char *myString = new char[strlen("Hello World!")+1];</td> </tr></table><span class="postbody">
<br/>
Then you copy the string into the new dynamic array:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">strcpy(myString, "Hello World!");</td> </tr></table><span class="postbody">
<br/>
And to cycle through it (old-school 1990's style) use a while loop like so:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char *pChar = myString;
<br/>
while(*pChar != 0)
<br/>
{
<br/>
printf("myString[%d] = \'%c\'\n", int(pChar - myString), *pChar);
<br/>
pChar++;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
And ALWAYS make sure you free the memory you just used:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">delete [] myString;
<br/>
myString = 0;</td> </tr></table><span class="postbody">
<br/>
<br/>
That's one way with a mix of C++ and C, the C++ is the new/delete operators (I prefer them over alloc() and free()) with C-Style string handling that I've seen in many mid 1990's game source-code.
<br/>
<br/>
Using the same allocation and copying of the string into the dynamic array, you can use an array index to get the character too using a for loop instead of the while loop I supplied:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for (int i=0; i&lt;strlen(myString); i++)
<br/>
{
<br/>
printf("myString[%d] = \'%c\'\n", i, myString[i]);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
You could even change the for line to:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for (int i=0; myString[i]!=0; i++)</td> </tr></table><span class="postbody">
<br/>
Which breaks out of the loop if we reach a NULL terminator in the string (assuming you have been a good programmer and have NULL terminated your string which is good practice anyway.)
<br/>
<br/>
As for const char* type casting, I have troubles with that too, then again I changed my way of using const, now I only use it when the value it is referring to WONT change (which is exactly what it means)  I think if you declare your string as a constant character pointer, the compiler detects the type cast to a normal character pointer and immediately throws an error because you've told it that the values it contains wont be changed.  (which is a good thing, that it's catching that one out for you)
<br/>
<br/>
I only use const char* in functions involving strings such as:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int find_substring(const char* string, const char* substring);</td> </tr></table><span class="postbody">
<br/>
Where neither string or substring will be modified because I'm only looking at the data in either of them within the function.
<br/>
<br/>
Another way to do it is for instance:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
char *myString = "Hello World!";
<br/>
</td> </tr></table><span class="postbody">
<br/>
Though I don't quite trust that, I'd prefer to allocate memory dynamically for the string and handle the freeing of that memory myself.
<br/>
Or this is valid too when initializing the variables if I remember correctly:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
char myString[] = "Hello World!";
<br/>
or
<br/>
char myString[256] = "Hello World";
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Strings are tricky business if not thought about carefully, pointers are not as tricky as they seem when you read a good article on them.<br/>_________________<br/><a class="postlink" href="http://crocfanforum.forumotion.com/programming-f7/croc-ds-he-s-back-t28.htm" target="_blank"></a><a href="http://img411.imageshack.us/img411/4229/dscroclife2.gif">[Images not permitted - Click here to view it]</a> - Move over Mario... Cruise by Crash... Croc Rocks!</span><span class="gensmall"><br/><br/>Last edited by Rexhunter99 on Wed Feb 09, 2011 5:01 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#175799 - MichaelMossman - Tue Feb 08, 2011 4:03 pm</h4>
    <div class="postbody"><span class="postbody">Thank you very much for that very lucid insight to the vagaries of string and char.
<br/>
<br/>
I am grateful for your comments and it has certainly helped me to solve my own particular problem, which was how to pass a string to a function and then let that function work on the string using char pointers.
<br/>
<br/>
What you have said actually clarifies the situation much more than most of the tutorials I have seen on the subject. For my own part, I managed to get round the apparent compiler impasse by actually using a string declaration in the function and passing a string into it. For some reason, I had convinced myself that the only way to pass a string was by using char pointers and that was the route cause of my problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175800 - elhobbs - Tue Feb 08, 2011 7:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rexhunter99 wrote:</b></span></td> </tr> <tr> <td class="quote">First of all you can dynamically allocate memory for your string like so:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char *myString = new char[strlen("Hello World!")];</td> </tr></table><span class="postbody">
<br/>
Then you copy the string into the new dynamic array:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">strcpy(myString, "Hello World!");</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">this code creates a 1 character buffer overflow. it neglects to allocate space for the terminating null character that is expected for c strings. strlen does not count the terminating null character - you need to do it yourself. strcpy does copy the terminating null character - in this case past the end of the array you allocated.
<br/>
I stopped reading at that point - there may or may not be more issues...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175801 - Rexhunter99 - Wed Feb 09, 2011 4:59 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rexhunter99 wrote:</b></span></td> </tr> <tr> <td class="quote">First of all you can dynamically allocate memory for your string like so:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char *myString = new char[strlen("Hello World!")];</td> </tr></table><span class="postbody">
<br/>
Then you copy the string into the new dynamic array:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">strcpy(myString, "Hello World!");</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">this code creates a 1 character buffer overflow. it neglects to allocate space for the terminating null character that is expected for c strings. strlen does not count the terminating null character - you need to do it yourself. strcpy does copy the terminating null character - in this case past the end of the array you allocated.
<br/>
I stopped reading at that point - there may or may not be more issues...</span></td> </tr></table><span class="postbody">
<br/>
Oh crud!  You're right D= I totally forgot that because I was naughty and didn't check the reference to be extra sure D=  *is crushed by noobness*
<br/>
<br/>
Anyways edited the post and fixed it all =) I think tutorials are correct though, C++ strings are the way to go now and IIRC libnds has C++ strings =D
<br/>
<br/>
Thanks for that catch elhobbs =)<br/>_________________<br/><a class="postlink" href="http://crocfanforum.forumotion.com/programming-f7/croc-ds-he-s-back-t28.htm" target="_blank"></a><a href="http://img411.imageshack.us/img411/4229/dscroclife2.gif">[Images not permitted - Click here to view it]</a> - Move over Mario... Cruise by Crash... Croc Rocks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175805 - Dwedit - Wed Feb 09, 2011 2:45 pm</h4>
    <div class="postbody"><span class="postbody">#1: post should be moved out of "DS Misc"
<br/>
#2: C++ strings are in the Standard Template Library, and are defined the standard library's header files, plus whatever needs to be linked from libcpp.  Libnds isn't involved anywhere.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175806 - Miked0801 - Wed Feb 09, 2011 7:21 pm</h4>
    <div class="postbody"><span class="postbody">strncpy instead of strcpy whenever possible as well.  Might as well not accidently blow your receive buffer.
<br/>
<br/>
Or just use the proper C++ methods and not worry about dynamic memory loss :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
