<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How to use DsWiFiLib? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS Misc > How to use DsWiFiLib?</h2>
<div id="posts">
<div class="post">
    <h4>#157893 - Mohammad - Sun Jun 01, 2008 1:56 am</h4>
    <div class="postbody"><span class="postbody">Does anyone have an example on how to use WiFi Lib, I'm going to use it to connect to a MySQL DB through PHP though...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157896 - Lazy1 - Sun Jun 01, 2008 6:10 am</h4>
    <div class="postbody"><span class="postbody">There should be examples provided in the dswifi download, if there isn't wifi_lib_test will show you how to initialize the wifi library.
<br/>
<br/>
Here is my modified startup/stop code, should get a cleaning though:
<br/>
(Warning: Horrible preprocessor abuse)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define InitStage( StageTitle, InitCode ) { \
<br/>
   iprintf( "%s... ", StageTitle ); \
<br/>
   InitCode; \
<br/>
   iprintf( "%s\n", StageResult == 1 ? "OK" : "FAIL" ); \
<br/>
   if ( StageResult == 0 ) return 0; \
<br/>
}
<br/>
<br/>
void IRQTimer3( void ) {
<br/>
   Wifi_Timer( 50 );
<br/>
}
<br/>
<br/>
void IRQFifoNotEmpty( void ) {
<br/>
   u32 FifoData = 0;
<br/>
   
<br/>
   if ( ( FifoData = REG_IPC_FIFO_RX ) == 0x87654321 )
<br/>
      Wifi_Sync( );
<br/>
}
<br/>
<br/>
void Arm9Arm7Sync( void ) {
<br/>
   REG_IPC_FIFO_TX = 0x87654321;
<br/>
}
<br/>
<br/>
int StartupWifi( void ) {
<br/>
   int StageResult = 0;
<br/>
   int Status = 0;
<br/>
   int VBlanks = 0;
<br/>
   u32 WifiPass = 0;
<br/>
   
<br/>
   InitStage( "Initialize wifi", {
<br/>
         REG_IPC_FIFO_CR = IPC_FIFO_ENABLE | IPC_FIFO_SEND_CLEAR;
<br/>
         WifiPass = Wifi_Init( WIFIINIT_OPTION_USELED );
<br/>
         
<br/>
         REG_IPC_FIFO_TX = 0x12345678;
<br/>
         REG_IPC_FIFO_TX = WifiPass;
<br/>
         
<br/>
         TIMER3_CR = 0;
<br/>
         TIMER3_DATA = 0;
<br/>
         
<br/>
         irqSet( IRQ_TIMER3, IRQTimer3 );
<br/>
         irqEnable( IRQ_TIMER3 );
<br/>
         
<br/>
         irqSet( IRQ_FIFO_NOT_EMPTY, IRQFifoNotEmpty );
<br/>
         irqEnable( IRQ_FIFO_NOT_EMPTY );
<br/>
         
<br/>
         REG_IPC_FIFO_CR = IPC_FIFO_ENABLE | IPC_FIFO_RECV_IRQ;
<br/>
         
<br/>
         Wifi_SetSyncHandler( Arm9Arm7Sync );
<br/>
         
<br/>
         TIMER3_DATA = -6553;
<br/>
         TIMER3_CR = TIMER_ENABLE | TIMER_DIV_256 | TIMER_IRQ_REQ;
<br/>
         
<br/>
         while ( Wifi_CheckInit( ) == 0 ) {
<br/>
            swiWaitForVBlank( );
<br/>
            VBlanks++;
<br/>
            
<br/>
            // ARM7 Did not init. Don't hang, just fail
<br/>
            if ( VBlanks &gt;= 240 )
<br/>
               break;
<br/>
         }
<br/>
         
<br/>
         StageResult = VBlanks &lt; 240 ? 1 : 0;
<br/>
      }
<br/>
   );
<br/>
   
<br/>
   if ( StageResult == 1 ) {
<br/>
      InitStage( "Connect via wfc data", {
<br/>
            Wifi_AutoConnect( );
<br/>
            
<br/>
            while ( 1 ) {
<br/>
               Status = Wifi_AssocStatus( );
<br/>
               
<br/>
               if ( Status == ASSOCSTATUS_ASSOCIATED ) {
<br/>
                  StageResult = 1;
<br/>
                  break;
<br/>
               }
<br/>
               
<br/>
               if ( Status == ASSOCSTATUS_CANNOTCONNECT ) {
<br/>
                  StageResult = 0;
<br/>
                  break;
<br/>
               }
<br/>
               
<br/>
               if ( VBlanks &gt;= 600 ) {
<br/>
                  StageResult = 0;
<br/>
                  break;
<br/>
               }
<br/>
               
<br/>
               swiWaitForVBlank( );
<br/>
               VBlanks++;
<br/>
            }
<br/>
         }
<br/>
      );
<br/>
      
<br/>
      return StageResult;
<br/>
   }
<br/>
      
<br/>
   return 0;
<br/>
}
<br/>
<br/>
int StopWifi( void ) {
<br/>
   Wifi_DisconnectAP( );
<br/>
   Wifi_DisableWifi( );
<br/>
         
<br/>
   swiWaitForVBlank( );
<br/>
   swiWaitForVBlank( );
<br/>
   swiWaitForVBlank( );
<br/>
   swiWaitForVBlank( );
<br/>
   
<br/>
   return 1;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT:
<br/>
Forgot ARM7 Code!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//---------------------------------------------------------------------------------
<br/>
void VblankHandler(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
<br/>
   u32 i;
<br/>
<br/>
   //sound code  :)
<br/>
   TransferSound *snd = IPC-&gt;soundData;
<br/>
   IPC-&gt;soundData = 0;
<br/>
<br/>
   if (0 != snd) {
<br/>
<br/>
      for (i=0; i&lt;snd-&gt;count; i++) {
<br/>
         s32 chan = getFreeSoundChannel();
<br/>
<br/>
         if (chan &gt;= 0) {
<br/>
            startSound(snd-&gt;data[i].rate, snd-&gt;data[i].data, snd-&gt;data[i].len, chan, snd-&gt;data[i].vol, snd-&gt;data[i].pan, snd-&gt;data[i].format);
<br/>
         }
<br/>
      }
<br/>
   }
<br/>
   
<br/>
   Wifi_Update( );
<br/>
}
<br/>
<br/>
static __inline__ void FifoWaitWhileEmpty( void ) {
<br/>
   while ( REG_IPC_FIFO_CR &amp; IPC_FIFO_RECV_EMPTY )
<br/>
      swiWaitForVBlank( );
<br/>
}
<br/>
<br/>
void IRQFifoNotEmpty( void ) {
<br/>
   u32 FifoData = 0;
<br/>
   
<br/>
   if ( ( FifoData = REG_IPC_FIFO_RX ) == 0x87654321 )
<br/>
      Wifi_Sync( );
<br/>
}
<br/>
<br/>
void Arm7Arm9Sync( void ) {
<br/>
   REG_IPC_FIFO_TX = 0x87654321;
<br/>
}
<br/>
<br/>
void SetupWifiHardware( void ) {
<br/>
   u32 FifoData = 0;
<br/>
<br/>
   irqSet( IRQ_WIFI, Wifi_Interrupt );
<br/>
   irqEnable( IRQ_WIFI );
<br/>
   
<br/>
   while ( 1 ) {
<br/>
      FifoWaitWhileEmpty( );
<br/>
      
<br/>
      if ( ( FifoData = REG_IPC_FIFO_RX ) == 0x12345678 )
<br/>
         break;
<br/>
         
<br/>
      swiWaitForVBlank( );
<br/>
   }
<br/>
   
<br/>
   FifoWaitWhileEmpty( );
<br/>
   FifoData = REG_IPC_FIFO_RX;
<br/>
   
<br/>
   Wifi_Init( FifoData );
<br/>
   
<br/>
   irqSet( IRQ_FIFO_NOT_EMPTY, IRQFifoNotEmpty );
<br/>
   irqEnable( IRQ_FIFO_NOT_EMPTY );
<br/>
   
<br/>
   REG_IPC_FIFO_CR = IPC_FIFO_ENABLE | IPC_FIFO_RECV_IRQ;
<br/>
   
<br/>
   Wifi_SetSyncHandler( Arm7Arm9Sync );
<br/>
}
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(int argc, char ** argv) {
<br/>
//---------------------------------------------------------------------------------
<br/>
   REG_IPC_FIFO_CR = IPC_FIFO_ENABLE | IPC_FIFO_SEND_CLEAR;
<br/>
<br/>
   // read User Settings from firmware
<br/>
   readUserSettings();
<br/>
<br/>
   //enable sound
<br/>
   powerON(POWER_SOUND);
<br/>
   writePowerManagement(PM_CONTROL_REG, ( readPowerManagement(PM_CONTROL_REG) &amp; ~PM_SOUND_MUTE ) | PM_SOUND_AMP );
<br/>
   SOUND_CR = SOUND_ENABLE | SOUND_VOL(0x7F);
<br/>
<br/>
   irqInit();
<br/>
<br/>
   // Start the RTC tracking IRQ
<br/>
   initClockIRQ();
<br/>
<br/>
   SetYtrigger(80);
<br/>
   irqSet(IRQ_VCOUNT, VcountHandler);
<br/>
   irqSet(IRQ_VBLANK, VblankHandler);
<br/>
<br/>
   irqEnable( IRQ_VBLANK | IRQ_VCOUNT);
<br/>
   
<br/>
   SetupWifiHardware( );
<br/>
<br/>
   // Keep the ARM7 mostly idle
<br/>
   while (1) swiWaitForVBlank();
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by Lazy1 on Sun Jun 01, 2008 8:01 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#157901 - Mohammad - Sun Jun 01, 2008 4:22 pm</h4>
    <div class="postbody"><span class="postbody">but now how would I download the text from my website so like 
<br/>
<a href='http://www.mysite.com/mygame/nds/game.php?sql="SELECT' target="_blank">http://www.mysite.com/mygame/nds/game.php?sql="SELECT</a> * FROM monsters"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157902 - simonjhall - Sun Jun 01, 2008 4:24 pm</h4>
    <div class="postbody"><span class="postbody">That code's lacking the ARM7 stuff...it won't work without it!
<br/>
And have a look for the actual sample, as that shows you how to do a dash of http. I'm sure you can get it through the DKP updater.<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157903 - Maxxie - Sun Jun 01, 2008 4:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mohammad wrote:</b></span></td> </tr> <tr> <td class="quote">but now how would I download the text from my website so like 
<br/>
<a href='http://www.mysite.com/mygame/nds/game.php?sql="SELECT' target="_blank">http://www.mysite.com/mygame/nds/game.php?sql="SELECT</a> * FROM monsters"</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, you better don't as this will open your server for sql based attacks.
<br/>
<br/>
<a class="postlink" href="http://www.w3.org/Protocols/rfc2616/rfc2616.html" target="_blank">On the question of how to access hypertext base web content</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157904 - Mohammad - Sun Jun 01, 2008 5:01 pm</h4>
    <div class="postbody"><span class="postbody">first it will have to authenticate its self and be added to the trusted MAC address DB. Also the URL will be a lot longer then that with random gibberish.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157907 - Maxxie - Sun Jun 01, 2008 7:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mohammad wrote:</b></span></td> </tr> <tr> <td class="quote">first it will have to authenticate its self and be added to the trusted MAC address DB.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Which will not prevent injection into the authentificated machine.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also the URL will be a lot longer then that with random gibberish.</td> </tr></table><span class="postbody">
<br/>
<br/>
No random gibberisch will add to security. Everyone on the way that logs requested pages will be able to get into, and i am not even thinking about bots. I strongly advise to use predefined, well formed SQL commands in your php you only pass _checked_ parameters to.
<br/>
<br/>
Please help keeping <a class="postlink" href="http://en.wikipedia.org/wiki/Zombie_computer" target="_blank">zombies</a> out, thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157908 - Cydrak - Sun Jun 01, 2008 7:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also the URL will be a lot longer then that with random gibberish.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Maybe you can't imagine "decoding" such things. But if it can't be guessed, I assure you it's not impractical to read assembler (nevermind amazing tools like IDA Pro). As such, your game code may provide a nice tutorial. :-)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">first it will have to authenticate its self and be added to the trusted MAC address DB.</td> </tr></table><span class="postbody">
<br/>
I'm not really a PHP/SQL guy, but... what guarantee is the MAC your client claims to have? As for logins, remember you're doing this over wifi... see Defcon's infamous <a class="postlink" href="http://blog.makezine.com/archive/2005/07/_defcon_the_wal.html" target="_blank">Wall of Sheep</a>. (So, you say you're on a secure network? How about your players?)
<br/>
<br/>
Just to further the point: I used to run a small Apache server. Though not linked or publicised <span style="font-style: italic">at all</span>, I remember lots of exploit attempts (probably worms) in the access logs. It was fairly routine--and this was years ago. I don't think it's paranoid to be skeptical of your input, whether you trust your clients or not.
<br/>
<br/>
Finally, at some point you might wish to change the tables. Would you rather patch the server or the game?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157909 - Mohammad - Sun Jun 01, 2008 7:28 pm</h4>
    <div class="postbody"><span class="postbody">this isn't anything public, it's just for four of us people to keep a DB up to date on some stuff, if it gets hacked, no one cares. But is there a MySQL header for NDSLIB?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157921 - DensitY - Sun Jun 01, 2008 11:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mohammad wrote:</b></span></td> </tr> <tr> <td class="quote">this isn't anything public, it's just for four of us people to keep a DB up to date on some stuff, if it gets hacked, no one cares. But is there a MySQL header for NDSLIB?</td> </tr></table><span class="postbody">
<br/>
<br/>
not to my knowledge. But I can think of 3 ways of doing it,
<br/>
<br/>
Firstly you could write it so your DS application issues commands to a PC applicaiton which'll do the SQL queries for you, and return the result (just requires you to create custom simple TCP (well last time I checked TCP packets had problems, might have to send UDP with libwifi :s) protocol between your pc app and the DS app, no biggy), I'd possibly recommend this because you can make it as secure as you want (if you want to write your own SSL Client for DS that is). Secondly you could write a full SQL client layer on the DS, which will not be fun and something I don't advice.
<br/>
The third way is possibly implementing a basic HTTP client on the ds, and connect to a host web address (on pc) which'll run a CGI app that'll return the results, not very secure.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158012 - Mohammad - Tue Jun 03, 2008 11:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">That code's lacking the ARM7 stuff...it won't work without it!
<br/>
And have a look for the actual sample, as that shows you how to do a dash of http. I'm sure you can get it through the DKP updater.</td> </tr></table><span class="postbody">
<br/>
They took that stuff out sadly, because "everyone already has it" sorta thing. *grunt* could someone try to just zip it and put it on rapidshare.com or megaupload, sorry to be a nuisance</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158013 - simonjhall - Tue Jun 03, 2008 11:30 am</h4>
    <div class="postbody"><span class="postbody">So what's in the sample then? Just turning on and off wifi? That's not a sample!<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158014 - Mohammad - Tue Jun 03, 2008 3:08 pm</h4>
    <div class="postbody"><span class="postbody">there is no sample... did I miss something? (uhh oh)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158044 - Lazy1 - Tue Jun 03, 2008 10:22 pm</h4>
    <div class="postbody"><span class="postbody">All you really need to know is how to enable the wifi hardware, if you don't know socket programming the DS is not the place to start learning.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158052 - Mohammad - Tue Jun 03, 2008 11:28 pm</h4>
    <div class="postbody"><span class="postbody">hmm can't say that I do I did UDP/TCP MMORPG games (that never got that first M) but I honestly don't think it will be that hard. Yellowstar people can learn, sometimes the hardest is the most rewarding, and in the long run the best (because everything else is <span style="font-style: italic">so</span> easy). Well I can't run DKPupdater.exe for w/e reason. /me is fon of zips so if anyone knows where to get it zipped lemme know until then, trying to get to the bottom of the updater.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158053 - silent_code - Tue Jun 03, 2008 11:44 pm</h4>
    <div class="postbody"><span class="postbody">all devkitpro related components and support libraries can be found zipped at the project's sourceforge page. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158107 - tepples - Thu Jun 05, 2008 1:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mohammad wrote:</b></span></td> </tr> <tr> <td class="quote">Well I can't run DKPupdater.exe for w/e reason.</td> </tr></table><span class="postbody">
<br/>
Does the updater open and close without displaying anything? Or is it that you can't run .exe files in general?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158140 - melw - Thu Jun 05, 2008 3:36 pm</h4>
    <div class="postbody"><span class="postbody">If you're using PHP as a server backend there's no need to mix SQL in any of your DS code. Just make a PHP page that responds to queries sent from DS and returns something back corresponding what you need. This way you can optimize the packets sent between the client and server to minimum, e.g. use the first byte(s) for identifying what kind of data is being sent/queried according to game situation and the rest of the packets for parameters and data.
<br/>
<br/>
Making a MySQL client for DS might be a fun project, but for games I don't see much point in going that direction... Just my two cents on this topic.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
