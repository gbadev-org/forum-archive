<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem loading map data. [Renamed] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Graphics > Problem loading map data. [Renamed]</h2>
<div id="posts">
<div class="post">
    <h4>#95153 - christosterone - Fri Jul 28, 2006 2:03 am</h4>
    <div class="postbody"><span class="postbody">I stopped gba programming for like 6 months and now im getting back into it, but im having trouble loading the map... im retarded. i dont knwo what im doing wrong;
<br/>
<br/>
in map.c
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const unsigned int mapData[2048]= 
<br/>
{
<br/>
   0x00a800a7,0x003600a9,0x00380037,0x003a0039,0x003c003b,0x00000000,0x00000000,0x00000000,</td> </tr></table><span class="postbody">
<br/>
<br/>
in main.c
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for(loop = 0; loop &lt; 128*128/2; loop++)
<br/>
      ground.mapData[loop] = mapData[loop];</td> </tr></table><span class="postbody">
<br/>
<br/>
for some reason its only showing up half the pixels and blanks or something i dont know.... its probably really somehting stupid.
<br/>
i think i may need to shift the bits over because ints and u16s have 1/2 the amt of bits as an int.... im not sure
<br/>
<br/>
i bet its really simple and im sorry to waste your time... i feel retarded
<br/>
<br/>
-chris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95177 - DrkMatter_ - Fri Jul 28, 2006 3:47 am</h4>
    <div class="postbody"><span class="postbody">You should ask yourself the following questions: are you...
<br/>
<br/>
<ul>- only writing to VRAM during VBlank?
<br/>
- writing to VRAM 16 bits at a time?
<br/>
- certain your original data is in little endian?</ul></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95184 - tepples - Fri Jul 28, 2006 4:21 am</h4>
    <div class="postbody"><span class="postbody">Take screenshots of VisualBoyAdvance's tile viewer and map viewer, as needed to demonstrate the problem, save them in PNG format, and make them available on some image hosting site.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95226 - christosterone - Fri Jul 28, 2006 7:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DrkMatter_ wrote:</b></span></td> </tr> <tr> <td class="quote">- only writing to VRAM during VBlank? </td> </tr></table><span class="postbody">
<br/>
yes, i the code loads the 512x512 text background right at the beginning and then the program goes into an infinite loop.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DrkMatter_ wrote:</b></span></td> </tr> <tr> <td class="quote">- writing to VRAM 16 bits at a time?</td> </tr></table><span class="postbody">
<br/>
no i am not; i believe the int is 32 bits whereas i need 16 bits. The only map editor i know which doesnt suck is mirach, but it only outputs in integer format. i could either bitsplit the integer (im not exactly sure how) or use another mapping program (any suggestions?).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DrkMatter_ wrote:</b></span></td> </tr> <tr> <td class="quote">- certain your original data is in little endian?</td> </tr></table><span class="postbody">
<br/>
im not sure what that means.
<br/>
<br/>
this is waht the map is: and what it should look like:
<br/>
<a href="http://moop.gotdns.com/~christosterone/screenshot/map.PNG" target="_blank">http://moop.gotdns.com/~christosterone/screenshot/map.PNG</a>
<br/>
<br/>
this is what the gba is outputting:
<br/>
<a href="http://moop.gotdns.com/~christosterone/screenshot/shot.PNG" target="_blank">http://moop.gotdns.com/~christosterone/screenshot/shot.PNG</a><br/>_________________<br/><a href="http://moop.gotdns.com/~christosterone" target="_blank">http://moop.gotdns.com/~christosterone</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95240 - Cearn - Fri Jul 28, 2006 10:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>christosterone wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DrkMatter_ wrote:</b></span></td> </tr> <tr> <td class="quote">- writing to VRAM 16 bits at a time?</td> </tr></table><span class="postbody">
<br/>
no i am not; i believe the int is 32 bits whereas i need 16 bits. The only map editor i know which doesnt suck is mirach, but it only outputs in integer format. i could either bitsplit the integer (im not exactly sure how) or use another mapping program (any suggestions?).</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Or you could just cast the source or destination pointers to match the other, or use a dedicated copy routine like memcpy, dma or CpuFastSet.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u32 size= size_in_bytes_of_mapData;
<br/>
<br/>
// casting to u32*. 2x faster than u16 copies
<br/>
u32 *dst= (u32*)ground.mapData, *src= (u32*)mapData;
<br/>
for(ii=0; ii&lt;size/4; ii++)
<br/>
    *dst++ = *src++;
<br/>
<br/>
// memcpy; 3x faster than u16 copies
<br/>
memcpy(ground.mapData, mapData, size);
<br/>
<br/>
// GBA specific copiers; ~8x faster
<br/>
dma_cpy(ground.mapData, mapData, size/4);
<br/>
CpuFastSet(mapData, ground.mapData, size/4);
<br/>
</td> </tr></table><span class="postbody">
<br/>
But even then, the output seems too weird for that to be the only problem. But it's a start. Also check the tile/map viewers (not just the final screen) to see what the problem is.
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">FIX: src is a pointer, duh &gt;_&lt;</span></span><span class="gensmall"><br/><br/>Last edited by Cearn on Fri Jul 28, 2006 8:07 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#95328 - FluBBa - Fri Jul 28, 2006 8:05 pm</h4>
    <div class="postbody"><span class="postbody">Is your ground.mapData short/u16 cast it to int when in the loop.
<br/>
The problem looks as if you read twice as much as you write.<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95350 - christosterone - Fri Jul 28, 2006 11:21 pm</h4>
    <div class="postbody"><span class="postbody">eureka!
<br/>
<br/>
thanks so much for the help &gt;_&lt;
<br/>
<br/>
-chris<br/>_________________<br/><a href="http://moop.gotdns.com/~christosterone" target="_blank">http://moop.gotdns.com/~christosterone</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
