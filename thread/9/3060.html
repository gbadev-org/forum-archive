<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Huge backgrounds Help - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Graphics > Huge backgrounds Help</h2>
<div id="posts">
<div class="post">
    <h4>#17876 - Justin2097 - Tue Mar 16, 2004 1:01 pm</h4>
    <div class="postbody"><span class="postbody">My idea is, i think, a pretty simple one.
<br/>
<br/>
I am designing a map program for use alongside a PC game. So i can use my GBA as a map for the game i am playing. 
<br/>
Pointless i know, but this is for learning purposes only.
<br/>
<br/>
My tiles are 32*32 pixels, and there are about 3160 (81*39). 
<br/>
They take up much more room than the max 512*512 (8*8px) tiles allowed. 
<br/>
All in all i would need 6 of the 512*512 tile maps for the one map i'm trying to produce.
<br/>
<br/>
My question is how can i go about producing an array of tiles in my program that will update when i scroll around, 
<br/>
for example: -
<br/>
<br/>
When i scroll left, the tiles that disappear to the right, appear on the left and the new tile is loaded into its space.
<br/>
<br/>
The map itself does not rotate or scale. It just moves in 4 directions; Up, Down, Left, and Right. No diagonals either.
<br/>
<br/>
Are there any tutorials out there which show how to do this? or can someone explain how to do it. I've tired looking on the 
<br/>
pern project. and nothing is explained fully. I understand the theory, as i have a bit of experience with delphix games 
<br/>
development, i just don't know how to do it GBA.
<br/>
<br/>
Thanks in advance for any help offered.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17887 - Nessie - Tue Mar 16, 2004 5:18 pm</h4>
    <div class="postbody"><span class="postbody">One question is, are the 3160 tiles all <span style="font-style: italic">unique</span> tiles or do you have 3160 tiles, many of which are duplicates of other ones?
<br/>
<br/>
If you are dealing with the latter situation described, using a tool to dead-strip duplicated tiles may be enough to solve your problem.
<br/>
<br/>
Or had you already tried this approach and it won't work?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17888 - Justin2097 - Tue Mar 16, 2004 5:25 pm</h4>
    <div class="postbody"><span class="postbody">They are not all unique, no. I have 180 unique tiles. Each 32px*32px.
<br/>
<br/>
The map i want to display is the full size, what i wrote above I can't recall now.
<br/>
<br/>
I have the tiles in a bmp file and pcx file.
<br/>
<br/>
The thing is, i can create a map in an editor and scroll around it. But it's nowhere near big enough.
<br/>
<br/>
I need to know how to get the tiles on screen without using the map program. And then how to slice a section off one edge, change it and paste it on the other edge.
<br/>
<br/>
I hope thats a bit clearer :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17890 - ScottLininger - Tue Mar 16, 2004 6:11 pm</h4>
    <div class="postbody"><span class="postbody">This is totally doable, but I can't say that I've seen a tutorial on it anywhere.
<br/>
<br/>
Here's some pseudocode... The idea is to produce your monster map as a single array, then copy in just the tiles you need onto a 256x256 background. (That's all you need to cover the whole screen.) Copying the entire set of tiles instead of just the "edge" tiles is much simpler.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void UpdateMap(u16* myHugeMap,int myHugeMapTileWidth,int originX,int originY) {
<br/>
<br/>
  // counter
<br/>
  int row;
<br/>
<br/>
  // you only need 21 rows to cover your GBA screen (21*8 &gt; 160) 
<br/>
  for(row = 0; row &lt; 21; row++) {
<br/>
      
<br/>
    // copy a 32-tile-wide stripe of tiles into the current row
<br/>
    // to cover the width of the screen (32 * 8 &gt; 240)
<br/>
    REG_DMA3SAD = &amp;myHugeMap[originX + ((row + originY) * myHugeMapTileWidth)];
<br/>
    
<br/>
    // copy it into whichever BG you're using (1 in this example)
<br/>
    REG_DMA3DAD = &amp;bg1Pointer[y * 32];
<br/>
    
<br/>
    // start DMA xfer
<br/>
    REG_DMA3CNT = 32 | DMA_16NOW;
<br/>
<br/>
  }
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The originX,originY in this approach is the x,y offset in TILES, not pixels, but by combining the above with some background scrolling on the pixel level, you can make seamless scrolling over an arbitrarily large map.
<br/>
<br/>
Hope my gibberish makes sense. :) 
<br/>
<br/>
The harder part is probably finding a map editor that handles huge maps. I can't help you there.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17891 - Justin2097 - Tue Mar 16, 2004 6:24 pm</h4>
    <div class="postbody"><span class="postbody">I'm not sure this is entirely what i meant. though it does spread some light.
<br/>
<br/>
What i want to achieve is a background that doesn't have to be created using a map editor (Because neither the programs or the GBA can handle maps of this size). 
<br/>
<br/>
I want to be able to use my bmp with the tiles in, as a tile set. I'm not sure how to achieve this firstly, do you have to create a different file or can you just copy 32px*32px sections from the bmp onto the GBA screen.
<br/>
<br/>
Then i want to create a dynamic tile array (for the whole map), each contains reference to a tile in the bmp. Using this array i want to display a certain section of the whole map, say the center 35 tiles (7*5).
<br/>
<br/>
Then, when a certain direction is pressed, the map moves across. When it does this, the tiles that move off screen, are swapped for the next corresponding tile in the array, and is position of the other side of the screen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17894 - Nessie - Tue Mar 16, 2004 8:34 pm</h4>
    <div class="postbody"><span class="postbody">That's not entirely true, there are map editors out there that will allow you to create a map of any size, regardless of whether it's a GBA hardware compatible size.  Additionally, there is at least one map editor that will dead-strip any duplicated tiles and reduce it to the smallest possible set.
<br/>
<br/>
Most GBA games on the market with large areas have to implement the method that Scott described above.
<br/>
<br/>
I dunno, if you only have 180 unique (8 pixel x 8 pixel) tiles, writing any amount of code to handle your case of 3160 non-unique tiles loaded into vram at once seems like a waste of effort?
<br/>
<br/>
Not trying to be critical, just trying to understand the situation. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17903 - tepples - Tue Mar 16, 2004 10:53 pm</h4>
    <div class="postbody"><span class="postbody">You have 180 unique 32x32 pixel tiles. This translates into 2880 unique 8x8 pixel tiles. If you can make these 180 large tiles from 1024 or fewer small tiles (including horizontal or vertical reflection), you can use the "metatile" algorithm, which has been used since the NES. In the metatile algorithm, each large tile is defined as a rectangle of numbers of small tiles, in this case 4 tiles across and 4 tiles down. To learn about metatiles, read <a class="postlink" href="http://retards.org/library/technology/computers/programming/gbdev/docs/gbdev_faq.html#Metatiles" target="_blank">this</a>.
<br/>
<br/>
To update a single space (x, y) of that map's display:<ol type="1"><li>Look at the map at location (x/4, y/4). This will give you what tile number is there.</li><li>Look at the metatile data at (x mod 4, y mod 4, tileno). This will give you what hardware tile to draw.</li><li>Draw this hardware tile at (x mod 32, y mod 32) in the map display.</li></ol>
<br/>
To update the map each frame:<ol type="1"><li>Scroll in X.</li><li>Update any newly uncovered display spaces.</li><li>Scroll in Y.</li><li>Update any newly uncovered display spaces.</li></ol><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17909 - Miked0801 - Wed Mar 17, 2004 2:12 am</h4>
    <div class="postbody"><span class="postbody">Scroll modules are one of the rights of passage on any piece of hardware.  If you get this working, you can hold your head high and say that you understand the BG graphics system of the GBA well.  Start with a full screen re-draw type scroller.  It's slower, but much easier to code.  Every time you detect that a new char/tile/meta title has entered the screen (note: in 256x256 mode, the biggest tile you'll be able to use is 2x2 due to contraints in X.  Consider using 512x256 mode if you want to make your life easier at first.) redraw the with the current visible tiles.  Enjoy.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17913 - tepples - Wed Mar 17, 2004 5:24 am</h4>
    <div class="postbody"><span class="postbody">The NES had a 248-pixel-wide display (<span style="font-style: italic">no</span> room for updating multiple tiles at once) and very little CPU-&gt;VRAM bandwidth (<span style="font-style: italic">no</span> time to update multiple tiles at once), and games managed to use large metatiles. Just make sure that you update only one HW map column or row at once; yes, this means you'll have partial metatiles on the seam.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
