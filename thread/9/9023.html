<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Circular windows - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Graphics > Circular windows</h2>
<div id="posts">
<div class="post">
    <h4>#76868 - gauauu - Sat Mar 25, 2006 4:58 pm</h4>
    <div class="postbody"><span class="postbody">I was looking at the Simonchu 2 game on the 2004mbit compo cart, and was curious about the circular windowing the author used for transitions.
<br/>
<br/>
Looking carefully at the effect in vba, it appears that he only uses the win0 window.  
<br/>
<br/>
So is he using an hblank interrupt to change it every scanline, or is there some other trick with win0 to get circular windowing?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#76869 - tepples - Sat Mar 25, 2006 5:24 pm</h4>
    <div class="postbody"><span class="postbody">Your first instinct was half right. Super Mario World (Super NES and GBA) during key effect, Yoshi's Island (Super NES and GBA) during boss explosion effect, and Simonchu 2 (GBA) probably use hblank triggered DMA (not an interrupt) to rewrite the left and right extents of the window on each scanline.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#76887 - Miked0801 - Sat Mar 25, 2006 9:33 pm</h4>
    <div class="postbody"><span class="postbody">You can also use a sprite as a window template as well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#76920 - gauauu - Sun Mar 26, 2006 7:45 am</h4>
    <div class="postbody"><span class="postbody">Cool, thanks.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You can also use a sprite as a window template as well.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's actually the solution I've been using in my game.  It works great when small, but doesn't do quite as nicely for when the circle gets really big.   Scaled sprites pixellate too much, if you don't scale it, then you need to use bunches and bunches of sprites to get the effect.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#76932 - keldon - Sun Mar 26, 2006 12:50 pm</h4>
    <div class="postbody"><span class="postbody">You can use both a background layer and sprites.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#76937 - Cearn - Sun Mar 26, 2006 2:28 pm</h4>
    <div class="postbody"><span class="postbody">Meh, why not ... 
<br/>
<br/>
A simple demo for a variable size and position windowed circle, using HDMA. You need a 160 entry array to store the horizontal spans of the window in, to be copied to REG_WIN0H by HDMA. win_circle() sets up the array, with all the required boundary checks, using a modified Breshenham circle routine.
<br/>
x0, y0, rr are the coordinates and radius of the circle; Move with D-pad, and resize the circle with A and B. The HDMA is set for single u16 repeating copy with a fixed destination (REG_WIN0H). Note that I'm starting the source at winh[1] and not winh[0], because the HBlank follows a scanline. The first scanline's window is set manually. 
<br/>
<br/>
It might be required to disable the HDMA at VBlank, but it seems to run fine if you don't so I'm not exactly sure.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 g_winh[160];
<br/>
<br/>
void win_circle(int x0, int y0, int rr, u16 winh[])
<br/>
{
<br/>
   int x=0, y= rr, d= 1-rr;
<br/>
   u32 tmp;
<br/>
<br/>
   // clear the whole array first.
<br/>
   memset16(winh, 0, 160);
<br/>
<br/>
   while(y &gt;= x)
<br/>
   {
<br/>
      // side octs
<br/>
      tmp= 240;
<br/>
      if(x0+y&lt;240)
<br/>
         tmp= x0+y;
<br/>
      if(x0&gt;y)
<br/>
         tmp |= (x0-y)&lt;&lt;8;
<br/>
      
<br/>
      if(y0&gt;=x)      // o4, o7
<br/>
         winh[y0-x]= tmp;
<br/>
      if(y0+x&lt;160)   // o0, o3
<br/>
         winh[y0+x]= tmp;
<br/>
<br/>
      if(d&lt;0)
<br/>
      {
<br/>
         d += 2*x+3;
<br/>
      }
<br/>
      else   // change in y: top/bottom octs
<br/>
      {
<br/>
         tmp= 240;
<br/>
         if(x0+x&lt;240)
<br/>
            tmp= x0+x;
<br/>
         if(x0&gt;x)
<br/>
            tmp |= (x0-x)&lt;&lt;8;
<br/>
         
<br/>
         if(y0&gt;=y)      // o5, o6
<br/>
            winh[y0-y]= tmp;
<br/>
         if(y0+y&lt;160)   // o1, o2
<br/>
            winh[y0+y]= tmp;
<br/>
<br/>
         d += 2*(x- --y)+3;
<br/>
      }
<br/>
      x++;
<br/>
   }
<br/>
}
<br/>
<br/>
void test_circle()
<br/>
{
<br/>
   int rr=40, x0=120, y0=80;
<br/>
<br/>
   m3_fill(CLR_YELLOW);   // full yellow background
<br/>
<br/>
   // register inits
<br/>
   REG_DISPCNT= DCNT_MODE3 | DCNT_BG2_ON | DCNT_WIN0_ON;
<br/>
   REG_WININ= 0x3F;   // all layers in win 0
<br/>
   REG_WIN0H= 240;
<br/>
   REG_WIN0V= 160;
<br/>
<br/>
   while(1)
<br/>
   {
<br/>
      vid_vsync();
<br/>
      key_poll();
<br/>
<br/>
      rr += key_tri_fire();   // size with B/A
<br/>
      x0 += key_tri_horz();   // move left/right
<br/>
      y0 += key_tri_vert();   // move up/down
<br/>
<br/>
      if(rr&lt;0)
<br/>
         rr= 0;
<br/>
<br/>
      // fill circle array
<br/>
      win_circle(x0, y0, rr, g_winh);
<br/>
   
<br/>
      // init win-circle HDMA
<br/>
      DMA_TRANSFER(&amp;REG_WIN0H, &amp;g_winh[1], 1, 3, 
<br/>
         DMA_ON | DMA_REPEAT | DMA_AT_HBLANK | DMA_DST_FIX);
<br/>
      // set first scanline manually
<br/>
      REG_WIN0H= g_winh[0];
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#76977 - gauauu - Mon Mar 27, 2006 2:11 am</h4>
    <div class="postbody"><span class="postbody">wow, very cool.  Thanks, Cearn.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
