<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Need Help With Fixed Point Affine Texture Mapping - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Graphics > Need Help With Fixed Point Affine Texture Mapping</h2>
<div id="posts">
<div class="post">
    <h4>#65493 - keldon - Tue Jan 03, 2006 5:48 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://klo.dkauk.com/tmp/fixedTexturing.jpg">[Images not permitted - Click here to view it]</a>
<br/>
The image shows an issue I am getting with my fixed point texture mapping algo. It displays fine using floating points and all I have really done is replaced the floats with fixed point numbers.
<br/>
<br/>
The red line and the 3 coloured dots were added for reference points. The cyan dots represents the 2 3-point polygons used to render the square. The yellow dot is just a marker for where I am getting incorrect results.
<br/>
<br/>
The same horizontal delta is used across the each 3 point polygon. It appears that the fixed point delta in this case is a little lower than it should be due to precision.
<br/>
<br/>
I am currently using 16:16 fixed point for su deltas despite the fact that su is in the range of 0 to 1. Could the be the very reason? If so then should I  use 1:31 fixed point for su deltas? And how would I go about multiplying 2 fixed point numbers with different points?
<br/>
<br/>
My fixed point conversion methods:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">inline int ftoi ( float f ){
<br/>
   return (int)((float)(1 &lt;&lt; 16) * f);
<br/>
}
<br/>
<br/>
inline int itoi ( int i ){
<br/>
   return i &lt;&lt; 16;
<br/>
}
<br/>
<br/>
inline int fpmul ( int a, int b ){
<br/>
   return (int)(((long long)a * (long long)b) &gt;&gt; 16);
<br/>
}
<br/>
<br/>
inline int rdiv ( int b ) {
<br/>
   return ((1 &lt;&lt; 31) /b)&lt;&lt; 1;
<br/>
}
<br/>
<br/>
inline int fpdiv ( int a, int b ) {
<br/>
    return (int) (((long long)a &lt;&lt; 16) / (long long)b);
<br/>
}
<br/>
<br/>
<br/>
inline float itof ( int i ) {
<br/>
   return (float)i / (float)(1 &lt;&lt;16);
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65494 - keldon - Tue Jan 03, 2006 5:54 pm</h4>
    <div class="postbody"><span class="postbody">I am thinking that maybe I could create a typedef type for 1:31 and 16:16 and overload those fixed point number methods to be able to have say:
<br/>
<br/>
inline int fpdiv ( fp31 a, fp16 b );</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65503 - kusma - Tue Jan 03, 2006 6:49 pm</h4>
    <div class="postbody"><span class="postbody">it looks like you change dudx and dvdx (the horisontal u and v deltas) in the middle of your polygon. why? they stay stay constant for the entire polygon...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65505 - keldon - Tue Jan 03, 2006 7:08 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://klo.dkauk.com/tmp/ipolygon.cpp" target="_blank">integer polygon code</a>
<br/>
<br/>
It does use a constant delta. But what I now think is happening is that I am starting off with different uv coordinates by the time I reach the left cyan dot in the polygon for the bottom.
<br/>
<br/>
The poly routine works by drawing the lines of the polygon whilst marking the su on the left side of the polygon at each line. What I think is happening here is that in the loop <span style="font-weight: bold">for ( int i = 0; i &lt; npoints -1; i ++ ) {</span> where I am setting the left uv of each line; I think I am completely losing accuracy.
<br/>
<br/>
Then in a second loop it takes the left su and applies the delta to it. I am positive it is just down to the accuracy lost after when drawing the lines.
<br/>
<br/>
Also to note, dx are actually 16:16 fixed point.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
