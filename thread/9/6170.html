<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Text System - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Graphics > Text System</h2>
<div id="posts">
<div class="post">
    <h4>#46669 - ProblemBaby - Tue Jun 28, 2005 10:38 pm</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
<br/>
Ive tried to code a Text System I want it to be like Zelda - Minish Cap.
<br/>
Every character has its own width, not forced to 8.
<br/>
My idea is to put all characters in a image and have a map were all tiles are uniqe and then read and draw every pixel seperatly.
<br/>
This is damn slow!
<br/>
About 80% for one row=)
<br/>
<br/>
Do you have any ideas to do this in a faster way?!
<br/>
Thanks in advance</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46671 - strager - Tue Jun 28, 2005 10:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">My idea is to put all characters in a image and have a map were all tiles are uniqe and then read and draw every pixel seperatly.
<br/>
This is damn slow!
<br/>
About 80% for one row=)</td> </tr></table><span class="postbody">
<br/>
<br/>
I've done this method, and it works fine.  If you could, paste the code that you're using.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46674 - ProblemBaby - Tue Jun 28, 2005 11:17 pm</h4>
    <div class="postbody"><span class="postbody">Well it isnt hardly optimized, probably its a lot that can speed it up:
<br/>
<br/>
The actual Pixel Plotting function
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void SetPixel(u32 x, u32 y)
<br/>
{
<br/>
   u16 Data;
<br/>
   u32 TileOffset, PixelOffset;
<br/>
   u32 xTile, yTile;
<br/>
   xTile = x &gt;&gt; 3;
<br/>
   yTile = y &gt;&gt; 3;
<br/>
   x &amp;= 0x7;
<br/>
   y &amp;= 0x7;   
<br/>
   TileOffset = yTile * 30 + xTile;
<br/>
   PixelOffset = y * 2 + (x &gt;&gt; 2);
<br/>
<br/>
   Data = BACKGROUND_DATAMEM[0x4000 + (TileOffset*0x10) + PixelOffset];
<br/>
<br/>
   Data |= 1 &lt;&lt; ((x&amp;0x3) * 4);
<br/>
<br/>
   BACKGROUND_DATAMEM[0x4000 + (TileOffset*0x10) + PixelOffset] = Data;
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
And here is the DrawChar function:
<br/>
c = character
<br/>
x, y = destination pos
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
u32 a, b;
<br/>
<br/>
u32 RowLength = 256;
<br/>
u32 SourceOffset;
<br/>
SourceOffset = c * 2;
<br/>
<br/>
for (b = 0; b &lt; 16; b++)
<br/>
{
<br/>
   for (a = 0; a &lt; 2; a++)
<br/>
   {
<br/>
      if (g_gfxFont_[SourceOffset + b * RowLength + a] &amp; 0xF)
<br/>
         Print_SetPixel(x+a*4, y+b);
<br/>
      if (g_gfxFont_[SourceOffset + b * RowLength + a] &amp; 0xF0)
<br/>
         Print_SetPixel(x+a*4+1, y+b);
<br/>
      if (g_gfxFont_[SourceOffset + b * RowLength + a] &amp; 0xF00)
<br/>
         Print_SetPixel(x+a*4+2, y+b);
<br/>
      if (g_gfxFont_[SourceOffset + b * RowLength + a] &amp; 0xF000)
<br/>
         Print_SetPixel(x+a*4+3, y+b);
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46676 - sajiimori - Tue Jun 28, 2005 11:27 pm</h4>
    <div class="postbody"><span class="postbody">To make this fast, you need pointer math.  Here's a thread from a long time ago that might be helpful:
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=2305" target="_blank">http://forum.gbadev.org/viewtopic.php?t=2305</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46679 - ProblemBaby - Wed Jun 29, 2005 1:13 am</h4>
    <div class="postbody"><span class="postbody">Well the only place I see where I can use it is in the PutChar-function
<br/>
I got some improvement. 
<br/>
But it must be better ways to draw pixels, right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46681 - sajiimori - Wed Jun 29, 2005 1:26 am</h4>
    <div class="postbody"><span class="postbody">Yeah, you should use a pointer to iterate through VRAM addresses rather than recalculating them from scratch for every pixel.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46713 - ProblemBaby - Wed Jun 29, 2005 9:59 am</h4>
    <div class="postbody"><span class="postbody">Well I think its hard because you never know in which tile you should draw.
<br/>
<br/>
Is this really the best method?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46722 - poslundc - Wed Jun 29, 2005 4:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">Is this really the best method?</td> </tr></table><span class="postbody">
<br/>
<br/>
It's one of only two methods that'll let you use other BG layers. The other is to use sprites and to multiplex them with an HBlank interrupt. But most games opt to do it with a BG, since the resources are more plentiful.
<br/>
<br/>
Here is <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=1764" target="_blank">another thread</a> that discusses some strategies for painting BG chars. There is no easy solution to the problem, unfortunately.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46744 - ProblemBaby - Wed Jun 29, 2005 11:54 pm</h4>
    <div class="postbody"><span class="postbody">I really want to use BG's
<br/>
Ive started to rewrite in ASM now. I write one character in ~0,13%
<br/>
and I think that is quite good. I'll see if I can do some more omptimizations. my Goal is about ~0,06 per character.
<br/>
But Probably it wont be that fast.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46791 - Miked0801 - Thu Jun 30, 2005 6:30 pm</h4>
    <div class="postbody"><span class="postbody">Question - why does your text rendering system need to be so fast?  Text is usually rendered while the screen is transitioning so you don't notice small spped hits - and if you're re-drawing a menu, it's ok to see a tic of blank screen.  Just seems you're optimizing something that really doesn't need it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46799 - ProblemBaby - Thu Jun 30, 2005 9:24 pm</h4>
    <div class="postbody"><span class="postbody">The most important thing is the music.
<br/>
I want to be able to write while music plays.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47115 - Mucca - Tue Jul 05, 2005 10:40 am</h4>
    <div class="postbody"><span class="postbody">You could process music in an interrupt. DMA then becomes a worry however. Or Im sure with some fancy ASM you could set up a text rendering "thread" that is serviced when time is available, and halts in a stable state when required.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47141 - Miked0801 - Tue Jul 05, 2005 7:17 pm</h4>
    <div class="postbody"><span class="postbody">Yes, music should be handled on an interrupt level.  If that isn't possible, then only render out a few lines at a time or check the LY counter against a threshold and pause in the middle.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
