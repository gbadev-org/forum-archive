<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>128 sprites on a line - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Graphics > 128 sprites on a line</h2>
<div id="posts">
<div class="post">
    <h4>#58756 - mice - Tue Oct 25, 2005 8:43 pm</h4>
    <div class="postbody"><span class="postbody">Sorry to bother you all, but exactly what happens when you line up all of the sprites on a single row? Glitches of some kind, I'd guess. But what type of glitches?
<br/>
Is the background affected by this or?
<br/>
<br/>
I'm not in the position to test this, seeing that I don't have a GBA.
<br/>
<br/>
Thanks!
<br/>
((mice</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58759 - poslundc - Tue Oct 25, 2005 9:18 pm</h4>
    <div class="postbody"><span class="postbody">The GBA can process up to 1,210 pixels per scanline (954 if you have the bit enabled that lets you modify OAM during HBlank). Transparent pixels still count towards this, and the pixels of rotation/scaling-enabled sprites consume more than three times the pixels that normal ones do.
<br/>
<br/>
Objects are processed in the order they appear in OAM, so entry 0 gets processed before entry 1, etc.
<br/>
<br/>
If you run out of pixels on a scanline, the remaining pixels for the remaining OAMs are dropped.
<br/>
<br/>
<a href="http://www.work.de/nocash/gbatek.htm#lcdobjoverview" target="_blank">http://www.work.de/nocash/gbatek.htm#lcdobjoverview</a>
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58761 - mice - Tue Oct 25, 2005 9:33 pm</h4>
    <div class="postbody"><span class="postbody">Thanks!
<br/>
<br/>
So only the remaining sprites are dropped, nothing of the background, right?
<br/>
The reason I'm asking is that I'm creating a small console of my own. And I write the sprites first and the bkg afterwards. Which means if I line up enough sprites on a line, the bkg will be affected as well.
<br/>
And that's pretty stupid. I've got to rethink this a bit.
<br/>
<br/>
Thanks again!
<br/>
((mice</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58786 - poslundc - Wed Oct 26, 2005 12:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mice wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks!
<br/>
<br/>
So only the remaining sprites are dropped, nothing of the background, right?</td> </tr></table><span class="postbody">
<br/>
<br/>
Right.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The reason I'm asking is that I'm creating a small console of my own. And I write the sprites first and the bkg afterwards. Which means if I line up enough sprites on a line, the bkg will be affected as well.
<br/>
And that's pretty stupid. I've got to rethink this a bit.</td> </tr></table><span class="postbody">
<br/>
<br/>
You might want to download the source code for Visual Boy Advance (or SNES9X, since the SNES is a comparable machine anyway) and see if it does anything to inspire your design.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58792 - tepples - Wed Oct 26, 2005 1:49 am</h4>
    <div class="postbody"><span class="postbody">During the "draw" portion of each scanline, the NES scans the 64-entry OAM (sprite display list) to see which sprites of the <span style="font-style: italic">next</span> scanline are "in range". If more than 8 sprites are in range, it stops the search. Then it fetches the appropriate sprite video patterns (tile data) during horizontal blanking. The Game Boy works roughly the same way.
<br/>
<br/>
The Super NES and GBA, on the other hand, seem to scan OAM and read patterns during draw time. (The GBA can be set to do so in hblank as well, giving even more ridiculously many sprite pixels per line.)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58833 - mice - Wed Oct 26, 2005 4:43 pm</h4>
    <div class="postbody"><span class="postbody">Really appreciate all of your answers!
<br/>
I'll DL the source and have a peek.
<br/>
<br/>
Thanks!
<br/>
((mice</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58895 - Joat - Thu Oct 27, 2005 12:30 am</h4>
    <div class="postbody"><span class="postbody">Most 2D consoles have seperate memory and circuits for the sprites, or seperate times to read them in.  On the NES, it only had to read a maximum of 8 patterns (since that's how many sprite record structs it had), and so it had a deterministic time during each scanline to do so, where it wouldn't interfere with the background search.
<br/>
<br/>
The GBA has seperate VRAM for sprites than backgrounds, and although I'm not exactly sure how it's sprite rendering works (I can't seem to design it in my head without a pair of scanline buffers, one that gets priority composited and cleared as a scanline is being drawn, and another that is getting filled for use on the next scanline), it's certainly doing both the background and sprites at the same time, so running out of time on sprites will not affect the background.
<br/>
<br/>
Anyhoo, for anyone who cares, I haven't figured out why the rot/scale sprites take 10 cycles of setup instead of just 4 (for the matrix reads), but the reason they take 2x to write is simple, sprite tile vram is on a 16 bit bus, so you get two pixels every cycle for normal sprites (or four for 4-bit mode, but that doesn't seem to be taken advantage of), but the random accesses of rot/scale sprites drop you down to one useful pixel per read.
<br/>
<br/>
Hmm, actually, it probably takes 10 because it has to compute the current sprite texture position, two multiplies, but why that couldn't be pipelined away, I dunno.  Anyhow, the scanline buffers would explain the quirky alpha blending behavior (since the sprites get rendered on top of each other first, with no blending, and then only get blended as they're actually displayed against the background).<br/>_________________<br/>Joat
<br/>
<a href="http://www.bottledlight.com" target="_blank">http://www.bottledlight.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58896 - Joat - Thu Oct 27, 2005 12:35 am</h4>
    <div class="postbody"><span class="postbody">Also, if you're desiging console hardware (on a FPGA or whatever, I presume), please feel free to drop by the IRC channel #hwdev on EFNet.  Several of us have done some FPGA graphics / console stuff, or at least think about it.<br/>_________________<br/>Joat
<br/>
<a href="http://www.bottledlight.com" target="_blank">http://www.bottledlight.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58987 - keldon - Thu Oct 27, 2005 9:31 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://nessie.emubase.de/" target="_blank">http://nessie.emubase.de/</a>
<br/>
<br/>
the NES emulator nessie also features full assembler source code for its nes emulator - so you can have a real nice look at how its hardware is implemented using low level instructions
<br/>
<br/>
the <a class="postlink" href="http://betov.free.fr/SpAsm.html" target="_blank">rosasm</a> assembler IDE is required to view NESSIE's asm source</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59036 - mice - Fri Oct 28, 2005 9:14 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The GBA has seperate VRAM for sprites than backgrounds,...
<br/>
</td> </tr></table><span class="postbody">
<br/>
That would mean you have the complete scanline to do the sprites and equal amount of time to do the background. Would be optimal.
<br/>
Unfortunately I don't have that luxury.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
...and although I'm not exactly sure how it's sprite rendering works (I can't seem to design it in my head without a pair of scanline buffers, one that gets priority composited and cleared as a scanline is being drawn, and another that is getting filled for use on the next scanline), it's certainly doing both the background and sprites at the same time, so running out of time on sprites will not affect the background. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
I've got two buffers for the actual pixel-info as well, for even and uneven lines. And a third buffer (one 256bit-register) holding the 'alpha' info. (The screen is 256x224).
<br/>
Before reading pixel-data from memory this alpha-buffer is read to see if there is already a pixel written to that particular position, if so it moves on to the next pixel. Saves memory accesses.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Also, if you're desiging console hardware (on a FPGA or whatever, I presume), please feel free to drop by the IRC channel #hwdev on EFNet. Several of us have done some FPGA graphics / console stuff, or at least think about it.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Yep, it's on a fpga. Will most certainly check out the channel. Thanks!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
