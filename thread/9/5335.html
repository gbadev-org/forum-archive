<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>animation troubles - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Graphics > animation troubles</h2>
<div id="posts">
<div class="post">
    <h4>#38834 - Hacim - Fri Apr 01, 2005 4:57 am</h4>
    <div class="postbody"><span class="postbody">Hello I'm new here so if there is a post that already answers this please tell
<br/>
me.
<br/>
 Anyway,my problem is trying to load a image into the OAM with DMA to when I press 'right' it will load one sprite and when I press 'left' it will load another.But when i do that it for some reason over writes part of the memory  
<br/>
reserved for a different object.The first object is a 32x32 image and I have the second sprite attribute2 looks like this 'attribute2=544;' is this wrong? It works fine if the attribute2 is set to 'attribute2=576;'. 
<br/>
anybody know?
<br/>
<br/>
thanks. -Hacim</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#38840 - FluBBa - Fri Apr 01, 2005 9:13 am</h4>
    <div class="postbody"><span class="postbody">You shouldn't load images to the Object<span style="text-decoration: underline">Attribute</span>Memory, you should load them to the VRAM for objects (0x06010000).
<br/>
Post some code for us to see.<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#38869 - Hacim - Fri Apr 01, 2005 4:17 pm</h4>
    <div class="postbody"><span class="postbody">I guess I didn't make that very clear.Here's the code I use for changing the sprite: </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (face!='r')DMAFastCopy((void*)spriteData,(u16*)0x06014000, 512, DMA_32NOW);</td> </tr></table><span class="postbody">
<br/>
<br/>
and this is what the second object's atributtes look like right now:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sprites[1].attribute0=COLOR_256|SQUARE|100;
<br/>
    sprites[1].attribute1=SIZE_16|50;
<br/>
    sprites[1].attribute2=576;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and the area of memory that the second sprite data is stored is 0x06014800.
<br/>
Maybe that will help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#38884 - FluBBa - Fri Apr 01, 2005 5:00 pm</h4>
    <div class="postbody"><span class="postbody">Check in VBA's tileviewer to make sure you get what you expect there, then just click on the tile and you'll see it's number...<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39082 - Cearn - Mon Apr 04, 2005 10:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Hacim wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if (face!='r')DMAFastCopy((void*)spriteData,(u16*)0x06014000, 512, DMA_32NOW);
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
512 words clears 512/8 = 64 tiles, i.e. 512 to 575. Try 256.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40664 - sgeos - Thu Apr 21, 2005 10:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Hacim wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if (face!='r')DMAFastCopy((void*)spriteData,(u16*)0x06014000, 512, DMA_32NOW);
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
512 words clears 512/8 = 64 tiles, i.e. 512 to 575. Try 256.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
You should figure out a way to replace that 512 with a sizeof() operation if at all possible.  Failing that, a macro will do.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40670 - Cearn - Thu Apr 21, 2005 11:51 am</h4>
    <div class="postbody"><span class="postbody">But a sizeof() might not work properly. You would need to include the file with the data into the file with the code (which you shouldn't) in order for sizeof() to be able to guess the proper size, or use something like "extern u16 spriteData[512]", for which you need to know the size anyway. If your data files are compiled separately and you're make them visible to the code by declaring pointers to them, you'll get the size of the pointers, not of the array itself.
<br/>
<br/>
But regardless of that, the exporter should have a define or constant that shows how big the data is: spriteDataLen, SPRITE_SIZE or something similar.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40768 - sgeos - Fri Apr 22, 2005 10:31 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">But a sizeof() might not work properly.</td> </tr></table><span class="postbody">
<br/>
sizeof() works properly if you call it on the right "thing".
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">You would need to include the file with the data into the file with the code (which you shouldn't) in order for sizeof() to be able to guess the proper size, or use something like "extern u16 spriteData[512]", for which you need to know the size anyway.</td> </tr></table><span class="postbody">
<br/>
My point is that magic numbers are bad.  I prefer sizeof() over #define because manually tweaking the data will not break the code. You could do something like this:
<br/>
<br/>
data.h
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern const type_t data[];
<br/>
extern const type_t int DATA_SIZE;
<br/>
extern const type_t int DATA_MEMBERS;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
data.c
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const type_t data[] =
<br/>
{
<br/>
};
<br/>
<br/>
const int DATA_SIZE = sizeof(data);                     /* size of data (in bytes) */
<br/>
const int DATA_MEMBERS = sizeof(data) / sizeof(type_t); /* members in array */
<br/>
</td> </tr></table><span class="postbody">
<br/>
DATA_SIZE and DATA_MEMBERS look like macros, and behave like macros, but are assigned using sizeof().
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">If your data files are compiled separately and you're make them visible to the code by declaring pointers to them, you'll get the size of the pointers, not of the array itself.</td> </tr></table><span class="postbody">
<br/>
Thats a case where a direct sizeof is not possible.  Attempting to use sizeof(ptr_to_data) would be an error on the part of the programmer.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">But regardless of that, the exporter should have a define or constant that shows how big the data is: spriteDataLen, SPRITE_SIZE or something similar.</td> </tr></table><span class="postbody">
<br/>
I agree.  This is always possible.  If you always generate your "data" with an exporter, a #define works just fine.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40789 - tepples - Fri Apr 22, 2005 5:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern const char data[];
<br/>
<br/>
size_t sz(void)
<br/>
{
<br/>
  return sizeof(data);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Wouldn't this make "error: can't take sizeof a variable with incomplete type", or does GCC allow link-time resolution of sizeof() as an extension to the C language?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41042 - sgeos - Sun Apr 24, 2005 2:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern const char data[];
<br/>
<br/>
size_t sz(void)
<br/>
{
<br/>
  return sizeof(data);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Wouldn't this make "error: can't take sizeof a variable with incomplete type", or does GCC allow link-time resolution of sizeof() as an extension to the C language?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I get the same error, but this compiles fine:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">typedef int type_t;
<br/>
<br/>
extern const type_t data[];
<br/>
extern const type_t DATA_SIZE;
<br/>
extern const type_t DATA_MEMBERS;
<br/>
<br/>
const type_t data[] =
<br/>
{
<br/>
        1,2,3
<br/>
};
<br/>
<br/>
const int DATA_SIZE = sizeof(data);
<br/>
const int DATA_MEMBERS = sizeof(data) / sizeof(type_t);
<br/>
</td> </tr></table><span class="postbody">
<br/>
make sizeoftest.o</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
