<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Is this font readable? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Graphics > Is this font readable?</h2>
<div id="posts">
<div class="post">
    <h4>#121319 - tepples - Sun Mar 11, 2007 2:59 pm</h4>
    <div class="postbody"><span class="postbody">I'm tired of remaking Tetris, and I want to try making something that uses a dialogue engine. (poslundc, are you still planning on releasing <a class="postlink" href="http://www.danposluns.com/gbadev/textutils.html" target="_blank">PFont</a>?) But I'm not a trained typographer, so please test my <a class="postlink" href="http://pinocchio.jk0.org/gbaforum/fontdraw.zip" target="_blank">font demo</a> to make sure it's readable.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121325 - sgeos - Sun Mar 11, 2007 4:30 pm</h4>
    <div class="postbody"><span class="postbody">Do you have a screenshot of the font?
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>  Why not use one of the bdf fonts on the net?
<br/>
<span style="font-weight: bold">EDIT:</span>  FWIW, I think a version of posprintf that can handle arbitrary wide character encoding formats and redefine escape/formatting characters would be fantastic.  Doing this myself is low on my priority list right now, but it would be nice.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121333 - tepples - Sun Mar 11, 2007 6:16 pm</h4>
    <div class="postbody"><span class="postbody">Do bdf/pcf fonts support anti-aliasing?
<br/>
<br/>
See <a class="postlink" href="http://pinocchio.jk0.org/gbaforum/fontdraw_01.png" target="_blank">VBA screenshot</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121336 - sgeos - Sun Mar 11, 2007 6:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Do bdf/pcf fonts support anti-aliasing?</td> </tr></table><span class="postbody">
<br/>
bdf is a 1 bit bitmapped font format.  Anti-aliasing is a software feature.  This question is like asking if plates support washing.  Yes, plates can be washed, but they don't provide any built in facilities for it.  (Yes, bdf fonts can be anti-aliased, but they don't provide any built in facilities for it.)
<br/>
<br/>
Poor man's anti-aliasing:
<br/>
Shift bitmap up one pixel, blit in midtone.  Shift right and blit.  Shift down and blit.  Shift left and blit.  (Midtone outline.)  Do not shift, blit in normal color.  You can preprocess/optimize as much of this as you want to.  (Masks and multiplies are an optimization.)
<br/>
<br/>
I say midtone because you may be using a dark font, or a light font.  You may even want to use black and white.  I actually like white text with a black outline.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">See <a class="postlink" href="http://pinocchio.jk0.org/gbaforum/fontdraw_01.png" target="_blank">VBA screenshot</a>.</td> </tr></table><span class="postbody">
<br/>
The lower case "t" needs to be fixed.  The quick brown fox sentence in both upper and lower case would be fantastic.  (Ignore mixed case.)
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121338 - Fatnickc - Sun Mar 11, 2007 6:55 pm</h4>
    <div class="postbody"><span class="postbody">I just tried it on my GBA, and have to agree with sgeos about the lower case t, as it is much more similar to the Japanese 'te' hiragana than the English 't'!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121339 - Sausage Boy - Sun Mar 11, 2007 6:58 pm</h4>
    <div class="postbody"><span class="postbody">I agree with sgeos, the lower case t is, while kinda cool, very confusing to read. I also personally prefer a straight ', but that's a matter of taste I suppose. The rest of the characters look absolutely wonderful.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121342 - tepples - Sun Mar 11, 2007 7:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Do bdf/pcf fonts support anti-aliasing?</td> </tr></table><span class="postbody">
<br/>
bdf is a 1 bit bitmapped font format.  Anti-aliasing is a software feature.</span></td> </tr></table><span class="postbody">
<br/>
In the case of bitmaps, it's also a feature of the data set. Sure, downsampling a 1-bit bitmap font into an alphascale font works, but if the 1-bit font isn't <a class="postlink" href="http://en.wikipedia.org/wiki/Font_hinting" target="_blank">hinted</a>, the result won't be the clearest.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">This question is like asking if plates support washing.</td> </tr></table><span class="postbody">
<br/>
Depends. A lot of families choose plates based on how well they stand up to a dishwasher. Likewise, I would choose fonts based on how well they stand up to downsampling.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The lower case "t" needs to be fixed.  The quick brown fox sentence in both upper and lower case would be fantastic.  (Ignore mixed case.)</td> </tr></table><span class="postbody">
<br/>
The t-shape in question is called the half-uncial t or insular t. It appears that this t-shape confuses more people than necessary, so I replaced it with the more familiar gothic t. (See <a class="postlink" href="http://medievalwriting.50megs.com/scripts/letters/historyt.htm" target="_blank">history of t</a>, and compare <a class="postlink" href="http://members.aol.com/writejapan/hiragana/te.htm" target="_blank">hiragana て (te)</a>.)
<br/>
<br/>
I have uploaded version 2 of gba and png.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121345 - sgeos - Sun Mar 11, 2007 8:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">This question is like asking if plates support washing.</td> </tr></table><span class="postbody">
<br/>
Depends. A lot of families choose plates based on how well they stand up to a dishwasher. Likewise, I would choose fonts based on how well they stand up to downsampling.</span></td> </tr></table><span class="postbody">
<br/>
Fair enough.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The t-shape in question is called the half-uncial t or insular t. It appears that this t-shape confuses more people than necessary, so I replaced it with the more familiar gothic t.</td> </tr></table><span class="postbody">
<br/>
Good plan.  Normal fonts (ie, not your title screen art) want to be easy to read, not creative.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I have uploaded version 2 of gba and png.</td> </tr></table><span class="postbody">
<br/>
Looks good, but I can't really comment on the lower ascii values without seeing them in action.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122031 - Ant6n - Fri Mar 16, 2007 4:35 pm</h4>
    <div class="postbody"><span class="postbody">what kind of requirements would a simple text output library have, anyway?
<br/>
i.e. what do people want?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122032 - sgeos - Fri Mar 16, 2007 4:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">what kind of requirements would a simple text output library have, anyway?
<br/>
i.e. what do people want?</td> </tr></table><span class="postbody">
<br/>
Simple?  ASCII.
<br/>
<br/>
Nice features- can handle things like unicode, shift JIS, etc.  Non-fixed width fonts are nice.  Automatic line breaks are nice for English and similar languages.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122062 - Ant6n - Fri Mar 16, 2007 8:25 pm</h4>
    <div class="postbody"><span class="postbody">so that would mean that one should be able to load a font in some simple format. the font should specify the characters (i.e. as bitmaps), together with their width (assuming they are variable width) and bpp, and which ones are special characters like '\n' or ' '.
<br/>
Would people use fonts of heights different than 8? or 16, or 32?
<br/>
<br/>
I was thinking that one could represent text boxes in single or multiple 4 bit sprites, Because most of the time, in games, text is displayed not on the whole screen. and if one does want full screen, then using a bg should do the job.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122063 - sgeos - Fri Mar 16, 2007 8:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">so that would mean that one should be able to load a font in some simple format.</td> </tr></table><span class="postbody">
<br/>
Correct.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">the font should specify the characters (i.e. as bitmaps), together with their width (assuming they are variable width) and bpp,</td> </tr></table><span class="postbody">
<br/>
Font: font height, font bitmap height, bpp, special character code points.
<br/>
Per Glyph: bitmap, width.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">and which ones are special characters like '\n' or ' '.</td> </tr></table><span class="postbody">
<br/>
You will need some way to hook code points to special characters.  Newline, formfeed, etc.
<br/>
<br/>
You might consider taking a user defined code point to font index funtion.  It could return negative values to indicate newline and friends.  (Naturally, they should be hidden behind macros like LIBPREFIX_NEWLINE.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">Would people use fonts of heights different than 8? or 16, or 32?</td> </tr></table><span class="postbody">
<br/>
Yes.  If I were you, I would have 2 values- bitmap height (8, 16, 32) and font height.  Bitmap height affects VRAM usage.  Glyphs should be positioned in the upper lefthand corner of the bitmap.  The next line starts (font_height + v_spacing) pixels down.  The next character starts (glyph_width + h_spacing) to the right.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I was thinking that one could represent text boxes in single or multiple 4 bit sprites,</td> </tr></table><span class="postbody">
<br/>
4 bit sprites?  Sprites are a fantastic way to display text.  They make character positioning easy.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Because most of the time, in games, text is displayed not on the whole screen. and if one does want full screen, then using a bg should do the job.</td> </tr></table><span class="postbody">
<br/>
You could recycle sprites.
<br/>
<br/>
Version 3 or so should probably support antialiasing and/or font outlines.  I would write the initial library with this in mind.
<br/>
<br/>
Version 5 or so might want to support dropping user defined sprites in the middle of the text.
<br/>
"Look for a person that looks like (face icon).
<br/>
He will give you (lamp icon)."
<br/>
A user defined function could be responsible for reporting these items (return LIBPREFIX_ICON(3)).  The user would have to figure out how to encode everything to make it work happily with the library.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122064 - tepples - Fri Mar 16, 2007 9:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">so that would mean that one should be able to load a font in some simple format. the font should specify the characters (i.e. as bitmaps), together with their width (assuming they are variable width) and bpp, and which ones are special characters like '\n' or ' '.
<br/>
Would people use fonts of heights different than 8? or 16, or 32?</td> </tr></table><span class="postbody">
<br/>
Yes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I was thinking that one could represent text boxes in single or multiple 4 bit sprites, Because most of the time, in games, text is displayed not on the whole screen.</td> </tr></table><span class="postbody">
<br/>
I made a text engine that used this method. Fonts not a power of 2 pixels in size were padded out.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and if one does want full screen, then using a bg should do the job.</td> </tr></table><span class="postbody">
<br/>
My text engine uses a background, as a lot of the time, there will be a character name, four lines of dialogue, and up to four responses. Currently, the default font in my engine has a total height of 12 pixels: 2 for diacritics, 2 for ascenders, 6 for x-height, and 2 for descenders. Then it's set on 14 pixel line height, which is easy because it uses column-major tile ordering, where each 8-pixel-wide column of tiles is a contiguous pixel map.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122073 - Ant6n - Fri Mar 16, 2007 9:46 pm</h4>
    <div class="postbody"><span class="postbody">How would one like to control text output (where its written). I.e. is it more useful to have something like 
<br/>
outputtext(surface,line,column,text)
<br/>
or 
<br/>
printtext(surface,text)
<br/>
in the latter case there would be a notion of a text cursur sitting somewhere - but then what exactly happens if the cursor reaches the end of the screen?
<br/>
how would one overwritte just a little segment? In the former case, it wouldnt be possible to use nonfixed width.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122092 - sgeos - Fri Mar 16, 2007 11:32 pm</h4>
    <div class="postbody"><span class="postbody">Basically everyone is using proportional fonts these days.  Even translated ROMs use proportional font systems.  I can't really see fixed width being all that useful for anyone who want to make production quality software.
<br/>
<br/>
I can see a few ways of doing things.
<br/>
<br/>
Text scrolls off the end of the screen unless the data contains newlines:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">setCursor(x, y);  // (x, y + vofs) after newline
<br/>
print(string);</td> </tr></table><span class="postbody">
<br/>
<br/>
Text autowraps.  User newlines might be needed to make things look prettier.  Data will scroll off of the end of the screen if it is too long.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">setCursor(x, y, w);  // as above with autowrap
<br/>
print(string);</td> </tr></table><span class="postbody">
<br/>
<br/>
Text autowraps and requires automatic keypress to advance.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">setCursor(x, y, w, h);  // as above with autowrap
<br/>
print(string);</td> </tr></table><span class="postbody">
<br/>
<br/>
Game related control codes include "wait for user input" and "delay output".  Delay may or may not want to be fancy.  One control code is probably enough if the delay time can be changed using a library function.  Delay can be used to do things like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Was that a joke?
<br/>
[delay].[delay].[delay].
<br/>
[delay]Oh, now I get it.</td> </tr></table><span class="postbody">
<br/>
Formfeed clears the screen.  It is very useful.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Only you can prevent forest fires.
<br/>
[userinput][formfeed]...wait...
<br/>
[userinput][formfeed]So can I![newline]
<br/>
Everyone can prevent forest fires!</td> </tr></table><span class="postbody">
<br/>
Formfeed probably wants to automatically call userinput.  I can't see using it without user input, but I can see requiring user input without clearing the screen:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">One[userinput], two[userinput], three[userinput]...[userinput][newline]
<br/>
I don't see four orbs.  What are you trying to pull?</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>  I would not have the library directly poll for user input.  The user program is perfectly capable of figuring out what user input is.  It can then call some sort of a gotUserInput() function.  I would probably include an isTextOnScreen() query function.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122104 - Ant6n - Sat Mar 17, 2007 1:26 am</h4>
    <div class="postbody"><span class="postbody">so you say it would make sense to create a bunch of control characters.
<br/>
But how can a cursor be set in a variable width context?
<br/>
and what happens if the cursor goes off the screen at the bottom?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122107 - Lick - Sat Mar 17, 2007 1:37 am</h4>
    <div class="postbody"><span class="postbody">The cursor can have a pixel position. [cursor.x += character.width;]
<br/>
If the text goes off the screen, don't draw it.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122109 - sgeos - Sat Mar 17, 2007 1:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">so you say it would make sense to create a bunch of control characters.</td> </tr></table><span class="postbody">
<br/>
Of course.  The display needs to handle display characters.  The user's text system will handle tags.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">It is &lt;dayofweek&gt; today.[newline]
<br/>
I like &lt;dayofweek&gt;s.[delay]  Do you like &lt;dayofweek&gt;s?</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">But how can a cursor be set in a variable width context?</td> </tr></table><span class="postbody">
<br/>
It operates on pixels, not cells.  Width, height, vspacing and hspacing are all calculated in pixels.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">and what happens if the cursor goes off the screen at the bottom?</td> </tr></table><span class="postbody">
<br/>
If you don't implent a vertical display region, undefined bahavior happens.  The system just tries to write off the bottom of the screen.  Nothing much happens if you drop sprites off the bottom of the screen.  At any rate, it is a bug and will need to be fixed before the program "ships".
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122120 - Ant6n - Sat Mar 17, 2007 2:37 am</h4>
    <div class="postbody"><span class="postbody">and how would text be deleted?
<br/>
the most general way to implement control characters if the engine lets you define control characters for '\n' and ' ', and others with a callback function, with different returns, i.e. string (insert date) or void (delay)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122141 - sgeos - Sat Mar 17, 2007 9:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">and how would text be deleted?</td> </tr></table><span class="postbody">
<br/>
Clearbuffer?  Formfeed?  I can't envision a scenario when half the text on the screen gets deleted.  I think a complete redraw would be OK.
<br/>
<br/>
I can see scrolling text, however- either rowlocked or free scrolling.  This should be supported.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">the most general way to implement control characters if the engine lets you define control characters for '\n' and ' ',</td> </tr></table><span class="postbody">
<br/>
Space is not really a control code.  It is a glyph with an empty bitmap and a narrow width.  Or are you talking about a line breakable space?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and others with a callback function, with different returns, i.e. string (insert date)</td> </tr></table><span class="postbody">
<br/>
You know, string is cute.  If the engine has a string insertion buffer and string control code, it would be very easy for the user callback function to implement things like date:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">return_t myCallback(param_t pId)
<br/>
{
<br/>
   // pointer to library string buffer
<br/>
   char *buffer = libGetBuffer();
<br/>
<br/>
   switch (pId)
<br/>
   {
<br/>
      case MY_DATE:
<br/>
         // this would work for ascii
<br/>
         sprintf(buffer, "%d-%d-%d", year, month, day);
<br/>
         return LIB_CODE_STRING;
<br/>
         break;
<br/>
      case MY_PLAYER_NAME:
<br/>
         // this would work for ascii
<br/>
         sprintf(buffer, "%s", myGetString(MY_PLAYER_NAME));
<br/>
         return LIB_CODE_STRING;
<br/>
         break;
<br/>
      ...
<br/>
      default:
<br/>
         return pId:
<br/>
      break;
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
I would not support any hard coded string insertion tags.  You don't know what the user will need, any they may be using something like a parial, packed unicode font.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">or void (delay)</td> </tr></table><span class="postbody">
<br/>
Control codes so far: newline, tab, formfeed, delay, userinput, string.  Bell?  Being able to change the bell sound and have it play whenever it hits the bell would cute.  Bell probably wants a callback function, because you don't know what the user sound system looks like.
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>  If you want to able to handle left to right, right to left, vertical text, etc, you'll need to keep track of the cursor base, line offset and character offsets.  After each line:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">line++;
<br/>
xCursor = xCursorBase + line * xLineOffset;
<br/>
yCursor = yCursorBase + line * yLineOffset;</td> </tr></table><span class="postbody">
<br/>
After each character:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">xCursor += glyph.xOffset;
<br/>
yCursor += glyph.yOffset;</td> </tr></table><span class="postbody">
<br/>
Clearly one of the values should always be zero.  By using different values, LTR, RTL, UTD, DTU fonts can be made.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122146 - DekuTree64 - Sat Mar 17, 2007 9:49 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">I can't envision a scenario when half the text on the screen gets deleted.  I think a complete redraw would be OK.</td> </tr></table><span class="postbody">
<br/>
Not in a conversation text box, but text systems are also heavily used in menus, and you do need to be able to update small areas like your remaining money for a shop, any text being entered by the user, etc.
<br/>
<br/>
One useful feature I have in my text render function is a "clear width" parameter. Basically it draws the string, and then clears any space after it, up to the clear width. With that, you generally don't have to explicitly clear anything. Just redraw the string and it will take care of the leftover garbage if the old string was longer.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122147 - Ant6n - Sat Mar 17, 2007 9:59 am</h4>
    <div class="postbody"><span class="postbody">i guess using some buffer is more useful than string return.
<br/>
does vertical text have variable width, height?
<br/>
<br/>
so far:
<br/>
text is written in text boxes. text boxes either live in bg or on sprites. in order to write text one has to specify a font. a 'font' specifies
<br/>
-font name (?)
<br/>
-the writing direction (or xOffset,yOffset - width and height are reversed in the following if writing direction vertical?)
<br/>
-the height of the characters
<br/>
-whether its fixed width
<br/>
-the width of characters
<br/>
-the height offsets
<br/>
-the palette for character bitmpas? (16 colors?)
<br/>
-the interval of allowed character indizes
<br/>
-the list of characters (maybe in implementation an array of offsets)
<br/>
<br/>
a 'character' with a given index specifies
<br/>
- the associated bitmap
<br/>
- bpp, index (or should this be global?)
<br/>
- the width
<br/>
- whether its a control character, specified together with options (or specifying that the options should be read like arguments following the control character in the text), which there could be the following
<br/>
-- word separater (i.e. space - simply to know where to break text for newline) - specifying when it gets printed
<br/>
-- new line
<br/>
-- 'delay' - with specified 'n' vblanks (?)
<br/>
-- scroll a character height (immediately/slow)
<br/>
-- delete screen ('form feed'?)
<br/>
-- callback/callback with string return to print
<br/>
-- simply functions of the text engine itself?
<br/>
-- tab -- why?
<br/>
-- userinput -- on gba? how?
<br/>
<br/>
its probably useful to have callbacks sit in some array, which has to get initialized during runtime. also, it would probably make sense to try to make callbacks safe so that the callback function itself can access the text engine (no?). would it be useful to be able to useful multiple fonts at once?
<br/>
functions
<br/>
initialize (options - autowrap..)
<br/>
create, delete text box
<br/>
set/move/get cursor position - in pixels
<br/>
set/move cursor position - in line,column
<br/>
print (returns width printed)
<br/>
clear (either a width in pixels, or some string)
<br/>
scroll (wole line, pixels, instant, slow)
<br/>
clear text box
<br/>
move text box
<br/>
hide/show box
<br/>
set palette (?)
<br/>
set callback
<br/>
<br/>
would one want to draw anything besides text?
<br/>
what about text color?
<br/>
would it make sense on such a limited system as the gba to assume that every possible font has a character set with 8 bit indizes?
<br/>
i guess that if the texbox lives in the same space as some other graphics (i.e. a sprite that specifies the background of an 'ok' dialog), then it should be possible to speciy a transparent background color blit.
<br/>
...gee, who would've thought something like this could be so complicated..    i smell feep</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122161 - sgeos - Sat Mar 17, 2007 2:34 pm</h4>
    <div class="postbody"><span class="postbody">I would try to keep the library itself as simple as possible, while leaving plug(s) so it can easily be extended by the user.  There are things your library should do and things it should not do.
<br/>
<br/>
Making messages is basically a four step process:
<br/>
Data creation (user hanldes this; text and fonts)
<br/>
Data conversion (user handles this; text and fonts, so they work with your library)
<br/>
Custom extensions (user handles this; helps the library do fancy game specific things)
<br/>
<span style="font-weight: bold">Putting glyphs on the screen</span> (your library does this)
<br/>
Anything else (not really related =)
<br/>
<br/>
You should not directly handle anything that doesn't involve putting glyphs on the screen.  A little about each step:
<br/>
<br/>
Data creation.  The programmer defines what the system will support, and then the person who writes the script writes it at a very high level, probably using tags for special display features.  You may end up with thousands of messages that look something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">MES_ID_HERE:
<br/>
// Register Input
<br/>
// r0 - NPC ID
<br/>
// r1 - number of items to be given
<br/>
// r2 - type of item to be given
<br/>
// r3 - sound effect linked to getting item
<br/>
//
<br/>
   [meta][face(r0)][name(r0)][voice(r0)][/meta]
<br/>
   [red][playername][/red]![sound(DRAMATIC)][delay] [icon(HEART)][delay]  I'm [name(r0)]![playerinput][newline]
<br/>
   [red]I[/red] really,[delay] REALLY,[delay] want to go with [red]you[/red]. [icon(HEART)][userinput][newline]
<br/>
   You have [big]no idea[/big] how much this means to me. [icon(HAPPYFACE)][delay][newline]
<br/>
   [bold]If you let my go with you,[/bold] [italic]I'll give you [green][caps][count(r1)][x_items(r2)][/caps][/green]![/italic][sound(r3)][userinput]
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Not all of the tags directly print something.  The metadata is not printed directly.  [count()] sets an internal variable that [x_items()] uses.  [caps] causes the callback to always return upper case glyph entries.  [bold] and [italic] change the font, etc.
<br/>
<br/>
Data conversion.  The messages and font(s) are precompiled.  The font is converted into a format your library is happy with.  All of the tags and tag functions are converted into code points.  Magic cookies may be inserted.  (A [voice] tag may automatically be inserted before every line, [bigline] may be inserted before lines that contain big text.)  The output is going to be a bunch of bytes if the user wants to do anything fancy.
<br/>
<br/>
I think a single callback function should be able to handle user extensions if the library has hooks to things like moveCursor().  Normal glyphs return a font index.  Control codes do something (change the font, color, etc) and the return NODISPLAY.  If the user want to implement caps, sound effects, register based input, etc, that is completely up to them.  Your library doesn't worry about it.
<br/>
<br/>
Your library only really worries about moving a cursor around and dropping glyphs on the screen.  It library should provide facilities for things like changing the font color, but in general it should be as simple as possible.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">i guess using some buffer is more useful than string return.</td> </tr></table><span class="postbody">
<br/>
I think you use both:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">return_t callback(param_t pId)
<br/>
{
<br/>
   if ( IS_ITEM(pId) )
<br/>
   {
<br/>
      libSetSubstringBuffer( getItemName(pId) );
<br/>
      return LIB_PRINT_SUBSTRING;
<br/>
   }
<br/>
   // ...
<br/>
}
<br/>
<br/>
void libCaller(param_t *pString)
<br/>
{
<br/>
   int i;
<br/>
<br/>
   for (i = 0; LIB_NULL != (index = callback(pString[i])); i++)
<br/>
   {
<br/>
      switch (index)
<br/>
      {
<br/>
         case LIB_PRINT_STRING:
<br/>
            printSubstring();
<br/>
            break;
<br/>
         default:
<br/>
            printGlyph(index);
<br/>
         break;
<br/>
      }
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">does vertical text have variable width, height?</td> </tr></table><span class="postbody">
<br/>
The font and each glyph should have some way to track both width and height.  A proportional vertial font will have a fixed width, but variable height.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">text is written in text boxes. text boxes either live in bg or on sprites. in order to write text one has to specify a font.</td> </tr></table><span class="postbody">
<br/>
Sounds good.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> a 'font' specifies
<br/>
-font name (?)</td> </tr></table><span class="postbody">
<br/>
Why?  A pointer to the header and glyph data should suffice.  The user can set up an id easily enough.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define MY_FONT &amp;something
<br/>
#define MY_FONT_BOLD  &amp;something_else</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-the writing direction (or xOffset,yOffset - width and height are reversed in the following if writing direction vertical?)</td> </tr></table><span class="postbody">
<br/>
The way I see it, width, height, offsets, etc define the writing direction.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Left to Right, Up to Down Proportional (English)
<br/>
New Line X Offset:   0
<br/>
New Line Y Offset:   16
<br/>
New Glyph X Offset:   PROPORTIONAL
<br/>
New Glyph Y Offset:   0
<br/>
<br/>
Right to Left, Up to Down Fixed (Hebrew)
<br/>
New Line X Offset:   0
<br/>
New Line Y Offset:   16
<br/>
New Glyph X Offset:   -14
<br/>
New Glyph Y Offset:   0
<br/>
<br/>
Up to Down, Right to Left Fixed (Japanese)
<br/>
New Line X Offset:   -16
<br/>
New Line Y Offset:   0
<br/>
New Glyph X Offset:   0
<br/>
New Glyph Y Offset:   16
<br/>
<br/>
Diagonal (Alien)
<br/>
New Line X Offset:   -18
<br/>
New Line Y Offset:   -14
<br/>
New Glyph X Offset:   -16
<br/>
New Glyph Y Offset:   4
<br/>
<br/>
Random (Alien)
<br/>
New Line X Offset:   0
<br/>
New Line Y Offset:   0
<br/>
New Glyph X Offset:   PROPORTIONAL
<br/>
New Glyph Y Offset:   PROPORTIONAL</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-the height of the characters
<br/>
-whether its fixed width</td> </tr></table><span class="postbody">
<br/>
The height of the characters is really the newline y offset.  English uses a y offset, but when vertial writing is used, and x offset will be used instead.  In theory, an alien script might use a diagonal offset.  (See above.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-the width of characters
<br/>
-the height offsets</td> </tr></table><span class="postbody">
<br/>
See above.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-the palette for character bitmpas? (16 colors?)</td> </tr></table><span class="postbody">
<br/>
Antialiased fonts will use a bunch of colors.  I might support both normal glyphs and full color icons.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-the interval of allowed character indizes</td> </tr></table><span class="postbody">
<br/>
The user callback function can handle this.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// returns font index or special library code
<br/>
return_t asciiCallback(param_t pId)
<br/>
{
<br/>
   if ((0x20 &lt;= pId) &amp;&amp; (pId &lt;= 0x7E))
<br/>
      return pId - 0x20;
<br/>
   switch (pId)
<br/>
   {
<br/>
      // control codes
<br/>
   }
<br/>
   // if all else fails
<br/>
   assert(0);
<br/>
   return LIB_UNDISPLAYABLE:
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-the list of characters (maybe in implementation an array of offsets)</td> </tr></table><span class="postbody">
<br/>
This data should be a simple array.  The user is responsible for making sure that the font works with your system.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">index = callback(text[i]);  // you don't know or care what the encoding format is
<br/>
glyphData_t glyphData[index]; // bitmap data
<br/>
int glyphSize;  // maybe???
<br/>
glyphOffset_t glyphWidth[index]; // proportional
<br/>
glyphOffset_t glyphHeight[index]; // proportional</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">a 'character' with a given index specifies
<br/>
- the associated bitmap</td> </tr></table><span class="postbody">
<br/>
Definitely.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">- bpp, index (or should this be global?)</td> </tr></table><span class="postbody">
<br/>
If I want a fairly complete Chinese font, I'm looking at ~5000 characters.  If I want a Chinese font with all the glyphs nobody uses, I'm looking at ~50,000 characters.  Minimizing the number of tables and glyph specific data is very important.  The index should be implicit.  Bpp should be global.  If you want to support full color icons in addition to fixed bpp glyphs, that would be really cool.  I do not want to store bpp for each of 50,000 characters (the bpp will be 1, btw =).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">- the width</td> </tr></table><span class="postbody">
<br/>
This is the <span style="font-weight: bold">new glyph x offset</span>.  If the font has a fixed width, use that value (even 0, in the case of vertical fonts).  Don't forget height.  Vertical writing systems will use this.  (0 for horizontal writing systems.)  You should store a pointer to proportional width/height tables.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define PROPORTIONAL -1
<br/>
<br/>
if (font.newglyph.x == PROPORTIONAL)
<br/>
   cursorXoffset = font.newglyph.proportional.x[index];
<br/>
else
<br/>
   cursorXoffset = font.newglyph.x;
<br/>
// same for y</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">- whether its a control character, specified together with options (or specifying that the options should be read like arguments following the control character in the text)</td> </tr></table><span class="postbody">
<br/>
I would not store this information with each character.  In the fanciest Chinese system I can imagine, there will be ~50,000 glyphs and ~250 control codes.  I don't want an extra 50k of null data in the ROM.  I'm perfectly capable of figuring out which of the 65536 code points are control codes by looking at the encoding point.  My callback can give that information to you.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">which there could be the following
<br/>
-- word separater (i.e. space - simply to know where to break text for newline) - specifying when it gets printed</td> </tr></table><span class="postbody">
<br/>
This is kind of neat.  I think some languages can break more or less anywhere and others can not.  A canBreak(bool pState) function that can be called by the library user might be friendlier toward large fonts.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-- new line</td> </tr></table><span class="postbody">
<br/>
Certainly.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-- 'delay' - with specified 'n' vblanks (?)</td> </tr></table><span class="postbody">
<br/>
I think one delay control coupled with a setDelay(int pVblanks) function should suffice.  If the user wants multiple delays, they could do something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">return_t callback(param_t pId)
<br/>
{
<br/>
   switch (pId)
<br/>
   {
<br/>
      case MY_LONG_DELAY:
<br/>
         libSetDelay(LONG_DELAY);
<br/>
         return LIB_CONTROL_DELAY;
<br/>
         break;
<br/>
      case MY_DELAY:
<br/>
         libSetDelay(DELAY);
<br/>
         return LIB_CONTROL_DELAY;
<br/>
         break;
<br/>
      case MY_SHORT_DELAY:
<br/>
         libSetDelay(SHORT_DELAY);
<br/>
         return LIB_CONTROL_DELAY;
<br/>
         break;
<br/>
      // ...
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-- scroll a character height (immediately/slow)</td> </tr></table><span class="postbody">
<br/>
Scroll the text box?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-- delete screen ('form feed'?)</td> </tr></table><span class="postbody">
<br/>
Form feed is a way of telling the printer, "spit this sheet of paper out and give me a new one".  You could call it pagebreak if you want to.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-- callback/callback with string return to print
<br/>
-- simply functions of the text engine itself?</td> </tr></table><span class="postbody">
<br/>
If possible, your library should communicate with one callback function.  The callback function can use engine functions to do fancy things, but I would actually avoid separate callbacks.  Text insertion (player name, item name, etc) can be accomplished by setting the engine substring buffer and then telling the engine to print that buffer.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-- tab -- why?</td> </tr></table><span class="postbody">
<br/>
Because it is easy.  Why not?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-- userinput -- on gba? how?</td> </tr></table><span class="postbody">
<br/>
Don't.  This is beyond the scope of your library.  If I really want to collect input, I'll print a message like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">  A  B  C  D  E  F  G  H  I  J  K  L
<br/>
  M  N  O  P  Q  R  S  T  U  V  W  X
<br/>
  Y  X  1  2  3  4  5  6  7  8  9  0
<br/>
  a  b  c  d  e  f  g  h  i  j  k  l
<br/>
  m  n  o  p  q  r  s  t  u  v  w  x
<br/>
  y  z  .  ,  '  -  &amp;  @  #  _ DEL NEX</td> </tr></table><span class="postbody">
<br/>
And move my own cursor around.  You only have to worry about putting that text on the screen.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">its probably useful to have callbacks sit in some array, which has to get initialized during runtime.</td> </tr></table><span class="postbody">
<br/>
Sure, but how many do you need?  User encoding to glyph index callback.  Maybe a bitmap loader?  I can't think of anything else.  The user encoding function can handle things like bells.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">also, it would probably make sense to try to make callbacks safe</td> </tr></table><span class="postbody">
<br/>
Well, the user is responsible for making a callback function that works.  Your library should document what it is supposed to do and then assume that the function works.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">so that the callback function itself can access the text engine (no?).</td> </tr></table><span class="postbody">
<br/>
Yes.  This way the user could have game specific embedded compiled text tags.  They are extremely powerful.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">would it be useful to be able to useful multiple fonts at once?</td> </tr></table><span class="postbody">
<br/>
Yes and no.  You should be able to switch the glyphset (and other font data) in the callback, but there should only be one active font at once.  By switching glyphsets, you can implement bold/italic fonts.  A bold control code sets the bold font, and a normal control code restores the normal font.  The engine loads bitmaps from the active font.  When fonts are switched, the engine should expect them to be more or less compatible (same size, writing direction, etc).  If the user must, they can move the cursor around to do strange things.  (The reason why I mentioned a magic cookie on a line with big text.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">functions
<br/>
initialize (options - autowrap..)
<br/>
create, delete text box
<br/>
set/move/get cursor position - in pixels
<br/>
set/move cursor position - in line,column
<br/>
print (returns width printed)
<br/>
clear (either a width in pixels, or some string)
<br/>
scroll (wole line, pixels, instant, slow)
<br/>
clear text box
<br/>
move text box
<br/>
hide/show box
<br/>
set callback</td> </tr></table><span class="postbody">
<br/>
These look good.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">what about text color?</td> </tr></table><span class="postbody">
<br/>
This is always fun.  I can see three ways of doing this: multiple palettes (wasteful), offset within palette (complicated), or both at once (more complicated, but really nifty).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">set palette (?)</td> </tr></table><span class="postbody">
<br/>
Or a pixel offset.  Add that offset to nonzero pixels.  I may want to pack 3 antialiased font colors into one palette.  Palette and pixel offset could be used to fit 6 colors in palette entries.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">would one want to draw anything besides text?</td> </tr></table><span class="postbody">
<br/>
Full color icons maybe?  If I choose to use a washing machine font (they exist), your engine should not care.  It should print the unwashable symbol.  =)  I suppose the callback could load a substring with multiple glyphs if it wanted to print really long characters.  Again, the library should just do the work and not care about it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">would it make sense on such a limited system as the gba to assume that every possible font has a character set with 8 bit indizes?</td> </tr></table><span class="postbody">
<br/>
No.  Please hide this behind a typedef.  Japanese and Chinese will use at least 16 bits.  I can't come up with a 32 bit scenario right now, but I suspect it exists.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef u8 libchar_t;</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">i guess that if the texbox lives in the same space as some other graphics (i.e. a sprite that specifies the background of an 'ok' dialog), then it should be possible to speciy a transparent background color blit.</td> </tr></table><span class="postbody">
<br/>
This is a good idea.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">...gee, who would've thought something like this could be so complicated..</td> </tr></table><span class="postbody">
<br/>
Making anything robust is complicated.  I know that Square Enix has special message programmers.  Other large studios probably do as well.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">i smell feep</td> </tr></table><span class="postbody">
<br/>
Feature creep?  The first version should be fairly simple.  Font colors, icons, etc should not be included, but you should keep them in mind. (Unless you can't wait to get multicolored text working, in that case go for it.)
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122168 - tepples - Sat Mar 17, 2007 3:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">Bell?  Being able to change the bell sound and have it play whenever it hits the bell would cute.  Bell probably wants a callback function, because you don't know what the user sound system looks like.</td> </tr></table><span class="postbody">
<br/>
If you define "<a class="postlink" href="http://www.pineight.com/rant/acpg/cash" target="_blank">bell</a>", you're going to have to define "simoleon", "<a class="postlink" href="http://en.wikipedia.org/wiki/Zeni" target="_blank">zenny</a>", "gil", "rupee", "zorkmid", and every other game currency.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">EDIT:</span>  If you want to able to handle left to right, right to left, vertical text, etc, you'll need to keep track of the cursor base, line offset and character offsets.  After each line:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">line++;
<br/>
xCursor = xCursorBase + line * xLineOffset;
<br/>
yCursor = yCursorBase + line * yLineOffset;</td> </tr></table><span class="postbody">
<br/>
After each character:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">xCursor += glyph.xOffset;
<br/>
yCursor += glyph.yOffset;</td> </tr></table><span class="postbody">
<br/>
Clearly one of the values should always be zero.  By using different values, LTR, RTL, UTD, DTU fonts can be made.</span></td> </tr></table><span class="postbody">
<br/>
What about those scripts that mix orientations, such as Hebrew, which is right-to-left for everything but numbers? And then you get into how much space each glyph takes, especially when using small text at 1 or 2 bpp.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122174 - sgeos - Sat Mar 17, 2007 4:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">Bell?  Being able to change the bell sound and have it play whenever it hits the bell would cute.  Bell probably wants a callback function, because you don't know what the user sound system looks like.</td> </tr></table><span class="postbody">
<br/>
If you define "<a class="postlink" href="http://www.pineight.com/rant/acpg/cash" target="_blank">bell</a>", you're going to have to define "simoleon", "<a class="postlink" href="http://en.wikipedia.org/wiki/Zeni" target="_blank">zenny</a>", "gil", "rupee", "zorkmid", and every other game currency.</span></td> </tr></table><span class="postbody">
<br/>
I'm talking about ASCII value 0x07.  Zenny 銭 is a real currency that is no longer in use.  So is Bita 鐚 (iron coins), by the way, but I don't think a game has used it yet.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">EDIT:</span>  If you want to able to handle left to right, right to left, vertical text, etc, you'll need to keep track of the cursor base, line offset and character offsets.  After each line:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">line++;
<br/>
xCursor = xCursorBase + line * xLineOffset;
<br/>
yCursor = yCursorBase + line * yLineOffset;</td> </tr></table><span class="postbody">
<br/>
After each character:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">xCursor += glyph.xOffset;
<br/>
yCursor += glyph.yOffset;</td> </tr></table><span class="postbody">
<br/>
Clearly one of the values should always be zero.  By using different values, LTR, RTL, UTD, DTU fonts can be made.</span></td> </tr></table><span class="postbody">
<br/>
What about those scripts that mix orientations, such as Hebrew, which is right-to-left for everything but numbers?</span></td> </tr></table><span class="postbody">
<br/>
If you must switch directions mid stream, you'll probably need some sort of <span style="font-weight: bold">non-newline carriage return</span> to move to the beginning of the line based on the new directional rules.  Japanese never (really) changes directions mid stream, but it can flow from either LTRUTD or UTDRTL.  Somehow I imagine a game would just pick one and run with it.  Being able to switch at runtime would be neat (a few code points use differnt glyphs depending on the directional flow of the text).
<br/>
<br/>
Evidently, <a class="postlink" href="http://www.i18nguy.com/unicode/hebrew-numbers.html" target="_blank">the order of numbers doesn't matter in Hebrew</a>.  It looks like perl should be able to pack whatever the translator hands the team.  Printing dynamic values would be a learning experience.  Making something like this work in Hebrew does scare me a little: "You got [gold(r0)] gold!"  I'm sure it's not actually all that bad.  Has anyone done Hebrew localization work?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And then you get into how much space each glyph takes, especially when using small text at 1 or 2 bpp.</td> </tr></table><span class="postbody">
<br/>
Each glyph should live in a fixed size box.  The width and height should be 8, 16 or 32 dot.  (64 seems like much on the GBA.)  From there it is just a matter of decoding the data.
<br/>
<br/>
This will give you the size of each glyph in ROM:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define BITS_PER_BYTE   8
<br/>
<br/>
int bytesPerGlyph(int pW, int pH, int pBpp)
<br/>
{
<br/>
   return (pW * pH * pBpp) / BITS_PER_BYTE;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
An 8 by 8 font at 1 bpp will take 8 bytes per character.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122182 - Ant6n - Sat Mar 17, 2007 7:10 pm</h4>
    <div class="postbody"><span class="postbody">The idea with an array of offsets is that its possible to have characters of different size live in the same array. One wastes some space on the initial list but gets some from not having padding bits in the 'glyphs' (my English is sorta rusty with all these texting terms). I guess in most real cases (of 1,2 bpp fonts) the padding way saves space.
<br/>
<br/>
I guess one could change the writing direction, and associate it with a text box. if one ones to write
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Hello,
<br/>
       i
<br/>
<br/>
       a
<br/>
       m Anton
<br/>
</td> </tr></table><span class="postbody">
<br/>
one would change the direction with some control character. If one wants to write &lt;2007 etirw llits i tub sdrawkcab si txet ym&gt; then either encode 2007 backwards or find out how wide 2007 is, skip that amount, change writing direction write 2007, change writing directin, skip that amount etc.
<br/>
I dont think it is useful for all characters to have callback, that might take quite some time (no?).
<br/>
I dont like the idea of having a callback on every character to see whether its a control character, i think that should be encoded with each character. And since width,height has to be specified with each character anyway, there might be some bits leftover for control information</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122204 - HyperHacker - Sat Mar 17, 2007 9:15 pm</h4>
    <div class="postbody"><span class="postbody">I'd say for Bell, just execute a callback and let it do all the sound stuff. Don't bother with another code to choose which sound to play; the callback should be able to decide. However, if you're not going for ASCII compliance, the next byte could be a parameter passed to the callback.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122212 - sgeos - Sat Mar 17, 2007 9:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">The idea with an array of offsets is that its possible to have characters of different size live in the same array. One wastes some space on the initial list but gets some from not having padding bits in the 'glyphs' (my English is sorta rusty with all these texting terms). I guess in most real cases (of 1,2 bpp fonts) the padding way saves space.</td> </tr></table><span class="postbody">
<br/>
I guess I don't know enough about it.  How does it work?  I do know that a 60564 code point unicode font will be huge even at 1bpp; I don't want to make it bigger.  (Not that anyone needs the whole thing.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">I guess one could change the writing direction, and associate it with a text box. if one ones to write
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Hello,
<br/>
       i
<br/>
<br/>
       a
<br/>
       m Anton
<br/>
</td> </tr></table><span class="postbody">
<br/>
one would change the direction with some control character.</span></td> </tr></table><span class="postbody">
<br/>
My question is, a system control character or a user control character?  This will not be a common feature.  The engine should expose this functionality so that the user can pull something like this off, but I don't think that the system needs to support this kind of control directly because very few people will need something like this.  FWIW, I think spiral text would be funny, but it has little practical application.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">I am slowly going crazy... One
<br/>
                             ,
<br/>
.. Crazy going slowly am I..  
<br/>
.                          . t
<br/>
h  ...erht ,rouf ,evif ,xiS  w
<br/>
c                            o
<br/>
tiws ,xis ,evif ,ruof ,eerht ,</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">If one wants to write &lt;2007 etirw llits i tub sdrawkcab si txet ym&gt; then either encode 2007 backwards</td> </tr></table><span class="postbody">
<br/>
The Hebrew translators will be working with Hebrew encoding tools.  They can encode constants properly.  Hebrew numbers don't work like English (so far as I can tell), so dynamic text will have to be reprogrammed anyway.  There is definitely a solution, and around the time you decide to pay $4000 for a Hebrew translation I bet that solution will be fairly simple to find. =)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">or find out how wide 2007 is, skip that amount, change writing direction write 2007, change writing directin, skip that amount etc.</td> </tr></table><span class="postbody">
<br/>
At which point you are looking at something like this.  I don't know how to easily calculate WIDTH if the font is proportional; not in any pretty sort of way, that is.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">[mirror]&lt;my text is backwards but i still write [skip(WIDTH)][/mirror]2007[mirror][skip(WIDTH)]&gt;</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">I dont think it is useful for all characters to have callback,</td> </tr></table><span class="postbody">You could assume that there is a contiguous mapping of encoding values to font indices, and you could assume that control codes come either before or after that section.  The user would have to tell you where the break is.  The problem is that if the text uses something like <a class="postlink" href="http://lfw.org/text/jp.html" target="_blank">native shift JIS encoding</a>, valid character codes are not contiguous and you need a callback.  (Of course, text preprocessing can fix this.)  IIRC, shift JIS is a "superset" ASCII.  You will get a displayable glyph every other character, because the first is only half of the character code.  Unless it is ASCII, in which case it is the complete character code.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">that might take quite some time (no?).</td> </tr></table><span class="postbody">
<br/>
This is a premature optimization.  I think that the flexibility gained outweighs any potential performance penalties that may not exist.  If a game is doing a lot, it will only display simple messages.  If a game has complex messages, it won't do much else while those messages are being displayed.
<br/>
<br/>
Using a callback for all characters, the user can implement case locking, glyph morphing and other fancy things.  The fantastic part of all of this, is that your engine will not have to worry about any of that.  It can just print the control codes it gets.  A simple callback function would look like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">return_t callback(param_t pId)
<br/>
{
<br/>
   // if this is a normal character...
<br/>
   if ((MIN_PRINTABLE) &amp;&amp; (pId &lt;= MAX_PRINTABLE))
<br/>
   {
<br/>
      // glyph morphing here, if any
<br/>
      // return the font index
<br/>
      return pId - MIN_PRINTABLE;
<br/>
   }
<br/>
<br/>
   // else, it is something special
<br/>
   switch (pId)
<br/>
   {
<br/>
      // handle control codes
<br/>
      // user can create special control codes with library hooks
<br/>
   }
<br/>
<br/>
   // if we got this far, something went wrong
<br/>
   assert(0);
<br/>
<br/>
   // don't display anything
<br/>
   return UNDISPLAYABLE:
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Adding caselocks would make the "normal character" portion more complex.  Native SJIS would be ugly- pId would have to mangled to work with the font, but it could be done.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I dont like the idea of having a callback on every character to see whether its a control character,</td> </tr></table><span class="postbody">
<br/>
You are doing more than finding out if it is a control character.  You are asking the user what the current code value really is.  What goes in as "a", may come out as "A" or "?" if the user wants a filter like that.
<br/>
<br/>
Also, how would you handle user defined control codes?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">i think that should be encoded with each character.</td> </tr></table><span class="postbody">
<br/>
Control codes don't generally have displayable glyphs associated with them.  Displayable characters generally don't need control information, although I could see adding something like "line breakable" to them.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And since width,height has to be specified with each character anyway, there might be some bits leftover for control information</td> </tr></table><span class="postbody">
<br/>
Any reasonable font will only have either a proportional width or a proportional height, but not both.  If font bitmaps can be up to 32 pixels wide, it is reasonable for proportional width to range from 0 to 32 plus a bit, or 0 to 63 at the most.  This leaves 2 control bits per glyph entry, if the font is proportional.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122218 - Ant6n - Sat Mar 17, 2007 10:11 pm</h4>
    <div class="postbody"><span class="postbody">so basicly you are proposing to separate the index of glyphs and character indizes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122222 - sgeos - Sat Mar 17, 2007 10:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">so basicly you are proposing to separate the index of glyphs and character indizes.</td> </tr></table><span class="postbody">
<br/>
Yes.  The glyph data (font) is stored in a normal array.  The encoding format used may not directly map to the font (SJIS is a horrible ugly encoding format, but it is fairly compact and standard in Japan).  The user callback turns the character index into a glyph index (trivial for anything like ASCII).  It also returns system control codes (because you don't know anything about the encoding format and you don't want to) and handles user extensions by catching user control codes and calling library functions (this is really powerful; you can't directly support everything anyone would want to do, but you can make it easy for them to add support).
<br/>
<br/>
As I said, preprocessing can but used to eliminate direct mapping issues.  This would actually make SJIS take up more space, because single byte charactars would have to be stored as 16 bit indices.  This is not really a big deal.  There are other advantages to a callback filter.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122247 - Ant6n - Sun Mar 18, 2007 2:20 am</h4>
    <div class="postbody"><span class="postbody">so everything done by a callback then. that callback can return a glyph index (which gets printed), and/or some standard control (which there very few, i.e. newline etc), or a string in the buffer. the callback should be able to ask for the next bytes in the string (i.e. if using some font with 16 bit characters etc).
<br/>
so glyphs are bmps of static size.
<br/>
one way to implement widths, heights is to have an array for them and specifiy where it is in an offset, somethin glike this
<br/>
<br/>
struct font{
<br/>
..stuff
<br/>
 u32 widths_offset;
<br/>
 u32 widths_length;
<br/>
..
<br/>
}
<br/>
<br/>
so after widths_offset bytes from the 'font' structure there is an array of widths-length that specifies the width for each character. analogously can height or other information be stored.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122266 - Ant6n - Sun Mar 18, 2007 6:55 am</h4>
    <div class="postbody"><span class="postbody">But what would be the best way to hook the textboxes into hardware?
<br/>
one way would be to assume that sprite text boxes are made of 32x32 or 64x64 sprites, so when creating a text box a list of pointers to memory have to be supplied along with it. these will be drawn into. I guess these could be directly in vram. for bg i guess the thing could be very similar, when specifying a text box one specifies a bg and a rectangle in the bg map.
<br/>
when printing data could be copied in some buffer and copied into vram during vblank. make sense, no?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122297 - sgeos - Sun Mar 18, 2007 2:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">so everything done by a callback then. that callback can return a glyph index (which gets printed), and/or some standard control (which there very few, i.e. newline etc),</td> </tr></table><span class="postbody">
<br/>
There should be an UNDISPLAYABLE control code, so that the user can tell the system "I did something with this, but you don't need to worry about it."
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">or a string in the buffer.</td> </tr></table><span class="postbody">
<br/>
Right.  The user fills the substring buffer (or sets a substring pointer, maybe this would be better?) and then returns a PRINT_SUBSTRING control code.  Whether the system prints the substring with a recursive call or not is up to you, but that should be documented.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">the callback should be able to ask for the next bytes in the string (i.e. if using some font with 16 bit characters etc).</td> </tr></table><span class="postbody">
<br/>
A peek() function might be neat, but in general I think that the callback should cache a value and then wait until it is called again.  I suppose the callback could call getNextCharacter(), which would return the next character and advance the stream.  This is probably better.  It would simplify escape characters, for the people who want to use them.
<br/>
<br/>
The system should operate on a typedefed character type.  Some people might want to natively work with wide characters instead of multibyte characters.  They should be able to do that by changing one line in the library header.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// change unsigned char to wchar_t if you want to use wide characters with wprintf and friends
<br/>
// change unsigned char to u16 or u32 for custom wide character support
<br/>
typedef unsigned char libChar_t;</td> </tr></table><span class="postbody">
<br/>
Has anyone used the wprintf() family of functions on the GBA or DS?  I can't find any documentation on wiprintf().  I don't think it exists, but it may have a different name.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">so glyphs are bmps of static size.
<br/>
one way to implement widths, heights is to have an array for them and specifiy where it is in an offset, somethin glike this
<br/>
<br/>
struct font{
<br/>
..stuff
<br/>
 u32 widths_offset;
<br/>
 u32 widths_length;
<br/>
..
<br/>
}
<br/>
<br/>
so after widths_offset bytes from the 'font' structure there is an array of widths-length that specifies the width for each character. analogously can height or other information be stored.</td> </tr></table><span class="postbody">
<br/>
<br/>
Why not do something like this?  It take up more or less the same amount of space and it is more organized.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define PROPORTIONAL   -1
<br/>
<br/>
const glyphData_t gFontGlyph[] =
<br/>
{
<br/>
   // 20,000 lines of font data
<br/>
};
<br/>
<br/>
const widthData_t gFontWidth[] =
<br/>
{
<br/>
   // 500 lines of width data
<br/>
};
<br/>
<br/>
// height is fixed, so there is no proportional height data
<br/>
<br/>
const fontData_t gFontData =
<br/>
{
<br/>
   gFontGlyph,   // Glyph Data
<br/>
   0,      // Newline X Offset
<br/>
   16,      // Newline Y Offset
<br/>
   PROPORTIONAL,   // Newchar X Offset
<br/>
   0,      // Newchar Y Offset
<br/>
   gFontWidth,   // Proportional Width
<br/>
   NULL,      // Proportional Height
<br/>
   // anything else, bpp, etc
<br/>
};</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But what would be the best way to hook the textboxes into hardware?</td> </tr></table><span class="postbody">
<br/>
The windows that the text is drawn over?  Without knowing what the user wants, it is hard to handle this problem.  My advice is, don't do this directly. Your library should just worry about where glyphs end up on the screen (you will need to keep track of the size of the display area).  Either let the user handle this directly (without involving your library at all), or use openTextBox() closeTextBox() callbacks and let the user handle the implemention.   There are many things the user might want to do:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Spirtes Only
<br/>
OBJ0 - Text, Window, UI
<br/>
BG-0 - Effects
<br/>
OBJ1 - Effects
<br/>
BG-1 - BG Overlay
<br/>
OBJ2 - Game Objects
<br/>
BG-2 - BG Underlay
<br/>
OBJ3 - (unused)
<br/>
BG-4 - BG Underlay
<br/>
BDRP - (unused)
<br/>
<br/>
Sprite Text, BG Window
<br/>
OBJ0 - Text, UI
<br/>
BG-0 - Window, UI
<br/>
OBJ1 - Effects
<br/>
BG-1 - Effects
<br/>
OBJ2 - Game Objects
<br/>
BG-2 - BG Overlay
<br/>
OBJ3 - Game Objects
<br/>
BG-4 - BG Underlay
<br/>
BDRP - (unused)
<br/>
<br/>
BG Only
<br/>
OBJ0 - Cursors, UI
<br/>
BG-0 - Text, Window
<br/>
OBJ1 - Effects
<br/>
BG-1 - Effects
<br/>
OBJ2 - Game Objects
<br/>
BG-2 - BG Overlay
<br/>
OBJ3 - Game Objects
<br/>
BG-4 - BG Underlay
<br/>
BDRP - (unused)
<br/>
<br/>
Text Only, Sprites
<br/>
OBJ0 - Text, UI
<br/>
BG-0 - Effects
<br/>
OBJ1 - Effects
<br/>
BG-1 - BG Overlay
<br/>
OBJ2 - Game Objects
<br/>
BG-2 - BG Underlay
<br/>
OBJ3 - (unused)
<br/>
BG-4 - BG Underlay
<br/>
BDRP - Solid Color Text Backdrop
<br/>
<br/>
Text Only, BG
<br/>
OBJ0 - Cursors, UI
<br/>
BG-0 - Text
<br/>
OBJ1 - Effects
<br/>
BG-1 - Effects
<br/>
OBJ2 - Game Objects
<br/>
BG-2 - BG Overlay
<br/>
OBJ3 - Game Objects
<br/>
BG-4 - BG Underlay
<br/>
BDRP - Solid Color Text Backdrop</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">one way would be to assume that sprite text boxes are made of 32x32 or 64x64 sprites, so when creating a text box a list of pointers to memory have to be supplied along with it.</td> </tr></table><span class="postbody">
<br/>
Sounds complicated.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">these will be drawn into. I guess these could be directly in vram.</td> </tr></table><span class="postbody">
<br/>
I could see passing a pointer to a section of VRAM.  If the amount needed is document, this would probably be the simplest approach.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">for bg i guess the thing could be very similar, when specifying a text box one specifies a bg and a rectangle in the bg map.</td> </tr></table><span class="postbody">
<br/>
You need to know what cells to write in the BG and/or which tiles to update.  Treating a bunch of tiles as a bitmap is the most powerful way to use a BG.  Part of the BG is formatted to use tiles like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">00  01  02  03  04  05  06  07  08  09  0A  0B  0C  0D  0E  0F
<br/>
10  11  12  13  14  15  16  17  18  19  1A  1B  1C  1D  1E  1F
<br/>
...
<br/>
70  71  72  73  74  75  76  77  78  79  7A  7B  7C  7D  7E  7F</td> </tr></table><span class="postbody">
<br/>
Then you just need to update the tiles.  Proportional fonts can be written to BGs using this technique.  You need to know how big the text area (width, height) is, and what tile index it starts at.  If you go this route, you may want to include a function that initialized a square of tiles.
<br/>
<br/>
Sprites are generally happy floating above everything else.
<br/>
<br/>
If you want to be able to handle simple windows, they usually consist on 8 border parts and an internal section.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/-    --    -\
<br/>
|.    ..    .|
<br/>
<br/>
|.    ..    .|
<br/>
|.    ..    .|
<br/>
<br/>
|.    ..    .|
<br/>
\-    --    -/</td> </tr></table><span class="postbody">
<br/>
The corners and sides may or may not be rotated.  When everything is put together it looks like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/--------------------------\
<br/>
|..........................|
<br/>
|..HHEELLOO..WWOORRLLDD!!..|
<br/>
|..HHEELLOO..WWOORRLLDD!!..|
<br/>
|..........................|
<br/>
\--------------------------/</td> </tr></table><span class="postbody">
<br/>
It seems like you might need to able to specify transparent/non-transparent background colors for loaded glyphs.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">when printing data could be copied in some buffer and copied into vram during vblank. make sense, no?</td> </tr></table><span class="postbody">
<br/>
This is a good idea.  The user could call syncText() or somesuch function some time during vblank.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122301 - tepples - Sun Mar 18, 2007 3:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">The system should operate on a typedefed character type.  Some people might want to natively work with wide characters instead of multibyte characters.  They should be able to do that by changing one line in the library header.
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// change unsigned char to wchar_t if you want to use wide characters with wprintf and friends
<br/>
// change unsigned char to u16 or u32 for custom wide character support
<br/>
typedef unsigned char libChar_t;</td> </tr></table><span class="postbody">
<br/>
Has anyone used the wprintf() family of functions on the GBA or DS?  I can't find any documentation on wiprintf().  I don't think it exists, but it may have a different name.</span></td> </tr></table><span class="postbody">
<br/>
I'm not sure that newlib has an integer version of the wide character functions. The thinking is that if your machine has enough RAM to hold the glyphs for a multi-byte character set, then it probably also has an FPU.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">these will be drawn into. I guess these could be directly in vram.</td> </tr></table><span class="postbody">
<br/>
I could see passing a pointer to a section of VRAM.  If the amount needed is document, this would probably be the simplest approach.</span></td> </tr></table><span class="postbody">
<br/>
Or pass a pointer to a struct containing VRAM base address, width, and height.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">for bg i guess the thing could be very similar, when specifying a text box one specifies a bg and a rectangle in the bg map.</td> </tr></table><span class="postbody">
<br/>
You need to know what cells to write in the BG and/or which tiles to update.  Treating a bunch of tiles as a bitmap is the most powerful way to use a BG.  Part of the BG is formatted to use tiles like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">00  01  02  03  04  05  06  07  08  09  0A  0B  0C  0D  0E  0F
<br/>
10  11  12  13  14  15  16  17  18  19  1A  1B  1C  1D  1E  1F
<br/>
...
<br/>
70  71  72  73  74  75  76  77  78  79  7A  7B  7C  7D  7E  7F</td> </tr></table><span class="postbody">
<br/>
Then you just need to update the tiles.  Proportional fonts can be written to BGs using this technique.  You need to know how big the text area (width, height) is, and what tile index it starts at.  If you go this route, you may want to include a function that initialized a square of tiles.</span></td> </tr></table><span class="postbody">
<br/>
If you are using a background map, then the following layout seen in the demo "fr018" is even easier because it treats each column of tiles as a linear bitmap so that going from row 7 to 8 doesn't need any special handling.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">00 08 10 18 20 28 30 38 40 48 50 58 60 68 ... B0 B8
<br/>
01 09 11 19 21 29 31 39 41 49 51 59 61 69 ... B1 B9
<br/>
...
<br/>
07 0F 17 1F 27 2F 37 3F 47 4F 57 5F 67 6F ... B7 BF</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">If you want to be able to handle simple windows, they usually consist on 8 border parts and an internal section.
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/-    --    -\
<br/>
|.    ..    .|
<br/>
<br/>
|.    ..    .|
<br/>
|.    ..    .|
<br/>
<br/>
|.    ..    .|
<br/>
\-    --    -/</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Or the border can be fancier (although still rectangular) in the case of, say, the fluffy rectangles used for dialogue windows in <span style="font-style: italic">Animal Crossing</span>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122308 - sgeos - Sun Mar 18, 2007 5:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">I'm not sure that newlib has an integer version of the wide character functions. The thinking is that if your machine has enough RAM to hold the glyphs for a multi-byte character set, then it probably also has an FPU.</td> </tr></table><span class="postbody">
<br/>
This is why assumptions are bad.  An FPU has nothing to do with ROM size.  Once you hit 257 glyphs, you need a non-single byte encoding scheme.  The gakushu kanji 学習漢字, kana, romaji and punctuation should come out to around 1200 ~ 1300 characters.  At 1 bpp, there is more than enough space for such a font (150k).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">these will be drawn into. I guess these could be directly in vram.</td> </tr></table><span class="postbody">
<br/>
I could see passing a pointer to a section of VRAM.  If the amount needed is document, this would probably be the simplest approach.</span></td> </tr></table><span class="postbody">
<br/>
Or pass a pointer to a struct containing VRAM base address, width, and height.</span></td> </tr></table><span class="postbody">
<br/>
This is better.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">If you are using a background map, then the following layout seen in the demo "fr018" is even easier because it treats each column of tiles as a linear bitmap so that going from row 7 to 8 doesn't need any special handling.
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">00 08 10 18 20 28 30 38 40 48 50 58 60 68 ... B0 B8
<br/>
01 09 11 19 21 29 31 39 41 49 51 59 61 69 ... B1 B9
<br/>
...
<br/>
07 0F 17 1F 27 2F 37 3F 47 4F 57 5F 67 6F ... B7 BF</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
This is really neat.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">If you want to be able to handle simple windows, they usually consist on 8 border parts and an internal section.
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/-    --    -\
<br/>
|.    ..    .|
<br/>
<br/>
|.    ..    .|
<br/>
|.    ..    .|
<br/>
<br/>
|.    ..    .|
<br/>
\-    --    -/</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Or the border can be fancier (although still rectangular) in the case of, say, the fluffy rectangles used for dialogue windows in <span style="font-style: italic">Animal Crossing</span>.</span></td> </tr></table><span class="postbody">
<br/>
All sorts of things get used- nothing but half fade out, solid boxes, simple borders, fancy borders, gradient windows, bitmapped windows...
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122322 - Ant6n - Sun Mar 18, 2007 6:27 pm</h4>
    <div class="postbody"><span class="postbody">my idea of having some function -getnextchar- that can be called by the callback is that if the font uses 16 bit characters, the user can always combine the argument of the callback (the current byte) and getnextchar to a u16, or u32.
<br/>
Peek seems like a cool idea, it only needs to return a pointer to the next byt in the string.
<br/>
<br/>
the idea of using a big struct that declares offsets and array sizes for some of its members is that the data can easily be stored in some continuous fashion, i.e. a file. It also means there is only one big structure (of unkown length, but oh well) despite there being many dynamic members.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Or pass a pointer to a struct containing VRAM base address, width, and height.</td> </tr></table><span class="postbody">
<br/>
I guess the linking with the hardware is the hardest part of the specification, because it seems there is no balance between being powerful, general and being simple. the above would mean that the VRAM has to be layout in a special way, i.e. a continuous section of VRAM in which sprites life in a specified way. It is not always clear whether its possible for the user to create that environment, that's why i proposed giving an array of pointers to sprites, i.e.
<br/>
maketextbox(......,u32 spritec,void **spritevrampointers).
<br/>
Same goes for bg, where it seems to me that specifying a bg (0-3), and then specifying a rectangle in the bg map is fairly general. Knowing the hardware it can easily be figured out where each bgtile sits. The assumption here is that the bg map stays constant.
<br/>
I see it would be favorable to have a useful layout (as Tepples proposed), but in general the only layout one can assume is 'tiles'. Since the data to be drawn has to be buffered anyway (if it is to be written during vblank), one could try to buffer it in such a way that it can be quickly copied into any arrangement of tiles.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122533 - sgeos - Tue Mar 20, 2007 12:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">my idea of having some function -getnextchar- that can be called by the callback is that if the font uses 16 bit characters, the user can always combine the argument of the callback (the current byte) and getnextchar to a u16, or u32.</td> </tr></table><span class="postbody">
<br/>
This is really good for encoding formats that mix ASCII with multibyte characters (SJIS), but it is less efficient for encoding formats that always use 16 or 32 bit values.  Why not provide getnextchar() and a typedef?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">Peek seems like a cool idea, it only needs to return a pointer to the next byt in the string.</td> </tr></table><span class="postbody">
<br/>
If getnextchar() exists, I'm not sure what I'd do with it, but it is cheap enough to implement so why not?  Somebody might come up with something.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">the idea of using a big struct that declares offsets and array sizes for some of its members is that the data can easily be stored in some continuous fashion, i.e. a file.</td> </tr></table><span class="postbody">
<br/>
This can be done anyway.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">It also means there is only one big structure (of unkown length, but oh well) despite there being many dynamic members.</td> </tr></table><span class="postbody">
<br/>
I think the disadvantages outweigh the advantages.  Unknown length can easily be solved:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">type_t myData[] =
<br/>
{
<br/>
   // unknown number of members
<br/>
};
<br/>
int myDataMembers = sizeof(myData) / sizeof(type_t);
<br/>
int myDataSize    = sizeof(myData);</td> </tr></table><span class="postbody">
<br/>
If you really want to use a file, you can write size data to the file header when you export your data.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Or pass a pointer to a struct containing VRAM base address, width, and height.</td> </tr></table><span class="postbody">
<br/>
I guess the linking with the hardware is the hardest part of the specification, because it seems there is no balance between being powerful, general and being simple.</span></td> </tr></table><span class="postbody">
<br/>
You need to careful when defining what your library does, and more importantly, what it does not do.  I actually recommend that you start with either BG text display or OBJ text display, but not both.  I think that windows are out of scope.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">the above would mean that the VRAM has to be layout in a special way,</td> </tr></table><span class="postbody">
<br/>
As long as you provide a function that formats VRAM and you tell people how to use it this is fine.  Many libraries have initialization requirements.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">i.e. a continuous section of VRAM in which sprites life in a specified way.</td> </tr></table><span class="postbody">
<br/>
I don't see any way around this for the sprites.  All sprite based text display systems that I am aware of use continuous VRAM tiles and continuous OAM entries.  This is the simplest way of doing things.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">It is not always clear whether its possible for the user to create that environment,</td> </tr></table><span class="postbody">
<br/>
Sure it is.  For a tiled BG:
<br/>
"To use this library you first need to use initBgMap().  It will format the BG for you.  You will need to have at least X free tiles in VRAM for the map to use."
<br/>
<br/>
For sprites:
<br/>
"To use this library you will need to have at least X free tiles in VRAM and at least one free OAM entry for each character you want to display."
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">that's why i proposed giving an array of pointers to sprites, i.e.
<br/>
maketextbox(......,u32 spritec,void **spritevrampointers).</td> </tr></table><span class="postbody">
<br/>
I would rather just pass a base address.  I can't see a situation where I wouldn't use a continuous section of VRAM.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Same goes for bg, where it seems to me that specifying a bg (0-3), and then specifying a rectangle in the bg map is fairly general.</td> </tr></table><span class="postbody">
<br/>
I think that you will have to specify a screen based block instead.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Knowing the hardware it can easily be figured out where each bgtile sits. The assumption here is that the bg map stays constant.</td> </tr></table><span class="postbody">
<br/>
You will need to tell the system which character base block is being used and what tile to start from.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I see it would be favorable to have a useful layout (as Tepples proposed), but in general the only layout one can assume is 'tiles'.</td> </tr></table><span class="postbody">
<br/>
If that layout simplifies things, it is probably worth forcing people to use it if they want to use your library.  I don't know of a better way to implement tile based text.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">void formatBg(int pScreenBaseBlock, int pX, int pY, int pW, int pH, int pTileOffset);
<br/>
<br/>
//  Formats a square with an upper lefthand corner at (pX, pY).
<br/>
//
<br/>
//  t = tile offset
<br/>
//
<br/>
//  t+0*h+0  t+1*h+0  ...  t+(w-1)*h+0
<br/>
//  t+0*h+1  t+1*h+1  ...  t+(w-1)*h+1
<br/>
//     .        .               .
<br/>
//     .        .               .
<br/>
//     .        .               .
<br/>
//  t+1*h-1  t+2*h-1  ...    t+w*h-1</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Since the data to be drawn has to be buffered anyway (if it is to be written during vblank), one could try to buffer it in such a way that it can be quickly copied into any arrangement of tiles.</td> </tr></table><span class="postbody">
<br/>
If you use a formatted matrix, all you have to do is DMA tile data to VRAM during the vblank.  If you use contiguous sprites, you will have to DMA sprite tile data and OAM entries to VRAM.  I don't know of a faster simpler way of doing things.  I also can't think of a situation where this would not be acceptable library behavior, but I would be happy to hear about one.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122543 - Ant6n - Tue Mar 20, 2007 3:01 am</h4>
    <div class="postbody"><span class="postbody">The sprite library that i have been setting up the last couple of months (don't habe much time for it) manages vram and sprite. If you wanna use that you have to load the sprite tiled bitmap (the picture information) and you have to create a sprite object that uses that bitmap. I only load the picture information into vram when its actually needed, and only put the sprite into oam when it's displayed. So after a while everything is totally out of order. To get some sprites that sit in vram in constant positions one can create some space, or one can create sprites that are always in some position in vram. I.e., you tell it "i want that sprite to always be in vram at the same spot". this has to be in a block either in front or after the sprites that get dynamicly loaded, otherwise things get too complicated to handle for me. But if you create and destroy these 'constant' sprites, after a while that memory gets noncontinuously allocable. To make a long story short, in this scenario it might not always be possible to have continuous sprite space. Anyhoo, I guess if one can give an array of sprites pointers, giving a continuous space of sprites is just a special case. So is the specially arranged block of bg vram vs figuring out the tile arrangement from hardware.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You will need to tell the system which character base block is being used and what tile to start from. </td> </tr></table><span class="postbody">
<br/>
If the bg (0-3) is supplied, the base block is bit 2-3 of bg&lt;n&gt;control.
<br/>
<br/>
I have to think about that typedef (make sure I don't subly make assumptions about the size of characters in a string), but I guess it makes sense.
<br/>
<br/>
After giving it some thought, I think its not really necessary to copy during vram. texting is not done 20 times a second, so one would probably not see much of flicker. And if it is really necessary, the user could just give a shadow ram block as oppossed to a block in vram, and copy him/herself.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I think the disadvantages outweigh the advantages. Unknown length can easily be solved: (...)</td> </tr></table><span class="postbody">
<br/>
Is that still true if there are multiple members that are arrays of unkown size, and it is not even known whether they actually exist? I.e. all widths and/or heights can be stored in array each, or they could be constant. The glyphs are of uknown size, and there is an unknown number of them. I would create one big struct like this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct{
<br/>
  char[4] ID;
<br/>
  u32 size;
<br/>
  s32 charcount,charwidth,charheight,defaultxoffset,defaultyoffset, ... etc
<br/>
  u32 widthcount,withoffset;  //points to array relative to struct base address
<br/>
  u32 heightcount,heightoffset;//same
<br/>
  u32 glyphcount,glyphoffset; //same
<br/>
  u32 charxoffsetcount,charxoffsetoffset;//same
<br/>
  u32 charyoffsetcount,charyoffsetoffset;//
<br/>
  u32 charwidth; //one could define it here, then one doesnt have to recompile despite using wide chars
<br/>
  u32 bpp,glyphwidth,glyphheight
<br/>
  ...probably some more stuff
<br/>
} Font</td> </tr></table><span class="postbody">
<br/>
<br/>
Here the 2nd element gives the size of the whole struct, which has constant data in the beginning and dynamic in the end.
<br/>
<br/>
As far as the as the callback goes.. I think the thing could be done like this: when somebody calls print(textbox,string), the engine goes into printing mode. It copies the string into some internal buffer. When there is a callback, one is allowed to call a the library functions, plus a few functions only accessible in reading mode, when not in reading mode they do nothing (nextchar,peek,insert string,cancel print). Insert string inserts the string after the current position in the reading buffer. after '0' is reached, the engine goes out of print mode. The callback returns the glyph index to be print. The highest bits of the return are used for control information (i.e. 'not printable', 'new line', 'breakable'). One could use the highest 16 bits for control.
<br/>
Would one have a font on the GBA that actually uses more than 65536 possible glyphs?
<br/>
<br/>
I see you would define a couple of structs instead, I dont understand how that would be more convenient. Maybe I am missing something</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122549 - sgeos - Tue Mar 20, 2007 5:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">To get some sprites that sit in vram in constant positions one can create some space, or one can create sprites that are always in some position in vram. I.e., you tell it "i want that sprite to always be in vram at the same spot". this has to be in a block either in front or after the sprites that get dynamicly loaded, otherwise things get too complicated to handle for me.</td> </tr></table><span class="postbody">
<br/>
This is more or less how sprite text systems work- you reserve a fixed number, say half, of your sprites for text.  VRAM is really more of an issue than OAM.  Once you start dealing with thousands of glyphs, every character needs its own tiles.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">Anyhoo, I guess if one can give an array of sprites pointers, giving a continuous space of sprites is just a special case.</td> </tr></table><span class="postbody">
<br/>
"I want 64 sprites, starting here."  If you are using a low level API, the sprite system should be happier with continuous VRAM/OAM usage.  If your API has a way to just get the next sprite this may not matter.  My fear is VRAM fragmentation.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">So is the specially arranged block of bg vram vs figuring out the tile arrangement from hardware.</td> </tr></table><span class="postbody">
<br/>
The advantage of regular schemes is that they let you treat VRAM/OAM as an array conceptually and most probably practically as well.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You will need to tell the system which character base block is being used and what tile to start from. </td> </tr></table><span class="postbody">
<br/>
If the bg (0-3) is supplied, the base block is bit 2-3 of bg&lt;n&gt;control.</span></td> </tr></table><span class="postbody">
<br/>
Sure.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I have to think about that typedef (make sure I don't subly make assumptions about the size of characters in a string), but I guess it makes sense.</td> </tr></table><span class="postbody">
<br/>
Breaking the assumption that 1 char == 1 glyph is very important if you want to work with international texts.  I suggest that you typedef to something like u32 while developing just to make sure that you can't forget.
<br/>
<br/>
If you intend to support multidirectional text, I recommend using a DTU(characters)RTL(lines) test at the same time just because it is basically the opposite of English (and all European languages that I am aware of).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">After giving it some thought, I think its not really necessary to copy during vram. texting is not done 20 times a second, so one would probably not see much of flicker. And if it is really necessary, the user could just give a shadow ram block as oppossed to a block in vram, and copy him/herself.</td> </tr></table><span class="postbody">
<br/>
Some old SJIS display code I wrote flickered.  Shadow RAM would work, although I guess that you can't read BGxCNT in that case.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I think the disadvantages outweigh the advantages. Unknown length can easily be solved: (...)</td> </tr></table><span class="postbody">
<br/>
Is that still true if there are multiple members that are arrays of unkown size, and it is not even known whether they actually exist?</span></td> </tr></table><span class="postbody">
<br/>
Yes.  Treating an array as a struct is silly.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I.e. all widths and/or heights can be stored in array each, or they could be constant.</td> </tr></table><span class="postbody">
<br/>
If you absolutely need a placeholder, you can do something like this or use a similar solution embedded in a struct:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const type_t gWidthDummy[] = {0};
<br/>
const type_t gWidthDummySize = 0;
<br/>
const type_t gWidthDummyMembers = 0;</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct{
<br/>
  char[4] ID;
<br/>
  u32 size;
<br/>
  s32 charcount,charwidth,charheight,defaultxoffset,defaultyoffset, ... etc
<br/>
  u32 widthcount,withoffset;  //points to array relative to struct base address
<br/>
  u32 heightcount,heightoffset;//same
<br/>
  u32 glyphcount,glyphoffset; //same
<br/>
  u32 charxoffsetcount,charxoffsetoffset;//same
<br/>
  u32 charyoffsetcount,charyoffsetoffset;//
<br/>
  u32 charwidth; //one could define it here, then one doesnt have to recompile despite using wide chars
<br/>
  u32 bpp,glyphwidth,glyphheight
<br/>
  ...probably some more stuff
<br/>
} Font</td> </tr></table><span class="postbody">
<br/>
When does charcount != glyphcount?  Do unprintable characters somehow matter?  I may choose to put control characters at the end of my encoding format (0xFFFF~) and printable characters at the start (0x0000~).
<br/>
Is PROPORTIONAL set using defaultxoffset,defaultyoffset?
<br/>
I'm assuming that the newline offset is in there somewhere, probably under a different name...
<br/>
What is the difference between charwidth,charheight and glyphwidth,glyphheight?
<br/>
If the font has a proportional height, heightcount == glyphcount; there is one proportional height entry per glyph (unless you want a height callback).
<br/>
If the font has a proportional width, widthcount == glyphcount; there is one proportional width entry per glyph (unless you want a width callback).
<br/>
A typedef is better than charwidth:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// the message table should use the library character type
<br/>
const char_t *const gMessageTableW[] =
<br/>
{
<br/>
   L"",
<br/>
   L"The problem is that I want to recompile here.",
<br/>
   NULL
<br/>
};
<br/>
<br/>
// it may look like this
<br/>
const char_t *const gMessageTable16[] =
<br/>
{
<br/>
   {0x0000},
<br/>
   {0x0431,0x3947,0x00E9,0x00CC,0x0000},   // Or here
<br/>
   NULL
<br/>
};
<br/>
<br/>
// or like this, although I doubt it
<br/>
const char_t *const gMessageTable32[] =
<br/>
{
<br/>
   {0x00000000},
<br/>
   {0x01423314,0x35964778,0x00E9C90A,0x00CC00CC,0x00000000},   // OK, probably not on the GBA =)
<br/>
   NULL
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Here the 2nd element gives the size of the whole struct, which has constant data in the beginning and dynamic in the end.</td> </tr></table><span class="postbody">
<br/>
Sure.  Are alignment issues covered?  With ~6000 glyphs I'll probably to use s8 for proportional width/height.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It copies the string into some internal buffer.</td> </tr></table><span class="postbody">
<br/>
The string is read only, so you should be able to trace over it.  I don't see why it needs to be copied.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">When there is a callback, one is allowed to call a the library functions, plus a few functions only accessible in reading mode, when not in reading mode they do nothing (nextchar,peek,insert string,cancel print).</td> </tr></table><span class="postbody">
<br/>
This is reasonable.  I would tell people not to call them outside of print mode and let broken undefined things happen if they are called in strange places.  This is up to you.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The highest bits of the return are used for control information (i.e. 'not printable', 'new line', 'breakable'). One could use the highest 16 bits for control.</td> </tr></table><span class="postbody">
<br/>
This works.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Would one have a font on the GBA that actually uses more than 65536 possible glyphs?</td> </tr></table><span class="postbody">
<br/>
I doubt it.  A more or less complete unicode font is a little over 60000.  I can't imagine anyone needing more than that.  If you allow font switching, they could always "bankswitch" fonts to use more than 65536 characters.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I see you would define a couple of structs instead, I dont understand how that would be more convenient. Maybe I am missing something</td> </tr></table><span class="postbody">
<br/>
Treating a single array as a struct is silly.  With isolated tables you could define both vertical and horizontal versions of a font using the same glyphset.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const glyphData_t gFontGlyph[] = 
<br/>
{
<br/>
   // 20,000 lines of font data 
<br/>
}; 
<br/>
<br/>
// Horizontal Proportional
<br/>
const widthData_t gFontWidth[] = 
<br/>
{
<br/>
   // 500 lines of width data 
<br/>
}; 
<br/>
<br/>
// Vertical Proportional
<br/>
const heightData_t gFontHeight[] = 
<br/>
{
<br/>
   // 500 lines of width data 
<br/>
}; 
<br/>
<br/>
const fontData_t gFontPropH = 
<br/>
{
<br/>
   gFontGlyph,    // Glyph Data 
<br/>
   0,             // Newline X Offset 
<br/>
   16,            // Newline Y Offset 
<br/>
   PROPORTIONAL,  // Newchar X Offset 
<br/>
   0,             // Newchar Y Offset 
<br/>
   gFontWidth,    // Proportional Width 
<br/>
   NULL,          // Proportional Height 
<br/>
   // anything else, bpp, etc 
<br/>
};
<br/>
<br/>
const fontData_t gFontPropV = 
<br/>
{
<br/>
   gFontGlyph,    // Glyph Data 
<br/>
   -16,           // Newline X Offset 
<br/>
   0,             // Newline Y Offset 
<br/>
   0,             // Newchar X Offset 
<br/>
   PROPORTIONAL,  // Newchar Y Offset 
<br/>
   gFontWidth,    // Proportional Width 
<br/>
   NULL,          // Proportional Height 
<br/>
   // anything else, bpp, etc 
<br/>
};
<br/>
<br/>
const fontData_t gFontFixH = 
<br/>
{
<br/>
   gFontGlyph,    // Glyph Data 
<br/>
   0,             // Newline X Offset 
<br/>
   16,            // Newline Y Offset 
<br/>
   16,            // Newchar X Offset 
<br/>
   0,             // Newchar Y Offset 
<br/>
   NULL,          // Proportional Height 
<br/>
   NULL,          // Proportional Height 
<br/>
   // anything else, bpp, etc 
<br/>
};
<br/>
<br/>
const fontData_t gFontFixV = 
<br/>
{
<br/>
   gFontGlyph,    // Glyph Data 
<br/>
   -16,           // Newline X Offset 
<br/>
   0,             // Newline Y Offset 
<br/>
   0,             // Newchar X Offset 
<br/>
   16,            // Newchar Y Offset 
<br/>
   NULL,          // Proportional Height 
<br/>
   NULL,          // Proportional Height 
<br/>
   // anything else, bpp, etc 
<br/>
};</td> </tr></table><span class="postbody">
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122553 - tepples - Tue Mar 20, 2007 6:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">texting is not done 20 times a second</td> </tr></table><span class="postbody">
<br/>
It is if you are using the same library to draw the player's score.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct{
<br/>
  char[4] ID;
<br/>
  u32 size;
<br/>
  s32 charcount,charwidth,charheight,defaultxoffset,defaultyoffset, ... etc
<br/>
  u32 widthcount,withoffset;  //points to array relative to struct base address
<br/>
  u32 heightcount,heightoffset;//same
<br/>
  u32 glyphcount,glyphoffset; //same
<br/>
  u32 charxoffsetcount,charxoffsetoffset;//same
<br/>
  u32 charyoffsetcount,charyoffsetoffset;//
<br/>
  u32 charwidth; //one could define it here, then one doesnt have to recompile despite using wide chars
<br/>
  u32 bpp,glyphwidth,glyphheight
<br/>
  ...probably some more stuff
<br/>
} Font</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
u32 for widths and heights? Isn't a u8 sufficient for text that fits on the GBA or DS screen?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122556 - Ant6n - Tue Mar 20, 2007 7:01 am</h4>
    <div class="postbody"><span class="postbody">of course, but these details can be worked out later (when its made sure that the alignment is right etc.). I like using header files for brainstorming, so they are floating alot until i actually finished the specification (and even then myself changing things, as long as there was no release things should be fine).
<br/>
<br/>
Actually it'd be better to use s8 on some of these; then -1 can have special meaning, i.e. 'PROPORTIONAL'. I was more trying to ask why this approach in general is less neat than using multiple arrays, as sgoes suggested.
<br/>
<br/>
I wonder, how much memory would people spare to an engine like for internal buffering?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122565 - HyperHacker - Tue Mar 20, 2007 7:48 am</h4>
    <div class="postbody"><span class="postbody">You can still use 0xFF instead of -1, and even make a #define out of it for convenience.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122566 - sgeos - Tue Mar 20, 2007 7:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">I like using header files for brainstorming, so they are floating alot until i actually finished the specification</td> </tr></table><span class="postbody">
<br/>
This is a fine way of doing things.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">Actually it'd be better to use s8 on some of these;</td> </tr></table><span class="postbody">
<br/>
Single item generic entries should probably use "int".  Arrays that need to be kept compact need to worry about space.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">then -1 can have special meaning, i.e. 'PROPORTIONAL'.</td> </tr></table><span class="postbody">
<br/>
IIRC, you can set u8 to -1, but it will end up being 255.  Not that it really matters.  Effective values should be in the range of 0 to about 40, unless someone wants to encode tab as a really wide/tall character.  A width of 127 should be enough.
<br/>
<br/>
Come to think of it, negative values might be legit for RTL writing systems.  -128 might work better for PROPORTIONAL.  It depends on how you want to handle things.  Being able to use the same table for LTR and RTL would be neat.  The table should be valid.
<br/>
<br/>
A mirror glyph mode (H-flip/V-flip/HV-flip) would be neat, but that is probably ultimately useless feature creep.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I was more trying to ask why this approach in general is less neat than using multiple arrays, as sgoes suggested.</td> </tr></table><span class="postbody">
<br/>
I'm not convinced that it is, really.  You seem to want files.  I like compiled data tables.  It's a little easier to set up data table export filters.  I do like having the option of recycling a 1300 ~ 6000 character glyphset, but I'll admit that chances are slim that both vertical and horizontal writing will be used in the same version of the game.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I wonder, how much memory would people spare to an engine like for internal buffering?</td> </tr></table><span class="postbody">
<br/>
String buffering or shadow VRAM?  The problem with sting buffering is, how long is the string?  Some strings are really long, especially once you start adding user input breaks and form feeds.
<br/>
<br/>
"And thus began the journey... [inputs][breaks]
<br/>
[18 pages later; this is an intro]
<br/>
...finally, they arrived at the gates of the small village."
<br/>
<br/>
"You know, my mommy tells her I talk her ear off and
<br/>
now I don't have anyone to talk to because my mommy
<br/>
told me to go outside and stop bothering her and...
<br/>
[insert the middle of the longest run on sentence ever]
<br/>
...potatoes."
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122570 - HyperHacker - Tue Mar 20, 2007 7:55 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">IIRC, you can set u8 to -1, but it will end up being 255.</td> </tr></table><span class="postbody">And GCC will complain.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">A mirror glyph mode (H-flip/V-flip/HV-flip) would be neat, but that is probably ultimately useless feature creep.</td> </tr></table><span class="postbody">If you're using a text-mode layer, it takes hardly any effort to implement. Just set the tile's H/V flip flags; you already have to set the palette flags in the same byte.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122572 - sgeos - Tue Mar 20, 2007 8:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">u32 for widths and heights? Isn't a u8 sufficient for text that fits on the GBA or DS screen?</td> </tr></table><span class="postbody">
<br/>
Spacewise, yes, but the u8 should really be typedefed to something like fontspan_t.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">You can still use 0xFF instead of -1, and even make a #define out of it for convenience.</td> </tr></table><span class="postbody">
<br/>
Always #define it.  Things change.  Always use typedefs.  Things change.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">IIRC, you can set u8 to -1, but it will end up being 255.</td> </tr></table><span class="postbody">And GCC will complain.</span></td> </tr></table><span class="postbody">
<br/>
How do I get it to complain?  It should complain, but this didn't for me:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// test.c
<br/>
int main(void)
<br/>
{
<br/>
        unsigned int x = -1;
<br/>
        return x;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">USER@Stardust ~/c/test
<br/>
$ gcc -Wall test.c -o test
<br/>
<br/>
USER@Stardust ~/c/test
<br/>
$ gcc -v
<br/>
Reading specs from /usr/lib/gcc/i686-pc-cygwin/3.4.4/specs
<br/>
Configured with: /usr/build/package/orig/test.respin/gcc-3.4.4-3/configure --ver
<br/>
bose --prefix=/usr --exec-prefix=/usr --sysconfdir=/etc --libdir=/usr/lib --libe
<br/>
xecdir=/usr/lib --mandir=/usr/share/man --infodir=/usr/share/info --enable-langu
<br/>
ages=c,ada,c++,d,f77,pascal,java,objc --enable-nls --without-included-gettext --
<br/>
enable-version-specific-runtime-libs --without-x --enable-libgcj --disable-java-
<br/>
awt --with-system-zlib --enable-interpreter --disable-libgcj-debug --enable-thre
<br/>
ads=posix --enable-java-gc=boehm --disable-win32-registry --enable-sjlj-exceptio
<br/>
ns --enable-hash-synchronization --enable-libstdcxx-debug
<br/>
Thread model: posix
<br/>
gcc version 3.4.4 (cygming special, gdc 0.12, using dmd 0.125)
<br/>
<br/>
USER@Stardust ~/c/test
<br/>
$</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">A mirror glyph mode (H-flip/V-flip/HV-flip) would be neat, but that is probably ultimately useless feature creep.</td> </tr></table><span class="postbody">If you're using a text-mode layer, it takes hardly any effort to implement. Just set the tile's H/V flip flags; you already have to set the palette flags in the same byte.</span></td> </tr></table><span class="postbody">
<br/>
Once you start using meta tiles you need to flip the tile matrix as well.  Sprites should be simple enough.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122595 - tepples - Tue Mar 20, 2007 5:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I was more trying to ask why this approach in general is less neat than using multiple arrays, as sgoes suggested.</td> </tr></table><span class="postbody">
<br/>
I'm not convinced that it is, really.  You seem to want files.  I like compiled data tables.</span></td> </tr></table><span class="postbody">
<br/>
The "files" approach is more viable on a platform without a large word-addressed memory, such as a Game Boy Advance game running from GBA Movie Player, a GBA game running from single-Pak multiplayer requesting files from the server over the serial link, or a Nintendo DS game.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The problem with sting buffering is, how long is the string?  Some strings are really long, especially once you start adding user input breaks and form feeds.</td> </tr></table><span class="postbody">
<br/>
If you only buffer the current "form" and the next "form", that shouldn't be too much of a problem.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">"And thus began the journey... [inputs][breaks]
<br/>
[18 pages later; this is an intro]
<br/>
...finally, they arrived at the gates of the small village."</td> </tr></table><span class="postbody">
<br/>
Ahh yes, the classic "second disc of Xenogears" school of game design. But do you really want to hang your entire cut scene system off your text engine?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122628 - sgeos - Tue Mar 20, 2007 9:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The problem with sting buffering is, how long is the string?  Some strings are really long, especially once you start adding user input breaks and form feeds.</td> </tr></table><span class="postbody">
<br/>
If you only buffer the current "form" and the next "form", that shouldn't be too much of a problem.</span></td> </tr></table><span class="postbody">
<br/>
Even the form is going to vary from game to game.  It you buffer the transformed form that is one thing, but once unprintable control characters show up all bets are off.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">"And thus began the journey... [inputs][breaks]
<br/>
[18 pages later; this is an intro]
<br/>
...finally, they arrived at the gates of the small village."</td> </tr></table><span class="postbody">
<br/>
Ahh yes, the classic "second disc of Xenogears" school of game design. But do you really want to hang your entire cut scene system off your text engine?</span></td> </tr></table><span class="postbody">
<br/>
No, but that doesn't mean that I won't have a message 18 forms long or longer somewhere else.  With embedded character portraits, this is quite feasible.  Consider something like Fire Emblem or Super Robot Wars- treating each dialogue as a single message (until bgs change/units get deployed, etc) is reasonable-
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">script(SCR_STAGE_01_00);   // load enemy base map
<br/>
message(MES_STAGE_01_01);  // plans at enemy base; 17 forms
<br/>
script(SCR_STAGE_01_01);   // launch enemy units
<br/>
script(SCR_STAGE_01_02);   // load battle map, deploy and move new units
<br/>
message(MES_STAGE_01_02);  // new units for this stage; 4 forms
<br/>
script(SCR_STAGE_01_03);   // deploy player units
<br/>
message(MES_STAGE_01_03);  // player meets new units; 31 forms
<br/>
script(SCR_STAGE_01_04);   // deploy enemy units
<br/>
message(MES_STAGE_01_04);  // ememy talks to new units; 7 forms
<br/>
gamestart();</td> </tr></table><span class="postbody">
<br/>
Naturally, all of this would actually exist in one big SCR_STAGE_01 script file (*) with the messages stored on the side and called from the script.
<br/>
<br/>
(*) this file may be exported to some other format before it run on the GBA (or DS, or toaster or whatever you want to run it on).
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122687 - HyperHacker - Wed Mar 21, 2007 6:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">How do I get it to complain?  It should complain, but this didn't for me:</td> </tr></table><span class="postbody">Maybe it only does that with hex numbers then.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122727 - sgeos - Wed Mar 21, 2007 3:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">How do I get it to complain?  It should complain, but this didn't for me:</td> </tr></table><span class="postbody">Maybe it only does that with hex numbers then.</span></td> </tr></table><span class="postbody">
<br/>
I created <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12785" target="_blank">a new thread</a> to talk about this.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
