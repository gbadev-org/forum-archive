<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Finding: The GBA window behaves oddly - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Graphics > Finding: The GBA window behaves oddly</h2>
<div id="posts">
<div class="post">
    <h4>#125786 - Dwedit - Tue Apr 17, 2007 12:47 am</h4>
    <div class="postbody"><span class="postbody">Illustration: <a href="http://home.comcast.net/~alanweiss3/dwedit/images/gbawindow.png">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
What's happening: At scanline #141, I'm updating DISPCNT and WIN0H.
<br/>
Here are the register values:
<br/>
<br/>
WIN0H (before):0...0
<br/>
WIN0H (after) :129...200
<br/>
WIN1H: 40...200
<br/>
WIN0V: 8...152
<br/>
WIN1V: 8...152
<br/>
WININ0: SFX O 3 _ 1 _
<br/>
WININ1: SFX O 3 2 1 0
<br/>
DISPCNT (before): W1 on, W0 off, Layer 3 off, layer 0,1,2 on
<br/>
DISPCNT (after): W1 on, W0 on, Layer 0,1,2,3 on
<br/>
<br/>
So basically 'layer 3' changes from off to on, and 'window 0 enabled' changes from off to on.  The window 1 stuff is probably irrelevant.
<br/>
<br/>
What's supposed to happen is that layer 3 gets enabled for Window 0, but instead, layer 3 stays disabled for 2 scanlines after the change!  The effect varies across emulators, NO$GBA shows what ideally should happen (wrong), and VisualBoyAdvance shows the layer disabled for only one scanline.
<br/>
Having layer 3 enabled in DISPCNT for all scanlines seems to fix the glitch.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125790 - DekuTree64 - Tue Apr 17, 2007 1:52 am</h4>
    <div class="postbody"><span class="postbody">It has nothing to do with the window. It is a known hardware limitation that turning on a BG layer takes a couple scanlines (and if I remember right, displays random garbage in the meantime). However, you can change an active BG's settings all you want, so you can point it to a blank screen map to effectively turn it off.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125791 - tepples - Tue Apr 17, 2007 1:54 am</h4>
    <div class="postbody"><span class="postbody">DekuTree64 is right.
<br/>
<br/>
In another topic (several years ago?) about mid-screen mode changes such as those used in <span style="font-style: italic">F-Zero</span> and <span style="font-style: italic">Mario Kart</span> games, we discovered that turning layers on and off mid-screen using DISPCNT causes artifacts for a few scanlines. Using the window registers produces the desired effect. But unfortunately, phpBB search is insufficient and forum.gbadev.org blocks Googlebot, so I can't dig up more information.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125935 - gladius - Wed Apr 18, 2007 10:00 am</h4>
    <div class="postbody"><span class="postbody">I think this was the thread you were talking about Tepples: <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=1303&amp;highlight=" target="_blank">http://forum.gbadev.org/viewtopic.php?t=1303&amp;highlight=</a>.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
