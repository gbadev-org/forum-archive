<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Teething background problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Graphics > Teething background problem</h2>
<div id="posts">
<div class="post">
    <h4>#118365 - neilio - Mon Feb 12, 2007 8:53 pm</h4>
    <div class="postbody"><span class="postbody">Yet another query :)
<br/>
<br/>
I'm trying to get a first tiled background program working but I can't seem to get the tilemap to work - the character graphics and palette (apparently) loads fine but all I get is a screen full of the 1st character graphic...
<br/>
<br/>
I'm hazarding a guess that whatever is causing it is around the <span style="color: green"><span style="font-weight: bold">//copy in the tile map data</span> </span>area or with the pointer to the screen base block.
<br/>
<br/>
Apologies for including long program code in a post but I'm not familiar with any file hosting sites at the moment! As always I'm using PERN headers.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include"gba.h"
<br/>
#include "bob.h"   
<br/>
#include "bob.c"  //graphics, palette and map data
<br/>
<br/>
// Globals to hold the key state
<br/>
u16 key_curr=0, key_prev=0;
<br/>
<br/>
//palette for background tiles
<br/>
#define BG_PALETTE_MEM (0x05000000)
<br/>
<br/>
///main entry point
<br/>
int main(void)
<br/>
{
<br/>
   int i;
<br/>
   u16 ii;
<br/>
<br/>
   //creat pointers to vram
<br/>
   u16* vramMap = (u16*)SCREEN_BASE_BLOCK(31);
<br/>
   u16* vramTiles = (u16*)MAP_BASE_BLOCK(0);
<br/>
   u16* vramBGPalette = (u16*)BG_PALETTE_MEM;    
<br/>
      
<br/>
   //copy the tile graphics in character graphics mem, 4bitsperpixel
<br/>
      for(i = 0; i &lt; 32; i++)
<br/>
            vramTiles[i] = bobTiles[i];  
<br/>
<br/>
   //copy in the palette, 16 colour palette
<br/>
   for(i = 0; i &lt; 16; i++)
<br/>
      vramBGPalette[i] = bobPal[i];
<br/>
<br/>
   //copy in the tile map data
<br/>
      for(i = 0; i &lt; 16*16; i++)
<br/>
            vramMap[i] = bobMapTiles[i];
<br/>
<br/>
   // set up BG0 for a 4bpp 32x32t map, using
<br/>
   //   using charblock 0 and screenblock 31
<br/>
   REG_BG0CNT = MAP_BASE_BLOCK(0) | SCREEN_BASE_BLOCK(31) | BG_COLOR_16 | TEXTBG_SIZE_256x256;
<br/>
<br/>
   SetMode(MODE_0 | BG0_ENABLE);   
<br/>
<br/>
   //main loop
<br/>
   while(1)
<br/>
   {
<br/>
      if(key_released(KEY_A))
<br/>
      {
<br/>
         ii=10;
<br/>
         REG_BG0HOFS=ii;
<br/>
         REG_BG0VOFS=ii;
<br/>
      }
<br/>
   }   
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
bob.c -&gt;
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const unsigned short bobPal[16]=
<br/>
{
<br/>
   0x0000,0xF0F0,0x0200,0x0210,0x4000,0x4010,0x4200,0x6318,
<br/>
   0x4210,0x001F,0x03E0,0x03FF,0x7C00,0x7C1F,0x7FE0,0x7FFF,
<br/>
};
<br/>
<br/>
const unsigned short bobTiles[32]=
<br/>
{
<br/>
   0x1000,0x0000,0x0000,0x0000,
<br/>
   0x0000,0x0000,0x0000,0x0000,
<br/>
   0x0000,0x0000,0x0000,0x0000,
<br/>
   0x0000,0x0000,0x0000,0x0000,
<br/>
<br/>
   0x1111,0x1111,0x1111,0x1111,
<br/>
   0x1111,0x1111,0x1111,0x1111,
<br/>
   0x1111,0x1111,0x1111,0x1111,
<br/>
   0x1111,0x1111,0x1111,0x1111,
<br/>
};
<br/>
<br/>
const unsigned short bobMapTiles[16*16]=
<br/>
{
<br/>
   0,1,1,1,1,1,1,1,
<br/>
   1,0,1,1,1,1,1,1,
<br/>
   1,1,0,1,1,1,1,1,
<br/>
   1,1,1,0,1,1,1,1,
<br/>
   1,1,1,1,0,1,1,1,
<br/>
   1,1,1,1,1,0,1,1,
<br/>
   1,1,1,1,1,1,0,1,
<br/>
   1,1,1,1,1,1,1,0,
<br/>
<br/>
   0,1,1,1,1,1,1,1,
<br/>
   1,0,1,1,1,1,1,1,
<br/>
   1,1,0,1,1,1,1,1,
<br/>
   1,1,1,0,1,1,1,1,
<br/>
   1,1,1,1,0,1,1,1,
<br/>
   1,1,1,1,1,0,1,1,
<br/>
   1,1,1,1,1,1,0,1,
<br/>
   1,1,1,1,1,1,1,0,
<br/>
<br/>
   0,1,1,1,1,1,1,1,
<br/>
   1,0,1,1,1,1,1,1,
<br/>
   1,1,0,1,1,1,1,1,
<br/>
   1,1,1,0,1,1,1,1,
<br/>
   1,1,1,1,0,1,1,1,
<br/>
   1,1,1,1,1,0,1,1,
<br/>
   1,1,1,1,1,1,0,1,
<br/>
   1,1,1,1,1,1,1,0,
<br/>
<br/>
   0,1,1,1,1,1,1,1,
<br/>
   1,0,1,1,1,1,1,1,
<br/>
   1,1,0,1,1,1,1,1,
<br/>
   1,1,1,0,1,1,1,1,
<br/>
   1,1,1,1,0,1,1,1,
<br/>
   1,1,1,1,1,0,1,1,
<br/>
   1,1,1,1,1,1,0,1,
<br/>
   1,1,1,1,1,1,1,0,
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
bob.h -&gt;
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef __BOB__
<br/>
#define __BOB__
<br/>
<br/>
#define bobPalLen 32
<br/>
extern const unsigned short bobbyPal[16];
<br/>
<br/>
#define bobTilesLen 64
<br/>
extern const unsigned short bobbyTiles[32];
<br/>
<br/>
#endif // __BOB__
<br/>
</td> </tr></table><span class="postbody"><span style="color: green"></span><br/>_________________<br/>I'd like to think this signature is under development, but it isn't.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118390 - Cearn - Tue Feb 13, 2007 12:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>neilio wrote:</b></span></td> </tr> <tr> <td class="quote">Yet another query :)
<br/>
<br/>
I'm trying to get a first tiled background program working but I can't seem to get the tilemap to work - the character graphics and palette (apparently) loads fine but all I get is a screen full of the 1st character graphic...
<br/>
<br/>
I'm hazarding a guess that whatever is causing it is around the <span style="color: green"><span style="font-weight: bold">//copy in the tile map data</span> </span>area or with the pointer to the screen base block.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It's this line:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>neilio wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   // set up BG0 for a 4bpp 32x32t map, using
<br/>
   //   using charblock 0 and screenblock 31
<br/>
   REG_BG0CNT = MAP_BASE_BLOCK(0) | SCREEN_BASE_BLOCK(31) | BG_COLOR_16 | TEXTBG_SIZE_256x256;
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
MAP_BASE_BLOCK and SCREEN_BASE_BLOCK are used to get the addresses in VRAM for the tiles and the map, respectively. They return values in the 0x06000000 range. What you put in REG<span style="font-style: italic">x</span>CNT are just indices, which libpern doesn't have macros for. You could try these from libgba:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define BG_TILE_BASE(m)    ((m) &lt;&lt; 2)
<br/>
#define BG_MAP_BASE(m)     ((m) &lt;&lt; 8)
<br/>
</td> </tr></table><span class="postbody">
<br/>
use BG_TILE_BASE for the charblock index and BG_MAP_BASE for the screenblock index. Aside from that the code runs fine.
<br/>
<br/>
Note that the terms SCREEN and MAP are <span style="font-style: italic">both</span> used to refer to the place maps are stored, not the (graphics) tiles. Using the name 'MAP_BASE_BLOCK' for tiles instead of the map is misleading to say the least. Also, if you add casting operators to the macros you're using, you wouldn't have to cast them manually when using them later in the code and  the infinite loop needs a VBlank synchronizer and key_poll to work properly.
<br/>
<br/>
And of course, don't use u16 for local variables, or #include data or code. :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118393 - sgeos - Tue Feb 13, 2007 1:07 am</h4>
    <div class="postbody"><span class="postbody">Was beaten in the middle of a response.  Here are a few tips to coding style and error reduction.
<br/>
<br/>
You shouldn't include *.c files.  Compile using something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gcc -Wall -o target target.c data.c</td> </tr></table><span class="postbody">
<br/>
<br/>
Hard coding sizes can lead to errors (unless it's automated and the automation works).  I generally declare arrays like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">type_t myArray[] =
<br/>
{
<br/>
   // data here
<br/>
};
<br/>
// gives number of bytes
<br/>
int myArraySize = sizeof(myArray);
<br/>
// OR gives number of members, depending on what you want
<br/>
int myArraySize = sizeof(myArray) / sizeof(type_t);
<br/>
<br/>
// loop
<br/>
for (i = 0; i &lt; myArraySize; i++)
<br/>
   // do something</td> </tr></table><span class="postbody">
<br/>
<br/>
You could so something like this instead:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define MY_ARRAY_SIZE 1234
<br/>
type_t myArray[MY_ARRAY_SIZE] =
<br/>
{
<br/>
   // data here
<br/>
};</td> </tr></table><span class="postbody">
<br/>
When my code does something I don't expect, first I use VBA's memory viewing features (tile, map, memory, etc) to make sure that things are loading properly.  I also use the I/O viewer to make sure that registers are being set properly.  I'll pull out <a class="postlink" href="http://www.work.de/nocash/gbatek.htm" target="_blank">gbatek</a> for reference if need be.  (Usually the case.)
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118419 - HyperHacker - Tue Feb 13, 2007 8:29 am</h4>
    <div class="postbody"><span class="postbody">What is the advantage to passing each .c file to the compiler separately instead of #including them?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118424 - Diddl - Tue Feb 13, 2007 11:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">What is the advantage to passing each .c file to the compiler separately instead of #including them?</td> </tr></table><span class="postbody">
<br/>
<br/>
including .c files is same than packing all together in a big .c file. 
<br/>
<br/>
<br/>
if a project grows bigger and bigger, it will be more and more difficult to understand this or to find any bugs and so on.
<br/>
<br/>
so it is better to split a code in many small parts. each part (.c file) does a simple task and could tested stand alone. and of course each part maybe can used in another project again (without testing and without splitting/changing).
<br/>
<br/>
and of course, if you use any .c file in nearly every project, you can make a precompiled library (.a file) from it, like this libfat and this libnds for example ...  ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118430 - sgeos - Tue Feb 13, 2007 1:00 pm</h4>
    <div class="postbody"><span class="postbody">Without modular code, it is hard to make large projects.  I'd hate to see 50,000 or 500,000 lines of code in a single file.
<br/>
<br/>
Large projects have many modules.  Let's say 200, just so that we have number.  If you were to include all of the other modules in main.c, you would have something that looks like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;gba.h&gt;
<br/>
#include "everything_else_i_need.h"
<br/>
#include "my_module_0.c"
<br/>
#include "my_module_1.c"
<br/>
// ... much later ...
<br/>
#include "my_module_199.c"
<br/>
<br/>
int main(void)
<br/>
{
<br/>
  // do something
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Including 200 files is goofy.  I guess it would work, although it is odd and nobody programs like that.  Keep in mind that you'll have to rebuild everything- every module, every time you make a single change, because they are one big bundle.  With large projects, this can take time.
<br/>
<br/>
If you do modularize, but include *.c files in different modules, there is a good chance you'll end up with two copys of the data.  #include "something.file" basically means, open "something.file", select all, copy, and then paste it all into this file.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118433 - keldon - Tue Feb 13, 2007 1:23 pm</h4>
    <div class="postbody"><span class="postbody">Let's just begin by saying it is the <span style="font-weight: bold">wrong way</span>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118438 - sgeos - Tue Feb 13, 2007 1:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">Let's just begin by saying it is the <span style="font-weight: bold">wrong way</span>.</td> </tr></table><span class="postbody">
<br/>
I hate it when people don't give reasons.  Why?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118466 - tepples - Tue Feb 13, 2007 7:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">Without modular code, it is hard to make large projects.</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">I hate it when people don't give reasons.  Why?</td> </tr></table><span class="postbody">
<br/>
Because you already did.
<br/>
<br/>
Also, there comes a time when understanding the reasons behind best practices is useful to a beginner, but this comes at least weeks after the time when the beginner needs to learn best practices. Beginners may have trouble understanding the best practices themselves, let alone the reasons. For instance, when you learned silent "e" in elementary school, did the teacher tell you exactly why it was silent? (Latin feminine ending <span style="font-style: italic">a</span> becomes French feminine ending <span style="font-style: italic">e</span> which was once pronounced, but languages change over generations, and final -e became dropped from pronunciation due to the inherent laziness in language acquisition. Use with English long vowels came as an analogy to use with Norman French long vowels. The reasons behind this, in turn, involve a history of the Norman Conquest.)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118483 - Miked0801 - Tue Feb 13, 2007 9:42 pm</h4>
    <div class="postbody"><span class="postbody">I doubt my teacher even knew that.  I love it when I find stuff like this :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118491 - HyperHacker - Tue Feb 13, 2007 11:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">What is the advantage to passing each .c file to the compiler separately instead of #including them?</td> </tr></table><span class="postbody">
<br/>
<br/>
including .c files is same than packing all together in a big .c file. 
<br/>
<br/>
<br/>
if a project grows bigger and bigger, it will be more and more difficult to understand this or to find any bugs and so on.
<br/>
<br/>
so it is better to split a code in many small parts. each part (.c file) does a simple task and could tested stand alone. and of course each part maybe can used in another project again (without testing and without splitting/changing).
<br/>
<br/>
and of course, if you use any .c file in nearly every project, you can make a precompiled library (.a file) from it, like this libfat and this libnds for example ...  ;)</span></td> </tr></table><span class="postbody">
<br/>
Yeah, I know what #include does, but the code is still in separate files. GCC still tells me which file an error occurrs in, I can share the same file between multiple projects, etc... I fail to see how it's at all different. Do some compilers not like it? Is it slower?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118500 - keldon - Tue Feb 13, 2007 11:52 pm</h4>
    <div class="postbody"><span class="postbody">Like someone else said, include is telling the compiler to copy and paste the code from that file into this file however it is written. If you include the file twice then the code is copy and pasted twice. If you edit any one of the files then the entire project has to be recompiled. So yes it is slower; much much much slower.
<br/>
<br/>
Also you are likely to encounter many problems working in this way! It eventually becomes impractical to include .c files.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118506 - HyperHacker - Wed Feb 14, 2007 12:23 am</h4>
    <div class="postbody"><span class="postbody">What kind of problems? And how could I avoid recompiling everything else after one file changes? It's also not exactly difficult to avoid including a file twice.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118512 - tepples - Wed Feb 14, 2007 1:01 am</h4>
    <div class="postbody"><span class="postbody">One kind of problem is the "multiple definition" error.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">And how could I avoid recompiling everything else after one file changes?</td> </tr></table><span class="postbody">
<br/>
A .h file contains only macros, type definitions, enumerated constant definitions, extern variable declarations, function prototypes, and static inline functions. A .c file #includes only .h files. If you use <span style="font-weight: bold">arm-eabi-gcc -c</span> to recompile one .c file into a .o file, then you can link all the .o files together into a .exe without having to recompile all the .c files.
<br/>
<br/>
<a class="postlink" href="http://www.gnu.org/software/make/" target="_blank">GNU Make</a> allows you to write "makefiles", or definitions of what files are created from other files and how to rebuild them, and automatically calls the programs you specify to rebuild each derived file (e.g. *.o, *.elf, *.gba, *.gbfs) when a file it depends on (e.g. *.c, *.h, *.chr) changes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">It's also not exactly difficult to avoid including a file twice.</td> </tr></table><span class="postbody">
<br/>
Unless you have files that include other files, which in turn include other files.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118520 - sgeos - Wed Feb 14, 2007 1:31 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Also, there comes a time when understanding the reasons behind best practices is useful to a beginner, but this comes at least weeks after the time when the beginner needs to learn best practices.</td> </tr></table><span class="postbody">
<br/>
I know.  I operate on the theory that it is better to give an incomprehensible answer, than something like "because it's wrong".  The short answer seems to imply that "you wouldn't get it, so I won't tell you".  Sometimes this is case, sometimes it isn't.  I think that making assumptions like this is wrong <span style="font-weight: bold">because</span> the person you are talking might actually be receptive to the information; they may never have had a chance to hear it before.
<br/>
<br/>
If you don't want tell someone the right way to do things because you don't have enough time, fine.  In that case I think that it would be best to say "There are a bunch of good reasons not to do things this way, but I don't have time to explain them now.  ... is the correct way of doing things."
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">What kind of problems?</td> </tr></table><span class="postbody">
<br/>
As tepples said, multiple definition.  If you only include *.c files in main, I don't think that you will run into this problem.  Once projects start growing, and modules start to depend on other modules, you'll need to pass information between them.  All of that information should be in the module itself.  "I need to be able to send messages, call the random number generator and spawn items."
<br/>
<br/>
If you include that information in the modules, and include *.c files in main, you'll bump into multiple definition errors.  If you use the order of definition in main to imply dependencies, you'll have to use the same ordering in future project.  This is a bit of a hassle for you, but there is much larger problem with this- it is a great hastle for everyone else.
<br/>
<br/>
If you expect me to be able to read your mind, I'm not going to hire you;  nobody else will either.  In large projects, you deal with multiple people.  Other people need to be able to understand what you write.  If you get hit by a car a month before the game masters, somebody needs to finish what you are doing.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And how could I avoid recompiling everything else after one file changes?</td> </tr></table><span class="postbody">
<br/>
By compiling *.c separately files and then linking them.  Ie, by not including *.c files.  If you include everything, you copy and paste everything into one big file, compile it.  You don't need to link because you are compiling every all at once.  Every time.  No matter what.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It's also not exactly difficult to avoid including a file twice.</td> </tr></table><span class="postbody">
<br/>
It's not hard to keep small projects organized.  As they grow, things get more difficult.  Even if you can sort out dependencies and avoid including the same file twice, the project structure will be alien to others.
<br/>
<br/>
And it will require complete rebuild after every change.  And you'll need to include everything in main.  The number of files included in main.c will just keep growing to the point where it is silly.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118612 - neilio - Wed Feb 14, 2007 5:49 pm</h4>
    <div class="postbody"><span class="postbody">Cearn-&gt;
<br/>
<br/>
Thanks for pointing out the most vital problem, pretty stupid trying to put a memory address pointer instead of an indice into a register! I'll be sure not to do that again.
<br/>
<br/>
I've changed things so I'm using SCREEN/TILE, not MAP/TILE, should be easier to follow.
<br/>
<br/>
Which macros were the ones you said about casting? Casting's something I need to learn about :P
<br/>
<br/>
Vblank synchronizer/key poll put back in, deleted them for no apparent reason!
<br/>
<br/>
Sgeos-&gt;
<br/>
<br/>
I'm now using sizeof(), makes things easier to manage!
<br/>
<br/>
<br/>
Thanks for pointing me in the right direction of good practices too :) background works great now!<br/>_________________<br/>I'd like to think this signature is under development, but it isn't.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118616 - gauauu - Wed Feb 14, 2007 6:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>neilio wrote:</b></span></td> </tr> <tr> <td class="quote">...pretty stupid trying to put a memory address pointer instead of an indice into a register! </td> </tr></table><span class="postbody">
<br/>
<br/>
Not to pick nits, but just for your sake in the future, the singular of indices is index, not indice.   Pretty understandable mistake, though :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118617 - Cearn - Wed Feb 14, 2007 6:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>neilio wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Which macros were the ones you said about casting? Casting's something I need to learn about :P
<br/>
</td> </tr></table><span class="postbody">
<br/>
These:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define CHAR_BASE_BLOCK(n)         (((n)*0x4000)+0x6000000)
<br/>
#define SCREEN_BASE_BLOCK(n)       (((n)*0x800)+0x6000000)
<br/>
#define BG_PALETTE_MEM              (0x05000000) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
still require casts when using them (u16*)BG_PALETTE_MEM and such instead of just BG_PALETTE_MEM.
<br/>
<br/>
These macros do not require the user to use explicit casts:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define CHAR_BASE_BLOCK(n)         ( (u16*)(0x06000000+(n)*0x4000))
<br/>
#define SCREEN_BASE_BLOCK(n)       ( (u16*)(0x06000000+(n)*0x800))
<br/>
#define BG_PALETTE_MEM              ((u16*)0x05000000) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You can also map matrices over VRAM like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef u16         SCREENBLOCK[1024];
<br/>
#define se_mem      ((SCREENBLOCK*)0x06000000)
<br/>
<br/>
// Copy bobMapTiles to Screenblock 31:
<br/>
for(ii=0; ii&lt;sizeof(bobMapTiles); ii++)
<br/>
    se_mem[31][ii]= bobMapTiles[ii];
<br/>
</td> </tr></table><span class="postbody">
<br/>
Tonc's code uses se_mem for screenblocks and tile_mem for charblocks. The nice thing about the latter is that the tile indices will be the same as those in the screen entries and attr2 of objects, which makes it easier to see what goes where. Besides, TILE copies much faster than u16 copies, but then so it almost every copy method. 
<br/>
<br/>
There's also a macro in libgba called MAP which is a triple indexed array: MAP[sbb][ty][tx] is screen-entry ([<span style="font-style: italic">tx</span>, <span style="font-style: italic">ty</span>) in block <span style="font-style: italic">sbb</span>. Things like these make locating stuff much easier.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118702 - neilio - Thu Feb 15, 2007 9:39 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, that helps to make things a bit more managable with the code. Run into a couple more problems but I'll save them for another thread since they're not related to backgrounds!<br/>_________________<br/>I'd like to think this signature is under development, but it isn't.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118915 - HyperHacker - Sun Feb 18, 2007 5:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">One kind of problem is the "multiple definition" error.</td> </tr></table><span class="postbody">
<br/>
I generally avoid that by wrapping in #ifnded:
<br/>
<br/>
#ifndef FILE_C_INCLUDED
<br/>
#define FILE_C_INCLUDED
<br/>
//code goes here
<br/>
#endif
<br/>
<br/>
No matter how many times you include this file, it's only processed once, unless you do something silly like undefine FILE_C_INCLUDED.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">And how could I avoid recompiling everything else after one file changes?</td> </tr></table><span class="postbody">
<br/>
A .h file contains only macros, type definitions, enumerated constant definitions, extern variable declarations, function prototypes, and static inline functions. A .c file #includes only .h files. If you use <span style="font-weight: bold">arm-eabi-gcc -c</span> to recompile one .c file into a .o file, then you can link all the .o files together into a .exe without having to recompile all the .c files.
<br/>
<br/>
<a class="postlink" href="http://www.gnu.org/software/make/" target="_blank">GNU Make</a> allows you to write "makefiles", or definitions of what files are created from other files and how to rebuild them, and automatically calls the programs you specify to rebuild each derived file (e.g. *.o, *.elf, *.gba, *.gbfs) when a file it depends on (e.g. *.c, *.h, *.chr) changes.[/quote]
<br/>
So what you're saying is if each source file is compiled to its own object file, there will never be a need to recompile one source file that hasn't changed just because another has? That makes sense, and I suppose if compiling was taking a long time, I could exploit this by storing somewhere the date and time each file was last compiled, and only recompiling if the last modification date is later than this. So far, though, I don't think I've had anything take more than 10 seconds to compile, even with tens of thousands of lines. I'd end up recompiling them all anyway, because just typing "make" is easier than "make file.c".
<br/>
<br/>
<br/>
Bit off topic?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118938 - sgeos - Sun Feb 18, 2007 11:31 am</h4>
    <div class="postbody"><span class="postbody">make automatically pays attention to dates for you.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118990 - wintermute - Sun Feb 18, 2007 11:49 pm</h4>
    <div class="postbody"><span class="postbody">Not only that but the handy devkitPro makefiles autogenerate dependencies on the fly. This means that if headers used by a particular .c/.cpp file change then that file will be rebuilt.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119018 - HyperHacker - Mon Feb 19, 2007 3:40 am</h4>
    <div class="postbody"><span class="postbody">Nice. Where does this date info get stored?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119024 - gauauu - Mon Feb 19, 2007 4:05 am</h4>
    <div class="postbody"><span class="postbody">It just compares the last modified dates (stored by the operating system) of the result file and the dependancy files.  For example, in compiling a C file to a obj file, it compares the dates of the C file and the obj file.  If the obj file is the most recently modified, then it knows it is up to date.  If the C file was modified more recently, it can tell that it needs to regenerate the obj file.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119060 - sgeos - Mon Feb 19, 2007 12:10 pm</h4>
    <div class="postbody"><span class="postbody">The date info is stored with each file.  Read the previous post for more information.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
