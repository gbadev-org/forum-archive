<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Algorithmically generated animation to images - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Graphics > Algorithmically generated animation to images</h2>
<div id="posts">
<div class="post">
    <h4>#37598 - kajic - Mon Mar 14, 2005 12:59 am</h4>
    <div class="postbody"><span class="postbody">I feel the need for a c/c++ function that takes data about an image and when given a command dumps the image to a file. I would like to use such a function to be able to extract the images of an animation generated by some algorithm. So I let my algorithm create a frame in an animation and as the frame is created I send its data to this function, and at the end of each cycle of the algorithm I tell the function to dump an image containing the data sent to it.
<br/>
I am thinking about making this function myself but I though maybe someone has already done something similar and feels like sharing the source.
<br/>
<br/>
- Robert</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37601 - sajiimori - Mon Mar 14, 2005 1:31 am</h4>
    <div class="postbody"><span class="postbody">Are you talking about building a 2D array of colors algorithmically and then writing a file based on that?  Do you already have the code to generate the array?
<br/>
<br/>
Depending on the image format you want to produce, the procedure for writing the array to a file might be trivial.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37604 - kajic - Mon Mar 14, 2005 2:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Are you talking about building a 2D array of colors algorithmically and then writing a file based on that?  Do you already have the code to generate the array?
<br/>
<br/>
Depending on the image format you want to produce, the procedure for writing the array to a file might be trivial.</td> </tr></table><span class="postbody">
<br/>
<br/>
I am not talking of any algorithm in particular. I am thinking of making a game in which a lot of the animations can be genrated with code. So what I am looking for is a way to calculate those animations in beforehand and then just dump each frame of an animation to an image. I would then convert the images to sprites and use them in my animations. 
<br/>
So lets say I have an algorithm that while looping makes some animation. I want a function that my algorithm can send the pixels calculated to and at the end of each frame tell the function to dump all pixels to an image. The declaration of the function could for example look like this: 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct image {
<br/>
   int red;
<br/>
   int green;
<br/>
   int blue;
<br/>
   struct image *next;
<br/>
} image;
<br/>
<br/>
void d2img(image *i, int red, int green, int blue, int width, int dump) {
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So in this particullar case lets say I first call the function a few hundred times with various rgb values. For each call it would store the values into the linked list suplied. When I finally call the function with dump set to 1 it would generate a image of some nice format (jpg,gif,etc.) from the data in the linked list (the width argument would be used to tell the function when to break the image into a new row). 
<br/>
The boring part (the part that made me post here hoping someone allready did all this) is I dont want to spend time learning how to generate an image.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37610 - tepples - Mon Mar 14, 2005 5:57 am</h4>
    <div class="postbody"><span class="postbody">For one thing, you do <span style="font-style: italic">not</span> put pixels in a linked list. Make a two dimensional array, and then we'll talk.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37611 - poslundc - Mon Mar 14, 2005 6:43 am</h4>
    <div class="postbody"><span class="postbody">There are endless possibilities of mathematically interesting images and animations you can generate, thanks to endless mathematics that can be used to govern image generation.
<br/>
<br/>
But you are unlikely to find that someone will have pre-created something that suits your particular needs, especially if you want a tool that conveniently generates the images and exports the results to a GBA-compatible format.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37612 - sajiimori - Mon Mar 14, 2005 6:53 am</h4>
    <div class="postbody"><span class="postbody">It's difficult to make any sort of meaningful response because your description of your intent is vague, and you seem to have decided upon a very strange architecture that doesn't fit the work that needs to be done.
<br/>
<br/>
It doesn't help things to talk in terms of nebulous ideas like dumping animation frames to images, converting images to sprites, or sending pixels to a function and then telling it to dump those pixels to an image.  These formulations don't fit the actual nature of the concepts involved.
<br/>
<br/>
Just focus on expressing what you actually want to accomplish, and not the architecture behind it, then we can talk about some reasonable ways to go about it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37626 - kajic - Mon Mar 14, 2005 11:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">For one thing, you do <span style="font-style: italic">not</span> put pixels in a linked list. Make a two dimensional array, and then we'll talk.</td> </tr></table><span class="postbody">
<br/>
<br/>
It seems like you are missing my point. My example was just indended to show what I was talking about, the linked list was just an idea of how to store the image, not something I have decided I MUST use. But I wouldn't mind if you could explain what is wrong with a linked list as I dont see it myself. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">It's difficult to make any sort of meaningful response because your description of your intent is vague, and you seem to have decided upon a very strange architecture that doesn't fit the work that needs to be done.
<br/>
<br/>
It doesn't help things to talk in terms of nebulous ideas like dumping animation frames to images, converting images to sprites, or sending pixels to a function and then telling it to dump those pixels to an image. These formulations don't fit the actual nature of the concepts involved.
<br/>
<br/>
Just focus on expressing what you actually want to accomplish, and not the architecture behind it, then we can talk about some reasonable ways to go about it.</td> </tr></table><span class="postbody">
<br/>
<br/>
The only reason I expressed myself as I did is I was hoping it would make you better understand what I was talking about. I am sorry it turned out to be nebulous.
<br/>
I don't know if there is any good in trying to explain again because I would probably end up repeating myself but I'll try one more time (in a very short way).
<br/>
<br/>
I am looking for a function that given data about a image will create a file of a well known format. The data given to it hasn't to be in a linked list but can be handed over in any way convenient, the linked list was just a though of mine.
<br/>
I just came to think of GD and I guess there should be something in it that suits my needs even if you still don't understand what I am talking about. Ill be sure to post the source here when I'm done though and hopefully you will then.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37641 - josath - Mon Mar 14, 2005 6:03 pm</h4>
    <div class="postbody"><span class="postbody">it seems like to me, all you are asking is if there are librarys that support writing image files. the answer is yes, lots and lots of them. there are many free ones. names like libpng or libjpeg are specific to one image format. try searching on google for 'c image library' , or sourceforge.net for just 'image library', you'll find dozens of more generic ones that handle many formats.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37642 - poslundc - Mon Mar 14, 2005 6:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kajic wrote:</b></span></td> </tr> <tr> <td class="quote">I am looking for a function that given data about a image will create a file of a well known format. The data given to it hasn't to be in a linked list but can be handed over in any way convenient, the linked list was just a though of mine.
<br/>
I just came to think of GD and I guess there should be something in it that suits my needs even if you still don't understand what I am talking about. Ill be sure to post the source here when I'm done though and hopefully you will then.</td> </tr></table><span class="postbody">
<br/>
<br/>
GD is great. I've used the PHP interface to it pretty much exclusively for the various GBA tools programming I've done. If all you want is a way to generate image files from your own internal representation of an image, you can't go wrong with GD.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37656 - tepples - Mon Mar 14, 2005 9:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kajic wrote:</b></span></td> </tr> <tr> <td class="quote">It seems like you are missing my point. My example was just indended to show what I was talking about, the linked list was just an idea of how to store the image, not something I have decided I MUST use.</td> </tr></table><span class="postbody">
<br/>
I strongly deprecated linked lists because I felt that they were clouding both your concept and our concept of what you really want to accomplish. Sometimes you need to crawl before you walk; start by learning the basics of digital signal processing.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But I wouldn't mind if you could explain what is wrong with a linked list as I dont see it myself. </td> </tr></table><span class="postbody">
<br/>
The most common data structure for a digital signal is an array, also called a vector. As images are two-dimensional signals, one would use a two-dimensional array. Programs that must handle images of various sizes will use a one-dimensional array treated as two-dimensional in software. Accessing an element in an array takes O(1) time. A linked list with one pixel per list element, on the other hand, will use half the memory for pointers, and accessing the nth element by number is O(n).
<br/>
<br/>
Anyway, you typically convert images to and from well-known image formats using a library such as GD, and you typically convert images to and from platform-specific image formats using your own code written to the platform's documentation. For GBA data formats, one complete reference is GBATEK by Martin Korth.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Mon Mar 14, 2005 9:34 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#37659 - kajic - Mon Mar 14, 2005 9:32 pm</h4>
    <div class="postbody"><span class="postbody">josath: Well I guess it is :) 
<br/>
I just got GD compiled and managed to compile a simple program using it. I had problems at first as I didnt realize gcc required the path of libgd.a to be specified. Anyway, now that it works I guess I have everything I indended to ask for in my first post. 
<br/>
Thanks for trying to help anyway! 
<br/>
<br/>
PS. 
<br/>
A friend pointed out the benefits of storing the image in a 2d array instead of a linked list :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37668 - kajic - Mon Mar 14, 2005 11:29 pm</h4>
    <div class="postbody"><span class="postbody">Here is a simple program I wrote that should explain what I was looking for. 
<br/>
UPDATE:
<br/>
I added the ability to export to a gif-animation. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include&lt;gd.h&gt;
<br/>
#include&lt;stdio.h&gt;
<br/>
#include&lt;stdlib.h&gt;
<br/>
#include&lt;string.h&gt;
<br/>
<br/>
#define WIDTH 320
<br/>
#define HEIGHT 240
<br/>
#define GIF_NAME "animation.gif"
<br/>
<br/>
<br/>
/* determine if a file exists */
<br/>
<br/>
int fileExists(char *filename) {
<br/>
  /* declare file */
<br/>
  FILE *file;
<br/>
  
<br/>
  /* try to open file */
<br/>
  if ((file = fopen(filename, "r")) == NULL) 
<br/>
    return 0;
<br/>
<br/>
  /* as the file exists we must close it */
<br/>
  fclose(file);
<br/>
  return 1;
<br/>
}
<br/>
<br/>
<br/>
/* add the frame to the gif-animation specified by GIF_NAME. if no such 
<br/>
   animation exists one will be created and before we add the frame the 
<br/>
   header of the gif will be written to the created file */
<br/>
<br/>
void makeGif(gdImagePtr im) {
<br/>
  /* declare output file */
<br/>
  FILE *outFile;
<br/>
<br/>
  /* if there exists no animatione we will create one and write its header */ 
<br/>
  if (!fileExists(GIF_NAME)) { 
<br/>
    /* open file */
<br/>
    outFile = fopen(GIF_NAME, "wb"); 
<br/>
        
<br/>
    /* write the header */
<br/>
    gdImageGifAnimBegin(im, outFile, 0, 0);
<br/>
<br/>
    /* close the file */
<br/>
    fclose(outFile);
<br/>
  }
<br/>
<br/>
  /* open file im append mode */
<br/>
  outFile = fopen(GIF_NAME, "ab");
<br/>
<br/>
  /* add the frame */
<br/>
  gdImageGifAnimAdd(im, outFile, 1, 0, 0, 1, gdDisposalNone, NULL);
<br/>
<br/>
  /* close the file */
<br/>
  fclose(outFile);
<br/>
}
<br/>
<br/>
<br/>
/* terminate the gif-animation specified by GIF_NAME. this is done 
<br/>
   by adding a semicolon to the end of the file. */
<br/>
<br/>
void closeGif() {
<br/>
  /* declare output file */
<br/>
  FILE *outFile;
<br/>
<br/>
  /* open file in append mode */
<br/>
  outFile = fopen(GIF_NAME, "ab");  
<br/>
<br/>
  gdImageGifAnimEnd(outFile);
<br/>
}
<br/>
<br/>
<br/>
/* save the frame at im to a png-file */
<br/>
<br/>
void makePng(gdImagePtr im, int frame) {
<br/>
  /* declare output file */
<br/>
  FILE *outFile;
<br/>
<br/>
  char frameName[11];
<br/>
  frameName[0] = '\0';
<br/>
  
<br/>
  /* convert frame int to string */
<br/>
  sprintf(frameName, "%d", frame);
<br/>
<br/>
  /* append the extension */
<br/>
  strcat(frameName, ".png\0");
<br/>
<br/>
  /* open output file */
<br/>
  outFile = fopen(frameName, "wb");
<br/>
<br/>
  /* output the image */
<br/>
  gdImagePng(im, outFile);
<br/>
<br/>
  /* close file */
<br/>
  fclose(outFile);
<br/>
}
<br/>
<br/>
<br/>
/* if the current frame shouldnt be skipped we can either call 
<br/>
   upon makePng for it to create the frame OR makeGif so that 
<br/>
   the frame can be added to the gif-animation specified by 
<br/>
   GIF_NAME */
<br/>
<br/>
void makeFile(gdImagePtr im, char *type, int frame, int frameSkipping) {
<br/>
  /* check if the frame we are at should be outputed */
<br/>
  if (frame % frameSkipping)
<br/>
    return;
<br/>
<br/>
  /* check what type of image we want to output */
<br/>
  if (!strcmp(type, "gif"))
<br/>
    makeGif(im);
<br/>
  else if (!strcmp(type, "png"))
<br/>
    makePng(im, frame);
<br/>
}
<br/>
<br/>
<br/>
/* sets the given pixel in the frame im to the given color */
<br/>
<br/>
void putPixel(gdImagePtr im, int x_pos, int y_pos, int red, int green, int blue) {
<br/>
  int color;
<br/>
<br/>
  /* set the drawing color  */
<br/>
  color = gdImageColorResolve(im, red, green, blue);
<br/>
<br/>
  /* put a pixel to the image */
<br/>
  gdImageSetPixel(im, x_pos, y_pos, color);
<br/>
}
<br/>
<br/>
<br/>
/* create a frame with the given dimensions/background color 
<br/>
   note: the color of the background is also made transparent */
<br/>
<br/>
gdImagePtr createImage(gdImagePtr im, int width, int height, int red, int green, int blue) {
<br/>
  /* allocate the image */
<br/>
  im = gdImageCreate(width, height);
<br/>
<br/>
  /* allocate the background color, as it is the first color allocated in a new
<br/>
     image it will be used as background */
<br/>
  int bg;
<br/>
  bg = gdImageColorAllocate(im, red, green, blue);
<br/>
<br/>
  return im;
<br/>
} 
<br/>
<br/>
<br/>
/* create a backup of the animation specified by GIF_NAME */
<br/>
<br/>
void backupAnimation(void) {
<br/>
  if (fileExists(GIF_NAME)) {
<br/>
    char newName[200];
<br/>
    newName[0] = '\0';
<br/>
    
<br/>
    int n;
<br/>
    for (n=1; n&gt;0; n++) {
<br/>
      sprintf(newName, "old.%d." GIF_NAME, n);
<br/>
      if (!fileExists(newName))
<br/>
   n=-1;
<br/>
    }
<br/>
<br/>
    rename(GIF_NAME, newName);
<br/>
  }
<br/>
}
<br/>
<br/>
<br/>
int main(int argc, char *argv[]) {
<br/>
  /* check if the correct number of arguments have been suplied */
<br/>
  if (argc != 3) {
<br/>
    /* print usage message */
<br/>
    printf("Usage: %s [string png/gif] [int frameSkip where frameSkip&gt;0]\nExample: %s gif 10; would produce a gif animation where every tenth frame is used. \nExample: %s png 1; would produce one png image for each frame. \nNote: The first frame can't be skipped. \n", argv[0], argv[0], argv[0]);
<br/>
    return 20;
<br/>
  }
<br/>
  
<br/>
  /* set output type */
<br/>
  char outType[3];
<br/>
  strcpy(outType, argv[1]);
<br/>
<br/>
  /* set frameSkip value */
<br/>
  int frameSkip;
<br/>
  frameSkip = atoi(argv[2]); /* this will cause an floating point exception if argv[2] cant be converted to and int */
<br/>
<br/>
  /* backup the animation file if it already exists */
<br/>
  if (!strcmp(outType, "gif")) 
<br/>
    backupAnimation();
<br/>
  
<br/>
  /* declare the image */
<br/>
  gdImagePtr im;
<br/>
<br/>
  /* create the image */
<br/>
  im = createImage(im, WIDTH, HEIGHT, 0, 0, 0);
<br/>
<br/>
  /* a simple algorithm indended for testing */
<br/>
  int frame;
<br/>
  int red=0, green=0, blue=0;
<br/>
  for (frame=0; frame&lt;HEIGHT; frame++) {
<br/>
    /* put pixels to image */
<br/>
    int i;
<br/>
    for (i=0; i&lt;WIDTH; i++) 
<br/>
      putPixel(im, i, frame, red, green, blue);
<br/>
<br/>
    /* output the image */
<br/>
    makeFile(im, outType, frame, frameSkip);
<br/>
<br/>
    /* change the color of the next row */
<br/>
    red++;
<br/>
  }
<br/>
<br/>
  /* close gif */ 
<br/>
  if (!strcmp(outType, "gif")) 
<br/>
    closeGif();
<br/>
<br/>
  /* destroy image */
<br/>
  gdImageDestroy(im);
<br/>
<br/>
  return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#78343 - StoneCypher - Thu Apr 06, 2006 11:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It seems like you are missing my point. My example was just indended to show what I was talking about, the linked list was just an idea of how to store the image, not something I have decided I MUST use. But I wouldn't mind if you could explain what is wrong with a linked list as I dont see it myself.</td> </tr></table><span class="postbody">
<br/>
<br/>
Uh.  Because you need to dereference a pointer to find the next pixel, instead of incrementing?  because that prevents array copies or blits?  because it's not conceptually a list?  Because it wastes almost as much space as encoding 5-bit unsigned packed values in 32-bit signed space?
<br/>
<br/>
This is an image:   
<br/>
    u16 myPic[size];  
<br/>
<br/>
This is your approach:
<br/>
    struct { int r,g,b; void* next; } myPic[size];
<br/>
<br/>
Differences:
<br/>
<br/>
    - Your approach takes 8 times as much space as it should.  On a platform as desperately short of memory as the DS, that's suicide.
<br/>
<br/>
    - Optimized assembly takes seven cycles minimum (probably more due to bank latency) to read a pixel; the normal approach generally takes about a fifth of a cycle through things like STMIA loops.  On a platform as cycle-limited as the DS, that's suicide.
<br/>
<br/>
    - Your approach has extremely poor clustering qualities, which is poison on an architecture as cache-dependant as the DS is.
<br/>
<br/>
    - Your approach bears no apparent resemblance to a bitmap.  There's a reason that word gets used both for arrays and images: images *are* arrays (vector images notwithstanding.)
<br/>
<br/>
    - Your approach ignores the fundamental nature of the data
<br/>
<br/>
    - Your approach means you have to seek from the beginning of the image to get *any* pixel, giving an average seek time of o(n), instead of the average seek time of o(1) had by an array
<br/>
<br/>
    - Your approach ignores the nature of VRAM; this simply won't work in video memory, period, end of story.
<br/>
<br/>
    - &lt;dolemite&gt; Nigga, is you crazy? &lt;/dolemite&gt;
<br/>
<br/>
Look, this would be a performance problem on a PC.  Time to learn <a class="postlink" href="http://sc.tri-bit.com/clrs" target="_blank">the fundamentals of data structures</a>.<br/>_________________<br/>Quidquid Latine dictum sit, altum Sonatur
<br/>
<a href="http://feeds.feedburner.com/StoneHome.gif">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#82475 - Ant6n - Sat May 06, 2006 8:09 pm</h4>
    <div class="postbody"><span class="postbody">nice bashing there, stonebusta</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
