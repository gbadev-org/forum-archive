<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Updating maps - newbie. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Graphics > Updating maps - newbie.</h2>
<div id="posts">
<div class="post">
    <h4>#10810 - goro - Tue Sep 16, 2003 4:47 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
Thanks to Nessie &amp; Tepples I have manage to learn about tile maps.
<br/>
<br/>
I'm using mode 0/16-color tiles and I want to update the map in memory (256x256 pixels)with I'm elements from the  map array(2048x256pixels) created using MapEd095.
<br/>
<br/>
The first screen is displayed using :-
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(loop = 0; loop &lt;256; loop++)
<br/>
      BGPaletteMem[loop] = backgroundPalette[loop];
<br/>
<br/>
   for(loop = 0; loop &lt; 6880; loop++)  //load tile image data
<br/>
      bg1.tileData[loop] = bgTiles[loop]; //4128
<br/>
<br/>
   //load the map image data
<br/>
   DrawMap();</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void DrawMap()
<br/>
{
<br/>
   u16 index1 = 0;
<br/>
   u16 index2 = 0;
<br/>
   u16 loop;
<br/>
   u16 loop2;
<br/>
   u16* temp = (u16*)map;
<br/>
<br/>
   for (loop = 0; loop &lt; 32; loop++)
<br/>
   {
<br/>
      for (loop2 = 0; loop2 &lt;32; loop2++)
<br/>
      {
<br/>
      
<br/>
         bg1.mapData[index1+loop2] = temp[index2+loop2];//draw 32 tiles;
<br/>
      }         
<br/>
      index1 += 32;
<br/>
      index2 += 256;   
<br/>
                                }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
-That should give you an idea of how my map array is organised (output from MapEd095)
<br/>
<br/>
I suspect that my map updating code contains the error :-
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void DrawUpdate()
<br/>
{
<br/>
   u16 index1 = 0;
<br/>
   u16 index2 = 32;
<br/>
   
<br/>
   u16 loop;
<br/>
   u16 loop2;
<br/>
   u16* temp = (u16*)map;
<br/>
<br/>
   for (loop2 = 0; loop2 &lt;32; loop2++)
<br/>
      {
<br/>
         bg1.mapData[index1+Counter] = temp[index2+Counter];//draw 32 tiles;
<br/>
               
<br/>
      
<br/>
      index1 += 32;
<br/>
      index2 += 256;
<br/>
      }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Can anyone help me? (if you need me to post more code-just ask)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10817 - tepples - Tue Sep 16, 2003 8:40 pm</h4>
    <div class="postbody"><span class="postbody">Now I understand what your "vertical alignment" problem is.
<br/>
<br/>
In memory, the space after row 5 column 31 is row 6 column 0.  But on screen, the space to the right of row 5 column 31 is row 5 column 0.  (This has been true of all Nintendo systems' tile video architectures.)
<br/>
<br/>
You have to code properly for the wraparound.  Keep track of horizontal and vertical offsets in screen-space separately, and make sure all writes to nametables fall in (0, 0) to (31, 31) by using the &amp; (bitwise AND) operator.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10863 - goro - Thu Sep 18, 2003 5:54 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
I got the scrolling thing to work (same 2048x256 map).
<br/>
<br/>
It seems the (output from MapEd095) offset is 256 tiles per column for this size of map while the VRAM offset is 32.
<br/>
<br/>
Now,
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">In memory, the space after row 5 column 31 is row 6 column 0. But on screen, the space to the right of row 5 column 31 is row 5 column 0. (This has been true of all Nintendo systems' tile video architectures.) 
<br/>
<br/>
You have to code properly for the wraparound. Keep track of horizontal and vertical offsets in screen-space separately, and make sure all writes to nametables fall in (0, 0) to (31, 31) by using the &amp; (bitwise AND) operator.</td> </tr></table><span class="postbody">
<br/>
<br/>
If (onscreen) the space to the right of row 5 column 31 is row 5 column 0, what is the space to the right of row 4 column 31?
<br/>
<br/>
I think this might also be throwing off my scroll/update sync. I don't want to see the screen updating so I'm doing it offscreen and I'm currently updating the columns once for every 8 pixels of scroll (because each tile is 8x8). But the screen always catches up with the scroll or vice versa.
<br/>
<br/>
Also -What is the syntax of the &amp;(bitwise AND) operator in this case?
<br/>
<br/>
I know that I'm asking for a bit much here but can anyone give a rough bit of code to demonstrate how I might overcome this...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10873 - jenswa - Thu Sep 18, 2003 8:25 pm</h4>
    <div class="postbody"><span class="postbody">Well i am not a wonder in these things, but my help might sometimes work.
<br/>
<br/>
the space to the right of row 4 column 31, is row 4 column 0
<br/>
But in memory the space is row 5 column.
<br/>
But i think you might have figured this one out, because tepples mentionned it in his post before (only he used 5 and 6).
<br/>
<br/>
<br/>
You scroll 8 pixels and then call the update function?
<br/>
And your background wraps around?
<br/>
<br/>
The screen space is 240 pixels wide, 0 - 29 columns, 30 and 31 are offscreen, the latest 16 pixels.
<br/>
So when you've scrolled 8 pixels left, all rows column 0 should be wrapped behind column 31 (to the right that is) and you should update that column with column 32 of your main map.
<br/>
If we move again 8 pixels left, all rows column 1 should be wrapped behind column 1 (also on the right side, because of the wraparound).
<br/>
So you want to update all rows, column 1, with column 33 from your main map.
<br/>
<br/>
<br/>
I hope this might give you some help.<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
