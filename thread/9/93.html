<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Compression/Decompression Graphic tool - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Graphics > Compression/Decompression Graphic tool</h2>
<div id="posts">
<div class="post">
    <h4>#526 - mentz - Wed Jan 08, 2003 1:28 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
I'm searching (if exists) for a  tool  that compress and decompress the strange lzxx routine (for GBA).
<br/>
<br/>
Thanks to all and sorry for may bad english....<br/>_________________<br/>xXx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#552 - JSensebe - Wed Jan 08, 2003 7:42 pm</h4>
    <div class="postbody"><span class="postbody">My <a class="postlink" href="http://members.cox.net/jsensebe/gba/GBACrusher.zip" target="_blank">GBA Crusher</a> can compress data using algorithms compatible with the GBA BIOS routines. It comes in two versions, a GUI version and a console version suitable for use in makefiles.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#563 - arog - Wed Jan 08, 2003 8:53 pm</h4>
    <div class="postbody"><span class="postbody">Is there any documentation for GBA Crusher?  I didn't 
<br/>
see any on your website.
<br/>
<br/>
- Aaron Rogers
<br/>
HAM Tutorial</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#577 - JSensebe - Wed Jan 08, 2003 9:43 pm</h4>
    <div class="postbody"><span class="postbody">Just type "GBACrusherCL" at the prompt, and you'll get a list of options. There really isn't that much to it. ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#646 - coca77 - Thu Jan 09, 2003 11:54 am</h4>
    <div class="postbody"><span class="postbody">Thanks for that tool, thought I was gonna have to go and code my own for a while.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#650 - mentz - Thu Jan 09, 2003 12:03 pm</h4>
    <div class="postbody"><span class="postbody">Wow that GBA Crusher is Amazing !!
<br/>
<br/>
But how can i decompress the file using the same gba-bios-routines ??<br/>_________________<br/>xXx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#776 - anli - Fri Jan 10, 2003 3:44 pm</h4>
    <div class="postbody"><span class="postbody">Put this in an assembler file:
<br/>
<br/>
.GLOBAL	LZ77UnCompVram
<br/>
.GLOBAL	LZ77UnCompWram
<br/>
LZ77UnCompVram:
<br/>
  swi 18
<br/>
  bx lr
<br/>
<br/>
LZ77UnCompWram:
<br/>
  swi 17
<br/>
  bx lr
<br/>
<br/>
<br/>
<br/>
This file is assembled like this:
<br/>
For arm mode:
<br/>
as -marm7tdmi file.s
<br/>
For thumb mode:
<br/>
as -mthumb file.s
<br/>
<br/>
This produces a file.o.
<br/>
<br/>
Now add this to your C code:
<br/>
extern void LZ77UnCompWram(void *src, void *dest);
<br/>
extern void LZ77UnCompVram(void *src, void *dest);
<br/>
<br/>
Now, you have two extra functions to play with. The "V" version is
<br/>
used when you are decompressing to video memory.
<br/>
<br/>
Dont forget to add file.o on the command line to your linker.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#786 - mentz - Fri Jan 10, 2003 5:49 pm</h4>
    <div class="postbody"><span class="postbody">thank you very much.............i will try....<br/>_________________<br/>xXx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#791 - lordmetroid - Fri Jan 10, 2003 6:18 pm</h4>
    <div class="postbody"><span class="postbody">useing compressed data will use some extra cycles right?
<br/>
or does it uncompress in hardware?<br/>_________________<br/>*Spam*
<br/>
Open Solutions for an open mind, <a href="http://www.areta.org" target="_blank">www.areta.org</a>
<br/>
<br/>
Areta is an organization of coders codeing mostly open source project, but there is alot of sections like GBA dev, Language learning communities, RPG communities, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#792 - anli - Fri Jan 10, 2003 6:26 pm</h4>
    <div class="postbody"><span class="postbody">It is decompressed with code in bios, so its a software decompression.
<br/>
And it is really slow.
<br/>
<br/>
But it works
<br/>
<br/>
:)
<br/>
<br/>
One thing that I forgot to mention before is that it is important that the source buffer is on an address that is divisable with 4.
<br/>
<br/>
Before I knew that, I was trying to decompress bitmapped pixel data that only rendered a black screen. Then I saw that the address wasnt divisable with 4. When I changed the alignment, it worked.
<br/>
<br/>
If you are using the bin2o utility, that I have written, you can use the argument /align=4.
<br/>
<br/>
/anli</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#794 - Touchstone - Fri Jan 10, 2003 6:28 pm</h4>
    <div class="postbody"><span class="postbody">The decompression is done by hardware but it ain't free because of that. It was a while since I tested the decompression and I've lost the results so I can't tell you how long it takes, I'm sorry.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#795 - anli - Fri Jan 10, 2003 6:32 pm</h4>
    <div class="postbody"><span class="postbody">Hey!
<br/>
It is a BIOS routine that does the decompression!
<br/>
<br/>
/anli</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#796 - Touchstone - Fri Jan 10, 2003 6:35 pm</h4>
    <div class="postbody"><span class="postbody">Ooh, I got my bits mixed up, sorry about that. :) The decompression is not done by the hardware but the software that does the decompression is stored in the gba firmware.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2536 - MayFly - Thu Feb 06, 2003 12:52 am</h4>
    <div class="postbody"><span class="postbody">While playing with the BIOS compression calls I?ve come across something that mystifies me.
<br/>
<br/>
My code works correctly under VisualBoyAdvance 1.3.1, but when I try the binary in my actual GBA with the FLASH cart all I see is a blank screen.
<br/>
<br/>
Here?s a synopsis of the process I use:
<br/>
<br/>
1: Convert my 240x160 (8 bit) image using Bimbo version 1.3 to a binary (say mona.bin)
<br/>
<br/>
2: Use GBACrusher version 0.1.1.10 with the LZ77, VRAM safe option (to create compmona.bin)
<br/>
<br/>
3: Use Anli?s obj2bin v1.0 as follows: 
<br/>
    obj2bin /align=4 /interwork  /const compmona.bin mona.o mona
<br/>
<br/>
4: When it?s time I called the code: 
<br/>
    LZ77UnCompVram((u16*)mona, VideoBuffer);
<br/>
<br/>
I made sure the source address is divisible by 4. 
<br/>
<br/>
Can you suggest what I?m missing, or doing wrong?
<br/>
<br/>
Thanks,
<br/>
MayFly</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2556 - anli - Thu Feb 06, 2003 9:19 am</h4>
    <div class="postbody"><span class="postbody">Hello!
<br/>
<br/>
Did you use the "video safe" compression option in gbacrusher?
<br/>
<br/>
/anli</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2557 - Splam - Thu Feb 06, 2003 10:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
2: Use GBACrusher version 0.1.1.10 with the LZ77, VRAM safe option (to create compmona.bin) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2611 - MayFly - Sun Feb 09, 2003 2:00 am</h4>
    <div class="postbody"><span class="postbody">Hi Guys,
<br/>
<br/>
First off, thank you for releasing GBAcrusher and bin2o: they are excellent utilities and we're (at least me and other GBA programmers) are better for it.
<br/>
<br/>
After doing some more research, consulting and digging around I found out what was wrong.
<br/>
<br/>
I used Anli's suggested code meantioned earlier in this thread.  The assumption was the assembler code was targeted as THUMB (I think).  In my project I was using the -thumb-interwork switch for the C and assembler code. 
<br/>
<br/>
The addresses called must be left shifted 16 bits (at least in ARM so I understand).  
<br/>
<br/>
When I changed swi 0x12 to swi 0x120000 the issue was resolved.
<br/>
<br/>
I thought -thumb-interwork switch created THUMB code unless you specify address space in the IRAM.  D'oh!
<br/>
<br/>
With all the issues I'm having/learning about programming this wonderful device I'm contimplating the creation of a GBA programming wtf FAQ. I imagine it could save folks a lot of grief.
<br/>
<br/>
Thank you all.
<br/>
<br/>
Regards,
<br/>
MayFly</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2712 - dummer Anf?nger - Tue Feb 11, 2003 11:09 am</h4>
    <div class="postbody"><span class="postbody">Hmm ... i had much trouble about using lzss into my photoshop filter because the gba seems to kill colours while decompressing.
<br/>
<br/>
I dont found working way to use it for mode 4 or 3 bitmaps...<br/>_________________<br/>... but im just a <span style="text-decoration: underline">dummy</span> <span style="font-weight: bold">Newbie</span>
<br/>
<br/>
(sorry for my terrible english)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2714 - anli - Tue Feb 11, 2003 11:14 am</h4>
    <div class="postbody"><span class="postbody">You have to use video safe compression, which is an option in gbacrusher.
<br/>
<br/>
/anli</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
