<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Question on animation - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Graphics > Question on animation</h2>
<div id="posts">
<div class="post">
    <h4>#70246 - gs2phateon - Sun Feb 05, 2006 3:36 am</h4>
    <div class="postbody"><span class="postbody">I'm about to start sprite animation for a project I'm working on, but I need some help to get started.  There are two ways I can think of doing animation.
<br/>
<br/>
First, I could just draw out every sprite for every animation, and have the program pick which frame to use out of every availible picture.  This would let me save memory by re-using frames.
<br/>
<br/>
Or, I could put all the frames in the right order in each file I use.  I imagine this would be easier to program for (I don't have to worry about using the wrong frame accidentally), but it's not as efficient and I would probably use several frames over and over when I don't necessarily have to.
<br/>
<br/>
Right now I'm leaning towards the second option (just because it's easier to program), but do animation frames take up enough space that I should be cautious as to how many I make?  Or is there a better way to animate a sprite?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70250 - tepples - Sun Feb 05, 2006 3:47 am</h4>
    <div class="postbody"><span class="postbody">For a 32x32 pixel sprite, each sprite cel takes 0.5 KB if not compressed. How many sprite cels did you plan to have in the game?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70252 - gs2phateon - Sun Feb 05, 2006 4:05 am</h4>
    <div class="postbody"><span class="postbody">Right now I'm not sure, but I don't want to underestimate.  This project will probably use more sprites then the average game, that's all I know.  I'm guessing without including enemy sprites, I could have 75 individual frames for the main sprite, if I don't conserve them.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70255 - tepples - Sun Feb 05, 2006 4:14 am</h4>
    <div class="postbody"><span class="postbody">75 frames isn't a lot at all; that's just 37.5 KB out of a 4096 KB ROM. Are you making your game for a ROM or for a multiboot?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70259 - gs2phateon - Sun Feb 05, 2006 4:21 am</h4>
    <div class="postbody"><span class="postbody">You're right, I added up KB total.  This will be for a ROM, so I guess I'll be just fine.  But is the second way I suggested (using all the sprites in a file according to the exact order they will be used) the best way to do animation?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70416 - gauauu - Mon Feb 06, 2006 8:12 am</h4>
    <div class="postbody"><span class="postbody">The "best" depends on what sorts of animation will occur (will all frames be in same order every time?)
<br/>
<br/>
What I do is define an animation structure that includes a pointer to a frame, the amount of time that frame should display, and a pointer to the next animation structure.  This provides all sorts of flexibility.  Each character might have multiple animation sequences, some of which automatically flow into other ones.
<br/>
<br/>
Then, I can also programmatically tell it to jump to any animation I want, like:
<br/>
setCharacterToAnimation(character, animationFrame);</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70519 - Touchstone - Tue Feb 07, 2006 12:19 am</h4>
    <div class="postbody"><span class="postbody">If you're really serious about your animations and want to have big animated characters (or whatever's animated) you could do cut out style animation, like South Park. I started writing a library for this but I never finished it. (Because I'm to lazy) Anyways, check out this stuff <a href="http://www.pokewhat.com/touchstone/" target="_blank">http://www.pokewhat.com/touchstone/</a>
<br/>
<br/>
If you're interested I can send you the source. It's quite pretty, I used it as a code sample for when I was looking for a job. Unfortunatelly it's not very dynamic yet, you have to keep track of where in VRAM you load your sprite tiles etc, but that's an easy fix if you have your VRAM allocation scheme already set up. My problem was that I was trying to be too dynamic and in the end I got nothing done.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70521 - gs2phateon - Tue Feb 07, 2006 12:31 am</h4>
    <div class="postbody"><span class="postbody">Could you explain the structure animation style some more, I'm not sure I understand the whole thing yet.  But that sounds like what I'm going for.  I will be using a wide variety of animations, and I need to be able to call them quickly and easily, sort of like in a fighting game.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70531 - gauauu - Tue Feb 07, 2006 2:50 am</h4>
    <div class="postbody"><span class="postbody">Ok, here's how I do it.  Keep in mind, I'm no expert...there's probably a much better way, but this works for me.
<br/>
<br/>
Basically, there's 3 chunks of data that I have for each character's animation.
<br/>
<br/>
First is the sprite tile data itself.
<br/>
Second is what I call the Frame Definition, which defines which tiles to use how to make one frame of animation (for example, large characters might be a mix of all sorts of combinations of smaller sprites)
<br/>
Third is what I call the Animation Definition, which defines which frames to use when.
<br/>
<br/>
So first is the structure for Frame Definitions.  Basically, each frame definition is a linked list of sprite definitions.  The code follows the nextSprite pointer (as long as it isn't null) to find the next sprite in the character frame:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct characterFrameDefStruct
<br/>
{
<br/>
   int xOffset;      //where the sprite appears relative
<br/>
   int yOffset;      //to the character's origin
<br/>
<br/>
   int tileNum;      //which tile index for the sprite
<br/>
<br/>
   int shape;        //sprite attributes.  you could add vflip, etc
<br/>
   int size;         //if you planned to use them
<br/>
   bool hflip;
<br/>
<br/>
   struct characterFrameDefStruct * nextSprite; //the next sprite in the frame
<br/>
};
<br/>
<br/>
//I like to typedef structs.  There are pros and cons.  Do a forum search
<br/>
//to read everyone's opinions.
<br/>
typedef struct characterFrameDefStruct characterFrameDef;  
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So my character data files usually have a chunk that looks like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define POS1 -8,-8
<br/>
#define POS2 8,-8
<br/>
#define MCFrame(x) (characterFrameDef *)&amp;(mainCharFrames[x])
<br/>
const characterFrameDef mainCharFrames[] = 
<br/>
{
<br/>
   ////FRAME: north 1
<br/>
   {//0
<br/>
      POS1,      //x,y offset
<br/>
      10,         //tile
<br/>
      TALL,      //shape (SQUARE/TALL/WIDE)
<br/>
      SIZE_32,      //size
<br/>
      false,       //flip
<br/>
      MCFrame(1) //nextSprite
<br/>
   },
<br/>
   {//1
<br/>
      POS2,         //x,y offset
<br/>
      12,            //tile
<br/>
      TALL,         //shape (SQUARE/TALL/WIDE)
<br/>
      SIZE_16,      //size
<br/>
      false, 
<br/>
      null          //nextSprite
<br/>
   },
<br/>
   //FRAME:  north 2
<br/>
   {//2
<br/>
      POS1,      //x,y offset
<br/>
      13,         //tile
<br/>
      TALL,      //shape (SQUARE/TALL/WIDE)
<br/>
      SIZE_32,      //size
<br/>
      false,       //flip
<br/>
      MCFrame(3)
<br/>
   },
<br/>
   {//3
<br/>
      POS2,         //x,y offset
<br/>
      15,            //tile
<br/>
      TALL,         //shape (SQUARE/TALL/WIDE)
<br/>
      SIZE_16,      //size
<br/>
      false, 
<br/>
      null          //nextSprite
<br/>
   },
<br/>
   ...etc
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Eventually, I'd like to create a tool to generate this data automatically, instead of having it typed into C files.  But oh well.
<br/>
<br/>
As you can see, this defines 2 frames of animation, each using 2 sprites.  The POS1, TALL, SIZE_16, etc, are all #defined values.  
<br/>
<br/>
Now that we have the frames defined for a character, we have to define the animation sequences.  I use a very similar system for animation as I do for defining the frames.  A linked list of definitions, each to refer to a frame, and point to the next frame:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct characterAnimDefStruct
<br/>
{
<br/>
   int frameDelay;       //how long to show the frame
<br/>
<br/>
   characterFrameDef * thisFrame;     //pointer to frame definition for this
<br/>
                                       //frame
<br/>
<br/>
   struct characterAnimDefStruct * nextFrame;   //next frame in this animation
<br/>
                                                 //sequence
<br/>
};
<br/>
typedef struct characterAnimDefStruct characterAnimDef;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So then a typical definition might look like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define MCAnim(x) (void *)&amp;(mainCharAnim[x])
<br/>
#define WALK_SPEED 10
<br/>
#define ATTACK_SPEED 4
<br/>
#define REST_SPEED 13
<br/>
<br/>
const characterAnimDef mainCharAnim[] = 
<br/>
{
<br/>
<br/>
   {//0 - north frame 1
<br/>
      WALK_SPEED,
<br/>
      MCFrame(0),
<br/>
      MCAnim(1)
<br/>
   },
<br/>
   {//1 - north frame 2
<br/>
      WALK_SPEED,
<br/>
      MCFrame(2),
<br/>
      MCAnim(2)
<br/>
   },
<br/>
   {//2 - north frame 3
<br/>
      WALK_SPEED,
<br/>
      MCFrame(0),
<br/>
      MCAnim(3)
<br/>
   },
<br/>
   {//3 - north frame 4
<br/>
      WALK_SPEED,
<br/>
      MCFrame(4),
<br/>
      MCAnim(0)
<br/>
   },
<br/>
    ....etc
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
As you can see here, sometimes a frame can be used in multiple places in one animation sequence (like a "neutral" position when walking).  Another nice thing about this is that some other special animations flow into other defined animations.  For example, if I have a resting animation, where my character shifts his weight back and forth, then you can define that the attack animation always flows into the resting animation loop.  
<br/>
<br/>
Now, in my character's code, to set which animation to start, I do something like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define mainCharAnimWalkN  mainCharAnim
<br/>
#define mainCharAnimWalkS  (characterAnimDef*)&amp;mainCharAnim[11]
<br/>
#define mainCharAnimWalkW  (characterAnimDef*)&amp;mainCharAnim[19]
<br/>
#define mainCharAnimWalkE  (characterAnimDef*)&amp;mainCharAnim[27]
<br/>
<br/>
setCharacterAnimationForced(mainChar, mainCharAnimWalkS);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I won't go into the details of the setCharacterAnimationForced function, but basically it takes a pointer to the character, and a pointer to the animation structure, then will take care of starting the animation.  At that point, the character animation code automates keeping track of the animation, so the code for this particular character doesn't have to worry about it. (unless it wants to jump to a different animation sequence, or stop animation entirely).
<br/>
<br/>
Actually, in my implementation, there are a few more fields I use in these structures, to define WHERE the graphics data comes from, because my game will dynamically load tiles for the animations when necessary.  But I didn't want to add to the confusion.
<br/>
<br/>
Ok, that was a long explanation.  I hope that's useful.  
<br/>
<br/>
Again, I'll repeat, there are probably a lot of flaws with my implementation.  And it's a royal pain in the butt to define the animations this way.  But it works for me.  I just need to make a tool to simplify the creation of this data for me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70533 - gs2phateon - Tue Feb 07, 2006 3:09 am</h4>
    <div class="postbody"><span class="postbody">Wow!  Thanks for that explanation.  That type of method was what I was hoping to use for animation.  Thanks again!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70615 - kashiwa - Tue Feb 07, 2006 8:13 pm</h4>
    <div class="postbody"><span class="postbody">I have one suggestion for gauauu, if those codes were not only an example.
<br/>
How about using a designated initializer with enum instead of #define definition?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
enum {
<br/>
   NORTH_FRAME_1,
<br/>
   NORTH_FRAME_2,
<br/>
   NORTH_FRAME_3,
<br/>
   ...
<br/>
};
<br/>
<br/>
const characterAnimDef mainCharAnim[] =
<br/>
{
<br/>
   [NORTH_FRAME_1] = {
<br/>
      WALK_SPEED,
<br/>
      MCFrame(0),
<br/>
      MCAnim(1)
<br/>
   },
<br/>
   [NORTH_FRAME_2] = {
<br/>
      WALK_SPEED,
<br/>
      MCFrame(2),
<br/>
      MCAnim(2)
<br/>
   },
<br/>
   [NORTH_FRAME_3] = {
<br/>
      WALK_SPEED,
<br/>
      MCFrame(0),
<br/>
      MCAnim(3)
<br/>
   },
<br/>
   ...
<br/>
};
<br/>
<br/>
enum {
<br/>
  mainCharAnimWalkN,
<br/>
  mainCharAnimWalkS,
<br/>
  mainCharAnimWalkW,
<br/>
  mainCharAnimWalkE,
<br/>
};
<br/>
<br/>
const characterAnimDef *mainCharAnimTable[] =
<br/>
{
<br/>
  [mainCharAnimWalkN] = { (characterAnimDef*)&amp;mainCharAnim[NORTH_FRAME_1] },
<br/>
  [mainCharAnimWalkS] = { (characterAnimDef*)&amp;mainCharAnim[SOUTH_FRAME_1] },
<br/>
  [mainCharAnimWalkW] = { (characterAnimDef*)&amp;mainCharAnim[WEST_FRAME_1] },
<br/>
  [mainCharAnimWalkE] = { (characterAnimDef*)&amp;mainCharAnim[EAST_FRAME_1] },
<br/>
};
<br/>
<br/>
setCharacterAnimationForced(mainChar, mainCharAnimTable[mainCharAnimWalkN]); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You can insert new frame without rewriting numbers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70665 - gauauu - Wed Feb 08, 2006 1:57 am</h4>
    <div class="postbody"><span class="postbody">kashiwa, thanks!
<br/>
<br/>
I didn't know it could be done that way, but that really makes it easier.  I was wondering if there was a nicer way to do it than what I was doing, but hadn't figured it out yet. 
<br/>
<br/>
Good call, thanks for the suggestion.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
