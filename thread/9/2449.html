<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Flipped Mode 5 and Sprites - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Graphics > Flipped Mode 5 and Sprites</h2>
<div id="posts">
<div class="post">
    <h4>#13177 - krozen - Sun Dec 07, 2003 12:50 pm</h4>
    <div class="postbody"><span class="postbody">Hey guys,
<br/>
im trying to use flipped mode 5 with sprites. i cant display the sprites tho! heres my code for setting up mode 5
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void setmode5flipped(int page)
<br/>
{
<br/>
  u16  *ioreg=(u16*)0x4000000;
<br/>
<br/>
  *ioreg=5+((page&amp;1)&lt;&lt;4)+ (1&lt;&lt;6)+ (1&lt;&lt;10)+(1&lt;&lt;12); 
<br/>
  ioreg[0x10]=0;
<br/>
  ioreg[0x11]=256;
<br/>
  ioreg[0x12]=128;
<br/>
  ioreg[0x13]=0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Ive set the first sprite at location 512, cause of the double buffer. Its really annoying me!
<br/>
Any suggestions?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13184 - sajiimori - Sun Dec 07, 2003 6:20 pm</h4>
    <div class="postbody"><span class="postbody">Were you just trying to set REG_DISPCNT (the 32 bit word located at 0x4000000)?  You're writing to all sorts of different places.
<br/>
<br/>
It's much simpler to do it this way:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define REG_DISPCNT    *(volatile u32*)0x4000000
<br/>
<br/>
#define MODE_0 0x0
<br/>
#define MODE_1 0x1
<br/>
#define MODE_2 0x2
<br/>
#define MODE_3 0x3
<br/>
#define MODE_4 0x4
<br/>
#define MODE_5 0x5
<br/>
<br/>
#define BACKBUFFER 0x10
<br/>
#define H_BLANK_OAM 0x20
<br/>
<br/>
#define OBJ_MAP_2D 0x0
<br/>
#define OBJ_MAP_1D 0x40
<br/>
<br/>
#define FORCE_BLANK 0x80
<br/>
<br/>
#define BG0_ENABLE 0x100
<br/>
#define BG1_ENABLE 0x200
<br/>
#define BG2_ENABLE 0x400
<br/>
#define BG3_ENABLE 0x800
<br/>
#define OBJ_ENABLE 0x1000
<br/>
<br/>
#define WIN1_ENABLE 0x2000
<br/>
#define WIN2_ENABLE 0x4000
<br/>
#define WINOBJ_ENABLE 0x8000
<br/>
<br/>
f()
<br/>
{
<br/>
  REG_DISPCNT = MODE_5 | OBJ_ENABLE | whatever_you_want;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
It seems like you're misunderstanding one or more of: array access, hexadecimal notation, or pointer arithmetic.
<br/>
<br/>
When you type array[index], what that means is *(array + index).  And when you have a u16*, adding 1 to it moves the pointer up by 16 bits (2 bytes).  So this code...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16  *ioreg=(u16*)0x4000000;
<br/>
ioreg[0x12]=128;
<br/>
</td> </tr></table><span class="postbody">
<br/>
...really writes to the address 0x4000024 (0x4000000 + 0x12 * 2), which happens to be REG_BG2PC (nowhere near what you're trying to write to).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13185 - krozen - Sun Dec 07, 2003 6:42 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for reply. This is code i got off a tutorial to stretch mode 5 so that it fits the whole screen. So u get a full 32 bit colour, a full screen plus double buffering. the code is available on the main gbadev.org site.
<br/>
I was trying to set the mode 5 with the sprite BG enable, BG 2 enabled and linear array for sprites, just as detailed in devotos tutorials in this line
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">*ioreg=5+((page&amp;1)&lt;&lt;4)+ (1&lt;&lt;6)+ (1&lt;&lt;10)+(1&lt;&lt;12); </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13186 - sajiimori - Sun Dec 07, 2003 7:38 pm</h4>
    <div class="postbody"><span class="postbody">Oh, I see.  The author of that code might consider entering the Obfuscated C Contest.  If you write code that you can read, you'll have an easier time solving problems.
<br/>
<br/>
P.S.  You actually get 15 bit color, not 32 bit.  Still pretty good though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13188 - sgeos - Sun Dec 07, 2003 9:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Oh, I see.  The author of that code might consider entering the Obfuscated C Contest.</td> </tr></table><span class="postbody">
<br/>
<br/>
Looks like a neat way doing things to me.  I had never considered treating a pointer to 0x04000000 as an array for writes to registers.  Hidden behind macro definitions, I'm not convinced it's a bad way of doing things.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13213 - Miked0801 - Mon Dec 08, 2003 7:10 pm</h4>
    <div class="postbody"><span class="postbody">Oh, but it is.  Did you understand what he was doing?  Did sajiimori at first glance?  Did I?  No.  Setting display registers doesn't require neat tricks or anything for speed or space.  It requires easy to read code that anyone can pick up and understand - especially in a tutorial.  Easy to read, understandable code is the hallmark of a great programmer.  Obfuscated, hard to read code is either done to look cool (when not working in a team envirnoment - otherwise it's reason for a smackdown), for job security (only I understand what this does so therefore my job is safe - err sortof), or out of ignorance.
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13214 - sajiimori - Mon Dec 08, 2003 7:54 pm</h4>
    <div class="postbody"><span class="postbody">I guess it all depends on whether you want to write code that elegantly expresses an idea or code that sits there being neat.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13216 - Cyberman - Mon Dec 08, 2003 10:18 pm</h4>
    <div class="postbody"><span class="postbody">This sounds like the start of a good lynching ;)
<br/>
<br/>
Well seriously you do a diservice to yourself and everyone else by being cute. Even if it might be more verbose you can at least maintain a project better by taking up some time to carefully define all your macros etc. 
<br/>
<br/>
Packaging helps however I remember a 'little' bug I had once in a system that controled an HVAC system, it would turn on and off all the relays with a quick snap every so often.  I found this bug was from my destructor for manipulating some bits in IO.  So... when you make something make sure it's doing what you intend it to do by being blantantly obvious with your code ;)
<br/>
<br/>
Cyb<br/>_________________<br/>If at first you don't succeed parachuting is NOT for you.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
