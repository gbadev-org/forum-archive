<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>issues with displaying sprites - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Graphics > issues with displaying sprites</h2>
<div id="posts">
<div class="post">
    <h4>#16169 - Darmstadium - Tue Feb 10, 2004 3:43 am</h4>
    <div class="postbody"><span class="postbody">I am having a problem making a sprite appear properly. I convert my image from a pcx to header file using dovoto's pcx2sprite utility. I load it into OAM and all I get is garbage. I try my code with this example header that came with gbajunkie's tutorial and it works just fine. This is extremely frustrating. Please try to compile my code and see what you end up with. Well, here is my source and the header file that has my sprite and the palette in it:
<br/>
<br/>
source.cpp
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "gba.h"
<br/>
#include "dispcnt.h"
<br/>
#include "spriteMan.h"
<br/>
#include "keypad.h"
<br/>
#include "sprite.h"
<br/>
<br/>
void InitializeSprites()
<br/>
{
<br/>
   u16 loop;
<br/>
   for(loop = 0; loop &lt; 128; loop++)
<br/>
   {
<br/>
      sprites[loop].attribute0 = 160;
<br/>
      sprites[loop].attribute1 = 240;
<br/>
   }
<br/>
}
<br/>
<br/>
void CopyOAM()
<br/>
{
<br/>
   u16 loop;
<br/>
   u16* temp = (u16*)sprites;
<br/>
   for(loop = 0; loop &lt; 512; loop++)
<br/>
      OAM[loop] = temp[loop];
<br/>
}
<br/>
<br/>
void WaitForVsync()
<br/>
{
<br/>
   while((volatile u16)REG_VCOUNT != 160){}
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
   u16 loop;
<br/>
   SetMode(OBJ_MAP_1D | MODE_1 | OBJ_ENABLE);
<br/>
   for(loop = 0; loop &lt; 256; loop++)
<br/>
      OBJPaletteMem[loop] = spriteManPal[loop];
<br/>
   InitializeSprites();
<br/>
   sprites[0].attribute0 = COLOR_256 | TALL | 60;
<br/>
   sprites[0].attribute1 = SIZE_32 | 60;
<br/>
   sprites[0].attribute2 = 0;
<br/>
   
<br/>
   for(loop = 0; loop &lt; 256; loop++)
<br/>
      OAMData[loop] = spriteManData[loop];
<br/>
   while(1)
<br/>
   {
<br/>
      WaitForVsync();
<br/>
      CopyOAM();
<br/>
   }
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
spriteMan.h
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
const u16 spriteManData[] = {
<br/>
                    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
<br/>
                    0x0000, 0x0000, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
<br/>
                    0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00,
<br/>
                    0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x00FF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0x00FF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00,
<br/>
                    0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF,
<br/>
                    0x00FF, 0xFFFF, 0xFFFF, 0xFFFF, 0x00FF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0x00FF, 0xFFFF, 0xFFFF, 0xFFFF, 0x00FF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x00FF, 0xFFFF, 0xFF00, 0x0000, 0x00FF, 0xFFFF,
<br/>
                    0xFF00, 0x0000, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF,
<br/>
                    0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00,
<br/>
                    0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x00FF, 0xFFFF,
<br/>
                    0x0000, 0xFFFF, 0x00FF, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0x00FF, 0xFFFF, 0xFF00, 0xFFFF, 0x00FF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0x00FF, 0xFFFF, 0xFF00, 0xFFFF,};
<br/>
<br/>
const u16 spriteManPal[] = {
<br/>
                    0x0802, 0x0802, 0x0802, 0x0802, 0x0802, 0x0802, 0x0802, 0x0802, 0x0802, 0x0000,
<br/>
                    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
<br/>
                    0x0800, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
<br/>
                    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0800, 0x0000, 0x0000, 0x0000,
<br/>
                    0x0000, 0x0004, 0x0000, 0x0421, 0x0421, 0x0842, 0x0842, 0x0C63, 0x0C63, 0x1084,
<br/>
                    0x1084, 0x14A5, 0x14A5, 0x18C6, 0x18C6, 0x1CE7, 0x1CE7, 0x2108, 0x2108, 0x2529,
<br/>
                    0x2529, 0x294A, 0x294A, 0x2D6B, 0x2D6B, 0x210C, 0x2108, 0x2529, 0x2529, 0x294A,
<br/>
                    0x294A, 0x2D6B, 0x3DEF, 0x4210, 0x4210, 0x4631, 0x4631, 0x4A52, 0x4A52, 0x4673,
<br/>
                    0x4671, 0x5294, 0x5294, 0x56B5, 0x56B5, 0x5AD6, 0x5AD6, 0x5EF7, 0x5EF7, 0x6318,
<br/>
                    0x6318, 0x6739, 0x6739, 0x6B5A, 0x6B5A, 0x6F7B, 0x6F7B, 0x6318, 0x6318, 0x6739,
<br/>
                    0x6739, 0x6B5A, 0x6B5A, 0x6F7B, 0x6F7B, 0x0004, 0x0000, 0x0421, 0x0421, 0x0842,
<br/>
                    0x0842, 0x0C63, 0x0C63, 0x1084, 0x1084, 0x14A5, 0x14A5, 0x18C6, 0x18C6, 0x1CE7,
<br/>
                    0x1CE7, 0x3188, 0x318C, 0x35AD, 0x35AD, 0x39CE, 0x39CE, 0x3DEF, 0x2D6B, 0x318C,
<br/>
                    0x318C, 0x35AD, 0x35AD, 0x39CE, 0x39CE, 0x3DEF, 0x3DEF, 0x4210, 0x4210, 0x4E31,
<br/>
                    0x4E33, 0x4A52, 0x4A52, 0x4E73, 0x4E73, 0x5294, 0x5294, 0x56B5, 0x56B5, 0x5AD6,
<br/>
                    0x5AD6, 0x5EF7, 0x5EF7, 0x739C, 0x739C, 0x77BD, 0x77BD, 0x7BDE, 0x7BDE, 0x7FFF,
<br/>
                    0x7FFF, 0x739C, 0x739C, 0x77BD, 0x77BD, 0x7BDE, 0x7BDE, 0x7FFF, 0x7FFF, 0x0004,
<br/>
                    0x0000, 0x0421, 0x0421, 0x0842, 0x0842, 0x0C63, 0x0C63, 0x1084, 0x1084, 0x14A5,
<br/>
                    0x14A5, 0x18C6, 0x18C6, 0x1CE7, 0x1CE7, 0x2108, 0x2108, 0x2529, 0x2529, 0x294A,
<br/>
                    0x294A, 0x2D6B, 0x2D6B, 0x318C, 0x318C, 0x35AD, 0x35AD, 0x39CE, 0x39CE, 0x3DEF,
<br/>
                    0x3DEF, 0x4210, 0x4210, 0x4631, 0x4631, 0x4A52, 0x4A52, 0x4E73, 0x4E73, 0x5294,
<br/>
                    0x5294, 0x33F1, 0x0015, 0x0020, 0x3809, 0x7A92, 0x3000, 0x382A, 0x0015, 0x0000,
<br/>
                    0x3001, 0x3000, 0x3809, 0x0008, 0x0000, 0x000A, 0x000A, 0x33F6, 0x7A88, 0x3000,
<br/>
                    0x7A8B, 0x3000, 0x0008, 0x0000, 0x0020, 0x0020, 0x3839, 0x33F8, 0x7E33, 0x3000,
<br/>
                    0x0020, 0x0008, 0x33E7, 0x2122, 0x3000, 0x0001, 0x0020, 0x0000, 0x0002, 0x2800,
<br/>
                    0x20DA, 0x0000, 0x0000, 0x33F3, 0x2072, 0x21C0,};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any help at all anybody could give would be VERY appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18232 - darknet - Mon Mar 22, 2004 9:46 pm</h4>
    <div class="postbody"><span class="postbody">I had a very similar problem for the longest time and, honestly, the only conclusion I came to was to not use PCX2SPRITES (or pcx2gba). I know it works for most people around here, but I can't get it working to save my life.
<br/>
<br/>
The conversion utility I use these days is gifs2sprites. Its in the tools section. Just convert your .pcx to a .gif in either photoshop or paint shop pro and then use gifs2sprites like so:
<br/>
<br/>
gifs2sprites 256 nameOfHeader.h gifFile.gif 
<br/>
<br/>
where 256 is 256 colors (or 16 if yours is 16) and nameOfHeader is what you want to name the header and gifFile is the name of the file you're passing. 
<br/>
<br/>
Whats cool about this program is that you can actually pass it a bunch of gif files and it will make a single palette from it, which is necessary when you have multiple sprites. Other than all of that, your code looks ok. 
<br/>
<br/>
I assume you want 0x802 to be the transparent color in your image? If so, everything should be kosher from there.
<br/>
<br/>
Let me know how it goes.
<br/>
<br/>
-Mike</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
