<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Specify the color bank for 16 color tilemaps with Grit - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Graphics > Specify the color bank for 16 color tilemaps with Grit</h2>
<div id="posts">
<div class="post">
    <h4>#165022 - Chano Marrano - Sat Dec 06, 2008 9:13 pm</h4>
    <div class="postbody"><span class="postbody">How to specify the color bank to use for 16 color tilemaps with Grit?
<br/>
<br/>
With gfx2gba it can be done with -b, but I have been reading Grit docs a while and I haven't seen anything...<br/>_________________<br/><a class="postlink" href="http://www.playeradvance.org/forum/showthread.php?t=19881" target="_blank">Sh*tty RPG</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165023 - Cearn - Sat Dec 06, 2008 11:04 pm</h4>
    <div class="postbody"><span class="postbody">In principle, color bank used for a tile will be the determined by the colors of the tile in question. If, say, the tile uses colors from the 0xF0-0xFF range, the screen-entry will use bank 15.
<br/>
<br/>
If you really need to use another bank for it, the easiest way would be to move the colors in the original bitmap. Alternatively, you could try the map-offset option, <span style="font-style: italic">-ma</span>. This adds a number each screen-entry, so if all the actual colors are in the first 16 colors, `-ma 0xF000' would effectively make each screen-entry use the last color bank.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165026 - Chano Marrano - Sat Dec 06, 2008 11:34 pm</h4>
    <div class="postbody"><span class="postbody">I think that the value of the map offset option is "moduled" (%) by 1024, so it can't be used for changing the color bank. 
<br/>
With '-ma 0xF000' option the output map is the same (I've also tried it with Wingrit, with identical results).<br/>_________________<br/><a class="postlink" href="http://www.playeradvance.org/forum/showthread.php?t=19881" target="_blank">Sh*tty RPG</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165039 - Chano Marrano - Sun Dec 07, 2008 12:10 pm</h4>
    <div class="postbody"><span class="postbody">The problem is in grit_prep_map function, at grit_prep.cpp:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(ii=0; ii&lt;mapN; ii++)
<br/>
      {
<br/>
         se= mapD[ii]&amp;SE_ID_MASK;
<br/>
         if(bBase0 || se)
<br/>
            se += base;
<br/>
         mapD[ii] &amp;= ~SE_ID_MASK;
<br/>
         mapD[ii] |= (se &amp; SE_ID_MASK);
<br/>
      }</td> </tr></table><span class="postbody"> Map offset is masked by SE_ID_MASK, so it can't be used for changing the color bank.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(ii=0; ii&lt;mapN; ii++)
<br/>
      {
<br/>
         se= mapD[ii];
<br/>
         if(bBase0 || se)
<br/>
            se += base;
<br/>
         mapD[ii] |= se;
<br/>
      }</td> </tr></table><span class="postbody"> This should fix the problem. At least it works for me :p.<br/>_________________<br/><a class="postlink" href="http://www.playeradvance.org/forum/showthread.php?t=19881" target="_blank">Sh*tty RPG</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165040 - Cearn - Sun Dec 07, 2008 1:18 pm</h4>
    <div class="postbody"><span class="postbody">Yeah. I originally did the masking thing to keep the tile indices from overflowing into other sections, but I guess it's not really necessary to do that. I'll change it soon enough.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165041 - Chano Marrano - Sun Dec 07, 2008 3:35 pm</h4>
    <div class="postbody"><span class="postbody">I think it would be better to keep offset masking and to add a specific option for the color banks because overwriting horizontal/vertical flipping section is not a good idea (I don't find a reason to change that intentionally).<br/>_________________<br/><a class="postlink" href="http://www.playeradvance.org/forum/showthread.php?t=19881" target="_blank">Sh*tty RPG</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165045 - Cearn - Sun Dec 07, 2008 6:59 pm</h4>
    <div class="postbody"><span class="postbody">I've changed it so that the offset applies to each field separately; no overwriting things that they shouldn't. It should work now.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
