<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Fractional part of scrolling register for rotated/scaled BGs - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Graphics > Fractional part of scrolling register for rotated/scaled BGs</h2>
<div id="posts">
<div class="post">
    <h4>#13096 - bomberman - Fri Dec 05, 2003 11:01 am</h4>
    <div class="postbody"><span class="postbody">Hi there,
<br/>
<br/>
I'm working on a game which uses zoom feature (ratio &lt; 1) and scrolling at the same time.
<br/>
There is a problem with the zoom. Let's say I display with ratio 2/3, the scaling register will get value 384 ( = 256 *( 1/ (2 / 3)).
<br/>
This means that the GBA will display only 2 pixels out of three consecutive pixels. In other words, if my bitmap sequence for a line is ABCABCABC, after scaling, it will be ABABAB. This is if scrolling register is 0. Now if I scroll one pixel to the right (scrolling register becomes 256), it will start removing a row not from point (0, 0) of the map, but from (1, 0) which is the first point displayed on the screen. So the display becomes BCBCBC. And if I scroll 2 pixels to the right (scrolling register value is 512), it will display CACACA. Result is when you scroll, everything flashes because at each new position, the removed row is not the same. Hope I was clear on this explanation !!!
<br/>
<br/>
I doubt that the fractional part of the scrolling register represents a fraction of pixel, it has no meaning.
<br/>
<br/>
What I noticed, however, is if fractional part is 0, then in case of 2/3 ratio, it removes the 3rd row in a sequence. If fractional part is 128, it removes the second row in a sequence, and if I put 256 (which in fact is a plain pixel), then I scroll one more pixel. Result is:
<br/>
scroll register at 0:                  ABABAB
<br/>
scroll register at (256 + 128):  BABABA
<br/>
scroll register at (512 + 256):  ABABAB
<br/>
<br/>
My scrolling is now fine !!! I can reproduce it with a ratio like 4/5 with using fractional part of 64, 128, 192, 256 depending on my (scrolling register % 5), i.e for a bitmap sequence like ABCDE, I'll have:
<br/>
scroll register at 0:                   ABCDABCD
<br/>
scroll register at (256 + 64):     BCDABCDA
<br/>
scroll register at (512 + 128):   CDABCDAB
<br/>
scroll register at (768 + 192):   DABCDABC
<br/>
scroll register at (1024 + 256): ABCDABCD
<br/>
<br/>
In short, it seems that rather than being a fraction of pixel, the fractional part of the register controls which rows are to be removed. With simple cases like that it works fine. My intuition tells me that I am on the right path, but I can not figure out what is the exact schema in a generic case like a "non standard" ratio of 4/7 for example.
<br/>
<br/>
Anyone has a clue or already experimented this ???
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13098 - tepples - Fri Dec 05, 2003 3:21 pm</h4>
    <div class="postbody"><span class="postbody">What you're seeing is the harsh aliasing of nearest-neighbor downsampling. The "fractional" part of the rot/scale translation registers (BG2X, BG2Y, BG3X, BG3Y) becomes more useful as you zoom <span style="font-style: italic">in</span>. Try writing 192 to the scaling registers and seeing how it scrolls, and you'll understand why it's called "fractional." If you're going to be staying zoomed out for a while, try blurring your texture tiles.
<br/>
<br/>
To work out the general schema for say 4/7, try adding 0, ceil(256/7), ceil(256*2/7), ceil(256*3/7), ceil(256*4/7), ceil(256*5/7), ceil(256*6/7).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13103 - bomberman - Fri Dec 05, 2003 5:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
To work out the general schema for say 4/7, try adding 0, ceil(256/7), ceil(256*2/7), ceil(256*3/7), ceil(256*4/7), ceil(256*5/7), ceil(256*6/7).
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This is the schema I use for a ratio of (n-1)/n. So it would work for 6/7. Adding ceil(256+i/n), 0 &lt;= i &lt;= n works only for a ratio of (n-1)/n. In case of p/n with p &lt; n, this does not work anymore and we need another pattern :O(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
