<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Batch conversion of graphics / palette merging - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Graphics > Batch conversion of graphics / palette merging</h2>
<div id="posts">
<div class="post">
    <h4>#1443 - Phattso - Sat Jan 18, 2003 10:37 pm</h4>
    <div class="postbody"><span class="postbody">Hi, folks!
<br/>
<br/>
Recently I've resurrected some old sprites I had from the early 90's.  They're all in .TIF format (24bit).  I've used Paint Shop Pro 7 to batch convert them to .BMP files (ready to be converted to .h files).
<br/>
<br/>
The trouble is, each frame has a slightly different palette - an unfortunate side effect of the conversion process.
<br/>
<br/>
I was wondering if any of you knew where I could find a utility to merge the palettes into one, and then re-save the .bmp files with the new palette/raster data?
<br/>
<br/>
Thanks in advance for any suggestions that can save me having to write my own tool to do this.  :-)
<br/>
<br/>
Cheers!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1444 - ampz - Sat Jan 18, 2003 10:54 pm</h4>
    <div class="postbody"><span class="postbody">Not that hard to write a tool to do that...
<br/>
<br/>
Check out the map editors for GBA... They should be able to load a bunch of custom images and produce some useable output.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1445 - Phattso - Sat Jan 18, 2003 11:31 pm</h4>
    <div class="postbody"><span class="postbody">Ampz,
<br/>
<br/>
Indeed there are a lot of conversion tools that merge palettes and produce .bin or .h files for use.
<br/>
<br/>
Perhaps I should have gone into more detail: I specifically need a tool that updates the source bitmap files, and not one that just takes loads of inputs and generates some seperate output files.
<br/>
<br/>
The reason is that I'll actually be converting these files one more time into RLE bitmaps, and then using a custom tool to save the RLE raster data as a .h file.  These sprites have *many* frames of animation, so I need them to be as small as possible (without having to incur the runtime penalty for other types of compression).
<br/>
<br/>
As you say, not a difficult job per se - but it could become time consuming and I'd rather not re-invent the wheel if someone else has already done this.  If they haven't, then I'll just write my own and release the tool when I'm done.
<br/>
<br/>
Thanks for replying.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1465 - JonH - Sun Jan 19, 2003 2:56 am</h4>
    <div class="postbody"><span class="postbody">mmm...
<br/>
<br/>
i know it may not exactly meet your requirement, but gifs2sprites will merge the palettes of every single one of your sprites. then, if this is greater than 256 colors, it will decrease the palette to adapt to the color depth.
<br/>
<br/>
quote from the readme included with the tool:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> If the result palette grows too large for the desired color depth, the number of colors will be decreased with help of color quantization. (All colors will be placed in a cube that is divided in a number of blocks until the number of blocks corresponds to the number of colors). If this happends, a warning will be displayed when the command is run. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
then if this doesn't help, just ignore my waffle ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1471 - Phattso - Sun Jan 19, 2003 11:09 am</h4>
    <div class="postbody"><span class="postbody">JonH,
<br/>
<br/>
I've tried that particular tool and others like it when I've been working with sprites in the Tile Modes.  For that they are invaluable, and their palette merging is really good.
<br/>
<br/>
Sadly, the problem for me is that I don't want it to generate a unified palette for the images and then reflect it in a .h file - I need it to physically update each of the source images with the new palette and raster data so I can then feed the images into my own converter.
<br/>
<br/>
As has been suggested, it's not that tough a tool to write (especially since I know that each palette contains the same colours, just in a different order).  Perhaps I'll just kick myself out of lazy mode and write something custom.   :-)
<br/>
<br/>
Thanks for the suggestion, though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1479 - tepples - Sun Jan 19, 2003 3:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Phattso wrote:</b></span></td> </tr> <tr> <td class="quote">I need it to physically update each of the source images with the new palette and raster data so I can then feed the images into my own converter.</td> </tr></table><span class="postbody">
<br/>
Why would you make it go in and modify your source images in-place?  Wouldn't it be a cleaner design to have the palette unifier output the images under a new name or in a new folder, leaving your source images unchanged?  Imagine what happens when you run an in-place palette unifier, edit one of your source images, run the palette unifier, edit, rinse and repeat.  You start seeing weird color shifts across all your sprites.  Eventually, your images would lose quality.
<br/>
<br/>
Never make a processing step that modifies your source images.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1485 - ampz - Sun Jan 19, 2003 3:38 pm</h4>
    <div class="postbody"><span class="postbody">I put all my sprites on one big bitmap, then I just convert the entire bitmap to an C array.
<br/>
No palette problems whatsoever...
<br/>
Of course, this means I have to use the 2D mapping mode, wich sometimes can be a bit of a pain in the nic'tah' (a goa'uld word for a specific bodypart)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1487 - tepples - Sun Jan 19, 2003 3:49 pm</h4>
    <div class="postbody"><span class="postbody">I too put all of a sprite's cels on one image before running it through the converter.  Sixteen colors, four bits, zero problems.
<br/>
<br/>
You don't have to use 2D mapping mode if you either A. make your bitmap 32 pixels wide (assuming 32x32 sprites) or B. use a tool that converts bitmaps to 1D mode sprite cels (which shouldn't be too hard to write).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1494 - Phattso - Sun Jan 19, 2003 4:54 pm</h4>
    <div class="postbody"><span class="postbody">tepples,
<br/>
<br/>
Indeed, you are right.  They should be output to a new .bmp file.  I was only trying to make obvious the fact that I don't want it output to another format (.h or .bin).  My explanation was badly worded.  :-)
<br/>
<br/>
As soon as I get the sprites with a unified palette, I won't need the tool any more (which is why I'm keen not to have to spend time writing one just for a one-shot deal).  But it is obviously not good programming practice to arbitrarily destroy ones source images.
<br/>
<br/>
I understand what you're all saying about having a single image, uinifying the palette, and then extracting the images.  This is how I do it for my mode 0/1/2 projects. 
<br/>
<br/>
As I've already mentioned, however, my situation is slightly different in this case.  I have some legacy images (128x128 .tif's) numbering into the hundreds (423, in fact) that were professionally created for a project on an ARM platform back in the early 90's.  It would have to be one *hell* of a big bitmap to do it the normal way.  ;-)
<br/>
<br/>
Thanks for the comments, all.
<br/>
<br/>
<br/>
btw, tepples: I downloaded TOD and had a quick play.
<br/>
<br/>
My head *still* hurts some 20 minutes later! ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1497 - ampz - Sun Jan 19, 2003 5:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">I too put all of a sprite's cels on one image before running it through the converter.  Sixteen colors, four bits, zero problems.
<br/>
<br/>
You don't have to use 2D mapping mode if you either A. make your bitmap 32 pixels wide (assuming 32x32 sprites) or B. use a tool that converts bitmaps to 1D mode sprite cels (which shouldn't be too hard to write).</td> </tr></table><span class="postbody">
<br/>
<br/>
True, IF all your sprites have the same dimensions you can use 1D mode by setting the image to the same width as the sprites. But very few games use only one size sprites.
<br/>
And no, it is impossible to write a automatic conversion tool that makes a 1D mapping out of a large image containing sprites of different sizes. A semi-automatic one can be done, but it's not that easy.
<br/>
<br/>
BTW, I have to switch to 1D... Animated sprites require me to write awful code if 2D mapping is used.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1517 - tepples - Sun Jan 19, 2003 8:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote:</b></span></td> </tr> <tr> <td class="quote">But very few games use only one size sprites.</td> </tr></table><span class="postbody">
<br/>
The NES allowed for only one sprite size per screen, 8x8 or 8x16 pixels.  The Super NES allowed for only two sprite sizes per screen.  Thus, NES and Super NES games often built their sprites out of small tiles, 8x16 pixels in the NES case and 16x16 pixels in the Super NES case.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And no, it is impossible to write a automatic conversion tool that makes a 1D mapping out of a large image containing sprites of different sizes.</td> </tr></table><span class="postbody">
<br/>
Impossible?  The Allegro library's "grabber" tool does it.  It reserves color 255 for "boxes" around sprite cels and then assumes that any rectangular area surrounded by color 255 is a sprite cel.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">A semi-automatic one can be done, but it's not that easy.</td> </tr></table><span class="postbody">
<br/>
It shouldn't be too hard to write a GUI tool that displays a bitmap, lets the user draw boxes on the bitmap, and saves the boxes' coordinates to a file that a converter uses.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1522 - ampz - Sun Jan 19, 2003 8:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote:</b></span></td> </tr> <tr> <td class="quote">And no, it is impossible to write a automatic conversion tool that makes a 1D mapping out of a large image containing sprites of different sizes.</td> </tr></table><span class="postbody">
<br/>
Impossible?  The Allegro library's "grabber" tool does it.  It reserves color 255 for "boxes" around sprite cels and then assumes that any rectangular area surrounded by color 255 is a sprite cel.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">A semi-automatic one can be done, but it's not that easy.</td> </tr></table><span class="postbody">
<br/>
It shouldn't be too hard to write a GUI tool that displays a bitmap, lets the user draw boxes on the bitmap, and saves the boxes' coordinates to a file that a converter uses.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
As I said, a semi-automatic conversion tool can be done. The user must specify the size of every sprite manually in some way.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1526 - Splam - Sun Jan 19, 2003 9:05 pm</h4>
    <div class="postbody"><span class="postbody">Mentioned this in another thread...  My grabber can either take "minimum rectangle" areas drawn by the user or do it automatically.  It removes any 8x8 pixel blocks and packs the rest together into 1 run of data, makes a header for the sprites which is a map of where actual 8x8 blocks exist and when it's being drawn my code can be set to either do it all as 8x8 sprites OR make the sprite out of the maximum size sprites it can (to reduce OAM usage and allow for more sprites per line).  All done with 1d mapping so each sprite can be transfered with 1 dma. Only thing that causes problems with grabbing minimum rectanlges is you then need to position each frame in the correct place on the screen but my grabber contains an animation editor too which includes that info + collision info :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1983 - headspin - Mon Jan 27, 2003 1:26 am</h4>
    <div class="postbody"><span class="postbody">If you have photoshop, you can make your sprites have the same palette in the same order by doing the following:
<br/>
<br/>
1. Load a sprite, set it to Image-&gt;Mode-&gt;Index Colour... and select the amount of colours you want (make sure this sprite has *all* the colours needed, otherwise paint a pixel with the extra colours needed. This will now set the colours &amp; order of colours.
<br/>
2. Load each sprite and "cut &amp; paste" it onto the one created above and save, the sprite will now look the same, but the order of colours are forced to be the same as the one pasted to.
<br/>
<br/>
-or-
<br/>
<br/>
You can do like 1. but then save the palette, and load it for each sprite.
<br/>
<br/>
-or-
<br/>
<br/>
If you have got some time and patience download a program called pedit (Palette Editor) and you can change the order of your colours in your palette, but it's not easy.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1984 - Splam - Mon Jan 27, 2003 1:45 am</h4>
    <div class="postbody"><span class="postbody">There are some windows apps around that will do batch colour remaping/reduction etc can't remember the names (last time I used one was a looong time ago) but try searching on google and you should hit something.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2001 - Phattso - Mon Jan 27, 2003 4:18 pm</h4>
    <div class="postbody"><span class="postbody">Many thanks for the suggestions!
<br/>
<br/>
What I've actually done is code up a proprietary app to reindex the palettes for me.  It's an automated version of what you suggested with Photoshop, headspin, but without having to open up each one of the hundreds of files manually.  ;-)
<br/>
<br/>
It's a pretty messy tool, and damned slow considering how little it does, but I may fix it up and release it for others to use in the future.  Having said that, I doubt there's much need for such a specific tool (TGA -&gt; BMP -&gt; RLE BMP with unified palette), and thus not worth spending any more time on making it half decent.
<br/>
<br/>
Still - the job is done now, and hopefully I'll never have to do it again!  :)
<br/>
<br/>
Thanks again, folks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2008 - tepples - Mon Jan 27, 2003 5:37 pm</h4>
    <div class="postbody"><span class="postbody">Of course, one of the advantages of 16-color tile modes is that the GBA reindexes the palettes for you in real time. If "Kirby", "Wario Land 4", and "Metroid Fusion" can get away with it...<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2065 - Phattso - Tue Jan 28, 2003 4:37 pm</h4>
    <div class="postbody"><span class="postbody">Indeed - very useful features in the tile modes (in fact, I'm constantly impressed with what people achieve using them).
<br/>
<br/>
We're working in Mode4, however, and using the full complement of colours.  :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
