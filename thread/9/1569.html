<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>help! scrolly background, an interesting one. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Graphics > help! scrolly background, an interesting one.</h2>
<div id="posts">
<div class="post">
    <h4>#8011 - magictoy - Mon Jun 30, 2003 7:03 pm</h4>
    <div class="postbody"><span class="postbody">Okay, I'm trying to achieve a similar effect to the floor in streetfighter 2. It looks to me like capcom have the floor as one background and they are changing the xposition of the background with every HBLANK interrupt. 
<br/>
I'm currently using HAM devkit and have tried to achieve this effect but I think the reason why I am failing is due to the double buffering. The background is updaed every time I call ham_CopyObjToOAM(); which flips the offscreen canvas and the one that is displayed.
<br/>
<br/>
Am I on the right track? I've already tried changing the colour palettes on each HBLANK but it mucks up. So any hints on achieving gradients that way would be appreciated too.
<br/>
<br/>
Fingers crossed someone has already succeeded in what I'm attempting to do. Oh, I'm using screenmode 1 btw, I've already used the rotating bg and one of the tiled backgrounds already in my project which leeaves me with the one remaining tiled bg. I'm reluctant to waste sprites to create a less appealing effect but with every hour I lose more hair the more likely it seems that I will have to use them...
<br/>
<br/>
please help
<br/>
Nick<br/>_________________<br/>-------
<br/>
To the winch, wench!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8396 - magictoy - Wed Jul 09, 2003 5:14 pm</h4>
    <div class="postbody"><span class="postbody">Hiya,
<br/>
<br/>
if it helps anyone, the game "tetanus on drugs" which source is available on gbadev.org uses this effect.
<br/>
<br/>
I, however, do not understand the code and therefore cannot replicate the effect. If any very kind and generous person can help at all, possibly pointing me in the right direction will forever be appreciated.
<br/>
<br/>
thanks in advance
<br/>
Nick<br/>_________________<br/>-------
<br/>
To the winch, wench!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8405 - tepples - Wed Jul 09, 2003 8:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>magictoy wrote:</b></span></td> </tr> <tr> <td class="quote">the game "tetanus on drugs" which source is available on gbadev.org uses this effect.</td> </tr></table><span class="postbody">
<br/>
Actually, <span style="font-style: italic">TOD</span> uses rot/scale mode.
<br/>
<br/>
The effect you describe is <a class="postlink" href="http://everything2.com/index.pl?node_id=941320" target="_blank"><span style="font-style: italic">Pole Position</span> style parallax scrolling</a>, which can be done entirely without rot/scale mode. The effect was used in dozens of auto racing games (especially on NES, Game Boy, Game Gear, and Sega Genesis, which had no rot/scale mode), in <span style="font-style: italic">NBA Jam</span> and <span style="font-style: italic">Super Street Fighter II</span> for Super NES and Sega Genesis, and even in the backdrops of 16-bit platformers such as <span style="font-style: italic">Actraiser</span>, <span style="font-style: italic">Sonic the Hedgehog 2</span>, <span style="font-style: italic">Donkey Kong Country 2</span>, and <span style="font-style: italic">Toy Story</span>.
<br/>
<br/>
To achieve this effect on the Game Boy Advance video hardware, use hblank DMA. Make an array of 'unsigned short' containing an x scroll position for each scanline, and fill it with appropriate data. During vblank, set up an hblank-triggered DMA transfer with 16-bit transfer word size, increasing source address (set to scanline_x[1] in *WRAM), constant destination address (set to BG0HOFS), and length 1 word. Remember to declare the registers volatile, and remember to turn off the DMA channel (DMA0CNT = 0) before setting up the next transfer.
<br/>
<br/>
Effects like those of <span style="font-style: italic">TOD</span> are not that much harder. Instead of the array of 'unsigned short', make an array of structs that represent the format of BG2 affine registers. Then follow the above instructions with these changes: 32-bit word size, destination BG2 pa, length 2 words.
<br/>
<br/>
I don't know how to set up such a DMA with HAMlib calls because I don't use HAMlib.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8799 - headspin - Sun Jul 20, 2003 12:51 pm</h4>
    <div class="postbody"><span class="postbody">I'm not sure if your talking about the same thing, but I gave some sample code for a wave effect at <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=300" target="_blank">http://forum.gbadev.org/viewtopic.php?t=300</a>. It uses a sine table and vblank interrupt, although the code is a little unfinished (I had issues getting the sine table to loop over without a split in the wave).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
