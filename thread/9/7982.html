<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>loading map data into a text background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Graphics > loading map data into a text background</h2>
<div id="posts">
<div class="post">
    <h4>#65495 - christosterone - Tue Jan 03, 2006 6:06 pm</h4>
    <div class="postbody"><span class="postbody">i have a map headerfile that holds data for a 256x256 map. when i load the data into a ROTBG, it looks fine. However, i want to use MODE0 so i need to use a TEXTBG. 
<br/>
<br/>
heres the code for the map headerfile
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u8 map[ 32 * 32 ] = {
<br/>
0x44,0x44,0x44, ..............};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
here's the code for loading map data that works fine for the ROTBG but not for the TEXTBG.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   temp = (u16*)map;
<br/>
   for(loop = 0; loop &lt; 32*32/2; loop++)
<br/>
         bg2.mapData[loop] = temp[loop];
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
if anybody could tell me what to do differently when loading mapdata for a TEXTBG that would be great.
<br/>
<br/>
thanks
<br/>
chris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65519 - Cearn - Tue Jan 03, 2006 8:01 pm</h4>
    <div class="postbody"><span class="postbody">The reason it doesn't work is because rotational backgrounds are fundamentally different than text backgrounds. The former uses 8-bit data, while the latter uses 16-bit data for their screen entries. 
<br/>
By casting the source to a u16 pointer, you're filling the screenblock with 0x4444 in this case, which would work fine for rot bgs, but not for text bgs. As a simple solution: just scrap the cast and work from the map data directly. Note, this <span style="font-style: italic">only</span> works because the map array is in bytes.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(loop = 0; loop &lt; 32*32; loop++) 
<br/>
    bg2.mapData[loop] = map[loop]; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Also, for what it's worth: don't keep map data (or any data or code) in header files. Don't use u16 for loop-variables, or indeed any variables unless you have to. Ints if you can, chars/shorts if you have to.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65520 - christosterone - Tue Jan 03, 2006 8:15 pm</h4>
    <div class="postbody"><span class="postbody">ahhh thanks so much. i got rid of the pointer and it runs swimmingly.
<br/>
<br/>
thanks
<br/>
chris</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
