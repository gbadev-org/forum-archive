<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>many many sprites - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Game Design > many many sprites</h2>
<div id="posts">
<div class="post">
    <h4>#69887 - christosterone - Thu Feb 02, 2006 8:06 pm</h4>
    <div class="postbody"><span class="postbody">I am designing the graphics engine structure for an RTS im making for the gba. there are many units and many projectiles and many other graphical entities which would be OAM screen sprites.
<br/>
<br/>
i quickly exceeded my 128 sprite limit.
<br/>
<br/>
i was thinking about only displaying the units which would be visible on the part of the map that my gba would be displaying. i would make rectangles and use somes algorithms to see which intersect  a rectangle thats the screen etc.
<br/>
<br/>
Even if i got it to work, it seems like i would have to redefine all 128 sprites every drawing loop cycle. 
<br/>
<br/>
does anybody think that will work or is there another way i should be doing this before i spend a lot of time coding.
<br/>
<br/>
chris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69895 - DekuTree64 - Thu Feb 02, 2006 8:52 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, that's what I'd do. You're pretty much going to have to touch every OAM anyway to update their positions, so it's not much worse to put it in a different slot too. 
<br/>
<br/>
Have each sprite store a pre-setup OAM entry. Then traverse the sprite list each frame, checking if each one is on the screen, and if so, claim the next real OAM and copy in your pre-setup one (and update the position). 
<br/>
<br/>
For this kind of system, it's usually best to also keep a 'shadow' OAM array in normal RAM, and then DMA it to the hardware OAM during VBlank. That way you don't get any tearing or flickering as you re-populate the array.
<br/>
<br/>
If your units need to be sorted by Y coordinate for depth sorting, then you can just keep your sprite list sorted to begin with. As you render them out to sequential OAM entries, they will naturally be sorted by the hardware.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70614 - christosterone - Tue Feb 07, 2006 8:12 pm</h4>
    <div class="postbody"><span class="postbody">i used to write java games (sigh) but thank god ive moved on. the only issue is there was a Rectangle class in the javalib that had such functions as "bool intersects(Rectangle r1, Rectangle r2)", and "bool contains(...)". 
<br/>
<br/>
are there any rectangle intersection algorithms anywhere or should i just write it myself?
<br/>
<br/>
-chris
<br/>
<br/>
ps thanks for the idea of making another sprite array then DMAing it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70662 - tepples - Wed Feb 08, 2006 1:40 am</h4>
    <div class="postbody"><span class="postbody">Rectangle intersection is easy. Think of it as an analytic geometry problem, taking it one edge at a time. Untested code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct Rectangle {
<br/>
  int l, t, r, b;
<br/>
} Rectangle;
<br/>
<br/>
boolean intersects(const Rectangle *a, const Rectangle *b) {
<br/>
<br/>
  /* Copy a into temporary variables */
<br/>
  int l = a-&gt;l;
<br/>
  int t = a-&gt;t;
<br/>
  int r = a-&gt;r;
<br/>
  int b = a-&gt;b;
<br/>
<br/>
  /* Clip the sides of the temporary rectangle to sit within b */
<br/>
  if(l &lt; b-&gt;l)
<br/>
    l = b-&gt;l;
<br/>
  if(t &lt; b-&gt;t)
<br/>
    t = b-&gt;t;
<br/>
  if(r &gt; b-&gt;r)
<br/>
    r = b-&gt;r;
<br/>
  if(b &gt; b-&gt;b)
<br/>
    b = b-&gt;b;
<br/>
<br/>
  /* If a is still positive in width and height, then the rectanges overlap */
<br/>
  return (l &lt; r) &amp;&amp; (t &lt; b);
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70974 - christosterone - Thu Feb 09, 2006 8:43 pm</h4>
    <div class="postbody"><span class="postbody">ahh thankyou. your code seems much cleaner than mine because my Rectangle structs dont have top, bottom, left, and right values. they have:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct Rectangle
<br/>
{
<br/>
   u16 x, y; 
<br/>
   u8  w, h;
<br/>
}Rectangle;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
i'll have to modify your code a bit to fit my needs because the width and height of my rectangles will remain constant. i like that your way is so much simpler; my process was about 5x longer :-)
<br/>
<br/>
thanks, chris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70986 - naleksiev - Thu Feb 09, 2006 9:47 pm</h4>
    <div class="postbody"><span class="postbody">There is a smaller solution
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">boolean intersects(const Rectangle *a, const Rectangle *b) 
<br/>
{
<br/>
   return (a-&gt;l &lt; b-&gt;r) &amp;&amp; (b-&gt;l &lt; a-&gt;r) &amp;&amp; (a-&gt;t &lt; b-&gt;b) &amp;&amp; (b-&gt;t &lt; a-&gt;b);
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
