<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>moving projectiles - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Game Design > moving projectiles</h2>
<div id="posts">
<div class="post">
    <h4>#65654 - christosterone - Wed Jan 04, 2006 7:59 pm</h4>
    <div class="postbody"><span class="postbody">hi i have the following projectile struct
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct projectile
<br/>
{
<br/>
   bool active;
<br/>
   u16 x;
<br/>
   u16 y;
<br/>
   u16 angle;
<br/>
   u8 type;
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and i need to know what code i should have to move the projectile 1 unit at a time in my game loop. 
<br/>
<br/>
ex.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//somewhere in main game loop
<br/>
if( projectiles[0].active )
<br/>
{
<br/>
// move projectile
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
thanks
<br/>
chris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65655 - keldon - Wed Jan 04, 2006 8:42 pm</h4>
    <div class="postbody"><span class="postbody">Having data as u8 or u16 will most likely not do you any favours.
<br/>
<br/>
Angle can often be better conveyed with a vector (direction and magnitude). Vectors are usually stored only as x and y. Magnitude is calculated by sqrt(x^2 + y ^2). You can then use your vector to move using its x and y and also use its vector for collision detection too when moving.
<br/>
<br/>
Using a vector also allows you to easily apply gravity and physics if need be with ease. For example a physics implementation (minus collision) of the <a class="postlink" href="http://sodarace.net/index.jsp" target="_blank">soda world</a> in about 30 lines of code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65657 - thegamefreak0134 - Wed Jan 04, 2006 8:47 pm</h4>
    <div class="postbody"><span class="postbody">What we really need to know is what the projectine needs to do. Actually moving the projectile is a simple matter of updating it's position and re-copying the OAM. I don't know if that differs with devkits though...<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65664 - sajiimori - Wed Jan 04, 2006 9:59 pm</h4>
    <div class="postbody"><span class="postbody">Agreed that vectors are the way to go.  You'll also need to use fixed-point math because there's no way to move 1 unit at an angle without moving a fraction of a unit in each direction.
<br/>
<br/>
If you've got any questions about fixed point math, vectors, or how to make a vector that's 1 unit long, we can help with that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65707 - christosterone - Thu Jan 05, 2006 2:44 am</h4>
    <div class="postbody"><span class="postbody">yea all i need is the code that will move vector by one incrament (vector length) at a time. i should probably make my x and y doubles. i can convert to u16s when im making the screen sprites later but i need precision now. 
<br/>
<br/>
so i think this would be a better struct
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct projectile
<br/>
{
<br/>
   bool active;
<br/>
   double x;
<br/>
   double y;
<br/>
   u16 angle;
<br/>
   u8 type;
<br/>
   u8 speed;
<br/>
}; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
now i believe this code would find the next position
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
projectile bullet;
<br/>
 //assume i set values to the struct...
<br/>
<br/>
//moving bullet, included SIN[] and COS[] tables in header file
<br/>
void moveBullet()
<br/>
{
<br/>
 double newx = bullet.x + SIN[ bullet.angle ];
<br/>
 double newy = bullet.y + COS[ bullet.angle ];
<br/>
<br/>
 bullet.x = newx;
<br/>
 bullet.y = newy;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
now i would incorporate the speed function so i can check for collisions at every step (instead of moving the bullet in lengthy bursts)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 loop;
<br/>
for( loop=0; loop&lt;bullet.speed; loop++ )
<br/>
{
<br/>
 moveBullet();
<br/>
 checkCollisions(); // assume i made this somewhere
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
would it be better to move the bullet in steps then check for collisions (as depicted above) or to just make it move in bullet.speed bursts like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void moveBullet()
<br/>
{
<br/>
 double newx = bullet.x + bullet.speed * SIN[ bullet.angle ];
<br/>
 double newy = bullet.y + bullet.speed * COS[ bullet.angle ];
<br/>
<br/>
 bullet.x = newx;
<br/>
 bullet.y = newy;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65713 - sajiimori - Thu Jan 05, 2006 3:30 am</h4>
    <div class="postbody"><span class="postbody">If you're set on using angles instead of velocity vectors, it looks like you already have some code.
<br/>
<br/>
I agree that you need fractional precision, but the GBA doesn't have floating point hardware so it's emulated in software.  Use fixed point math.
<br/>
<br/>
Move bullets in big jumps if you don't mind missing collisions between the start and end positions.  Move bullets a unit at a time if you don't mind that it's slow.  Move bullets using vector collision if you want speed and accuracy.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65715 - keldon - Thu Jan 05, 2006 3:52 am</h4>
    <div class="postbody"><span class="postbody">Why the u8's and u16's? They are slower to access than u32's.
<br/>
<br/>
Note:
<br/>
Cos = Adjacent / Hypotenuse
<br/>
Sin = Opposite / Hypotenuse
<br/>
<br/>
I'm positive that your use of sin and cos is the wrong way around. It is probably working properly because Y is upside down in GB screen space and your direction 0 is facing up.
<br/>
<br/>
So your line should read:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">double newx = bullet.x + COS[ bullet.angle ] </td> </tr></table><span class="postbody">
<br/>
<br/>
Remember when writing your LUT that the Y plane is inverted so your COS table should be inverted too.
<br/>
<br/>
Other than that your code is workable although you would benefit from using vectors for collisions rather than integration which is innacurate and slow anyway.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">yea all i need is the code that will move vector by one incrament (vector length) at a time. i should probably make my x and y doubles. i can convert to u16s when im making the screen sprites later but i need precision now. </td> </tr></table><span class="postbody">
<br/>
To do this you can either store your table as <span style="font-style: italic"> SIN[i] = Sin(i) * length</span>. Or by multiplying Sin[i] by length;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69889 - christosterone - Thu Feb 02, 2006 8:20 pm</h4>
    <div class="postbody"><span class="postbody">edit: nvm i got it to work. thanks for all the trig code</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73391 - greenllll - Sat Feb 25, 2006 7:00 am</h4>
    <div class="postbody"><span class="postbody">I've taken math up to Calculus and Discrete Mathmatics, and I do not remember learning how to do any real work with vectors.  I remember hearing something about it being taught in Physics.  Where did you guys learn how to work with vectors?  The concept fascinates me.  I love math, but mostly trig.  Calculous is very tough for me.  I love this thread too.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73401 - waruwaru - Sat Feb 25, 2006 9:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>greenllll wrote:</b></span></td> </tr> <tr> <td class="quote">Where did you guys learn how to work with vectors?</td> </tr></table><span class="postbody">
<br/>
<br/>
I remember studying lots of matrix math in "Linear Algebra".  Some schools also offer classes in Computer Graphics.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73711 - Miked0801 - Mon Feb 27, 2006 7:19 pm</h4>
    <div class="postbody"><span class="postbody">In truth, the basics that we use here are covered in Physics 101 (201).  Whenever I need a quick refresher, I pull out my college text and look at chapter 2 and 3 :)
<br/>
<br/>
The actual applications of vectors (projections, collision detections, etc.) are covered sort-of in Linear Algebra, but I found that game programming books describe what is needed better.  That and asking lots of questions and getting lots of answers.
<br/>
<br/>
Trust me.  Once you start using vectors and discover just how powerful they are, you will never go back to angle math again if you can at all help it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73717 - sajiimori - Mon Feb 27, 2006 8:11 pm</h4>
    <div class="postbody"><span class="postbody">We use angles a lot, but maybe that's a result of working in 3D.  Things need to be rotated pretty often.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73729 - christosterone - Mon Feb 27, 2006 9:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
 Move bullets using vector collision if you want speed and accuracy.</td> </tr></table><span class="postbody">
<br/>
<br/>
i know a lot about vectors mathematically, but im wondering how i would use vector colissions instead of angles and speed or whatever it is that im doing.
<br/>
<br/>
im not sure if i want vector math, though, because the moving projectiles are the only things moving in a uniform direction. the tank units etc will move sparatically. the angle and speed might be the better for this project. however, i would like to see alternatives just in case im wrong.
<br/>
<br/>
also, you stated i needed to use fixed point math. how would one go about doing that? bitshifting, right?
<br/>
<br/>
thanks chris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73739 - tepples - Mon Feb 27, 2006 11:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>christosterone wrote:</b></span></td> </tr> <tr> <td class="quote">also, you stated i needed to use fixed point math. how would one go about doing that? bitshifting, right?</td> </tr></table><span class="postbody">
<br/>
Yes. Go to Google and look for some fixed point arithmetic tutorials.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73750 - keldon - Tue Feb 28, 2006 12:29 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://en.wikipedia.org/wiki/Special:Search?search=fixed+point&amp;fulltext=fulltext&amp;sourceid=mozilla-search" target="_blank">Fixed point section on wikipedia</a>
<br/>
<a class="postlink" href="http://en.wikipedia.org/wiki/Fixed_point_%28computing%29" target="_blank">A selected on fixed point arithmetic on wikipedia</a>
<br/>
<br/>
Maybe you might want to add the wikipedia search engine to your browser if you have <a class="postlink" href="http://www.mozilla.org/" target="_blank">mozilla</a>. It is quite useful; by far the most powerful of the browsers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73762 - sajiimori - Tue Feb 28, 2006 1:21 am</h4>
    <div class="postbody"><span class="postbody">Choosing between angles and vectors for physics is unrelated to how sporadic your motion is.
<br/>
<br/>
As far as how to do collision detection, it depends on what kinds of things you want to collide: fast moving versus slow moving, point-sized objects or objects with volume, collision against static world geometry or other moving objects...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73812 - shen3 - Tue Feb 28, 2006 5:51 am</h4>
    <div class="postbody"><span class="postbody">Hi;
<br/>
<br/>
I figured I would post a quick description of how I move the bullets in my game.
<br/>
<br/>
My struct is something like this
<br/>
bullet {
<br/>
  int x;
<br/>
  int y;
<br/>
  int dx;
<br/>
  int dy;
<br/>
}
<br/>
<br/>
all of these are stored as fixed point where dividing by 256 (or &gt;&gt; 8) will get the pixel on the screen. 
<br/>
<br/>
This means bullets can move a fraction of a pixel per turn. eg dx = 256+128 moves the bullet 1 and a half pixels in the x direction per turn.
<br/>
<br/>
I was worried that this sort of thing was going to look jerky, especially if you picked values like 200 for dx, so the bullet would move 1 pixel, move 1 pixel, then not move at all the next turn. 
<br/>
<br/>
In reality this looks very smooth.
<br/>
<br/>
moving the bullet is done as follows
<br/>
bullet.x = bullet.x + bullet.dx;
<br/>
bullet.y = bullet.y + bullet.dy;
<br/>
<br/>
The only tricky parts is making sure you shift &gt;&gt; 8 before using the x and y as pixel locations.
<br/>
<br/>
Setting up dx + dy can be easily done using a sin or cos look up table.
<br/>
<br/>
Shen</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#75396 - christosterone - Sun Mar 12, 2006 6:17 pm</h4>
    <div class="postbody"><span class="postbody">dx and dy are 256x the size of a pixel. are the normal X and Y the same way? so it would be
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bullet.x = bullet.x + dx;
<br/>
screenx = (bullet.x)&gt;&gt;8
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
thanks,
<br/>
 chris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#75428 - sajiimori - Sun Mar 12, 2006 9:12 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, otherwise a motion of 1.4 pixels would be truncated to 1.0 pixels and it would be no faster.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
