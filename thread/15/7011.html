<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>room data loading - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Game Design > room data loading</h2>
<div id="posts">
<div class="post">
    <h4>#55566 - christosterone - Thu Sep 29, 2005 2:05 pm</h4>
    <div class="postbody"><span class="postbody">I am used to having room files and then parsing that into a level in the game at runtime.
<br/>
<br/>
ex the room file would look like this:
<br/>
width:5
<br/>
height:7
<br/>
torch:4,5
<br/>
<br/>
Can I have the gba open and read separate files? If not, what would you suggest to load many, separate rooms at runtime? If i create header files with the data that might work, but loading room files is a lot cleaner and simpler.
<br/>
<br/>
Any suggestions?
<br/>
<br/>
Chris G</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55585 - tepples - Thu Sep 29, 2005 6:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>christosterone wrote:</b></span></td> </tr> <tr> <td class="quote">I am used to having room files and then parsing that into a level in the game at runtime.
<br/>
<br/>
ex the room file would look like this:
<br/>
width:5
<br/>
height:7
<br/>
torch:4,5
<br/>
<br/>
Can I have the gba open and read separate files?</td> </tr></table><span class="postbody">
<br/>
Have you tried <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GBFS</a> yet?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55586 - poslundc - Thu Sep 29, 2005 6:12 pm</h4>
    <div class="postbody"><span class="postbody">The GBA does not have a native file system. ROM data is mapped to memory locations 0x08000000 and above. So you can access any data you want just by grabbing the correct pointer to the memory (usually through a named, const variable so you don't need to worry about the actual location).
<br/>
<br/>
You can impose a wrapper file system like tepples' <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GBFS</a> if you desire, which has its own distinct advantages, but isn't necessary for GBA programming. If you use it, then I expect you can have as many "open files" as you desire.
<br/>
<br/>
Dan.
<br/>
<br/>
<span style="font-weight: bold">Edit:</span> tepples posted first...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55665 - sgeos - Fri Sep 30, 2005 10:49 am</h4>
    <div class="postbody"><span class="postbody">Getting resources onto the GBA is one of the obstacles you face when programming for it.  I'd preprocess your files and spit out functions to build your rooms.  Then I'd make a table of function pointers, but that is just me.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55671 - Touchstone - Fri Sep 30, 2005 11:57 am</h4>
    <div class="postbody"><span class="postbody">I agree with sgeos. With the gba you have a great opportunity to avoid anything even remotely resembling files. You can do pretty much anything data related as const data structures, especially if you create C or assembler-files that is compiled and linked into the game, that way you can use code symbols instead of fixed adresses.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55680 - tepples - Fri Sep 30, 2005 4:05 pm</h4>
    <div class="postbody"><span class="postbody">[fanboy="GBFS"]
<br/>
But if you make everything as const data structures, then your artists will have to have a copy of devkitARM installed on their machines in order to test their work in an emulator, and it'll take longer to build the program as the compiler and linker have to process everything, not just the code.
<br/>
[/fanboy]<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55726 - Touchstone - Sat Oct 01, 2005 12:25 am</h4>
    <div class="postbody"><span class="postbody">Yes, one of the problems data in const arrays is artists having to compile the game each time they want to test their new stuff. Another problem is of course if your current room data is referring to other data that doesn't exist yet you cannot properly link a game binary. This is probably a lot bigger problem as it's likely that your artist still have to have some sort of tool to convert their Photoshop images to a format that's readable in your game and I assume that the game binary still have to be modified by some sort of tool to include data files with your GBFS.
<br/>
<br/>
It will probably take longer to build your game to but obviously the data is only compiled once when it's changed so you don't recompile all your data files when you recompile your game. Unless you really want to.
<br/>
<br/>
Considering that const arrays doesn't have to be parsed by the gba I think makes it a lot easier to write safe checking code. You have tons of more ram and cpu on a PC obviously, and probably better debugging possibilities. Uhm.. So, yes.. That's what I'm thinking right now.. :-)<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55728 - tepples - Sat Oct 01, 2005 4:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Touchstone wrote:</b></span></td> </tr> <tr> <td class="quote">This is probably a lot bigger problem as it's likely that your artist still have to have some sort of tool to convert their Photoshop images to a format that's readable in your game</td> </tr></table><span class="postbody">
<br/>
Then put 'make', 'gbfs', and 'gfx2gba' on each artist's machine. That's a <span style="font-style: italic">lot</span> smaller than the GCC and Binutils packages.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> and I assume that the game binary still have to be modified by some sort of tool to include data files with your GBFS.</td> </tr></table><span class="postbody">
<br/>
True, but this "some sort of tool" simply involves padding the ROM to a multiple of 256 bytes, and the programmer can do this before shipping a nightly build out to artists.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It will probably take longer to build your game to but obviously the data is only compiled once when it's changed so you don't recompile all your data files when you recompile your game.</td> </tr></table><span class="postbody">
<br/>
I forgot to mention linking. Or does GCC 4 have incremental linking now?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Considering that const arrays doesn't have to be parsed by the gba I think makes it a lot easier to write safe checking code.</td> </tr></table><span class="postbody">
<br/>
You can generate binary files of level data matching a struct layout, stuff those into a GBFS file, and then have the GBA read those. I used this technique in TOD, and I'm using it now in Luminesweeper.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Sun Oct 02, 2005 1:35 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#55786 - sgeos - Sun Oct 02, 2005 6:44 am</h4>
    <div class="postbody"><span class="postbody">You probably want to created all your linked rooms on the PC before you export to some sort of custom GBA storage format.  (Test now and then, of course.)
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55822 - Touchstone - Sun Oct 02, 2005 8:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Then put 'make', 'gbfs', and 'gfx2gba' on each artist's machine. That's a <span style="font-style: italic">lot</span> smaller than the GCC and Binutils packages.</td> </tr></table><span class="postbody">I doubt that harddrive size is what matters the most though. It's more likely to be how easy the tool is to use and I image both ways could be made just as simple to use.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">I forgot to mention linking. Or does GCC 4 have incremental linking now?</td> </tr></table><span class="postbody">I haven't tried GCC4 so I can't say. It will probably be slower to link with all data as const data rather than just linking your game code. I can't tell if linking all data as const is slower than linking and then running the tool that appends the data as files at the end of the binary though. I figure that that have to take some amount of time aswell, although it's probably faster. On the other hand you would have to dynamically access your game data through a file system instead of just reading the value of a ROM address. If that includes hashing through a string table an then parsing the file data then I'd probably go with longer linking times anyhow.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">You can generate binary files of level data matching a struct layout, stuff those into a GBFS file, and then have the GBA read those. I used this technique in TOD, and I'm using it now in Luminesweeper.</td> </tr></table><span class="postbody">Yeah, this can be done altough you'd probably be introducing a whole slew of unecessary bugs. Ugh, I can just see all the structure data alignment bugs from piling up. :-) "What the heck, the structure contain one byte, one int and one byte and that's exactly how I've stored it in my binary, what gives". Sure, you'll most likely learn to avoid this if you've been burnt once and if you are planning on having any of these structures in ram you would probably have to arrange the data in an as optimised way as possible anyways.
<br/>
<br/>
One cool thing about having your data in const structures is that the data and the c symbols are in ROM. You don't have to have variables in RAM to point to your data to access any part of it. If you at any time would need to know how many animation sequences your hero have you could just type heroAnim.SequenceCount and there it is. RAM usage is obviously nice to keep to a minimum aswell and this helps with that.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
