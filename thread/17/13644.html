<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[SOLVED] EZF Advance + homebrew game = NOT a valid GBA ROM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Flash Equipment > [SOLVED] EZF Advance + homebrew game = NOT a valid GBA ROM</h2>
<div id="posts">
<div class="post">
    <h4>#134259 - profoX - Thu Jul 12, 2007 2:50 am</h4>
    <div class="postbody"><span class="postbody">Tonight I have tried GBA programming for the very first time.
<br/>
KDevelop (the IDE I use) had an excellent sample for GBA that I could crosscompile and link (after some messing around with devkitadvance)
<br/>
<br/>
The compiled rom runs great in VisualBoyAdvance, but I can't get the rom to run on my EZF Flash Advance flash cart.
<br/>
<br/>
Please look at this screenshot to see the problem:
<br/>
The left window (VisualBoyAdvance) displays what it has to display, while the right window (EZF Advance Client) gives an error in the statusbar claiming "It's NOT a valid GBA ROM" when I try to load it.
<br/>
<a class="postlink" href="http://wesley.debianbox.be/images/gba_rom_problem.png" target="_blank">http://wesley.debianbox.be/images/gba_rom_problem.png</a>
<br/>
<br/>
Anyone have ANY idea what could be wrong? This is my first take at creating roms, so maybe it's just something obvious.
<br/>
<br/>
I hope you guys know something.. Thanks!
<br/>
<br/>
<span style="font-style: italic">edit: solved -- I just switched over to a more modern toolchain and tried out a new example file :) worked like a charm</span></span><span class="gensmall"><br/><br/>Last edited by profoX on Thu Jul 12, 2007 9:32 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#134260 - phonymike - Thu Jul 12, 2007 3:04 am</h4>
    <div class="postbody"><span class="postbody">did you fix the header? the rom must contain the 'nintendo logo' at the beginning of the rom. there's a checksum that needs to be calcluated also in the header. look in the tools under header on this site. I use a program called gba rom manipulator, it does all that. you need to compile and fix the header each time, or you can embed the data in your crt0.s file, but it's easier to just run a program to do it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134263 - profoX - Thu Jul 12, 2007 3:18 am</h4>
    <div class="postbody"><span class="postbody">I tried this application: <a href="http://gbadev.org/tools.php?showinfo=76" target="_blank">http://gbadev.org/tools.php?showinfo=76</a> (GBA Rom Fixer 1.03) but it's still not working eventhough the program says it has fixed my rom. (because the problem you advised gives me an error)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134265 - profoX - Thu Jul 12, 2007 3:32 am</h4>
    <div class="postbody"><span class="postbody">According to a perl script I found, only the logo got changed by using the previous program, I used the same script to also fix the checksum and I also changed the rom name, because there were weird characters instead of a name. Now this is what I get after fixing the rom when running the check script:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
wesley@ch:/media/exthome/dev/gba$ ./ht.pl -cl hidone.gba
<br/>
rom name : Test Game
<br/>
logo: ok!
<br/>
checksum: ok!
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But EZFA still does not want to accept the rom :( Any more ideas?
<br/>
Thanks so far!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134269 - Ant6n - Thu Jul 12, 2007 4:36 am</h4>
    <div class="postbody"><span class="postbody">do you do any console print in visual boy advance (agbprint?). It'd crash a rom running on hardware afaik.
<br/>
EDIT: oh, your flash program doesnt even accept your file.
<br/>
what toolchain are you using? could you post the code/rom?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134279 - SimonB - Thu Jul 12, 2007 6:55 am</h4>
    <div class="postbody"><span class="postbody">Doesnt the EZFA client require you to name your compiled rom .gba instead of .bin etc?
<br/>
<br/>
Simon</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134341 - Lynx - Thu Jul 12, 2007 4:49 pm</h4>
    <div class="postbody"><span class="postbody">Are you talking about the <a class="postlink" href="http://www.jzdocs.com/modules.php?name=News&amp;file=article&amp;sid=35" target="_blank">EZF Advance III</a> Flash Cart?<br/>_________________<br/><a class="postlink" href="http://www.ndshb.com" target="_blank">NDS Homebrew Roms &amp; Reviews</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134347 - profoX - Thu Jul 12, 2007 5:10 pm</h4>
    <div class="postbody"><span class="postbody">Hi, guys. Thanks for your help so far.
<br/>
<br/>
SimonB: it is named .gba so that can't be the problem
<br/>
<br/>
Ant6n: phonymike has tried to help me a bit through email, but he's on vacation now, so I'll just explain to everyone here what he said (I hope he doesn't mind copy/paste of his mail)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">you need a file called crt0.s, did you delete it? your rom has
<br/>
straight arm7 code from the beginning to end. what it needs to be a true gba
<br/>
rom is the very first instruction is a jump (branch) that jumps past 189
<br/>
bytes to the rest of the code. those 189 bytes have the nintendo logo (when
<br/>
you turn the gba on, it says nintendo at the bottom, that image is stored at
<br/>
the beginning of the game.) you also need a header which has information
<br/>
such as a title, revision number, company id code etc. you need to get
<br/>
crt0.s (it's an assembly file) have it assembled (into crt0.o) and placed at
<br/>
the very beginning of your rom. right now if you fix the header, it will
<br/>
overlay your code and make it corrupt. check the docs, and find out about
<br/>
crt0.s or crt0.o. ask in the forum, maybe coding or beginners about that
<br/>
file and getting it into your project (with KDvelop.)
<br/>
<br/>
I looked at your source and see you do have the crt0.o in the main folder.
<br/>
that needs to be linked with your main.o (main.c compiles into main.o.) you
<br/>
deving on linux or smth? I can't tell where your main makefile is.</td> </tr></table><span class="postbody">
<br/>
<br/>
To answer his last question: yes, I am devving on linux. And my main makefile is located above the src/ directory.
<br/>
<br/>
The crt0.o file (that I created with arm-agb-elf-as) is on my computer somewhere. I use -T"location of the file" as a linker flag to refer to the file (actually, the crt0.o file I use is also included in my source code, one directory higher than src/)
<br/>
<br/>
This is the error I get when I try to configure with the  -T"location of crt0.o" flag:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">configure:2778: checking for C compiler default output file name
<br/>
configure:2805: arm-agb-elf-gcc -nostartfiles  -Tcrt0.o conftest.c  &gt;&amp;5
<br/>
/usr/local/bin/../lib/gcc-lib/arm-agb-elf/3.1/../../../../arm-agb-elf/bin/ld:crt0.o:1: ignoring invalid character `\177' in expression
<br/>
/usr/local/bin/../lib/gcc-lib/arm-agb-elf/3.1/../../../../arm-agb-elf/bin/ld:crt0.o:1: ignoring invalid character `\001' in expression
<br/>
/usr/local/bin/../lib/gcc-lib/arm-agb-elf/3.1/../../../../arm-agb-elf/bin/ld:crt0.o:1: ignoring invalid character `\001' in expression
<br/>
/usr/local/bin/../lib/gcc-lib/arm-agb-elf/3.1/../../../../arm-agb-elf/bin/ld:crt0.o:1: ignoring invalid character `\001' in expression
<br/>
/usr/local/bin/../lib/gcc-lib/arm-agb-elf/3.1/../../../../arm-agb-elf/bin/ld:crt0.o:1: parse error
<br/>
collect2: ld returned 1 exit status
<br/>
configure:2808: $? = 1
<br/>
configure:2846: result:
<br/>
configure: failed program was:
<br/>
| /* confdefs.h.  */
<br/>
| #define PACKAGE_NAME ""
<br/>
| #define PACKAGE_TARNAME ""
<br/>
| #define PACKAGE_VERSION ""
<br/>
| #define PACKAGE_STRING ""
<br/>
| #define PACKAGE_BUGREPORT ""
<br/>
| #define PACKAGE "hi"
<br/>
| #define VERSION "0.1"
<br/>
| /* end confdefs.h.  */
<br/>
|
<br/>
| int
<br/>
| main ()
<br/>
| {
<br/>
|
<br/>
|   ;
<br/>
|   return 0;
<br/>
| }
<br/>
configure:2853: error: C compiler cannot create executables
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I think the crt0.o file is corrupt or wasn't compiled right?
<br/>
<br/>
Anyway, here is the sourcecode for everyone to mess with:
<br/>
<a href="http://wesley.debianbox.be/files/hi.zip" target="_blank">http://wesley.debianbox.be/files/hi.zip</a>
<br/>
<br/>
All sourcecode was generated automatically by KDevelop.
<br/>
Toolchain I use: KDevelop (IDE) + everything in devkitadvance. I compile directly from KDevelop, which first configures a Makefile and then compiles the file using arm-agb-elf-gcc -- I hope that's what you meant with toolchain</span><span class="gensmall"><br/><br/>Last edited by profoX on Thu Jul 12, 2007 5:14 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#134349 - profoX - Thu Jul 12, 2007 5:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lynx wrote:</b></span></td> </tr> <tr> <td class="quote">Are you talking about the <a class="postlink" href="http://www.jzdocs.com/modules.php?name=News&amp;file=article&amp;sid=35" target="_blank">EZF Advance III</a> Flash Cart?</td> </tr></table><span class="postbody">
<br/>
Nope, just version 1 from <span style="font-weight: bold">[REMOVED]</span>.. A red cartridge..
<br/>
Like this: <span style="font-weight: bold">[Piracy related URL removed - MOD]</span>
<br/>
<br/>
<span style="font-style: italic">edit: heh, piracy related? I guess you can't trust Google Images nowadays. Anyway, you guys probably know what I mean... It's a red cartridge.. search "ezf advance" in Google Images and you'll see it.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134364 - Lynx - Thu Jul 12, 2007 8:01 pm</h4>
    <div class="postbody"><span class="postbody">Just checking because the EZF Advance III was a complete piece of crap. ;)<br/>_________________<br/><a class="postlink" href="http://www.ndshb.com" target="_blank">NDS Homebrew Roms &amp; Reviews</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134370 - keldon - Thu Jul 12, 2007 8:27 pm</h4>
    <div class="postbody"><span class="postbody">I had this problem; most homebrew games have faulty headers. This was confirmed by the moderator of the EZFlash IRC chat room. Try copying using the EZFlash client, which will fix the header for you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134372 - profoX - Thu Jul 12, 2007 8:31 pm</h4>
    <div class="postbody"><span class="postbody">Ok, you guys. I have fixed stuff myself by just discarding devkitadvance and installing/configuring devkitARM + libgba :) works fine -- it even fixes the rom header automatically! Great!!
<br/>
<br/>
Thanks for all the help, though!
<br/>
I didn't know the GBA-Dev community was so big and helpful.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
