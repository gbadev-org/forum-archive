<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>EFA2 hacking: Status, Hosting suggestions ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Flash Equipment > EFA2 hacking: Status, Hosting suggestions ?</h2>
<div id="posts">
<div class="post">
    <h4>#72610 - CyteX - Mon Feb 20, 2006 12:02 pm</h4>
    <div class="postbody"><span class="postbody">Hi *
<br/>
<br/>
I did a bit RE and identified enable/unlock and access sequences of the EFA2 cart. I'm able to read boot block, FAT and root directory of the U-DISK in NAND Flash. That means: Yes, now we can access the U-DISK of EFA2 from our homebrew stuff. Nevertheless, there is still work to do (i.e. NOR-Flash functionality, Savegame handling, fread etc.).
<br/>
<br/>
Now I'm searching a place on the Net where to host the stuff. My first thoughts are to put it on SourceForge, but it may be a good idea to join forces with other projects.
<br/>
<br/>
As it is still in development it makes no sense to post it here on gbadev as there will be updates quite regularly . Things like SourceForge (cvs) or a Wiki will be the better choice.
<br/>
<br/>
Which other places/projects do you know where the "libefa2" can be placed ?
<br/>
Are there any Flashcart related projects where I can contribute ?
<br/>
Makes it sense to put it on PIRACY-DOT-COM Wiki ?
<br/>
<br/>
bye Cy'</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73214 - Joat - Thu Feb 23, 2006 10:37 pm</h4>
    <div class="postbody"><span class="postbody">Heya, I've been collecting flash cart related info at <a href="http://www.bottledlight.com/ds/index.php/Hardware/FlashCartridges" target="_blank">http://www.bottledlight.com/ds/index.php/Hardware/FlashCartridges</a>
<br/>
<br/>
I'd be glad to put your technical info up, or give you an account on the wiki, but I don't do generic web hosting.  Dovoto and a bunch of others do tho, just drop him an email or ask in #mellowdsdev or #gbadev on EFNET IRC.
<br/>
<br/>
Regarding a CVS repository, hmm.  There is some code already in the devkitpro tree somewhere for gbamp flashing IIRC, but we're talking about creating a new module just for cart management / FAT / etc...  Will post back here when that gets decided.<br/>_________________<br/>Joat
<br/>
<a href="http://www.bottledlight.com" target="_blank">http://www.bottledlight.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73350 - CyteX - Sat Feb 25, 2006 12:08 am</h4>
    <div class="postbody"><span class="postbody">Ah, great Joat ! I gave your site a short look as I searched the forum for EFA2 related infos, but thought it was only related to Flashcarts usable with NDS only.
<br/>
<br/>
Gave it another, closer, view now and saw, that the EZFlash III and the EFA2 got the same magic unlock sequences before and after control register access:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  *(u16 *)0x9FE0000 = 0xD200;
<br/>
  *(u16 *)0x8000000 = 0x1500;
<br/>
  *(u16 *)0x8020000 = 0xD200;
<br/>
  *(u16 *)0x8040000 = 0x1500;
<br/>
  ....
<br/>
  *(u16 *)0x9FC0000 = 0x1500;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Hehe.. I just gave them names :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  // "Magic" registers used for unlock/lock sequences
<br/>
  #define REG_EFA2_MAGIC_A   *(vu16*)0x09fe0000
<br/>
  #define REG_EFA2_MAGIC_B   *(vu16*)0x08000000
<br/>
  #define REG_EFA2_MAGIC_C   *(vu16*)0x08020000
<br/>
  #define REG_EFA2_MAGIC_D   *(vu16*)0x08040000
<br/>
  #define REG_EFA2_MAGIC_E   *(vu16*)0x09fc0000
<br/>
<br/>
  // NAND flash lock/unlock register ?
<br/>
  #define REG_EFA2_NAND_LOCK *(vu16*)0x09c40000
<br/>
  // NAND flash enable register ?
<br/>
  #define REG_EFA2_NAND_EN   *(vu16*)0x09400000
<br/>
  // NAND flash command write register
<br/>
  #define REG_EFA2_NAND_CMD   *(vu8*)0x09ffffe2
<br/>
  // NAND flash address/data write register
<br/>
  #define REG_EFA2_NAND_WR    *(vu8*)0x09ffffe0
<br/>
  // NAND flash data read register
<br/>
  #define REG_EFA2_NAND_RD    *(vu8*)0x09ffc000
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So there is the possibility that EZFlash III and EFA2 are at least a bit compatible.
<br/>
<br/>
I would be very happy if it is OK to send you my code and you put it on the Wiki. Generic web hosting is not really needed, it is a good idea to put same things at the same place.
<br/>
<br/>
This weekend I wanted to start with the udisk directory and file access. Sure, it won't be finished on Monday, but at least a simple directory listing and textfile display will be done as demonstator.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73355 - CyteX - Sat Feb 25, 2006 1:07 am</h4>
    <div class="postbody"><span class="postbody">Ahh.. may be a good idea to contribute to chishm's gba_nds_fat library.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73380 - chishm - Sat Feb 25, 2006 5:19 am</h4>
    <div class="postbody"><span class="postbody">Yes, it'd be great if you could add EFA2 udisk support to the FAT library. There are just a few things you need to take care of:
<br/>
1) Use io_mpcf.h and io_mpcf.c as templates for your driver.
<br/>
2) The only supported sector size is 512 bytes. The udisk should support this if it is a standard USB thumb drive.
<br/>
3) Be sure to return true from your EFA2_Startup() function if, and only if, there is definitely an EFA2 in the DS.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
