<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>devkitARM release 13 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Announcements And Comments > devkitARM release 13</h2>
<div id="posts">
<div class="post">
    <h4>#46128 - wintermute - Mon Jun 20, 2005 4:59 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://devkitpro.sourceforge.net/" target="_blank">http://devkitpro.sourceforge.net/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46130 - DiscoStew - Mon Jun 20, 2005 5:21 pm</h4>
    <div class="postbody"><span class="postbody">Does this release also include the fix for the error in the GBA crtl?
<br/>
<br/>
Other than that, I'm glad to see progress being continued with this.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46166 - wintermute - Tue Jun 21, 2005 5:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DiscoStew wrote:</b></span></td> </tr> <tr> <td class="quote">Does this release also include the fix for the error in the GBA crtl?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It certainly does.
<br/>
<br/>
I'm planning on some method to make updates to the crtls easier for end users to install in future.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46493 - chishm - Sun Jun 26, 2005 7:25 am</h4>
    <div class="postbody"><span class="postbody">There seems to be a problem with this version of DKArm in that it doesn't initialise all memory on startup, which is fine for most programs, however it causes problems when compiling for the GBA movie player. This problem may also apply to earlier versions, however ROMs compiled using r8 are fine. 
<br/>
<br/>
The problem is as follows: I build any of my multiboot programs using DKArm r8 and they work with both an Xboo cable and a GBAMP. I then compile using r13 and the ROMs work perfectly well using an Xboo cable, but when loaded with the GBAMP there are various problems. For instance, my text library doesn't show any text, and the PCX test built with my CF driver will not load the PCX. Both of these rely on global variables, but I am not sure if this is the problem. Sorry I can't be more specific.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46514 - tepples - Sun Jun 26, 2005 3:10 pm</h4>
    <div class="postbody"><span class="postbody">I ought to write a variation on Multiboot Menu that acts as a test harness for startup code, filling IWRAM and EWRAM with pseudorandom values before loading a .mb file. Would this help?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46518 - Lord Graga - Sun Jun 26, 2005 5:47 pm</h4>
    <div class="postbody"><span class="postbody">I seem to have the same problem as Chism with my F2A cart, using a loader.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46532 - chishm - Sun Jun 26, 2005 11:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">I ought to write a variation on Multiboot Menu that acts as a test harness for startup code, filling IWRAM and EWRAM with pseudorandom values before loading a .mb file. Would this help?</td> </tr></table><span class="postbody">
<br/>
It may help for flash carts, but probably not for the GBAMP. It copies the multiboot binary directly to EWRAM then jumps to it. This means any loader that overwrites EWRAM would also overwrite the game.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46533 - wintermute - Sun Jun 26, 2005 11:49 pm</h4>
    <div class="postbody"><span class="postbody">have you tried these  to run your app ?
<br/>
<a href="http://nocash.emubase.de/gbatek.htm#biosresetfunctions" target="_blank">http://nocash.emubase.de/gbatek.htm#biosresetfunctions</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46537 - chishm - Mon Jun 27, 2005 1:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">have you tried these  to run your app ?
<br/>
<a href="http://nocash.emubase.de/gbatek.htm#biosresetfunctions" target="_blank">http://nocash.emubase.de/gbatek.htm#biosresetfunctions</a></td> </tr></table><span class="postbody">
<br/>
RegisterRamReset is fine in r8 as long as I don't reset IWRAM or EWRAM, in which case the GBA freezes no matter what (as expected). Using it in r13 doesn't make any difference, it behaves as in the above post. 
<br/>
<br/>
SoftReset (RAM_RESTART) freezes on a white screen with either revision or boot method and SoftReset (ROM_RESTART) starts from the cart (as expected).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46542 - tepples - Mon Jun 27, 2005 4:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">I ought to write a variation on Multiboot Menu that acts as a test harness for startup code, filling IWRAM and EWRAM with pseudorandom values before loading a .mb file.</td> </tr></table><span class="postbody">
<br/>
It may help for flash carts, but probably not for the GBAMP. It copies the multiboot binary directly to EWRAM then jumps to it. This means any loader that overwrites EWRAM would also overwrite the game.</span></td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://www.pineight.com/gba/#mbmenu" target="_blank">Multiboot Menu</a> <span style="font-style: italic">is</span> designed for flash carts. The next version will overwrite almost all of EWRAM (except the last 1040 bytes or so, which are reserved for use by PogoShell) with PRNG trash and <span style="font-style: italic">then</span> overwrites the beginning of the trash with the game. If the init code can't handle the trash, the .mb program dies. The thinking is that if a program is compatible with the trash version of mbmenu, then it'll be more likely compatible with GBAMP.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46546 - chishm - Mon Jun 27, 2005 5:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><a class="postlink" href="http://www.pineight.com/gba/#mbmenu" target="_blank">Multiboot Menu</a> <span style="font-style: italic">is</span> designed for flash carts. The next version will overwrite almost all of EWRAM (except the last 1040 bytes or so, which are reserved for use by PogoShell) with PRNG trash and <span style="font-style: italic">then</span> overwrites the beginning of the trash with the game. If the init code can't handle the trash, the .mb program dies. The thinking is that if a program is compatible with the trash version of mbmenu, then it'll be more likely compatible with GBAMP.</td> </tr></table><span class="postbody">
<br/>
Sorry. I misunderstood you before. Yes that would help fix problems with startup code. Unfortunately the startup code is part of the linker or CRT.0 or something. As you can tell I am not totally sure how to rewrite the startup code, as I don't know ASM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47184 - chishm - Wed Jul 06, 2005 5:59 am</h4>
    <div class="postbody"><span class="postbody">I have worked out the cause to the problem. In gba_crt0.s it has:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@---------------------------------------------------------------------------------
<br/>
@ Clear SBSS section to 0x00
<br/>
@---------------------------------------------------------------------------------
<br/>
   ldr   r0, =__sbss_start
<br/>
   ldr   r1, =__sbss_end
<br/>
   sub   r1, r0
<br/>
   bl   ClearMem</td> </tr></table><span class="postbody">
<br/>
But this is either clearing out parts of the program from SBSS that it shouldn't, or, more likely, it is not properly clearing the GBAMP garbage from IWRAM. Changing the above to bss fixes it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47187 - wintermute - Wed Jul 06, 2005 6:28 am</h4>
    <div class="postbody"><span class="postbody">hmm, that's quite weird
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   mov   r0, #3
<br/>
   lsl   r0, #24            @ r0 = 0x3000000
<br/>
   ldr   r1, =__iwram_end
<br/>
   sub   r1,r0
<br/>
   bl   ClearMem
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
should be clearing all of iwram, including bss.
<br/>
<br/>
if you replace the iwram code above with
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
@---------------------------------------------------------------------------------
<br/>
@ Clear BSS section to 0x00
<br/>
@---------------------------------------------------------------------------------
<br/>
   ldr   r0, =__bss_start
<br/>
   ldr   r1, =__bss_end
<br/>
   sub   r1, r0
<br/>
   bl   ClearMem
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
retaining the SBSS clear does it still work, or does it exhibit the problems?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47194 - chishm - Wed Jul 06, 2005 8:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">if you replace the iwram code above with
<br/>
*SNIP*
<br/>
retaining the SBSS clear does it still work, or does it exhibit the problems?</td> </tr></table><span class="postbody">
<br/>
Replacing the code fixes it. In fact, just adding the code fixes it. So obviously the IWRAM was not being properly cleared before. Works great now, except I've noticed that DevKitARM r13 adds about 3 KiB to the size of the ROM over r8. Is there any particular reason for this?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
