<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Article series on sound programming - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Announcements And Comments > Article series on sound programming</h2>
<div id="posts">
<div class="post">
    <h4>#25406 - DekuTree64 - Sun Aug 22, 2004 1:31 am</h4>
    <div class="postbody"><span class="postbody">Hi all, with the new compo underway and me being unable to enter, I can still join in on the fun by helping everyone out with a new article on sound mixing. Day 1 is complete, and can be read <a class="postlink" href="http://www.angelfire.com/wizard/deku/program/sound1.html" target="_blank">here</a> (please excuse the ads). It covers the basics of playing a sound and setting up a double buffering system. Nothing too advanced yet, but if you have a few minutes, give it a read and tell me what you think. 
<br/>
Hopefully I'll be able to keep day 2 a little shorter and more to-the-point, and get it up by tomorrow night.
<br/>
<br/>
Thanks!<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25407 - dagamer34 - Sun Aug 22, 2004 2:27 am</h4>
    <div class="postbody"><span class="postbody">Anxiously waiting for Day 2... :)<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25411 - DekuTree64 - Sun Aug 22, 2004 9:38 am</h4>
    <div class="postbody"><span class="postbody">Ha, <a class="postlink" href="http://www.angelfire.com/wizard/deku/program/sound2.html" target="_blank">day 2</a> complete a day sooner than I planned. This one goes through the basics of writing a mixer, with code for what I hope is a fully functional one. I haven't even tried to compile the code, but theoretically it would work.
<br/>
<br/>
Next time I'm planning to do a basic music player, or at least get through making a converter tool in preparation for it.
<br/>
What I need to know from you guys is, what music format would you like to see? 
<br/>
MOD is simple, but kind of limited. S3M is cool, but doesn't have envelopes. 
<br/>
XM has envelopes, but I remember having trouble finding sufficient info to write a player in the past. 
<br/>
IT is the big kahuna, but really complicated. If I do this, it will be stripped down. Particularly, no dynamic channels. Nice as they are, they complicate things pretty badly and would likely give you more bugs than the extra freedom makes up for. 
<br/>
<br/>
Let me know what you'd like to see and I'll get started when I have time.
<br/>
Keep one thing in mind though: I'm doing this for fun, so the more people reply happily from it, the more fun it will be to write, and then I'll make more^_^<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25412 - lordmetroid - Sun Aug 22, 2004 9:45 am</h4>
    <div class="postbody"><span class="postbody">I think you should go for mod as you said it's the most simple one, and so people would rather understand the concept of how to write a player and then if they decide for another format they can still write a player but would need to put some more effort in it to suit the other kinds of formats, but writing the simplest player possible makes it a less complex tutorial and so easier to get a grip of...<br/>_________________<br/>*Spam*
<br/>
Open Solutions for an open mind, <a href="http://www.areta.org" target="_blank">www.areta.org</a>
<br/>
<br/>
Areta is an organization of coders codeing mostly open source project, but there is alot of sections like GBA dev, Language learning communities, RPG communities, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25426 - dagamer34 - Sun Aug 22, 2004 7:41 pm</h4>
    <div class="postbody"><span class="postbody">I'm having a bit of trouble grasping some of the code here. Perhaps if examples were available it would be easier to learn. :)<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25430 - DekuTree64 - Sun Aug 22, 2004 8:31 pm</h4>
    <div class="postbody"><span class="postbody">Hmm, I'll see if I can get a working example going. Is there anything in particular that you'd like to see more commenting on, or another paragraph to explain? I'd like to make the tutorial as useful as possible, but I've been fiddling with these things so long I don't even know what parts are tricky anymore, so the feedback really helps.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25442 - DekuTree64 - Mon Aug 23, 2004 2:35 am</h4>
    <div class="postbody"><span class="postbody">Ok, day 2 has been updated with an [url="http://www.angelfire.com/wizard/deku/program/sound2.zip"]example[/url] demonstrating how to use the mixer from the tutorial. Amazingly enough, it compiled and worked after only fixing a couple of places where I wrote tempBuf instead of tempBuffer. I added a new define, SND_MAX_CHANNELS instead of hardcoding the 4 from the tutorial. Also, there's code for all the initialization stuff, and for showing how to actually start channels up.
<br/>
<br/>
As always, let me know what you think. In particular, anything that doesn't make sense and needs an explanation.
<br/>
<br/>
Also, has lordmetroid singlehandedly thrown the vote on music players to 100% MOD, or does anyone have a different preference?<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25447 - SmileyDude - Mon Aug 23, 2004 4:53 am</h4>
    <div class="postbody"><span class="postbody">nice articles so far, deku -- I wish I would've had them last year when I was working on my mixer :)  I can't wait until they are done, that's for sure.  
<br/>
<br/>
BTW -- I toss in my vote for MOD.  It's a nice simple format, it's fairly common, and it's not very resource intensive.  Plus, I would like to see another implementation of it, if only for my benefit -- I have some pretty horrid effect handling in my code :D<br/>_________________<br/>dennis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25448 - abilyk - Mon Aug 23, 2004 5:27 am</h4>
    <div class="postbody"><span class="postbody">Just wanted to shout a thanks out to Deku for taking the time to do these articles.  I consider myself a pretty competent coder but I've always viewed sound programming as a scary, foreign undertaking.  Though I still plan to use a third-party library for our first game, I've already learned a lot from the first article.
<br/>
<br/>
Regarding which music format to focus on, I don't know enough specifics about each to give an educated suggestion.  I'd definitely suggest to keep it simple, but if you deem something more complicated than MOD a better learning tool, then by all means go for that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25465 - isildur - Mon Aug 23, 2004 5:04 pm</h4>
    <div class="postbody"><span class="postbody">Great tutorial! 
<br/>
<br/>
One thing though, when I clicked on Day 2, the popup add that popped had a virus in it, reported by McAfee. Just wanted to let you know.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25466 - ScottLininger - Mon Aug 23, 2004 5:31 pm</h4>
    <div class="postbody"><span class="postbody">In terms of which format to use, I'd lean toward one that has a decent, stable, and free program for building new songs. I know that S3M has Modtracker, which is pretty good. I'm not familiar with any MOD tools...
<br/>
<br/>
Tutorials that take you from point A to point C without providing easy tools for point B are really frustrating.
<br/>
<br/>
Thanks for the work, dekutree!
<br/>
<br/>
-Scott</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25487 - NoMis - Mon Aug 23, 2004 11:41 pm</h4>
    <div class="postbody"><span class="postbody">Cool ^...^
<br/>
<br/>
NoMis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25488 - tepples - Mon Aug 23, 2004 11:52 pm</h4>
    <div class="postbody"><span class="postbody">Modplug Tracker, a GPL'd Windows app, can save in four formats: mod, xm, s3m, it. For a simple format to interpret, I'd suggest mod if your mixer uses signed samples or s3m if it uses unsigned samples.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25514 - DekuTree64 - Tue Aug 24, 2004 9:06 am</h4>
    <div class="postbody"><span class="postbody">Sorry all, but no new article today. The one on making a MOD converter is, as I feared, getting very long and cumbersome. I'm almost done with the loading and pattern conversion though, so after that I'll show how to pull it all together into a useful program that eliminates duplicate samples and such, and how to output all the data so the player will come out nice and friendly. 
<br/>
Must sleep for now though.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25532 - dagamer34 - Tue Aug 24, 2004 3:46 pm</h4>
    <div class="postbody"><span class="postbody">Do you plan on adding SFX channels to your player?<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25579 - DekuTree64 - Wed Aug 25, 2004 10:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>isildur wrote:</b></span></td> </tr> <tr> <td class="quote">One thing though, when I clicked on Day 2, the popup add that popped had a virus in it, reported by McAfee. </td> </tr></table><span class="postbody">
<br/>
Sheesh. I knew the popups were bad, but I didn't think Angelfire would host viruses. I'll see if I can get a payed account soon to get rid of them.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote">Do you plan on adding SFX channels to your player?</td> </tr></table><span class="postbody">
<br/>
Yup.
<br/>
<br/>
Ok, day 3 started to get so long I had to chop it in half. The <a class="postlink" href="http://www.angelfire.com/wizard/deku/program/sound3.html" target="_blank">first half</a> of the original day 3 is up, but it's pretty boring until you get to the pattern conversion stuff. I tried to chop out as much unnecessary info as possible and get it to a more readable size, but there's quite a bit of code that takes up some space.
<br/>
I kind of wish I would have just skipped over the MOD basics and gone straight to conversion, since there are plenty of good format references already, and I don't have a lot of free time to work on it (12 hours at work today, so I'm pretty fried), but that might have been a little confusing anyway.
<br/>
<br/>
Day 4 should be up tomorrow night, and will cover sound effects and outputting the data tables. With luck, I will be able to finish an example program for it as well, but it may just be the article.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26078 - DekuTree64 - Tue Sep 07, 2004 1:58 am</h4>
    <div class="postbody"><span class="postbody">Ok, I'm back at it again. Last weekend was soaked up by flying home to visit my family, and the rest of the week I was either at work or sleeping, which I will be returning to tomorrow, but for now I'm free.
<br/>
<br/>
<a class="postlink" href="http://deku.gbadev.org/program/sound4.html" target="_blank">Day 4</a> is up, and right here on ad-free GBADev.org, courtesy of Simon the Great.
<br/>
<br/>
I haven't fully proof-read it yet, and the example project won't be up until later tonight, but hopefully the article itself can be of some use. Too bad I probably won't be able to do the next one until saturday, it'll be a lot of fun to write.
<br/>
<br/>
Off to grill some hot dogs for the moment, but I'll finish up the example after that.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26081 - DekuTree64 - Tue Sep 07, 2004 8:24 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://deku.gbadev.org/program/sound4.zip" target="_blank">Example</a> complete. I sleep.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27287 - DekuTree64 - Fri Oct 08, 2004 10:36 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://deku.gbadev.org/program/sound5.html" target="_blank">Day 5</a> of the series is at last complete. Only one remaining for a complete music player, and one more after that for some crazy assembly fun.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27290 - chrisrothery - Fri Oct 08, 2004 1:43 pm</h4>
    <div class="postbody"><span class="postbody">Just wanted to say that even though I'm not ready to implement what you talk about in these tutorials, I have read them and they're excellent.   
<br/>
<br/>
Good work and thanks for demystifying something that was set to give me a load of grief when I (finally) got there (from spectrum through amiga to pc &amp; gba, nothing I have ever written has made a single sound, but after this, my first release has a chance of having a soundtrack - thanks to a friend who's musically inclined).
<br/>
<br/>
Thanks again deku.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27548 - DekuTree64 - Fri Oct 15, 2004 9:22 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://deku.gbadev.org/program/sound5.html" target="_blank">Day 5</a> has been tweaked with a bunch of little changes to make things work better, and a few real bugs fixed, after actually putting it all to use preparing an <a class="postlink" href="http://deku.gbadev.org/program/sound5.zip" target="_blank">example project</a>. Check the notes at the top for all the little details. 
<br/>
<br/>
The example ROM doesn't sound much like the original song yet, but it will soon. Day 6 looms on the horizon! (except I haven't started writing it yet)<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27618 - allenu - Sun Oct 17, 2004 8:30 am</h4>
    <div class="postbody"><span class="postbody">Hey, thanks for the great tutorials, DekuTree64.  I was able to add sound to my game engine with a minimum of effort.  I was surprised that the sound hardware was so easy to program for.  I always figured sound programming would be difficult for some reason, but your tutorials made it easy.
<br/>
<br/>
Allen</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27632 - ProblemBaby - Sun Oct 17, 2004 8:03 pm</h4>
    <div class="postbody"><span class="postbody">yes, your tutorials are really nice!
<br/>
But I think it would be nice if you could add some info about other formats also.. especially XM (because that is what iam working with=))
<br/>
<br/>
Ive problems to make it sound as good as it does in the tracker.
<br/>
and also problems with pitching because of the 256 finetune levels and it seems like they doesnt work as they do in a MOD-file ( I dont know!)
<br/>
<br/>
But except for that I really like your tutorials Ive learnt a lot of stuff!
<br/>
Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27635 - Touchstone - Sun Oct 17, 2004 8:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">I think it would be nice if you could add some info about other formats also.. especially XM (because that is what iam working with=))</td> </tr></table><span class="postbody">
<br/>
If you download FastTracker 2 you get a text file explaining the XM format. You can download it from here: <a class="postlink" href="http://www.pouet.net/prod.php?which=13350" target="_blank">http://www.pouet.net/prod.php?which=13350</a><br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27636 - DekuTree64 - Sun Oct 17, 2004 9:01 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for your comments guys^^ I'm working on day 6 (effects) right now. I had a bit of difficulty deciding how I wanted to do it, but it's going good now. Should be much more understandable than the 'easy' way of handling effects, just putting ifs all over to handle them where needed (that's what I tried when first writing a player and I never did get it working quite right).
<br/>
<br/>
That's a good idea scattering some info around for concerns with other formats. I'll see if I can squeeze some tidbits into the previous issues wherever they would make the most sense to explain.
<br/>
<br/>
I've never actually worked with XM before, but upon closer examination of the MOD frequency table, the finetune values are just linearly interpolated between the periods/frequencies. XM is probably the same, so you can just store the basic note frequencies and calculate the finetunes mathematically. Like a finetune of 96 would be 3/4 of the way between the current note and the note above it, or -128 would be completely one note below.
<br/>
<br/>
As for making it sound as good as a PC, it probably won't. Try running it in MODPlug with the frequency set to 19KHz or whatever its lowest is, 8-bit mono, and resampling off to get a better comparison, but that still sounds slightly filtered to me, to smooth out the high-frequency aliasing screechyness of chip sounds played with nearest neighbor sampling. 
<br/>
You could also try playing the song with Krawall to get an idea what kind of quality is possible on the GBA itself.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27640 - ProblemBaby - Sun Oct 17, 2004 10:22 pm</h4>
    <div class="postbody"><span class="postbody">The freeware version of krawall only supports skm=/
<br/>
but it was a nice I idea to change the mixing setup in ModPlug
<br/>
Never thought about that.
<br/>
It doesnt sound that good anymore but my player still sounds more crap.
<br/>
And some samples sounds louder then it does in my player even cause I use clipping.
<br/>
<br/>
Touchstone: Ive read it and it is nice, without it I wouldnt even had a XM loaded. But some stuff is still hard to.
<br/>
<br/>
Dekutree64: Yes I also thought it was like that, but this line confuse me:
<br/>
FineTune = -128..+127 (-128 = -1 halftone, +127 = +127/128 halftones)[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27645 - DekuTree64 - Mon Oct 18, 2004 3:59 am</h4>
    <div class="postbody"><span class="postbody">Ah, forgot about that little detail of Krawall. Well you can still get an idea what general sound quality to expect by listening to songs on other players.
<br/>
<br/>
And for the volume, if just some sounds are too quiet, the problem is probably in your effect processing more than the mixer. Clipping will only let you use higher final volume without getting serious distortion, but shouldn't have any effect on individual channels. Especially when you go adding in the volume-column effects, it gets really confusing handling them all properly.
<br/>
<br/>
As for the finetunes, that line you copied is basically what I was guessing at. That 127/128 thing just means that going one more finetune level up would be a full note above the original. What IS important though, is wether the finetune frequencies go up linearly or exponentially. Notes go exponentially by 2^(note/12), which is why you have to put them in a table. The finetunes, seem to be linear between notes though, so just multiply by finetune and divide by 128 type of thing. 
<br/>
For a hint, the standard interpolation formula is a*(1-x)+b*x, where a and b are the 'start' and 'end' values, and x is the distance between them (0-1). It'll be a little different when x (the finetune) is negative (x-1 instead of 1-x, I think) but that formula is always a good place to start.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27653 - ProblemBaby - Mon Oct 18, 2004 12:43 pm</h4>
    <div class="postbody"><span class="postbody">Okey I thought it also were expontially
<br/>
but if it is linear it is trivial
<br/>
I think this will do the job.
<br/>
But which one is correct in the postive case
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if (finetune &lt; 0)
<br/>
{
<br/>
   ftune = ((FreqTable[Note - 1] - FreqTable[Note]) * fintune) &gt;&gt; 7;
<br/>
   freq = FreqTable[Note] - ftune;
<br/>
<br/>
}
<br/>
else
<br/>
{
<br/>
   // which one is correct
<br/>
   ftune = ((FreqTable[Note + 1] - FreqTable[Note]) * fintune) &gt;&gt; 7;
<br/>
   ftune = ((FreqTable[Note + 1] - FreqTable[Note]) * (fintune+1)) &gt;&gt; 7;
<br/>
   freq = FreqTable[Note] + ftune;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And about the volumes, I think it has something to do with the volume envelopes. I dont have any effects and the volume envelope is just a straight line in the middle.
<br/>
But....
<br/>
if I push at the VOL button in the Instrument editor in ModPlugTracker
<br/>
it sounds like it does in my player, but if I draw a straight line at the top, it sounds like it does when the VOL button is unmarked.
<br/>
Ive no idea of why it is like that...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27721 - ProblemBaby - Wed Oct 20, 2004 12:56 am</h4>
    <div class="postbody"><span class="postbody">I solved it!
<br/>
Ive always thought that my sounds, sounds a bit crappy and the volume to low, Well now its solved I made a stupid mistake to always think that the problem was my mixer. I didnt read the XM spec carefully.
<br/>
The sampledata is stored as delta values=)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27820 - Gene Ostrowski - Thu Oct 21, 2004 8:08 pm</h4>
    <div class="postbody"><span class="postbody">Dekutree, thanks for the excellent articles on this topic.  I am at a point where I will be needing to add MOD and SFX support to my game (actually, removing my reliance on Krawall), and this is coming at a good time.
<br/>
<br/>
I'm having difficulty in getting the example compiled-- what environment are you using?  There seem to be some missing headers such as data.h, irq.h and misc.h, and a bunch of defines such as SOUNDA_LOUT, SOUNDA_FIFORESET, etc., not to mention the div() function and a div_t datatype definition...
<br/>
<br/>
I'm using GCC that was installed with HAMDEVKIT (not using HAM, though), and I searched through the files for these defines to no avail.  I don't see them in my devkitadv-r5 install either, so I'm wondering where they came from.
<br/>
<br/>
Once I get this to compile and run correctly, I'll be more than happy to help you get this optimized and bug-free before you convert the mixer to asm.  I'll be more than happy to donate some time to help you out with this, and we'll all benefit.
<br/>
<br/>
One optimization that should speed up the mixer significantly would be to perform a check before anything is mixed for a channel which determines if the end of the sample will be reached <span style="font-style: italic">at all </span>during the loop:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// first, check and see if it will reach the end or not
<br/>
if (chnPtr-&gt;pos+(samplesToMix*chnPtr-&gt;inc) &gt;= chnPtr-&gt;length)
<br/>
{
<br/>
   // yes, at some point it will hit the end
<br/>
   // (insert the original "for i = 0 to samplesToMix" loop here)
<br/>
   // which can also be optimized, since we can calculate the sample
<br/>
   // will actually cause the overflow... 
<br/>
<br/>
}
<br/>
else
<br/>
{
<br/>
   // nope, so just mix them all, avoiding all "if" checks, since we will
<br/>
   // never reach the end anyway
<br/>
   for(i = 0; i &lt; samplesToMix; i++)
<br/>
   {
<br/>
      // mix a sample into the intermediate buffer
<br/>
      tempBuffer[i] += chnPtr-&gt;data[ chnPtr-&gt;pos&gt;&gt;12 ] * chnPtr-&gt;vol;
<br/>
      chnPtr-&gt;pos += chnPtr-&gt;inc;
<br/>
   }   
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>------------------
<br/>
Gene Ostrowski</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33399 - ProblemBaby - Sun Jan 02, 2005 10:03 pm</h4>
    <div class="postbody"><span class="postbody">Have you stopped writing the article series?=/
<br/>
I hope you haven't cause it is really good!
<br/>
and I look forward to read the two last days.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33401 - DekuTree64 - Sun Jan 02, 2005 11:37 pm</h4>
    <div class="postbody"><span class="postbody">Nope, I haven't declared them entirely dead yet. I may split the part on effects into two though. I didn't like how it was going, due to the large amount of code needed even with my idea for a relatively clean function table-based way of handling effects. 
<br/>
I was just looking at it the other day though and it's really not that bad, just a little cluttered to handle a few tricky effects. So, I'll see if I can get back going on it and make the current one the prep-work with a few simple effects, and then do the rest next time.
<br/>
<br/>
Thanks for the encouragement, makes it much easier to write when I know someone will actually learn from it :)<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33797 - DekuTree64 - Sun Jan 09, 2005 6:21 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://deku.gbadev.org/program/sound6.html" target="_blank">Yay!</a><br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42122 - DekuTree64 - Fri May 06, 2005 10:41 am</h4>
    <div class="postbody"><span class="postbody">I finally got around to putting the last few finishing touches on these, and I'm happy to say the main series is finished with a fully functional MOD player. Actually ended up doing 2 new parts. <a class="postlink" href="http://deku.gbadev.org/program/sound7.html" target="_blank">Day 7</a>, which has a bunch of little changes to preemtively fix problems that showed up at the end, as well as adding proper SFX handling, and <a class="postlink" href="http://deku.gbadev.org/program/sound8.html" target="_blank">day 8</a>, which does all the effects.
<br/>
<br/>
Now, a question for all of you folks. What would you like to see next, assembly mixer optimizations, or a DS version? Or something different?<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42128 - isildur - Fri May 06, 2005 2:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">I finally got around to putting the last few finishing touches on these, and I'm happy to say the main series is finished with a fully functional MOD player. Actually ended up doing 2 new parts. <a class="postlink" href="http://deku.gbadev.org/program/sound7.html" target="_blank">Day 7</a>, which has a bunch of little changes to preemtively fix problems that showed up at the end, as well as adding proper SFX handling, and <a class="postlink" href="http://deku.gbadev.org/program/sound8.html" target="_blank">day 8</a>, which does all the effects.
<br/>
<br/>
Now, a question for all of you folks. What would you like to see next, assembly mixer optimizations, or a DS version? Or something different?</td> </tr></table><span class="postbody">
<br/>
<br/>
Optimizations would be nice ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42131 - tepples - Fri May 06, 2005 2:36 pm</h4>
    <div class="postbody"><span class="postbody">What about (converted) S3M support, so that I can get volume effects and other effects at the same time?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
