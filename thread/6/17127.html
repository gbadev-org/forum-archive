<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>devkitARM release 28 and associated libraries. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Announcements And Comments > devkitARM release 28 and associated libraries.</h2>
<div id="posts">
<div class="post">
    <h4>#172708 - wintermute - Fri Feb 26, 2010 12:41 am</h4>
    <div class="postbody"><span class="postbody">Freshly uploaded for your development pleasure ;)
<br/>
<br/>
For full details see the post on the main devkitPro site <a href="http://www.devkitpro.org/devkitarm/devkitarm-release-28-and-associated-libraries/" target="_blank">http://www.devkitpro.org/devkitarm/devkitarm-release-28-and-associated-libraries/</a><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172719 - ritz - Fri Feb 26, 2010 3:45 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the release! I was able to upgrade my project very easily and everything worked without code changes. However, I do have an issue that I didn't have with r27: my ARM9 binary has now grown close to 60KB more. After digging around in the .map file (and comparing it to a r27 .map), I've determined that most of the libg.a stuff I'm linking in is almost double in size. Is that just because of the newlib update or new gcc stuff? Maybe debugging left in? Anyone else see this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172731 - headspin - Sat Feb 27, 2010 12:18 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the update MW and crew. I was looking at the diff for mpu_setup.s and noticed there was a pretty serious bug fixed. A bug which has the potential to make your entire app unstable. I urge everyone to update to the latest devkitARM.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@---------------------------------------------------------------------------------
<br/>
__libnds_mpu_setup:
<br/>
@---------------------------------------------------------------------------------
<br/>
@ turn the power on for M3
<br/>
@---------------------------------------------------------------------------------
<br/>
   ldr     r1, =0x8203
<br/>
   mov   r0, #0x04000000 @ &lt;-- this line was missing
<br/>
   add   r0, r0, #0x304
<br/>
   strh    r1, [r0]</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172732 - wintermute - Sat Feb 27, 2010 3:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ritz wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks for the release! I was able to upgrade my project very easily and everything worked without code changes. However, I do have an issue that I didn't have with r27: my ARM9 binary has now grown close to 60KB more. After digging around in the .map file (and comparing it to a r27 .map), I've determined that most of the libg.a stuff I'm linking in is almost double in size. Is that just because of the newlib update or new gcc stuff? Maybe debugging left in? Anyone else see this?</td> </tr></table><span class="postbody">
<br/>
<br/>
The gcc optimiser has been getting steadily more aggressive with the 4.4 series which does seem to result in larger code. I'm planning to look at building more of the libraries with dead code elimination options in the near future.
<br/>
<br/>
Headkaze, actually the mpu setup is called from the crt0 directly after interrupts are disabled when r0 holds the correct value. That line was simply added for clarity and to avoid problems if the call needs moved.
<br/>
<br/>
The actual issue that was fixed relates to when the temp stacks are set up in order to allow the bios call which detects debug memory.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172733 - headspin - Sat Feb 27, 2010 5:04 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for clarifying. I do like that the bitmap sprite issue is fixed too.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172736 - zelbo - Sat Feb 27, 2010 8:49 pm</h4>
    <div class="postbody"><span class="postbody">i'm really excited about this in particular: "set background colors in consoleInit functions"
<br/>
<br/>
if that does what i hope it does, my text wont have to have a transparent backround.
<br/>
<br/>
except i can't figure it out. when i look at console.h (last modified 11/3/2009 10 am) i see this line:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">PrintConsole* consoleInit(PrintConsole* console, int layer, BgType type, BgSize size, int mapBase, int tileBase, bool mainDisplay, bool loadGraphics);
<br/>
</td> </tr></table><span class="postbody">
<br/>
i can't see anything there about background color.
<br/>
<br/>
Am i missing something? did i update wrong? i wouldn't put it past me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172737 - wintermute - Sat Feb 27, 2010 9:13 pm</h4>
    <div class="postbody"><span class="postbody">Prior to this release the console init functions didn't set the backdrop colors in the palette, just the foreground colors. This meant that the background color was whatever was set last which led to some amusing color setup after exiting to menu with the new code.
<br/>
<br/>
What you hope it did isn't really possible without an awful lot of fiddling about, sorry to get you excited.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172763 - ritz - Mon Mar 01, 2010 8:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">The gcc optimiser has been getting steadily more aggressive with the 4.4 series which does seem to result in larger code.</td> </tr></table><span class="postbody">
<br/>
Thanks for the info. I noticed that the latest newlib version has had some major locale related work added to it. This looks to have contributed to the size too.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172772 - Cearn - Tue Mar 02, 2010 3:22 pm</h4>
    <div class="postbody"><span class="postbody">I've made a little project with just a single main() and a printf() call and compared the mapfiles for DKA r26, r27 and r28 (see <a class="postlink" href="http://www.coranac.com/files/misc/printf-r26-r28.zip" target="_blank">here</a> for an excel file with the results). It seems to be related to two things:<ul><li>the locale stuff ritz mentioned (all sorts of extra mb, wchar, utf and more conversion routines).</li><li>A number of functions have increased in size by 50 to 100%, including a number of mem* routines, and very deep routines that start with two underscores. Maybe the loop-unroller and inliner have been a little overzealous?</li></ul>Also, grit 0.8.5? Did I miss a version?
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">@zelbo
<br/>
The transparency in the console is caused by having zero-pixels (pixels with value 0) in the tiles. If you want them to be opaque use a font that doesn't have them, or do a post-processing step that will un-clear those pixels. Since the console fills the text pixels with 0xF, you can just OR the whole region with, say, 0xEEEEEEEE so that the letter pixels have value 15 and the background pixels have 14. It's a bit hackish, but it <a class="postlink" href="http://www.coranac.com/tonc/text/text.htm#img-txt-se1" target="_blank">works</a>.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173187 - wintermute - Thu Mar 25, 2010 10:01 pm</h4>
    <div class="postbody"><span class="postbody">It seems that newlib ended up being compiled without optimisation which accounts for at least some of the extra size. Fixed in release 30
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=17176" target="_blank">http://forum.gbadev.org/viewtopic.php?t=17176</a>
<br/>
<br/>
I rolled a 0.8.4 release of grit with an extra error message + 0.8.5 had the build process updated to produce OSX 10.4 compatible binaries. Release 30 has your latest changes rolled in as 0.8.6 minus the static const int for sizes, that isn't a constant expression so it causes issues setting up tables at file scope.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173416 - ritz - Mon Apr 05, 2010 10:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ritz wrote:</b></span></td> </tr> <tr> <td class="quote">my ARM9 binary has now grown close to 60KB more</td> </tr></table><span class="postbody">
<br/>
r30 fixed this for me, thanks
<br/>
(just got back from vacation)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
