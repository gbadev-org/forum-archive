<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>R4 and M3 Simply DAT file en/decrypter - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS Flash Equipment > R4 and M3 Simply DAT file en/decrypter</h2>
<div id="posts">
<div class="post">
    <h4>#128718 - chishm - Mon May 14, 2007 2:27 pm</h4>
    <div class="postbody"><span class="postbody">Here's the fruits of my efforts for this weekend: <a class="postlink" href="http://chishm.drunkencoders.com/NDS_Projects/r4crypt.zip" target="_blank">r4crypt</a>.
<br/>
<br/>
You can use it to encrypt and decrypt the DAT files used by the R4 DS and M3 Simply. This includes _DS_MENU.DAT and CHEAT.DAT. You can completely replace the menu if you want to, or examine what's really in those DAT files.
<br/>
<br/>
The R4's decrypter is built into the hardware. All I had to go on were the output of the decrypter when presented with various inputs. Therefore my decryption code is not optimal, but it works.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128726 - Diddl - Mon May 14, 2007 4:01 pm</h4>
    <div class="postbody"><span class="postbody">Wonderful, thanks to you Chishm.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128736 - Dood77 - Mon May 14, 2007 6:07 pm</h4>
    <div class="postbody"><span class="postbody">So... this decrypts the DAT files that contain the menu graphics? Or do they contain code for the actual functionality of the firmware? (Or both?)
<br/>
I've been thinking of getting an R4...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128743 - tepples - Mon May 14, 2007 6:57 pm</h4>
    <div class="postbody"><span class="postbody">Would this help for extracting the R4's SD card init code and putting it into a DLDI so that fatInitDefault() can work even after a hot-swap? Or would that require dumping the R4 card's BIOS itself?<br/>_________________<br/>Driven from Tilwick by ice storms, couldn't fit in in Flower Bud...
<br/>
<br/>
Nintendo DS: With two ARMs, who needs legs?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128746 - Lick - Mon May 14, 2007 7:03 pm</h4>
    <div class="postbody"><span class="postbody">I think it would require modifying the R4 BIOS. Not sure if that's possible.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128754 - chuckstudios - Mon May 14, 2007 9:32 pm</h4>
    <div class="postbody"><span class="postbody">You are my new personal hero.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128782 - chishm - Tue May 15, 2007 6:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Would this help for extracting the R4's SD card init code and putting it into a DLDI so that fatInitDefault() can work even after a hot-swap? Or would that require dumping the R4 card's BIOS itself?</td> </tr></table><span class="postbody">
<br/>
Yes it could help, but only if the menu did anything extra. However, after looking at the R4's firmware, it appears that the hardware itself takes care of initialising the TF card. The biggest obstacle to being able to init on re-insertion is the DS card encryption.
<br/>
<br/>
The _DS_MENU.DAT file contains the entire menu and default graphics. The code that is booted by the DS is only about 40KiB big. All it does is load the menu file. The R4 hardware takes care of initialising the SD card, reading the FAT file system, finding the menu file and decrypting each block of the menu as the boot code requests it.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128785 - Diddl - Tue May 15, 2007 7:46 am</h4>
    <div class="postbody"><span class="postbody">this means R4 has it's own intelligence? a small controller or such?
<br/>
<br/>
it was rather clearly, cause it can create sav file in real time (while saving within game).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128801 - yasu - Tue May 15, 2007 11:06 am</h4>
    <div class="postbody"><span class="postbody">first, sorry about that I'm not good at English.
<br/>
<br/>
I have more simple code to crypt. is it in need?
<br/>
(it can crypt using by just 2 bytes seed :)
<br/>
<br/>
I resolved the crypt last month but I fear that
<br/>
M3S go begging if I release it in public...
<br/>
(M3S firmware will be able to be used in R4)
<br/>
What do you think about that?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128803 - tepples - Tue May 15, 2007 12:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">However, after looking at the R4's firmware, it appears that the hardware itself takes care of initialising the TF card. The biggest obstacle to being able to init on re-insertion is the DS card encryption.</td> </tr></table><span class="postbody">
<br/>
Then what's the obstacle to including just enough of a dumper that the TF begins to respond?<br/>_________________<br/>Driven from Tilwick by ice storms, couldn't fit in in Flower Bud...
<br/>
<br/>
Nintendo DS: With two ARMs, who needs legs?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128811 - chishm - Tue May 15, 2007 2:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yasu wrote:</b></span></td> </tr> <tr> <td class="quote">first, sorry about that I'm not good at English.
<br/>
<br/>
I have more simple code to crypt. is it in need?
<br/>
(it can crypt using by just 2 bytes seed :)
<br/>
<br/>
I resolved the crypt last month but I fear that
<br/>
M3S go begging if I release it in public...
<br/>
(M3S firmware will be able to be used in R4)
<br/>
What do you think about that?</td> </tr></table><span class="postbody">
<br/>
That's impressive that you got it down to just two bytes for the seed. I'm very curious to see the algorithm you used.
<br/>
<br/>
Since I've already released my code, I don't think your code can do any more harm. Also, I examined the latest firmware for both the R4 and M3 Simply. They are identical except for the hardware check, brand name, and menu graphics. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Then what's the obstacle to including just enough of a dumper that the TF begins to respond?</td> </tr></table><span class="postbody">
<br/>
The entire dumper is needed to bring the DS card to its "normal" state. To be honest, I'm a little tired of holding back the DS card code to prevent its evil uses. I'll try it out when I have the time and if I can bring the R4 to a usable state upon reinsertion then I'll seriously consider releasing the DS card code.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128814 - Lick - Tue May 15, 2007 3:12 pm</h4>
    <div class="postbody"><span class="postbody">No no! You must hold strong! You're our only hope!<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128822 - Lynx - Tue May 15, 2007 5:08 pm</h4>
    <div class="postbody"><span class="postbody">Evil uses?  All the pirate hardware companies already have it.. what more could come of it now?<br/>_________________<br/><a class="postlink" href="http://www.ndshb.com" target="_blank">NDS Homebrew Roms &amp; Reviews</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128827 - modulo - Tue May 15, 2007 7:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">The entire dumper is needed to bring the DS card to its "normal" state. To be honest, I'm a little tired of holding back the DS card code to prevent its evil uses. I'll try it out when I have the time and if I can bring the R4 to a usable state upon reinsertion then I'll seriously consider releasing the DS card code.</td> </tr></table><span class="postbody">
<br/>
<br/>
You don't actually have to read the "Secure Blocks" to reinit the R4.  If you skip that and just enter the main data mode, the sector read/write commands still work.  I haven't tested without doing the 2nd and 3rd "Get ROM Chip ID" commands, but the point is that if you don't want to release a full dumper you can strip it down to the bare minimum...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128828 - yasu - Tue May 15, 2007 7:17 pm</h4>
    <div class="postbody"><span class="postbody">ok, here is the crypting program with codes.
<br/>
<a href="http://home.usay.jp/pc/etc/nds/r4denc.zip" target="_blank">http://home.usay.jp/pc/etc/nds/r4denc.zip</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128834 - modulo - Tue May 15, 2007 7:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yasu wrote:</b></span></td> </tr> <tr> <td class="quote">I resolved the crypt last month but I fear that
<br/>
M3S go begging if I release it in public...
<br/>
(M3S firmware will be able to be used in R4)
<br/>
What do you think about that?</td> </tr></table><span class="postbody">
<br/>
<br/>
I was wondering if someone released this when I noticed that the 1.08 kernel checked the language/hardware bits in 14 places while the 1.07 kernel only checked in 2.  Perhaps this explains their paranoia...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128881 - D-Trogh - Wed May 16, 2007 1:28 pm</h4>
    <div class="postbody"><span class="postbody">Whooh.. Nice.. I wanted to edit this myself.. but I saw it was decrypted and because I don't know how to encrypt something.. Well.. I like this!
<br/>
I saw that someone (over at the R4DS Forum) ripped the icons.. well.. How can I do that ? What editor do I need to use.. TileMolester is no good :(
<br/>
<br/>
Edit:
<br/>
<br/>
Ooops.. TileMolester is good.. I just didn't check out the 2-Dimensional option :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128892 - MaHe - Wed May 16, 2007 2:56 pm</h4>
    <div class="postbody"><span class="postbody">This tool is _AMAZING_. I encrypted the FlashME binary to _DS_MENU.DAT and it worked perfectly (booted with FlashME v8's recovery mode). Also, DSOrganize can now be used as a bootloader and since de-encrypted _DS_MENU.DAT is just a .NDS binary, you can still keep it on the card.
<br/>
<br/>
Hats off to you chishm, you never fail to amaze us.<br/>_________________<br/><span style="font-size: 9px; line-height: normal">[ Crimson and Black Nintendo DS Lite | CycloDS Evolution | EZ-Flash 3-in-1 | 1 GB Transcend microSD ]</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128895 - D-Trogh - Wed May 16, 2007 3:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MaHe wrote:</b></span></td> </tr> <tr> <td class="quote">This tool is _AMAZING_. I encrypted the FlashME binary to _DS_MENU.DAT and it worked perfectly (booted with FlashME v8's recovery mode). Also, DSOrganize can now be used as a bootloader and since de-encrypted _DS_MENU.DAT is just a .NDS binary, you can still keep it on the card.
<br/>
<br/>
Hats off to you chishm, you never fail to amaze us.</td> </tr></table><span class="postbody">Just C&amp;P huh :P
<br/>
<br/>
Well.. I created a .BAT file for people that don't know how to work in CMD
<br/>
Just save under 'All Files' in NotePad as 'Yourname.BAT'
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@echo off
<br/>
cls
<br/>
:menu
<br/>
echo -------------
<br/>
echo  Action Menu
<br/>
echo -------------
<br/>
echo [1] Decrypt
<br/>
echo [2] Encrypt
<br/>
echo [3] Close
<br/>
echo -------------
<br/>
echo.
<br/>
set INPUT=
<br/>
Set /P INPUT= Action:
<br/>
<br/>
<br/>
if "%input%" =="" goto menu
<br/>
if "%input%" =="1" goto decrypt
<br/>
if "%input%" =="2" goto encrypt
<br/>
if "%input%" =="3" goto close
<br/>
<br/>
:decrypt
<br/>
r4crypt.exe -d _DS_MENU.DAT OUTPUT.DAT
<br/>
goto close
<br/>
<br/>
:encrypt
<br/>
r4crypt.exe -e OUTPUT.DAT _DS_MENU.DAT
<br/>
goto close
<br/>
<br/>
:close
<br/>
cls</td> </tr></table><span class="postbody">
<br/>
<br/>
Not that anyone needs this on these Forums.. but, maybe some other people do..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128899 - czw - Wed May 16, 2007 4:06 pm</h4>
    <div class="postbody"><span class="postbody">yasu is the first one decrypt/encrypt R4 kernel.
<br/>
(or Rudolph ??,I forget.)
<br/>
I have been posted in gbatemp one month ago.
<br/>
here is his website :)
<br/>
<a href="http://home.usay.jp/pc/etc/nds/" target="_blank">http://home.usay.jp/pc/etc/nds/</a>
<br/>
R4 Cheat Code Editor is another good tool.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128910 - Dood77 - Wed May 16, 2007 6:32 pm</h4>
    <div class="postbody"><span class="postbody">So you can replace the menu boot with ANY .nds?? Awesome! 
<br/>
I wonder what happens with libcartreset after this... (does it support R4?)
<br/>
I'm thinking an R4 is definitely in my future purchase list.
<br/>
Once again chishm, you've made a priceless contribution to DS homebrew :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128976 - OOPMan - Thu May 17, 2007 9:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MaHe wrote:</b></span></td> </tr> <tr> <td class="quote">This tool is _AMAZING_. I encrypted the FlashME binary to _DS_MENU.DAT and it worked perfectly (booted with FlashME v8's recovery mode). Also, DSOrganize can now be used as a bootloader and since de-encrypted _DS_MENU.DAT is just a .NDS binary, you can still keep it on the card.
<br/>
<br/>
Hats off to you chishm, you never fail to amaze us.</td> </tr></table><span class="postbody">
<br/>
<br/>
Very very very cool :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128977 - MaHe - Thu May 17, 2007 9:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>D-Trogh wrote:</b></span></td> </tr> <tr> <td class="quote">Just C&amp;P huh :P</td> </tr></table><span class="postbody">
<br/>
Yeah, first I wrote a different post there, but it got deleted ... =(<br/>_________________<br/><span style="font-size: 9px; line-height: normal">[ Crimson and Black Nintendo DS Lite | CycloDS Evolution | EZ-Flash 3-in-1 | 1 GB Transcend microSD ]</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128993 - chishm - Thu May 17, 2007 12:19 pm</h4>
    <div class="postbody"><span class="postbody">I think yasu's tool is even better than mine. I use a na?ve, almost brute-force approach with the encryption. I stopped refining the method once it worked. yasu's code should be quicker, using a better 2-byte state-based approach rather than my multiple tables of seed data. So my code is rudimentary, yasu's is refined. Use his, it's better.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129029 - macha88 - Fri May 18, 2007 2:03 am</h4>
    <div class="postbody"><span class="postbody">it seems yasu has made use of his tool and made translate packs to translate the firmware to japanese. Yasu, do you think you could make one for translate to english?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129124 - felix123 - Sat May 19, 2007 4:35 am</h4>
    <div class="postbody"><span class="postbody">I think we need more communication between DS hackers from the East and the West. Where do Japanese DS hackers hang out generally?<br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129132 - chuckstudios - Sat May 19, 2007 1:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>felix123 wrote:</b></span></td> </tr> <tr> <td class="quote">I think we need more communication between DS hackers from the East and the West. Where do Japanese DS hackers hang out generally?</td> </tr></table><span class="postbody">
<br/>
<br/>
Japan. XD</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129133 - yasu - Sat May 19, 2007 2:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>felix123 wrote:</b></span></td> </tr> <tr> <td class="quote">I think we need more communication between DS hackers from the East and the West. Where do Japanese DS hackers hang out generally?</td> </tr></table><span class="postbody">
<br/>
<br/>
yes, in japan... XD
<br/>
<br/>
I think there are few DS programmers in Japan.
<br/>
there is a DS programming topic in '2 channel'
<br/>
but comments are scarce...
<br/>
so I often visit DS programmers' web sites and their blogs.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129198 - souLLy - Sun May 20, 2007 4:35 pm</h4>
    <div class="postbody"><span class="postbody">I Decrypted the latest M3 simply menu and renamed it test.nds and tried to boot it but it froze on the front menu and the text was corrupted- anyone had this problem? I'm considering booting directly to either moonshell or ds organize but i want to make sure I can easily boot to the official simply menu if I want to.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154066 - rexii - Thu Apr 10, 2008 11:34 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MaHe wrote:</b></span></td> </tr> <tr> <td class="quote">This tool is _AMAZING_. I encrypted the FlashME binary to _DS_MENU.DAT and it worked perfectly (booted with FlashME v8's recovery mode). Also, DSOrganize can now be used as a bootloader and since de-encrypted _DS_MENU.DAT is just a .NDS binary, you can still keep it on the card.
<br/>
<br/>
Hats off to you chishm, you never fail to amaze us.</td> </tr></table><span class="postbody">
<br/>
<br/>
Sorry to dig up dirt, I still cant figure out how use this decrypted _DS_MENU.DAT as a bootloader in dsorganize, can someone help?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154077 - JLsoft - Thu Apr 10, 2008 4:21 pm</h4>
    <div class="postbody"><span class="postbody">I think they meant taking DSOrganize.nds, encrypting it using this tool, and replacing the normal R4/M3S kernel's _DS_MENU.DAT with it so that the card boots up directly into DSOrganize.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
