<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>EFA Linker and Firmwaredumper - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS Flash Equipment > EFA Linker and Firmwaredumper</h2>
<div id="posts">
<div class="post">
    <h4>#59010 - tuLL - Fri Oct 28, 2005 12:14 am</h4>
    <div class="postbody"><span class="postbody">Hello there
<br/>
<br/>
I have an EFA-Linker 512 Mb and have been trying to dump my firmware before doing flashme.
<br/>
<br/>
But I have a problem. EFA has a bug. When I write "ds.gba" roms in the Flashcart the loader doesn't allow me to change the save size, and so I only have 256Kb available which is 32 KB.
<br/>
<br/>
Natrium's firmwaredumper,
<br/>
<br/>
<a href="http://www.natrium42.com/blog/?p=20" target="_blank">http://www.natrium42.com/blog/?p=20</a>
<br/>
<br/>
dumps the firmware in chunks of 64 KB and so there's no way I can dump it.
<br/>
<br/>
I see 2 alternatives here, either change the dumper to make 8 dumps of 32 KB or write a dumper for the GBAMP.
<br/>
<br/>
I can't do either of those:| Will someone please help me?
<br/>
<br/>
Thank you very much in advance</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59023 - natrium42 - Fri Oct 28, 2005 3:00 am</h4>
    <div class="postbody"><span class="postbody">Just put this somewhere before main() in arm7 template of the combined example.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
<br/>
#define SERIAL_CR      (*(vuint16*)0x040001C0)
<br/>
#define SERIAL_CR32    (*(vuint32*)0x040001C0)
<br/>
#define SERIAL_DATA    (*(vuint16*)0x040001C2)
<br/>
#define SERIAL_DATA8   (*(vuint8*)0x040001C2)
<br/>
<br/>
#define SERIAL_ENABLE   0x8000
<br/>
#define SERIAL_BUSY     0x80
<br/>
<br/>
#define SPI_DEVICE_POWER  (0 &lt;&lt; 8)
<br/>
#define SPI_DEVICE_TOUCH  (2 &lt;&lt; 8)
<br/>
#define SPI_BAUDRATE_2Mhz 1
<br/>
#define SPI_BAUDRATE_1Mhz 2
<br/>
//#define SPI_CONTINUOUS    (1&lt;&lt;11)
<br/>
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
<br/>
#define SERIAL_SELECT         (1 &lt;&lt; 11)
<br/>
#define SERIAL_DEVICE_POWER      (0 &lt;&lt; 8)
<br/>
#define SERIAL_DEVICE_FIRMWARE   (1 &lt;&lt; 8)
<br/>
#define SERIAL_DEVICE_TOUCH      (2 &lt;&lt; 8)
<br/>
<br/>
#define KEY_X               (1 &lt;&lt; 10)
<br/>
#define KEY_Y               (1 &lt;&lt; 11)
<br/>
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
<br/>
void dump(u32 startaddr, u32 length) {
<br/>
   u8* a=(u8*)0xa000000;
<br/>
   int i;
<br/>
<br/>
   REG_IME = 0; // disable interrupts (critical section)
<br/>
<br/>
   while (SERIAL_CR &amp; SERIAL_BUSY);
<br/>
<br/>
   SERIAL_CR = 0x8900;
<br/>
   SERIAL_DATA = 3;
<br/>
   while (SERIAL_CR &amp; SERIAL_BUSY);
<br/>
   SERIAL_DATA =  (startaddr&amp;0xff0000)&gt;&gt;16;
<br/>
   while (SERIAL_CR &amp; SERIAL_BUSY);
<br/>
   SERIAL_DATA =  (startaddr&amp;0xff00)&gt;&gt;8;
<br/>
   while (SERIAL_CR &amp; SERIAL_BUSY);
<br/>
   SERIAL_DATA =  (startaddr&amp;0xff);
<br/>
   while (SERIAL_CR &amp; SERIAL_BUSY);
<br/>
<br/>
   for(i=0;i&lt;0x10000;i++) {
<br/>
      SERIAL_DATA = 0;
<br/>
      while (SERIAL_CR &amp; SERIAL_BUSY);
<br/>
      a[i]=SERIAL_DATA;
<br/>
   }
<br/>
<br/>
   REG_IME = 1; // enable interrupts
<br/>
}
<br/>
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You need to dump 0x40000 bytes. You could either modify this to write to a GBAMP or to dump to SRAM in chunks of 0x8000 bytes.
<br/>
<br/>
For example, you also could put the line "dump(0x00000, 0x8000);" into main() before the while loop. Compile and dump that single chunk. Then change to "dump(0x08000, 0x8000);" recompile and dump, etc... for all chunks. It's a bit tedious :P
<br/>
<br/>
It's better to write some GBAMP code.<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59026 - tepples - Fri Oct 28, 2005 3:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>natrium42 wrote:</b></span></td> </tr> <tr> <td class="quote">It's better to write some GBAMP code.</td> </tr></table><span class="postbody">
<br/>
...which would be almost as simple as fopen(), fwrite(), fclose(), right?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59028 - natrium42 - Fri Oct 28, 2005 4:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>natrium42 wrote:</b></span></td> </tr> <tr> <td class="quote">It's better to write some GBAMP code.</td> </tr></table><span class="postbody">
<br/>
...which would be almost as simple as fopen(), fwrite(), fclose(), right?</span></td> </tr></table><span class="postbody">
<br/>
Yep, since Chishm has done all the work :)<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59069 - tuLL - Fri Oct 28, 2005 5:47 pm</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
<br/>
Ok guys, I'll try it. I doubt I'll be able to program to the GBAMP as this will be my first venture at C++ and the DS. I've programmed on some other languages, mainly cientifically inclined, so I'll give it a try. And with a little help from friends maybe I can get it done this weekend.
<br/>
<br/>
I really don't like to have passme hanging on the back and am afraid of doing flashme without a backed up firmware.
<br/>
<br/>
Thanks a million!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59974 - tuLL - Sun Nov 06, 2005 1:42 am</h4>
    <div class="postbody"><span class="postbody">Well, the EFA guys beat me to it. They've updated their loader and now it supports up to 2048 sized saves.
<br/>
<br/>
Thanks again!
<br/>
<br/>
PS: Well, the new loader writes 256 whatever value I put there. Back to the drawing board:D</span><span class="gensmall"><br/><br/>Last edited by tuLL on Sun Nov 06, 2005 2:12 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#60013 - josath - Sun Nov 06, 2005 8:44 am</h4>
    <div class="postbody"><span class="postbody">you could write a simple app, that just dumps one chunk of firmware at a time, and then waits for you to press a key. this way, you get a chunk, take the gba cart out &amp; copy off the sram, put it back in, and get the next chunk. no need for recompiling, reflashing cart, restarting the ds.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60032 - tuLL - Sun Nov 06, 2005 2:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">you could write a simple app, that just dumps one chunk of firmware at a time, and then waits for you to press a key. this way, you get a chunk, take the gba cart out &amp; copy off the sram, put it back in, and get the next chunk. no need for recompiling, reflashing cart, restarting the ds.</td> </tr></table><span class="postbody">
<br/>
<br/>
Heya
<br/>
<br/>
The problem is not the work it gives me, as I'll do it only once. The problem is making it:D
<br/>
<br/>
I'll keep trying, trial and error.
<br/>
<br/>
Thank you all for your support.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
