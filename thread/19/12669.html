<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>gba emulation for r4ds - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS Flash Equipment > gba emulation for r4ds</h2>
<div id="posts">
<div class="post">
    <h4>#121248 - Danno22 - Sat Mar 10, 2007 8:03 pm</h4>
    <div class="postbody"><span class="postbody">as r4ds runs off slot1 i understand that it cant run .gba files. 
<br/>
<br/>
But is there a solution (i.e. an emulator) to run .gba roms through r4ds?
<br/>
<br/>
Danno</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121258 - tepples - Sat Mar 10, 2007 8:55 pm</h4>
    <div class="postbody"><span class="postbody">Which GBA homebrew games do you want to run? If they're my works (see <a class="postlink" href="http://www.pineight.com/gba/" target="_blank">list</a>), I could look into porting them to DS. If they're someone else's, ask the author to port them. If they're <a class="postlink" href="http://www.gnu.org/philosophy/free-sw.html" target="_blank">free software</a>, and you know how to code, try your hand at porting them yourself.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121599 - Oliv5400 - Tue Mar 13, 2007 10:43 am</h4>
    <div class="postbody"><span class="postbody">Hi !,
<br/>
<br/>
I have 2 big noobs question about that :
<br/>
<br/>
1-Why when the DS boot in GBA Mode (Slot2) we CAN launch ds stuff with a loader (ds.gba) and when the DS boot in NDS Mode (Slot1) we CAN'T launch GBA stuff ? ( no gba.ds.. )
<br/>
<br/>
2-Why the linker must have RAM to run GBA stuff ? the DS stuff don't need it, maybe all the GBA card have RAM onboard ? in this case why don't use it with our old GBA game for extra memory ?
<br/>
<br/>
Thanks !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121601 - Diddl - Tue Mar 13, 2007 11:14 am</h4>
    <div class="postbody"><span class="postbody">it depends on the structure of a program.
<br/>
<br/>
gba programs can be executed directly from rom, cause cartridge memory is directly addressable.
<br/>
<br/>
NDS cartridge is not directly addressable. you only can read the program into internal ram and execute (like a PC does). big programs have to be loaded partially and executed partially. so program for NDS have to be designed for this way of execution.
<br/>
<br/>
Ez Flash V goes it own way with a combination of slot 1 and slot2 cartridge. all gba games and nds games lies on a TF card in slot 1. if you want to execute a gba game, it loads into slot 2 cartridge and executes it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121603 - Oliv5400 - Tue Mar 13, 2007 12:44 pm</h4>
    <div class="postbody"><span class="postbody">Ok, i understand.
<br/>
<br/>
So make a virtual memory management ( with forwarding acces ) between slot2 to internal RAM + Slot1 ( like NDS works ) can solve this.
<br/>
Using a main NDS exec to cache reading the GBA ARM7 opcode and redirect it on the fly with the new I/O acces could do the trick.
<br/>
<br/>
Someone test it ? or this solution is too slow ?
<br/>
<br/>
I find this very interesting.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121607 - Diddl - Tue Mar 13, 2007 2:23 pm</h4>
    <div class="postbody"><span class="postbody">for virtual memory management you need other CPU. ARM doesn't support exceptions and such thing nessecary for VMM.
<br/>
<br/>
the only simple way is to have enough RAM to load all cartridge data in it. any slot2 ram extension will do it (browser ext. , supercard, m3, ez trimode ...). 
<br/>
<br/>
the best way is a configurable memory extension like any slot 2 solution can do (ez flash4). only ram could be overwritten.
<br/>
<br/>
### 
<br/>
<br/>
another problem would be save game management. only to execute a gba application isn't enough. but why do anything for gba stuff? there are enough slot 2 solutions which works perfect!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121610 - simonjhall - Tue Mar 13, 2007 2:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Oliv5400 wrote:</b></span></td> </tr> <tr> <td class="quote">Someone test it ? or this solution is too slow ?</td> </tr></table><span class="postbody">Yeah, I had a go with this. I set up an exception handler to catch accesses to the non-existent gba ROM space and then read the actual data from disk and patched in the result back into the running program. It ran completely transparently, but was pretty slow. I think I managed about ~100k a second...
<br/>
<br/>
I think Mighty Max had a better solution for this using the memory mirror system and cached data. Can't remember the details...
<br/>
<br/>
Either solution would allow you to emulate the gba rom space.
<br/>
<br/>
For proper memory-mapping support an MMU is required - neither DS CPU has one.<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121630 - tepples - Tue Mar 13, 2007 4:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">but why do anything for gba stuff? there are enough slot 2 solutions which works perfect!!</td> </tr></table><span class="postbody">
<br/>
What happens when almost all homebrew effort has moved to the DS and demand for GBA flash equipment has dropped so low that mass production of SLOT-2 cards is no longer viable? I got into GBA homebrew in December [Error], six months after the GBA came out in North America, and this had already happened to GBC flash equipment.
<br/>
<br/>
<span style="font-weight: bold">CORRECTION:</span> dec 2001.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Tue Mar 13, 2007 5:45 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#121634 - kusma - Tue Mar 13, 2007 5:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">I got into GBA homebrew in December [Error], six months after the GBA came out in North America, and this had already happened to GBC flash equipment.</td> </tr></table><span class="postbody">
<br/>
Uh?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121638 - Lazy1 - Tue Mar 13, 2007 5:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">but why do anything for gba stuff? there are enough slot 2 solutions which works perfect!!</td> </tr></table><span class="postbody">
<br/>
What happens when almost all homebrew effort has moved to the DS and demand for GBA flash equipment has dropped so low that mass production of SLOT-2 cards is no longer viable? I got into GBA homebrew in December [Error], six months after the GBA came out in North America, and this had already happened to GBC flash equipment.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I think that as more applications start to use external ram on gba carts they will always be readily available.
<br/>
However, as far as I know only 3 applications so far make use of it (DSLinux, Moonshell and Mini vMac DS).
<br/>
<br/>
As for GBA applications running from slot-1, wasn't someone working on getting those to run in DS mode?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121639 - tepples - Tue Mar 13, 2007 5:44 pm</h4>
    <div class="postbody"><span class="postbody">Sorry. I meant December 2001.
<br/>
<br/>
GBA release - June 2001
<br/>
I discover GBA homebrew - December 2001
<br/>
I discover no GBC carts are available - December 2001<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121650 - Oliv5400 - Tue Mar 13, 2007 6:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">why do anything for gba stuff? there are enough slot 2 solutions which works perfect!!</td> </tr></table><span class="postbody">
<br/>
Why not ? we are on GBADev afterall ;o)..  this can be very usefull and don't forget : GBA never die !
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It ran completely transparently, but was pretty slow</td> </tr></table><span class="postbody">
<br/>
Did you try it in full asm ?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I think Mighty Max had a better solution for this using the memory mirror system and cached data. Can't remember the details...</td> </tr></table><span class="postbody">
<br/>
Yes dynamic "rom to ram" caching with predictive area memory acces like a CPU pipeline.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121698 - simonjhall - Wed Mar 14, 2007 1:17 am</h4>
    <div class="postbody"><span class="postbody">Yeah, I'm sure you could predict where data's gonna be read from then pull that data from the disk. However, if it's an emulator you don't need any of these fancy exception-based schemes! Fixing up memory is like, part of the emulator... :-)
<br/>
<br/>
Anyway, coding it in assembler wouldn't have made too much difference, although I would have done so if required. The problem was the overhead of the actual exception-handling process, which wasn't in my control as I'm 95% sure that that task is split between the CPU and BIOS code. From doing an invalid read/write to actually entering my code hundreds (thousands?) of cycles had elapsed!
<br/>
<br/>
Even if I had done some kind of caching thing you'd still have to handle this overhead on every invalid memory access.
<br/>
Max got around this by using the mirroring mechanism so that (if I remember correctly) on first access to an invalid page it would pull in the whole page and then the original program would use the mirror (which has no overhead). I don't think this would work too well if the program wasn't aware of it though...
<br/>
<br/>
I got bored of this virtual memory hoo-ha and now a bunch of kind people bought and donated me slot-2 hardware which has extra RAM :-)<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
