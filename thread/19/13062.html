<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Prevent reset when GBA slot linker is inserted - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS Flash Equipment > Prevent reset when GBA slot linker is inserted</h2>
<div id="posts">
<div class="post">
    <h4>#126487 - KeithE - Mon Apr 23, 2007 7:35 pm</h4>
    <div class="postbody"><span class="postbody">The N-Card, Firelink, NeoFlash MK5, and other similar cards come with a GBA slot USB linker that is used to transfer programs from the PC to the DS card.  
<br/>
<br/>
When this linker is inserted, the DS automatically restarts, except when the SELECT key is held in the flash cartridge main menu during insertion.
<br/>
<br/>
My question is: does anyone know what is happening when SELECT is held to prevent the DS from resetting?  I want to write some software that prompts the user to insert the cartridge, and I don't want the DS to reset.  It must be possible, since the firmware of the cartridge somehow prevents the reset when SELECT is held.
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126498 - josath - Mon Apr 23, 2007 9:50 pm</h4>
    <div class="postbody"><span class="postbody">Does it reset if you insert the linker while running homebrew? Perhaps it's working the other way around...the flashcart menu listens for card insert and triggers a reset, unless you hold select.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126525 - KeithE - Tue Apr 24, 2007 1:44 am</h4>
    <div class="postbody"><span class="postbody">Yes, it does reset when I insert the linker while running homebrew.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126532 - tepples - Tue Apr 24, 2007 4:30 am</h4>
    <div class="postbody"><span class="postbody">Does it reset even if the homebrew explicitly disables Game Pak interrupts?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126559 - KeithE - Tue Apr 24, 2007 1:47 pm</h4>
    <div class="postbody"><span class="postbody">Good idea tepples.  I just tried that, with this code in both arm7 and arm9 right before the main while loop:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">irqDisable(IRQ_CART);</td> </tr></table><span class="postbody">
<br/>
<br/>
Unfortunately, it still is resetting.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135293 - darkfader - Sat Jul 21, 2007 11:33 pm</h4>
    <div class="postbody"><span class="postbody">I think it's just tripping the power circuit.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135335 - KeithE - Sun Jul 22, 2007 1:55 pm</h4>
    <div class="postbody"><span class="postbody">What do you mean by "tripping the power circuit"?
<br/>
<br/>
The interesting thing is that it can be prevented by holding SELECT while in the flash cartridge menu, so there must be a way to make homebrew that allows it to be inserted without resetting.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135341 - wintermute - Sun Jul 22, 2007 3:23 pm</h4>
    <div class="postbody"><span class="postbody">He means shorting the power circuit so that the protection kicks in and the DS resets.
<br/>
<br/>
Your only real option is to dump the menu and find out what it's doing when select is pressed. It's likely that one or more of the GBA cart lines is normally in a particular state before the cartridge is inserted. Circuitry in the cart probably uses this state to enable a gate which shorts the power supply, causing a reset. Code in the menu will set the output to a different state - maybe SRAM select line or a particular address on the bus.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135953 - KeithE - Fri Jul 27, 2007 9:01 pm</h4>
    <div class="postbody"><span class="postbody">That seems like a very likely scenario.  I've never dumped a menu or tried to reverse engineer an .nds file, so I guess I've got my work cut out for me.
<br/>
<br/>
I did figure out a way to put the USB GBA cartridge into a mode where it will not cause a reset.
<br/>
<br/>
1) With the DS turned off, insert the USB cartridge in the GBA slot and nothing in the DS slot.
<br/>
2) Turn the DS on, and wait for the menu to show.
<br/>
3) Remove the USB cartridge, then turn the DS off.
<br/>
<br/>
After this process, when I insert the USB cartridge while the DS is on, it does not reset.  To put it back into the mode where it resets, I can turn the DS off before removing the USB cartridge.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135954 - spinal_cord - Fri Jul 27, 2007 9:15 pm</h4>
    <div class="postbody"><span class="postbody">Does the DS do a 'proper' reset, or does it just switch off? Would figuring this out lead to the ability for homebrew to reset the DS?<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135955 - KeithE - Fri Jul 27, 2007 9:27 pm</h4>
    <div class="postbody"><span class="postbody">When the USB cartridge is inserted the DS resets completely, just like you have turned it off, then back on again with the power switch.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135956 - wintermute - Fri Jul 27, 2007 9:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>spinal_cord wrote:</b></span></td> </tr> <tr> <td class="quote">Does the DS do a 'proper' reset, or does it just switch off? Would figuring this out lead to the ability for homebrew to reset the DS?</td> </tr></table><span class="postbody">
<br/>
<br/>
It's a hardware based reset, so no.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
