<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>gba mode switch not booting gbamp :( - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS Flash Equipment > gba mode switch not booting gbamp :(</h2>
<div id="posts">
<div class="post">
    <h4>#129587 - spinal_cord - Wed May 23, 2007 11:53 pm</h4>
    <div class="postbody"><span class="postbody">I'm switching to gba mode using the method in the following page -
<br/>
<br/>
<a href="http://www.bottledlight.com/ds/index.php/Main/GBAMode" target="_blank">http://www.bottledlight.com/ds/index.php/Main/GBAMode</a>
<br/>
<br/>
but my gbamp doesn't boot, although its fine with other [pre-compiled] switchers on the net. Is there a way to fix this, or better code to use?<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129743 - cory1492 - Fri May 25, 2007 9:55 pm</h4>
    <div class="postbody"><span class="postbody">There is a bit more to it than just that... from gbatek document, which appears to be MIA on the web at the moment...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Switching from NDS Mode to GBA Mode
<br/>
<br/>
  --- NDS9: ---
<br/>
  ZEROFILL VRAM A,B     ;init black screen border (or other color/image)
<br/>
  POWCNT=8003h          ;enable 2D engine A on upper screen (0003h=lower)
<br/>
  EXMEMCNT=...          ;set Async Main Memory mode (clear bit14)
<br/>
  IME=0                 ;disable interrupts
<br/>
  SWI 06h               ;halt with interrupts disabled (lockdown)
<br/>
  --- NDS7: ---
<br/>
  POWERMAN.REG0=09h     ;enable sound amplifier &amp; upper backlight (05h=lower)
<br/>
  IME=0                 ;disable interrupts
<br/>
  wait for VCOUNT=200   ;wait until VBlank
<br/>
  SWI 1Fh with R2=40h   ;enter GBA mode, by CustomHalt(40h)
<br/>
</td> </tr></table><span class="postbody">
<br/>
A small/simplistic demo I slapped together for someone not so long ago which compiles under R20:
<br/>
<a class="postlink" href="http://nds.cmamod.com/files/resetgba.zip" target="_blank">resetgba.zip</a> (not tested on GBAMP, that I am aware of any way)
<br/>
There are alternates in discussions here already, which inline the assembly in the A7 as well...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   // Restart in gba mode
<br/>
   __asm (".arm\n"
<br/>
   "mov    r2, #0x40\n"
<br/>
   "swi    0x1F0000\n"
<br/>
   );</td> </tr></table><span class="postbody">
<br/>
<br/>
search is your friend...
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?p=122119#122119" target="_blank">http://forum.gbadev.org/viewtopic.php?p=122119#122119</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130117 - tondopie - Thu May 31, 2007 1:35 am</h4>
    <div class="postbody"><span class="postbody">You can also acheive the same with a lot simpler way specified in hbfirmware. It needs some updating to DKA r20 mind you.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
