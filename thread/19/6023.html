<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Passme execution address - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS Flash Equipment > Passme execution address</h2>
<div id="posts">
<div class="post">
    <h4>#45614 - Wriggler - Sun Jun 12, 2005 7:37 pm</h4>
    <div class="postbody"><span class="postbody">Hi everyone, I've been frustrated using my crappy flash card with an (excellent) Passme device. At the moment I'm having to use crazy methods to get Arm9 code at the start of the GBA cart (the default software always writes a boot menu, which of course is Arm7 stuff and kills the passme).
<br/>
<br/>
The problem comes with my flash software; it only writes the first three blocks successfully. This is fine for tiny demos, but anything larger just won't write to the flash card (at least not using the method I'm using!).
<br/>
<br/>
So, two approaches to this problem:
<br/>
-Anyone know of/has made a flash app for a MagicFlash/PowerFlash card?
<br/>
-(...or...) Can the passme be changed so that the area of execution is not the start of GBA rom memory? Could I reflash the passme to point to the third block on the card, instead of the zeroth?
<br/>
<br/>
Cheers everyone!
<br/>
<br/>
Ben</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45620 - natrium42 - Sun Jun 12, 2005 8:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Wriggler wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
-(...or...) Can the passme be changed so that the area of execution is not the start of GBA rom memory? Could I reflash the passme to point to the third block on the card, instead of the zeroth?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, change the following lines in passme.vhd available at <a href="http://darkfader.net/ds" target="_blank">http://darkfader.net/ds</a>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
         -- patch ARM7 entry address
<br/>
         when 16#034# =&gt; patched_data &lt;= X"C0";
<br/>
         when 16#035# =&gt; patched_data &lt;= X"00";
<br/>
         when 16#036# =&gt; patched_data &lt;= X"00";
<br/>
         when 16#037# =&gt; patched_data &lt;= X"08";
<br/>
</td> </tr></table><span class="postbody">
<br/>
(In this example the offset the PassMe jumps to is 0x080000C0.)
<br/>
Generate the programming file using Xilinx ISE WebPack (free with registration). Use a CheapTag JTAG cable to reprogram the PassMe.
<br/>
<br/>
Now that your PassMe jumps to a different address, you have to make a modified loader (similar to ndsmall.bin) which will contain a few dozen NOPs in the beginning to cover the bytes jumped over by new VHDL.<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45649 - cory1492 - Mon Jun 13, 2005 11:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Now that your PassMe jumps to a different address, you have to make a modified loader (similar to ndsmall.bin) which will contain a few dozen NOPs in the beginning to cover the bytes jumped over by new VHDL.</td> </tr></table><span class="postbody">You sure natruim? I thought changing the jump in VHDL would cover that, unless you mean the loader looks to raw addresses on the cart and needs to be modified to match the VHDL code... I suppose there is no simple way to do something similar with the firmware?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45737 - Lynx - Tue Jun 14, 2005 1:38 pm</h4>
    <div class="postbody"><span class="postbody">He means that if the PassMe is looking for 0x080000C8, you need to pad the ROM up to 0x080000C8 so that your real data will start there.  Otherwise, PassMe will be jumping to the middle of the ROM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45743 - cory1492 - Tue Jun 14, 2005 3:40 pm</h4>
    <div class="postbody"><span class="postbody">I had thought by the question he was looking to use passme to start code after the first 3 blocks on the flash cart (sounds like he wants to use it to bypass the standard loader) which would, technically, mean that the loader "is" the padding...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45769 - Wriggler - Tue Jun 14, 2005 7:52 pm</h4>
    <div class="postbody"><span class="postbody">Great, thanks for the help guys. I'll look into trying something along these lines...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cory1492 wrote:</b></span></td> </tr> <tr> <td class="quote">I had thought by the question he was looking to use passme to start code after the first 3 blocks on the flash cart (sounds like he wants to use it to bypass the standard loader) which would, technically, mean that the loader "is" the padding...</td> </tr></table><span class="postbody">
<br/>
<br/>
Yup, that's the one. I'm only interested in bypassing the loader, as there doesn't seem to be an effective way of writing to my flash cart without it :(
<br/>
<br/>
Again, thanks for your help.
<br/>
<br/>
Ben</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45772 - natrium42 - Tue Jun 14, 2005 8:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Wriggler wrote:</b></span></td> </tr> <tr> <td class="quote">Great, thanks for the help guys. I'll look into trying something along these lines...
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cory1492 wrote:</b></span></td> </tr> <tr> <td class="quote">I had thought by the question he was looking to use passme to start code after the first 3 blocks on the flash cart (sounds like he wants to use it to bypass the standard loader) which would, technically, mean that the loader "is" the padding...</td> </tr></table><span class="postbody">
<br/>
<br/>
Yup, that's the one. I'm only interested in bypassing the loader, as there doesn't seem to be an effective way of writing to my flash cart without it :(
<br/>
<br/>
Again, thanks for your help.
<br/>
<br/>
Ben</span></td> </tr></table><span class="postbody">
<br/>
The GBA menu loader comes after the binary and not before the binary. A jump to it is inserted into GBA header by your flashing software. PassMe jumps over this GBA header. Hence jumps to GBA menu loader are not executed.
<br/>
<br/>
How old is your flashcart? Maybe it has a few bad blocks since flash wears out?<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45773 - Wriggler - Tue Jun 14, 2005 8:41 pm</h4>
    <div class="postbody"><span class="postbody">...so you're saying that the passme should work even though the menu is copied to the flash cart? Because, well, it doesn't. The flash cart isn't that old, and it doesn't have bad blocks in the first few sectors (as I can write it using one method, but not the other).
<br/>
<br/>
If the boot menu is at the end of the cart, shouldn't the passme just ignore it completely?
<br/>
<br/>
(BTW- Flash cart is a MagicFlash 256)
<br/>
<br/>
Ben</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45783 - natrium42 - Tue Jun 14, 2005 10:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Wriggler wrote:</b></span></td> </tr> <tr> <td class="quote">...so you're saying that the passme should work even though the menu is copied to the flash cart? Because, well, it doesn't.</td> </tr></table><span class="postbody">
<br/>
Well, I do believe you, so let's figure it out :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Wriggler wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If the boot menu is at the end of the cart, shouldn't the passme just ignore it completely?
<br/>
</td> </tr></table><span class="postbody">
<br/>
That's the idea.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Wriggler wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
(BTW- Flash cart is a MagicFlash 256)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Can you write a demo to the flashcart and then read it back? If this is possible, you can compare it to the original binary (use HexWorkshop) and see what bytes are being changed. Usually a few bytes in the 192 byte header are changed and the menu loader is attached somewhere after the demo binary.<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45802 - Lynx - Wed Jun 15, 2005 4:53 am</h4>
    <div class="postbody"><span class="postbody">:'(  Man, you should dump those other projects and get back to the NDS, Natrium42.  We miss you! :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45811 - cory1492 - Wed Jun 15, 2005 11:47 am</h4>
    <div class="postbody"><span class="postbody">Wriggler, is the current method you use <span style="font-style: italic">replacing</span> the loader in the standard writing soft with you nds stuff?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45813 - Vince - Wed Jun 15, 2005 1:57 pm</h4>
    <div class="postbody"><span class="postbody">Hiya,
<br/>
<br/>
I am not sure here about what Natrium says concerning the loader :  on F2A/F2A Ultra for instance, the loader is written at the beginning of the cart (0x8000000) and ROMS are after it. 
<br/>
<br/>
This seems odd to me that the loader lies at the end because this would mean rewriting it every time we add a new ROM (and repatching the jump accordingly every time). This would also pose problems to bankswitch : if the first ROM's size is equal to 256M, supplementary code would need to be inserted to bankswitch before jumping at the loader address.
<br/>
<br/>
Vince<br/>_________________<br/>Reclaim control of your F2A/F2AU with <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=32532" target="_blank">if2a</a> !!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45834 - cory1492 - Wed Jun 15, 2005 5:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vince wrote:</b></span></td> </tr> <tr> <td class="quote">on F2A/F2A Ultra for instance, the loader is written at the beginning of the cart (0x8000000) and ROMS are after it.</td> </tr></table><span class="postbody">Thanks Vince, Natrium confused me there. I didnt think there was any changes to the header with the f2a carts since it uses a content descriptor, but I am not certain about the magicflash series...it just seems to make sense to me to put the bootloader at the beginning as its what gets loaded first.
<br/>
<br/>
You could try it and see, I guess, you could look at the loaders bin and find its hex size, then add 0xC0 to that and use that for the value that passme loads, and load the loader as well as a nds.gba file to see if it works... not sure how many time the Xilinx CPLD was meant to be reprogrammed effectively, but it shouldnt be hard to put it back the way it was if you are able to dump the code with ISE first. You may have to make a custom loader.bin with that number added to the start address codes so the addresses of the arm7 and 9 arent skewed...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45840 - natrium42 - Wed Jun 15, 2005 6:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vince wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I am not sure here about what Natrium says concerning the loader :  on F2A/F2A Ultra for instance, the loader is written at the beginning of the cart (0x8000000) and ROMS are after it.</td> </tr></table><span class="postbody">
<br/>
Well, if it's a cart with a memory bank just for the menu loader, this is possible. Otherwise, you cannot write a GBA menu loader into the beginning of a bank and still use that same bank for GBA roms. The reason is that you cannot relocate the GBA code (i.e. when you shift every byte of a GBA demo, all the absolute references will be wrong.)
<br/>
<br/>
So, you'd have to investigate what a particular flashcart does. There is no generalization.<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45901 - Vince - Thu Jun 16, 2005 9:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Well, if it's a cart with a memory bank just for the menu loader, this is possible. Otherwise, you cannot write a GBA menu loader into the beginning of a bank and still use that same bank for GBA roms. The reason is that you cannot relocate the GBA code (i.e. when you shift every byte of a GBA demo, all the absolute references will be wrong.)</td> </tr></table><span class="postbody">
<br/>
Yes, that's true for the F2A : the loader takes 128KB, the exact size of a flash bank on that card.
<br/>
<br/>
I, however, don't get why this would pose problem to put the loader and a ROM on the same bank (you are talking about flash banks aren't you?). The old F2A pro carts loader was only 32K so there was room for a (small) ROM in the same bank. I suppose this is based on how flash addressing works... I'll have a look into that.
<br/>
<br/>
Vince<br/>_________________<br/>Reclaim control of your F2A/F2AU with <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=32532" target="_blank">if2a</a> !!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
