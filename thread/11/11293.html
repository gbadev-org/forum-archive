<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>String Isolation, Automated Retrieval - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Help Wanted > String Isolation, Automated Retrieval</h2>
<div id="posts">
<div class="post">
    <h4>#104236 - sgeos - Wed Sep 27, 2006 10:31 am</h4>
    <div class="postbody"><span class="postbody">If you want localize your project now or in the future, you need isolate all of your text strings and put them in one place.  The logical place is in a spreadsheet, because translators can easily work with spreadsheets.  In theory spreadsheets can also hold more than language (provided a universal encoding).
<br/>
<br/>
Given a spreadsheet with string names and strings:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">TXT_LANG      en              fr      ja
<br/>
TXT_CHARSET   iso-8859-1      ...     ...
<br/>
TXT_MENU      Menu            ...     ...
<br/>
TXT_M_MANUAL  Online Help     ...     ...
<br/>
</td> </tr></table><span class="postbody">
<br/>
I'd like to create a general solution that:
<br/>
A) Retrieves the data from the spreadsheet
<br/>
B) Inserts strings into a project based on a language setting
<br/>
<br/>
Please post here or send me a private message if you would like to help.  I'm using open office.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104291 - tepples - Wed Sep 27, 2006 8:48 pm</h4>
    <div class="postbody"><span class="postbody">To get the data out of your spreadsheet, tell OpenOffice.org to export it in tab-separated format, which is easy for a program to parse.
<br/>
<br/>
By "inserts strings into a project" what do you mean? A project on which platform? Does this platform have a file system? Do you want translators to be able to see their work on hardware without having to recompile the program? Do you want the player to be able to select a language at runtime?
<br/>
<br/>
Without any other sort of requirement guidance, I'd come up with something that takes your tab-separated file and spits out something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/* begin strings-en.c */
<br/>
const char TXT_MENU[] = "Menu";
<br/>
const char TXT_M_MANUAL[] = "Online Help";
<br/>
/* EOF */
<br/>
<br/>
/* begin strings-tokipona.c */
<br/>
const char TXT_MENU[] = "lipu wile";
<br/>
const char TXT_M_MANUAL[] = "lipu pi kama sona";
<br/>
/* EOF */
<br/>
</td> </tr></table><span class="postbody">
<br/>
"ja" scares me. I've never tried exporting a spreadsheet containing kanji (Chinese ideograms) from OOo. Can your tools handle all strings using UTF-8 encoding?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104343 - sgeos - Thu Sep 28, 2006 5:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">To get the data out of your spreadsheet, tell OpenOffice.org to export it in tab-separated format,</td> </tr></table><span class="postbody">
<br/>
A tab delimited csv file with nothing surrounding the text?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">which is easy for a program to parse.</td> </tr></table><span class="postbody">
<br/>
The ideal solution doesn't involve the user manually opening OOo.  Admittedly, one assumes that you don't get new translations or updates multiple times a day- a manual step might not be a big deal.
<br/>
<br/>
It looks like OOo macros can be run from the command line, so automation amounts to writing a macro.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">By "inserts strings into a project" what do you mean? A project on which platform?</td> </tr></table><span class="postbody">
<br/>
I'm looking for a general solution that is not platform specific.  I might be working with C or HTML or even something weird and proprietary.  I think that there are two types of general scenarios:
<br/>
<br/>
A) Template/Non-Centralized
<br/>
spreadsheet -(conversion)-&gt; data table -(preprocessor)-&gt; embedded text
<br/>
<br/>
B) Centralized File
<br/>
spreadsheet -(conversion)-&gt; data table -(filter)-&gt; useful strings file(s)
<br/>
<br/>
The "data table" can be a tab delimited file unless something else is "easier" to work with.  The C preprocessor can be used for the template method (with a step or two in between).
<br/>
<br/>
Centralized file output is specific to what you happen to be doing.  A generic solution for C could be written if that would be useful.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Does this platform have a file system? Do you want translators to be able to see their work on hardware without having to recompile the program?</td> </tr></table><span class="postbody">
<br/>
Being able to view translations on hardware without recompiling would be fantastic.  It is not something I had even considered.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Do you want the player to be able to select a language at runtime?</td> </tr></table><span class="postbody">
<br/>
This option certainly wants to be reserved.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Without any other sort of requirement guidance, I'd come up with something that takes your tab-separated file and spits out something like this:</td> </tr></table><span class="postbody">
<br/>
*snip code*
<br/>
<br/>
Which is a fine solution if your build only needs one language at a time.  Can the language be changed at runtime using that solution?
<br/>
<br/>
As far as C goes, I'd work through an API like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void addLanguage(int pLanguage, const char **pMessageData);
<br/>
void setLanguage(int pLanguage);
<br/>
const char *getMessage(int pMessage);
<br/>
const char *getMessageL(int pMessage, int pLanguage);</td> </tr></table><span class="postbody">
<br/>
And spit out something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// Language Codes
<br/>
#define LANG_EN 0
<br/>
#define LANG_TOKIPONA 1
<br/>
<br/>
// Message ID Codes
<br/>
#define ID_TXT_MENU 0
<br/>
#define ID_TXT_N_MANUAL 1
<br/>
<br/>
// Messages (Default Language)
<br/>
#define TXT_MENU getMessage(ID_TXT_MENU)
<br/>
#define TXT_N_MANUAL getMessage(ID_TXT_N_MANUAL)
<br/>
<br/>
// Messages (Specified Language)
<br/>
#define LTXT_MENU(LTXT_a) getMessageL(ID_TXT_MENU, LTXT_a)
<br/>
#define LTXT_N_MANUAL(LTXT_a) getMessageL(ID_TXT_N_MANUAL, LTXT_a)
<br/>
<br/>
// en Message Table
<br/>
const char *gTxtEn[] =
<br/>
{
<br/>
   "Menu",
<br/>
   "Online Help",
<br/>
   NULL
<br/>
};
<br/>
<br/>
// tokipona Message Table
<br/>
const char *gTxtTokipona[] =
<br/>
{
<br/>
   "lipu wile",
<br/>
   "lipu pi kama sona",
<br/>
   NULL
<br/>
};</td> </tr></table><span class="postbody">
<br/>
You might not want to actually go through a function to get your messages.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">"ja" scares me. I've never tried exporting a spreadsheet containing kanji (Chinese ideograms) from OOo.</td> </tr></table><span class="postbody">
<br/>
Have you ever tried looking at the source of <a class="postlink" href="http://www.intsys.co.jp/" target="_blank">a Japanese web page</a>?  Copy (from the net), paste, export works fine for me.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Can your tools handle all strings using UTF-8 encoding?</td> </tr></table><span class="postbody">
<br/>
If your tools can only handle ASCII, you can convert the non-ascii compatible characters to numeric character references before mucking around with them.  I've found that this is the best way to make things not break in strange places. =)  Many cygwin tools seem to assume ASCII. You always convert your data back to UTF-8 or whatnot as one of your last steps.
<br/>
<br/>
Instead, you could just convert the data into raw bytes in the firest place.  The data only needs to be human readable in the spreadsheed and on the target platform.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106350 - ecurtz - Wed Oct 18, 2006 5:44 am</h4>
    <div class="postbody"><span class="postbody">How's this going? I'm interested in seeing how it comes out, and here are some semi-random thoughts...
<br/>
<br/>
You may want to use a byte or short at the beginning to mark the strings for length (pascal style, for us old-time Mac types.)
<br/>
<br/>
Have you looked at <a class="postlink" href="http://www.gnu.org/software/gettext/manual/html_mono/gettext.html" target="_blank">gettext?</a> There may be some useful utilities there for yanking out your strings and cataloging them.
<br/>
<br/>
Are you going to assign a category or section id or something to the strings to aid in swapping sections into RAM? I suppose this doesn't matter much on cart systems.
<br/>
<br/>
Consider embedding the layout in the strings (spacing, line breaks, etc.) yes it's an ugly hack and "should" be done at runtime, but on the other hand more code on the computer means more control over output and less work on the final device.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106380 - sgeos - Wed Oct 18, 2006 3:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ecurtz wrote:</b></span></td> </tr> <tr> <td class="quote">How's this going?</td> </tr></table><span class="postbody">
<br/>
I have an implementation specific solution that converts tab delimited spreadsheet files into an import table.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ecurtz wrote:</b></span></td> </tr> <tr> <td class="quote">I'm interested in seeing how it comes out,</td> </tr></table><span class="postbody">
<br/>
This is the perl script I'm using.  You might want to have it spit out ifdef, define, and endif.  ...I might just add that...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#!/usr/bin/perl -w
<br/>
<br/>
while (defined($line = &lt;STDIN&gt;))
<br/>
{
<br/>
        if ($line =~ s/([^\t\n]+)([\t])([^\t\n]+|)(?:[\t]|)([^\t\n]+|)(?:[\t]|)[\n]/#define\t$1$2$3\n/g)
<br/>
        {
<br/>
                print STDOUT $line;
<br/>
        }
<br/>
        else
<br/>
        {
<br/>
                print STDOUT "\n";
<br/>
        }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
The final $3 represents the second column in the spreadsheet.  $4 would be the third column.  The script would have to be enhanced to handle more columns.  Usage:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">cat in.csv | csv2h.pl &gt; out.h</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ecurtz wrote:</b></span></td> </tr> <tr> <td class="quote">You may want to use a byte or short at the beginning to mark the strings for length (pascal style, for us old-time Mac types.)</td> </tr></table><span class="postbody">
<br/>
I could see a length marker being helpful.  Depends on what you want to do.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ecurtz wrote:</b></span></td> </tr> <tr> <td class="quote">Have you looked at <a class="postlink" href="http://www.gnu.org/software/gettext/manual/html_mono/gettext.html" target="_blank">gettext?</a> There may be some useful utilities there for yanking out your strings and cataloging them.</td> </tr></table><span class="postbody">
<br/>
I had not.  The goal is actually to yank all strings before starting.  gettext appears to be for "fixing" already written programs.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ecurtz wrote:</b></span></td> </tr> <tr> <td class="quote">Are you going to assign a category or section id or something to the strings to aid in swapping sections into RAM? I suppose this doesn't matter much on cart systems.</td> </tr></table><span class="postbody">
<br/>
I'd be more inclined to use a different string table for each language and let the compiler worry about the details unless they become a problem.  See the example above.
<br/>
<br/>
Here is another data table communication example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "stdio.h"
<br/>
#include "stdlib.h"
<br/>
#include "string.h"
<br/>
<br/>
// txt.h - autogenerated
<br/>
#define TXT_NEWLINE   "\n"
<br/>
#define TXT_DUMMY   "---"
<br/>
#define TXT_PLAYER   "Exandris"
<br/>
#define TXT_HELPME   "Help me!  I'm in the castle!"
<br/>
#define TXT_AREYOU   "Are you %s?"
<br/>
#define TXT_CASH   "You have %s gold."
<br/>
<br/>
// tid.h - would also be autogenerated; different script
<br/>
#define TID_NEWLINE   0
<br/>
#define TID_DUMMY   1
<br/>
#define TID_PLAYER   2
<br/>
#define TID_HELPME   3
<br/>
#define TID_AREYOU   4
<br/>
#define TID_CASH   5
<br/>
#define TID_MAX      6
<br/>
<br/>
// txt.c - would also be autogenerated; different script
<br/>
const char *gText[] =
<br/>
{
<br/>
   TXT_NEWLINE,
<br/>
   TXT_DUMMY,
<br/>
   TXT_PLAYER,
<br/>
   TXT_HELPME,
<br/>
   TXT_AREYOU,
<br/>
   TXT_CASH,
<br/>
   NULL
<br/>
};
<br/>
<br/>
// main.h
<br/>
#define BUFFER_MAX 82
<br/>
<br/>
// main.c
<br/>
int gGold = 1234;
<br/>
<br/>
const char *getString(int pId)
<br/>
{
<br/>
   return gText[pId];
<br/>
}
<br/>
<br/>
void printStringBase(const char *pFormat, const char *pParam)
<br/>
{
<br/>
   printf(pFormat, pParam);
<br/>
   printf(TXT_NEWLINE);
<br/>
}
<br/>
<br/>
void printString(int pId)
<br/>
{
<br/>
   const char *format = getString(pId);
<br/>
   printStringBase(format, TXT_DUMMY);
<br/>
}
<br/>
<br/>
void printStringS(int pId, int pParamId)
<br/>
{
<br/>
   const char *format = getString(pId);
<br/>
   const char *param  = getString(pParamId);
<br/>
   printStringBase(format, param);
<br/>
}
<br/>
<br/>
void printStringI(int pId, int pParam)
<br/>
{
<br/>
   const char *format = getString(pId);
<br/>
   char param[BUFFER_MAX];
<br/>
   sprintf(param, "%d", param);
<br/>
   printStringBase(format, param);
<br/>
}
<br/>
<br/>
void messageTest(void)
<br/>
{
<br/>
   int i;
<br/>
   for (i = 0; i &lt; TID_MAX; i++)
<br/>
      printString(i);
<br/>
}
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   // real calls
<br/>
   printString(TID_PLAYER);
<br/>
   printString(TID_HELPME);
<br/>
   printStringS(TID_AREYOU, TID_PLAYER);
<br/>
   printStringI(TID_CASH, gGold);
<br/>
<br/>
   messageTest();
<br/>
   return 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
A bunch of variations of this theme could be written.  You could put different language versions of the print functions in function tables and then use the API above.  There is a good chance you'll need to write new functions for different languages.
<br/>
<br/>
Note that no message has more than one parameter.  This is a Good Thing when dealing with translation.  This could happen to you-  "You kick the apple and a tree falls on your head."  This is much better- "You kick the tree."  "An apple falls on your head."  Sure, not as much fun, but it can't be botched by the translator.
<br/>
<br/>
Note that all of the messages use %s for parameters.  This is not a must, but I believe that you should write your messages for your offline proofreaders and translators.  Even a non-tech savvy proofreader should be able to understand- "%s means the program puts something like a name or number there."  This might no fly- "A % followed by another character will be replaced with a program supplied value."  Then again I might be too afraid of how non-tech savvy people can get.  =)  The online message test also takes advantage of the strings only approach.
<br/>
<br/>
You might want to store the string length if your display system needs that information.  I'd probably put it in an array of its own and use the message id as an index.
<br/>
<br/>
All of these files should be autogenerated.  The thought of handing a header over to a proofreader or translator frightens me.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ecurtz wrote:</b></span></td> </tr> <tr> <td class="quote">Consider embedding the layout in the strings (spacing, line breaks, etc.) yes it's an ugly hack and "should" be done at runtime, but on the other hand more code on the computer means more control over output and less work on the final device.</td> </tr></table><span class="postbody">
<br/>
Do you have an example?  Precalculation is often a very good thing.
<br/>
<br/>
This may sound crazy, but you might want to consider not using ASCII encoding.  Your font starts with glyph 0, so you may wish to use a proprietary encoding that takes advantage of that.  I'd probably use high values for control codes.  This way your text display system can use built in byte code functions.  You'll need to preprocess all of your messages to take advantage of this.
<br/>
<br/>
If you are using ASCII, 0x80 to 0xFF could be used as byte codes.  You may back yourself into a system that is hard extend to multibyte encoding formats.  Although I suppose that that is the case with any program that assumes 1 byte == 1 glyph or control code.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106398 - tepples - Wed Oct 18, 2006 6:05 pm</h4>
    <div class="postbody"><span class="postbody">Or you can use 0x01 through 0x1F (or even just 0x1B) followed by one or more ASCII characters for your control codes, and then use UTF-8 for text.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
