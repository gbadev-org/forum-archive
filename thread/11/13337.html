<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>wanted: custom php coding for the moon books project - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Help Wanted > wanted: custom php coding for the moon books project</h2>
<div id="posts">
<div class="post">
    <h4>#130402 - bobslack - Sun Jun 03, 2007 1:26 am</h4>
    <div class="postbody"><span class="postbody">I am looking for someone to write a small online utility that people can paste text into, hit a button, and have the text reformatted to 40 characters width, and then download said output.
<br/>
<br/>
email me at <a href="mailto:btmullins@gmail.com">btmullins@gmail.com</a><br/>_________________<br/>Brandon
<br/>
Founder and WebMaster of The MoonBooks Project
<br/>
Free classic literature and films on the Nintendo DS
<br/>
<a href="http://moonbooks.net" target="_blank">http://moonbooks.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130403 - keldon - Sun Jun 03, 2007 1:39 am</h4>
    <div class="postbody"><span class="postbody">You can do that with javascript or java (and of course php).
<br/>
<br/>
So would that be 40 characters width where line breaks <span style="font-weight: bold">only</span> happen after 40 characters? What happens to the other line breaks, do they become spaces or are they ignored?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130409 - bobslack - Sun Jun 03, 2007 2:13 am</h4>
    <div class="postbody"><span class="postbody">they would be removed. check out one of the books at <a href="http://moonbooks.net" target="_blank">http://moonbooks.net</a> to see what i mean. i basically reformatted plain project gutenberg files.<br/>_________________<br/>Brandon
<br/>
Founder and WebMaster of The MoonBooks Project
<br/>
Free classic literature and films on the Nintendo DS
<br/>
<a href="http://moonbooks.net" target="_blank">http://moonbooks.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130503 - ScottLininger - Mon Jun 04, 2007 5:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">&lt;?php
<br/>
<br/>
if ($_REQUEST['doDownload']) {
<br/>
  $filename = "SomeBook.txt";
<br/>
  header("Pragma: public");
<br/>
  header("Expires: 0");
<br/>
  header("Cache-Control: must-revalidate, post-check=0, pre-check=0"); 
<br/>
  header("Content-Type: application/octet-stream");
<br/>
  header( "Content-Disposition: attachment; filename=\"$filename\"");
<br/>
  header( "Content-Description: File Transfert");
<br/>
  echo ReformatToFixedWidth($_REQUEST['input'],40);
<br/>
  die();
<br/>
}
<br/>
<br/>
function ReformatToFixedWidth($str,$maxLineLength) {
<br/>
  
<br/>
  // replace return chars to correct for brower/os differences
<br/>
  $str = str_replace("\r\n","\n",$str);
<br/>
  $str = str_replace("\t","     ",$str);
<br/>
<br/>
  // mark the paragraph locations for now with a char not likely to be in the text (|)
<br/>
  $str = str_replace("\n\n","|",$str);
<br/>
  $str = str_replace("\n"," ",$str);
<br/>
  $str = str_replace("  "," ",$str);
<br/>
  
<br/>
  $returnStr = "";
<br/>
  $lastWordStart = 0;
<br/>
  $lastLineStart = 0;
<br/>
<br/>
  // walk the text and find a word break that gets maximum words per line
<br/>
  for ($i=0;$i&lt;strlen($str);$i++) {
<br/>
    $currentChar = substr($str,$i,1);
<br/>
    
<br/>
    $currentLineLength = $i - $lastLineStart;
<br/>
    if ($currentChar == ' ') {
<br/>
      $lastWordStart = $i+1;
<br/>
    } elseif ($currentChar == '|') {
<br/>
      $returnStr .= substr($str,$lastLineStart,$i-$lastLineStart)."\r\n\r\n";
<br/>
      $lastWordStart = $i+1;
<br/>
      $lastLineStart = $i+1;
<br/>
    } elseif ($currentLineLength &gt;= $maxLineLength) {
<br/>
      $returnStr .= substr($str,$lastLineStart,$lastWordStart-$lastLineStart)."\r\n";
<br/>
      $lastWordStart = $lastWordStart;
<br/>
      $lastLineStart = $lastWordStart;
<br/>
    } 
<br/>
  }
<br/>
  return $returnStr;
<br/>
}
<br/>
?&gt;
<br/>
&lt;html&gt;
<br/>
<br/>
&lt;form method="post"&gt;
<br/>
&lt;h3&gt;Paste your book here:&lt;/h3&gt;
<br/>
&lt;textarea name="input" rows="20" cols="40"&gt;Paste here.&lt;/textarea&gt;
<br/>
&lt;P&gt;
<br/>
&lt;input type="submit" value="Convert Now!" /&gt; 
<br/>
&lt;input type="submit" name="doDownload" value="Convert and Download" /&gt;
<br/>
&lt;/form&gt;
<br/>
<br/>
&lt;h3&gt;See results here:&lt;/h3&gt;
<br/>
&lt;textarea name="output" rows="20" cols="40"&gt;&lt;?=ReformatToFixedWidth($_REQUEST['input'],40)?&gt;&lt;/textarea&gt;
<br/>
<br/>
&lt;/html&gt;</td> </tr></table><span class="postbody">
<br/>
<br/>
This should do ya.
<br/>
<br/>
-Scott</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130883 - bobslack - Sat Jun 09, 2007 12:00 am</h4>
    <div class="postbody"><span class="postbody">that seems to cut off a portion of the text towards the bottom.<br/>_________________<br/>Brandon
<br/>
Founder and WebMaster of The MoonBooks Project
<br/>
Free classic literature and films on the Nintendo DS
<br/>
<a href="http://moonbooks.net" target="_blank">http://moonbooks.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131668 - ScottLininger - Mon Jun 18, 2007 11:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bobslack wrote:</b></span></td> </tr> <tr> <td class="quote">that seems to cut off a portion of the text towards the bottom.</td> </tr></table><span class="postbody">
<br/>
<br/>
Can you send me the text you're trying to use? Worked fine for a couple of Gutenberg files I grabbed randomly from their site.
<br/>
<br/>
Also, what browser are you using?
<br/>
<br/>
-Scott</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
