<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Newbie help :P - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Newbie help :P</h2>
<div id="posts">
<div class="post">
    <h4>#19576 - -Ramirez- - Thu Apr 22, 2004 7:12 am</h4>
    <div class="postbody"><span class="postbody">Yeah... I'm just that... a newbie to assembly.  I've been doing extensive research on the language for the past few days, and it's quite different from what I'm used to.  However, I'm getting the hang of it... slowly, with a few bumps along the way.
<br/>
<br/>
For future reference (as I'm no doubt going to be asking more questions later), I thought I'd mention what I'm learning assembly for.  It's not to create a GBA game or anything of that sort.  It's merely so I can read the disassembly of a ROM and be able to extract certain formulas for use in an IRC bot.  Weird?  Maybe... but I've always wanted to do it. :)  In case you're wondering, the game is Pokemon Sapphire.  Yeah yeah, I know, Pokemon?!  I've always loved the battle system that's in the game, as well as the extreme selection of different characters.
<br/>
<br/>
Now... on to the questions!  (I sure hope you guys aren't evil to newcomers... :P)  First off... the research I've done suggests that Mappy VM is probably the best emulator to use for debugging needs.  (For me anyway.)  The problem is... I get no video or sound on that emulator, so it's kind of hard to use.  So... if you have a way to fix that, or another emulator suggestion, that would be very helpful.  (I know, this has nothing to do with assembly, but I imagine you don't want me creating a new thread for each new question... so I plan to just post new questions in this thread over and over.)
<br/>
<br/>
Ok... now on to a few assembly questions, which are extremely basic, so you guys shouldn't even have to think to answer them. :P  For the code to be able to read any values stored in the RAM, it has to first load them, correct?  If so, shouldn't I be able to search the disassembly for an address that matches an address I know of in RAM and be able to find it?  For example, I know that 0x02025C96 is the address that contains the value of the amount of an item you have in the game.  A search for that address in the disassembly produces no results.  I know that it could be loading an earlier address and simply add to that one and eventually reach the address I mentioned, but that makes me wonder how one is ever to find certain things if it's so broad.  Any suggestions you may have about finding where the code loads certain addresses would be appreciated.  Oh... and while we're on the subject of searching for addresses... I have been COMPLETELY unable to find anything that can actually save disassembly to a file, or let you search through it, with the exception of Mappy.  (Mappy loads the ROM, but the screen stays blank and I get no sound.  I was able to use its export feature even under these conditions.  The problem is that it doesn't even recognize all of the mnemonics/opcodes used.)  So... I'd like to know what's good to use for disassembling a ROM file, or of an emulator that can accurately export it.
<br/>
<br/>
Well, I guess that's all for now.  Sorry if I'm an annoying newbie, but everyone has to start somewhere, right? :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19582 - torne - Thu Apr 22, 2004 11:30 am</h4>
    <div class="postbody"><span class="postbody">Your questions:
<br/>
<br/>
I would recommend No$GBA rather than Mappy - you will have to do some hunting to find a copy as the author has discontinued the free version, but the licence explicitly allows previously released versions to still be distributed (it's just not on his site any more). It has a very nice debugger in it. =)
<br/>
<br/>
On the subject of addressing, it's not the case that that address will have to be in the disassembly. It may be being accessed as a PC-relative offset, which depending on your disassembler (I've not seen Mappy's output) may be displayed as just an offset, rather than an absolute address. More likely, it is being accessed as an offset into a structure; for example, the address given could be being accessed like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ldr r0,=0x02025c00
<br/>
ldr r1, [r0, #0x96]</td> </tr></table><span class="postbody">
<br/>
Of course, there are a massive number of variations on this, and the pair of instructions are not guarenteed to be adjacent.. or even to be a pair.
<br/>
<br/>
The easiest way to find where the address is loaded is to have a debugger that can trap memory accesses; simply have it break whenever you read that address. =)
<br/>
<br/>
The best disassembly tool I've ever used is DataRescue IDA Pro, which has godlike analysis and reverse engineering powers (it's used by security teams to analyse new worms/viruses just entering the wild when an explanation is desired in, say, an hour). Unfortunately it costs $400 for the standard version and $800 for the advanced version (the standard version is sufficient for the GBA as it understands ARM, but for PPC support I had to get the advanced version). If you want something free, objdump (part of GNU binutils) is a complete disassembler, but not a very smart one; any of the GBA devkits you can download from this site (devkitadvance, devkitarm..etc) will contain objdump. It will happily disassemble every byte in the ROM, regardless of whether it's code or data. This might be the issue you are having with Mappy; some of the 'unknown opcodes' may in fact actually just be data bytes. It's normal to have a few bytes of data at the end of each function, depending on the compiler and settings used to generate the code - this is the constant pool used to load values that cannot be constructed directly as operands. IDA determines what is code and what is data automatically based on tracing memory accesses and execution flow (static analysis, so it needs a little help from a human for difficult code).
<br/>
<br/>
You're not an annoying newbie; you asked sensible questions politely, and in good Englis, and thus deserve all the assistance we can give you =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19586 - isildur - Thu Apr 22, 2004 2:24 pm</h4>
    <div class="postbody"><span class="postbody">As for the debugger choice, did you try Cowbite? That's the one I prefer (not having the free No$GBA, the shareware version is too limited).
<br/>
<br/>
<a href="http://cowbite.emuunlim.com" target="_blank">http://cowbite.emuunlim.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19596 - -Ramirez- - Thu Apr 22, 2004 5:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">Your questions:I would recommend No$GBA rather than Mappy - you will have to do some hunting to find a copy as the author has discontinued the free version, but the licence explicitly allows previously released versions to still be distributed</td> </tr></table><span class="postbody">
<br/>
I searched like crazy for older versions of it... the oldest one I found was 1.0b or something along those lines.  It still had that 256KB limit, which makes loading the Sapphire ROM impossible.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">On the subject of addressing, it's not the case that that address will have to be in the disassembly. It may be being accessed as a PC-relative offset, which depending on your disassembler (I've not seen Mappy's output) may be displayed as just an offset, rather than an absolute address. More likely, it is being accessed as an offset into a structure; for example, the address given could be being accessed like:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ldr r0,=0x02025c00
<br/>
ldr r1, [r0, #0x96]</td> </tr></table><span class="postbody">
<br/>
Of course, there are a massive number of variations on this, and the pair of instructions are not guarenteed to be adjacent.. or even to be a pair.</span></td> </tr></table><span class="postbody">
<br/>
Yeah, that's what I assumed must have been going on, considering searching for the exact address produced nothing.  The problem now becomes tracking it down.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">The easiest way to find where the address is loaded is to have a debugger that can trap memory accesses; simply have it break whenever you read that address. =)</td> </tr></table><span class="postbody">
<br/>
Which ones do you know of that are capable of doing such a thing?  I don't recall seeing this option on any of the emulators I've tried.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">The best disassembly tool I've ever used is DataRescue IDA Pro, which has godlike analysis and reverse engineering powers.  Unfortunately it costs $400 for the standard version and $800 for the advanced version (the standard version is sufficient for the GBA as it understands ARM, but for PPC support I had to get the advanced version).</td> </tr></table><span class="postbody">
<br/>
I've seen a lot about this program while I was searching for something good to debug with.  It definitely seemed like a good program... but that price is completely undoable for me.  *sigh* Nothing is ever free anymore, is it?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">If you want something free, objdump (part of GNU binutils) is a complete disassembler, but not a very smart one; any of the GBA devkits you can download from this site (devkitadvance, devkitarm..etc) will contain objdump. It will happily disassemble every byte in the ROM, regardless of whether it's code or data.</td> </tr></table><span class="postbody">
<br/>
I tried that  after you mentioned it, and it appears to only allow me to disassemble .ELF files.  Unless I was using it wrong or something... that's not going to work.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">This might be the issue you are having with Mappy; some of the 'unknown opcodes' may in fact actually just be data bytes. It's normal to have a few bytes of data at the end of each function, depending on the compiler and settings used to generate the code</td> </tr></table><span class="postbody">
<br/>
I considered that... but other emulators (namely VGBA) were showing actual opcodes rather than "undefined" or whatever in the same addresses that Mappy showed "undefined.'  I just assumed Mappy is the one with problems, as it's the one that can't even display anything for me. :P
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">and in good Englis</td> </tr></table><span class="postbody">
<br/>
Haha, seems like that's rare nowadays, doesn't it?
<br/>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>isildur wrote:</b></span></td> </tr> <tr> <td class="quote">As for the debugger choice, did you try Cowbite?</td> </tr></table><span class="postbody">
<br/>
Yes.  It has the same video problem for me as Mappy.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19602 - torne - Thu Apr 22, 2004 7:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>-Ramirez- wrote:</b></span></td> </tr> <tr> <td class="quote">It still had that 256KB limit, which makes loading the Sapphire ROM impossible.</td> </tr></table><span class="postbody">
<br/>
Unfortunately, that's the limitation imposed by the free version. All versions of the free version have that limit. I forgot you were disassembling a commercial cart. =)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">The easiest way to find where the address is loaded is to have a debugger that can trap memory accesses; simply have it break whenever you read that address. =)</td> </tr></table><span class="postbody">
<br/>
Which ones do you know of that are capable of doing such a thing?  I don't recall seeing this option on any of the emulators I've tried.</span></td> </tr></table><span class="postbody">
<br/>
VBA should be able to do this, either natively or through the GDB stub.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I've seen a lot about this program while I was searching for something good to debug with.  It definitely seemed like a good program... but that price is completely undoable for me.  *sigh* Nothing is ever free anymore, is it?</td> </tr></table><span class="postbody">
<br/>
I can't afford it either, but the computer lab with which I'm associated has licences and thus I can use it on the lab machines. =)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">If you want something free, objdump (part of GNU binutils) is a complete disassembler, but not a very smart one; any of the GBA devkits you can download from this site (devkitadvance, devkitarm..etc) will contain objdump. It will happily disassemble every byte in the ROM, regardless of whether it's code or data.</td> </tr></table><span class="postbody">
<br/>
I tried that  after you mentioned it, and it appears to only allow me to disassemble .ELF files.  Unless I was using it wrong or something... that's not going to work.</span></td> </tr></table><span class="postbody">
<br/>
You're using it wrong. It defaults to assuming the input file is ELF. All you need to do is tell it what it is - the object type you have is 'binary'. =) You may also need to use the 'disassemble all' option because there is no section information in a binary. You also need to manually tell it whether to disassemble as ARM or Thumb; this is yet another thing which may be a problem for Mappy. IIRC, VBA disassembles instructions based on what the CPU is currently set to; so if it's executing ARM code, it will disassemble everything as ARM code (which will look wrong for anything that's Thumb) and vice versa. There is no way of telling what is Thumb and what is ARM reliably other than using execution tracing (which, yes, IDA does for you).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">and in good Englis</td> </tr></table><span class="postbody">
<br/>
Haha, seems like that's rare nowadays, doesn't it?</span></td> </tr></table><span class="postbody">
<br/>
Well, now I look dumb. =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19616 - -Ramirez- - Thu Apr 22, 2004 10:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">VBA should be able to do this, either natively or through the GDB stub.</td> </tr></table><span class="postbody">
<br/>
It certainly doesn't appear to have this feature built-in.  So... what is this "GDB stub?"  I've seen the menu option for "GDB," but had no idea what it was for.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">I can't afford it either, but the computer lab with which I'm associated has licences and thus I can use it on the lab machines. =)</td> </tr></table><span class="postbody">
<br/>
Lucky... :P
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">You're using it wrong. It defaults to assuming the input file is ELF. All you need to do is tell it what it is - the object type you have is 'binary'. =) You may also need to use the 'disassemble all' option because there is no section information in a binary. You also need to manually tell it whether to disassemble as ARM or Thumb</td> </tr></table><span class="postbody">
<br/>
Oh... I should have looked at the options more closely.  I figured it out now, thanks.
<br/>
-Edit-
<br/>
Well, not quite.  Is it capable of saving the output to a file?  If so, I don't see the option for it anywhere...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">this is yet another thing which may be a problem for Mappy. IIRC, VBA disassembles instructions based on what the CPU is currently set to; so if it's executing ARM code, it will disassemble everything as ARM code (which will look wrong for anything that's Thumb) and vice versa. There is no way of telling what is Thumb and what is ARM reliably other than using execution tracing (which, yes, IDA does for you).</td> </tr></table><span class="postbody">
<br/>
So it can actually switch between ARM and Thumb in the middle of the disassembly?  Does objdump account for that?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">Well, now I look dumb. =)</td> </tr></table><span class="postbody">
<br/>
Everyone typos. :P  It's not as if you don't know how to spell the word, or intentionally spelled it that way.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19620 - torne - Thu Apr 22, 2004 10:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>-Ramirez- wrote:</b></span></td> </tr> <tr> <td class="quote">It certainly doesn't appear to have this feature built-in.  So... what is this "GDB stub?"  I've seen the menu option for "GDB," but had no idea what it was for.</td> </tr></table><span class="postbody">
<br/>
Are you using the VBA command-line debugger? You shouldn't be looking on the menu options. =)
<br/>
A GDB stub is the piece of code that GDB, the GNU Debugger, connects to in order to debug a target machine. You get GDB, or Insight, or some other GDB front end, and connect to the stub in VBA, and then you can debug doing anything that GDB supports.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">You're using it wrong. It defaults to assuming the input file is ELF. All you need to do is tell it what it is - the object type you have is 'binary'. =) You may also need to use the 'disassemble all' option because there is no section information in a binary. You also need to manually tell it whether to disassemble as ARM or Thumb</td> </tr></table><span class="postbody">
<br/>
Oh... I should have looked at the options more closely.  I figured it out now, thanks.
<br/>
-Edit-
<br/>
Well, not quite.  Is it capable of saving the output to a file?  If so, I don't see the option for it anywhere...</span></td> </tr></table><span class="postbody">
<br/>
Uhm.. just redirect the output to a file. 'objdump --options inputfile &gt; output.asm'
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">So it can actually switch between ARM and Thumb in the middle of the disassembly?  Does objdump account for that?</td> </tr></table><span class="postbody">
<br/>
Well, yes. The ARM code, the Thumb code, and the data are all mixed up together in what will seem to be a pretty random fashion. If you don't understand how that works, then you are unlikely to get far disassembling a rom, tbh.. there is no way to distinguish which is which without tracing the execution flow, which is extremely nontrivial to do by hand, and is hard to do even with a debugger. No disassembler that I've ever seen or heard of can do it, other than IDA, and IDA still needs human guidance to do it.
<br/>
<br/>
You will do reasonably well to assume that almost all the code is Thumb, because it *probably* is. There might be large chunks of ARM, there might only be small chunks, there might be hardly any at all, but I would be very suprised if the majority wasn't Thumb. Of course, Pokemon is a big, complicated ROM, and easily the vast majority of it is not code at all but data. =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19624 - -Ramirez- - Thu Apr 22, 2004 11:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">Are you using the VBA command-line debugger? You shouldn't be looking on the menu options. =)</td> </tr></table><span class="postbody">
<br/>
Haha, nope.  I didn't realize it had more options.  I'm certainly using it now. :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">A GDB stub is the piece of code that GDB, the GNU Debugger, connects to in order to debug a target machine. You get GDB, or Insight, or some other GDB front end, and connect to the stub in VBA, and then you can debug doing anything that GDB supports.</td> </tr></table><span class="postbody">
<br/>
Oh, I'll have to try that then.  If you don't mind, can you point me to where I can download one of the two?  I can always go search if you don't have one.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">Uhm.. just redirect the output to a file. 'objdump --options inputfile &gt; output.asm'</td> </tr></table><span class="postbody">
<br/>
I feel like a moron now.  I had no idea you could do that with any program.  Looks like I'm not exactly an expert with the command prompt either. :P
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">Well, yes. The ARM code, the Thumb code, and the data are all mixed up together in what will seem to be a pretty random fashion. If you don't understand how that works, then you are unlikely to get far disassembling a rom, tbh.. there is no way to distinguish which is which without tracing the execution flow, which is extremely nontrivial to do by hand, and is hard to do even with a debugger. No disassembler that I've ever seen or heard of can do it, other than IDA, and IDA still needs human guidance to do it.</td> </tr></table><span class="postbody">
<br/>
Thanks for the boost in confidence... :(  Somehow I think I'll still be able to manage.  One of my friends was able to do quite a bit in terms of extracting the formulas he needed from another ROM.  He didn't have IDA Pro or anything like that either.  (If you're wondering why I don't ask HIM about all of this, it was a while ago, and I don't see him very often anymore.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">You will do reasonably well to assume that almost all the code is Thumb, because it *probably* is. There might be large chunks of ARM, there might only be small chunks, there might be hardly any at all, but I would be very suprised if the majority wasn't Thumb. Of course, Pokemon is a big, complicated ROM, and easily the vast majority of it is not code at all but data. =)</td> </tr></table><span class="postbody">
<br/>
VBA seems to display it as ARM almost all the time.  ARM is the language I've been researching and studying, so I hope you're wrong. :(
<br/>
<br/>
-Edit-
<br/>
Actually, now that I'm using the SDL version, you seem to be correct, unfortunately.  It's showing most things in Thumb now.  *goes to find Thumb versions of the documents he has*</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19626 - torne - Thu Apr 22, 2004 11:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>-Ramirez- wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">Are you using the VBA command-line debugger? You shouldn't be looking on the menu options. =)</td> </tr></table><span class="postbody">
<br/>
Haha, nope.  I didn't realize it had more options.  I'm certainly using it now. :)</span></td> </tr></table><span class="postbody">
<br/>
It's the only debugger I've really used much, though I tend not to use debuggers (on any platform).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">A GDB stub is the piece of code that GDB, the GNU Debugger, connects to in order to debug a target machine. You get GDB, or Insight, or some other GDB front end, and connect to the stub in VBA, and then you can debug doing anything that GDB supports.</td> </tr></table><span class="postbody">
<br/>
Oh, I'll have to try that then.  If you don't mind, can you point me to where I can download one of the two?  I can always go search if you don't have one.</span></td> </tr></table><span class="postbody">
<br/>
GDB is just, well, GDB. It's GNU software, same as everything else. VBA's site has a copy of Insight compiled for Windows, targetting ARM and all ready to plug into VBA.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">Uhm.. just redirect the output to a file. 'objdump --options inputfile &gt; output.asm'</td> </tr></table><span class="postbody">
<br/>
I feel like a moron now.  I had no idea you could do that with any program.  Looks like I'm not exactly an expert with the command prompt either. :P</span></td> </tr></table><span class="postbody">
<br/>
What you can do using an NT shell (presumably you are) is nothing compared to what you get with a Unix-style shell (such as the Cygwin version of bash). Shell is magic. =)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Thanks for the boost in confidence... :(  Somehow I think I'll still be able to manage.  One of my friends was able to do quite a bit in terms of extracting the formulas he needed from another ROM.  He didn't have IDA Pro or anything like that either.  (If you're wondering why I don't ask HIM about all of this, it was a while ago, and I don't see him very often anymore.)</td> </tr></table><span class="postbody">
<br/>
Well, if you can get the debugger to work for you nicely, you shouldn't have many problems; the kind of thing you're looking for will probably be easier through a debugger than just a disassembly.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">VBA seems to display it as ARM almost all the time.  ARM is the language I've been researching and studying, so I hope you're wrong. :(</td> </tr></table><span class="postbody">
<br/>
VBA displays it as ARM if it's executing ARM code at the moment. This means that wherever the current instruction pointer is, is ARM code; typically, the code just in front of and behind that will be the same. =)
<br/>
Thumb and ARM are two different opcode encodings for the same processor; every Thumb instruction maps to an ARM instruction which has the same effects (though the converse is not true) - thus, they are not different languages and you shouldn't have to learn anything. Almost every opcode is the same, they just have restricted choices of operands/flags, or take two operands instead of three (e.g. arithmetic instructions in Thumb always assume that the destination is the same as the first source).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19627 - -Ramirez- - Thu Apr 22, 2004 11:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">VBA's site has a copy of Insight compiled for Windows, targetting ARM and all ready to plug into VBA.</td> </tr></table><span class="postbody">
<br/>
I'll go take a look, thanks.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">What you can do using an NT shell (presumably you are) is nothing compared to what you get with a Unix-style shell (such as the Cygwin version of bash). Shell is magic. =)</td> </tr></table><span class="postbody">
<br/>
So I've heard... but I really have no reason to use any unix OSs, so I'll have to live with Windows. :P
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">Well, if you can get the debugger to work for you nicely, you shouldn't have many problems; the kind of thing you're looking for will probably be easier through a debugger than just a disassembly.</td> </tr></table><span class="postbody">
<br/>
Yeah, VBA's debugger is working extremely well for me now.  This should be all I need.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19630 - torne - Fri Apr 23, 2004 12:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>-Ramirez- wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">What you can do using an NT shell (presumably you are) is nothing compared to what you get with a Unix-style shell (such as the Cygwin version of bash). Shell is magic. =)</td> </tr></table><span class="postbody">
<br/>
So I've heard... but I really have no reason to use any unix OSs, so I'll have to live with Windows. :P</span></td> </tr></table><span class="postbody">
<br/>
I use Windows. Cygwin lets you have a perfectly good *nix shell anyway. My default command prompt is bash, and my Windows machine runs X. =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19632 - -Ramirez- - Fri Apr 23, 2004 12:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">I use Windows. Cygwin lets you have a perfectly good *nix shell anyway. My default command prompt is bash, and my Windows machine runs X. =)</td> </tr></table><span class="postbody">
<br/>
Wtf, now I REALLY didn't know about that.  I'll definitely have to look into it after I'm all done with this.
<br/>
<br/>
Btw, VBA's debugger is so useful.  I'm able to do exactly what I was wanting.  Thanks a lot for all of your help. :)  I may need some help with understanding some assembly concepts later... if I do, I'll be sure to post. :P
<br/>
<br/>
Thanks again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19634 - torne - Fri Apr 23, 2004 12:49 am</h4>
    <div class="postbody"><span class="postbody">That's what Cygwin does; lets *nix software compile to run under Windows. Your ARM devkit (objdump..etc) is almost certainly compiled for Cygwin. =)
<br/>
<br/>
And yeah, the inbuilt debugger is quite nice; I could never get the GDB stub to work right so I just used that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19642 - -Ramirez- - Fri Apr 23, 2004 1:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">I could never get the GDB stub to work right so I just used that.</td> </tr></table><span class="postbody">
<br/>
I couldn't either.  Even if it did work, I can't imagine it being much more useful than the built-in one already is.
<br/>
<br/>
<br/>
Oh, and I have a new question. ;)  What exactly do the opcodes "PUSH" and "POP" do?  Something to do with stack, which I guess is what I need to have explained to me.  What is the stack?  It appears to be some sort of storage area.
<br/>
<br/>
-Edit-
<br/>
...and another.  How exactly does branching work?  When it executes the branch, does it just jump to the specified position and execute whatever is on that address?  Does it just do that one "command", or does it execute more than that?  If it goes longer, how does it know where to stop?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19654 - Miked0801 - Fri Apr 23, 2004 4:12 am</h4>
    <div class="postbody"><span class="postbody">Push places registers on the stack (a memory pointer that grows backwards from roughly the end of memory.)  Pop takes them back off. Branch is a goto - it jumps to the location and continues running - no return.  BTW, the code never stops executing so beware where you jump to... :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19656 - -Ramirez- - Fri Apr 23, 2004 4:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">Push places registers on the stack (a memory pointer that grows backwards from roughly the end of memory.)  Pop takes them back off.</td> </tr></table><span class="postbody">
<br/>
I see.  So... how does it read from the stack once it's placed something there?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">Branch is a goto - it jumps to the location and continues running - no return.  BTW, the code never stops executing so beware where you jump to... :)</td> </tr></table><span class="postbody">
<br/>
Ok, that makes sense.  So what's the difference between B, BL, and BX?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19661 - poslundc - Fri Apr 23, 2004 5:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>-Ramirez- wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">Push places registers on the stack (a memory pointer that grows backwards from roughly the end of memory.)  Pop takes them back off.</td> </tr></table><span class="postbody">
<br/>
I see.  So... how does it read from the stack once it's placed something there?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
You use pop to read off the most recent (top) entry on the stack, at the same time as you remove it. That is the general principle behind stack operation: you only ever either add new stuff onto it or access the top item when you remove it, and it is last-in-first-out (LIFO) as opposed to a queue, which is FIFO.
<br/>
<br/>
(In practice you can access elements other than the top one but this is how general stack behaviour works.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">Branch is a goto - it jumps to the location and continues running - no return.  BTW, the code never stops executing so beware where you jump to... :)</td> </tr></table><span class="postbody">
<br/>
Ok, that makes sense.  So what's the difference between B, BL, and BX?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
B - Branch jumps to a local address that is calculated as an offset relative to the program counter (PC).
<br/>
<br/>
BL - Branch and Link is the same as Branch, but it stores the current address in the link register (LR) before jumping so that you can return from what is usually a subroutine.
<br/>
<br/>
BX - Branch and Exchange reads the destination address out of a register instead of calculating a PC-relative offset. This makes it possible to jump much further than you can with B or BL. It also lets you switch processing modes from ARM to Thumb or vice-versa.
<br/>
<br/>
For more details <a class="postlink" href="http://www.arm.com" target="_blank">read the docs</a> for the ARM7TDMI processor.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19709 - -Ramirez- - Fri Apr 23, 2004 7:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">You use pop to read off the most recent (top) entry on the stack, at the same time as you remove it. That is the general principle behind stack operation: you only ever either add new stuff onto it or access the top item when you remove it, and it is last-in-first-out (LIFO) as opposed to a queue, which is FIFO.</td> </tr></table><span class="postbody">
<br/>
I understand, thanks.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">B - Branch jumps to a local address that is calculated as an offset relative to the program counter (PC).</td> </tr></table><span class="postbody">
<br/>
What exactly is the PC?  How is it set?
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">BL - Branch and Link is the same as Branch, but it stores the current address in the link register (LR) before jumping so that you can return from what is usually a subroutine.</td> </tr></table><span class="postbody">
<br/>
Ok, is this the only way LR can be modified?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">BX - Branch and Exchange reads the destination address out of a register instead of calculating a PC-relative offset. This makes it possible to jump much further than you can with B or BL. It also lets you switch processing modes from ARM to Thumb or vice-versa.</td> </tr></table><span class="postbody">
<br/>
I actually don't have any questions about this one. :P
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">For more details <a class="postlink" href="http://www.arm.com" target="_blank">read the docs</a> for the ARM7TDMI processor.</td> </tr></table><span class="postbody">
<br/>
Yeah... I already have several documents, but they're not exactly newbie friendly most of the time.
<br/>
<br/>
<br/>
I also have a new question.  Is it possible to use VGBA to break when a certain address is accessed?  That would be the absolute best thing for what I need to do.  The Sapphire ROM is huge, and I have quite a few areas mapped out.  If I could simply set a breakpoint whenever a certain address is read from, I could see the code I need very easily.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19716 - tepples - Fri Apr 23, 2004 8:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>-Ramirez- wrote:</b></span></td> </tr> <tr> <td class="quote">What exactly is the PC?  How is it set?</td> </tr></table><span class="postbody">
<br/>
The program counter (r15) contains the address a few bytes ahead of the currently executing instruction. Set it with branch instructions or with just plain moves into r15. However, only the BX instruction can change between ARM and Thumb modes on ARM7TDMI. (Later revisions of the ARM architecture have fixed this bug and can change modes on moves to r15.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Ok, is [the BL instruction] the only way LR can be modified?</td> </tr></table><span class="postbody">
<br/>
LR is a general-purpose register. Moves in and out of it work as expected.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19724 - torne - Fri Apr 23, 2004 9:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">However, only the BX instruction can change between ARM and Thumb modes on ARM7TDMI. (Later revisions of the ARM architecture have fixed this bug and can change modes on moves to r15.)</td> </tr></table><span class="postbody">
<br/>
Calling that a bug is a bit much; the logic required is totally different, so it's not like it's something they forgot. =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19735 - -Ramirez- - Sat Apr 24, 2004 2:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">stuff</td> </tr></table><span class="postbody">
<br/>
Thanks.  It's nice to know people are willing to answer simple questions.
<br/>
<br/>
<br/>
Now... (to anyone) what about the breakpoint on memory access?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19736 - poslundc - Sat Apr 24, 2004 3:17 am</h4>
    <div class="postbody"><span class="postbody">It should be doable if you get GDB working with VBA... but without it I think the best you can do is place an infinite loop where you want the code to break.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19737 - -Ramirez- - Sat Apr 24, 2004 4:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">It should be doable if you get GDB working with VBA... but without it I think the best you can do is place an infinite loop where you want the code to break.</td> </tr></table><span class="postbody">
<br/>
I don't think you understand what I'm looking for.  I need to find the code area that actually accesses a certain address in the ROM.  I would have no clue where to place a breakpoint in the actual disassembly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19738 - poslundc - Sat Apr 24, 2004 5:00 am</h4>
    <div class="postbody"><span class="postbody">Unless GDB supports watching specific memory locations (which it may; I haven't used it in years so I don't recall), I don't know how you would go about doing something like that without some major hacking.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19741 - -Ramirez- - Sat Apr 24, 2004 6:19 am</h4>
    <div class="postbody"><span class="postbody">I know several events in the game itself that would definitely access that area.  If I were to enter the debugger while the game was waiting for me to select a menu item (which leads directly to the event which accesses that memory address), wouldn't that allow me to find the code that checks for the menu option to be selected, then follow the path it would take from there?  Bah, I didn't word that too well.
<br/>
<br/>
Basically... this:
<br/>
1.  Get to the point in the game that gives me the menu to select what I want to do.
<br/>
2.  Enter the debugger.
<br/>
3.  Follow the code from the current address until I find an area checking the state of the A key, which would tell the game to start the event.  (Haha, that brings up another problem in itself... how do I check for the A key?)
<br/>
4.  Follow the code along the path it would take if the A key was pressed.
<br/>
5.  I'd eventually find the code that accesses that memory address I'm looking for, would I not?
<br/>
<br/>
If that would work, it'd be acceptable.  It might take quite a while to follow through to where I need to be though, I don't know.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19745 - Miked0801 - Sat Apr 24, 2004 8:08 am</h4>
    <div class="postbody"><span class="postbody">No$GBA allows breakpoints on writes to any memory adress and possibly reads though I haven't tried that yet.  This was enabled in the freeware version around somewhere...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19749 - -Ramirez- - Sat Apr 24, 2004 3:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">No$GBA allows breakpoints on writes to any memory adress and possibly reads though I haven't tried that yet.  This was enabled in the freeware version around somewhere...</td> </tr></table><span class="postbody">
<br/>
I can't use No$GBA due to the 256KB limit.  I'm not creating a ROM, but loading an existing one.
<br/>
<br/>
Btw, is SP another one of these registers that can be used by anything?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19857 - -Ramirez- - Mon Apr 26, 2004 11:23 pm</h4>
    <div class="postbody"><span class="postbody">Did everyone decide to go on a vacation or something? ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19864 - torne - Tue Apr 27, 2004 12:41 am</h4>
    <div class="postbody"><span class="postbody">I suspect we just don't know the answers. I haven't used a debugger for some time and can't tell you how to stop at a memory access, though I recall it being possible in GDB.
<br/>
<br/>
Oh, one I do know the answer to: SP (r13) is the stack pointer, and points to the current top of the stack. It's what pop/push use to keep track of where to pop and push. You can push it down as much as you like (to a point) to give yourself space for local variables, but you have to put it back before you exit the function. =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19866 - -Ramirez- - Tue Apr 27, 2004 12:46 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">I suspect we just don't know the answers.</td> </tr></table><span class="postbody">
<br/>
You can always post and say you don't know, as you just did. :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">though I recall it being possible in GDB.</td> </tr></table><span class="postbody">
<br/>
Yeah, I was just experimenting with that a minute ago.  Apparently... trying to set a watchpoint while connected to VBA-SDL doesn't work.  That's EXACTLY what I was looking for though.  Figures it doesn't work.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">Oh, one I do know the answer to: SP (r13) is the stack pointer, and points to the current top of the stack. It's what pop/push use to keep track of where to pop and push. You can push it down as much as you like (to a point) to give yourself space for local variables, but you have to put it back before you exit the function. =)</td> </tr></table><span class="postbody">
<br/>
Thanks... are there any other registers with special names that I should know about?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19880 - poslundc - Tue Apr 27, 2004 7:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>-Ramirez- wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">I suspect we just don't know the answers.</td> </tr></table><span class="postbody">
<br/>
You can always post and say you don't know, as you just did. :)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Well, I think it was pretty clear from the previous posts that you were in uncharted territory.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Thanks... are there any other registers with special names that I should know about?</td> </tr></table><span class="postbody">
<br/>
<br/>
PC - program counter, r15, has the current instruction address in it
<br/>
LR - link register, r14, is used by subroutines and is updated automatically on the BL instruction. Can be modified so long as it is restored.
<br/>
IP - intra-procedure scratch register, r12, is always safe to modify in subroutines (ie. you don't have to worry about preserving it).
<br/>
A1 to A4 - the function-parameter registers, r0-r3, contain any parameters passed to a subroutine and may also be used to return values. Like IP, they do not have to be preserved across function calls.
<br/>
<br/>
Those are the biggies.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19885 - Miked0801 - Tue Apr 27, 2004 2:23 pm</h4>
    <div class="postbody"><span class="postbody">and of course Stak Pointer mentioned earlier at r13.  I believe r7 is usually the frame-pointer as well though that shouldn't matter for anything.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19886 - tepples - Tue Apr 27, 2004 2:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>-Ramirez- wrote:</b></span></td> </tr> <tr> <td class="quote">You can always post and say you don't know, as you just did. :)</td> </tr></table><span class="postbody">
<br/>
I think people avoid cluttering the board with numerous "I don't know" posts because they don't want to appear as post sex-professionals.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Apparently... trying to set a watchpoint while connected to VBA-SDL doesn't work.  That's EXACTLY what I was looking for though.  Figures it doesn't work.</td> </tr></table><span class="postbody">
<br/>
Then perhaps you might try reporting this as a bug to the VBA maintainers.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Thanks... are there any other registers with special names that I should know about?</td> </tr></table><span class="postbody">
<br/>
R12-R15 (ip, sp, lr, pc) are pretty much all the registers that anybody calls by a special name. Look up their purposes in the <a class="postlink" href="http://www.cs.cornell.edu/courses/cs414/2004sp/resources/armcallconvention.pdf" target="_blank">ARM Thumb Procedure Call Standard</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19894 - torne - Tue Apr 27, 2004 8:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">I believe r7 is usually the frame-pointer as well though that shouldn't matter for anything.</td> </tr></table><span class="postbody">
<br/>
Nope, the frame pointer is r11. Code compiled with -fomit-frame-pointer will generally not care what you do with it. r7 is the Thumb-state work register, which means.. well, nothing, really - ARM's compiler likes to use r7 for various things when generating Thumb code, but nothing that forces you to treat it differently to r4-r6, and GCC just doesn't care.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19908 - Miked0801 - Tue Apr 27, 2004 10:10 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I'd assumed it was r7 as that register isn't pushed/popped as often when omit-framepointer is used.  Thanks for the correction.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19993 - poslundc - Thu Apr 29, 2004 3:03 pm</h4>
    <div class="postbody"><span class="postbody">It was discussed in another thread and it's been my observation that GCC uses r7 as a frame pointer in Thumb mode. It seems to do this regardless of whether a frame pointer is advisable or not (unless the aforementioned omit switch is present, I suppose).
<br/>
<br/>
This is also consistent with the ARM/Thumb intraprocedure call standard, which recommends the use of any of r4 to r7 as a frame pointer in Thumb mode.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20002 - Quirky - Thu Apr 29, 2004 6:41 pm</h4>
    <div class="postbody"><span class="postbody">VBA SDL's built in debugger, for DOS/Windows at least, has breaks on memory writes. You may need to use the .elf file. When I didn't have a clue about some silly bugs I found it pretty handy for trapping "random" errors. The command line'll be something like:
<br/>
<br/>
vba-sdl -d mygame.elf
<br/>
<br/>
Then when the debugger starts, use it like this
<br/>
<br/>
&gt; break AgbMain
<br/>
&gt; c
<br/>
&gt; bpw 3003cc0
<br/>
&gt; c
<br/>
<br/>
That sets a break at the C start of the prog, then continues to that point. Then you set the break point where you want and continue again. Course,  if the point's never reached, you won't break again, so maybe put another break in there somewhere.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
