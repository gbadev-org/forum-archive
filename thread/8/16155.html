<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Strange algorithm..? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Strange algorithm..?</h2>
<div id="posts">
<div class="post">
    <h4>#164121 - Ruben - Tue Oct 21, 2008 7:26 am</h4>
    <div class="postbody"><span class="postbody">Hey all.
<br/>
<br/>
OK, I don't know whether this should go under the audio section or here, but since it's more logical than anything else...
<br/>
<br/>
The basic idea of my "main" (mixing) algorithm is to multiply by the volumes like so..
<br/>
<br/>
value = (volume left OR (volume right LSL 16)) * sample
<br/>
value &amp;= ~((maximum channels-1) LSL 16) //32 channels max
<br/>
value = value LSR (channel count bits) //5 bits for 32
<br/>
<br/>
Or more graphically...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">     FFFFFFBC &lt;- -44
<br/>
MUL 007F 007F &lt;- Volume
<br/>
-------------
<br/>
    DE43 DE44
<br/>
BIC 001F 0000 &lt;- (32-1)&lt;&lt;16
<br/>
-------------
<br/>
    DE40 DE44
<br/>
LSR         5
<br/>
-------------
<br/>
    06F2 06F2</td> </tr></table><span class="postbody">
<br/>
<br/>
That's all OK and everything, but then comes a problem at the "final" (mix down) step.
<br/>
<br/>
Since I'm using a "fixed point multiplier" (the global volume) at the end to scale the values, anything that's &gt;= 80h has no distortion, but anything BELOW that... ayayay! And also, I've got a problem for clamping (clipping), as I can't think of any conventional method to clip that. (Maximum value: 7Fh, minimum value: -80h)
<br/>
<br/>
EDIT:
<br/>
Whoops. Wrong section. Can someone move it to coding or the appropriate one? Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164132 - keldon - Tue Oct 21, 2008 5:45 pm</h4>
    <div class="postbody"><span class="postbody">For clipping you can either brick wall limit (i.e. just apply max), or apply compression / soft limiting. Compression is basically reducing the volume of the chain when the level reaches the threshold; the attack and release are both gradual, reacting in around 1-6ms (or so).
<br/>
<br/>
p.s. you can't perform clipping with a bitwise AND. Oh, and are you losing 7 bits of precision with your "fixed point multiplier"? If so, you can calculate the result to 64bits and then downshift, iirc the ARM has a multiply that produces a 64 bit result.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
