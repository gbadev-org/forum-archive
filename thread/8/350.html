<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Integrating ASM into C code - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Integrating ASM into C code</h2>
<div id="posts">
<div class="post">
    <h4>#2149 - animension - Thu Jan 30, 2003 4:53 am</h4>
    <div class="postbody"><span class="postbody">Hi guys,
<br/>
<br/>
I'm trying to understand how C function parameters get passed into ASM code called by said C code. So far, I know that certain registers hold the values of the parameters and that only up to r3 gets stored directly into registers (all other parameters start on the stack). How would a function like this pass the values to an ASM function?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u32 myasmfunction(
<br/>
  u32 param1,
<br/>
  u32 param2,
<br/>
  u32 param3,
<br/>
  u32 param4,
<br/>
  u32 param5
<br/>
);
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Which parameters would be stored into the registers directly and which ones into the stack? How does one pass the return value of the function back ( does it need to be in a particular register when "bx lr" is called?)
<br/>
Do the parameters get bumped up one because there's a return value on the function?
<br/>
<br/>
I'd really like to know how to make C and ASM talk to each other so I can get low down on the nitty gritty ASM stuff :)
<br/>
<br/>
Thanks<br/>_________________<br/>"Beer is proof that God loves us and wants us to be happy."
<br/>
-- Benjamin Franklin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2169 - Touchstone - Thu Jan 30, 2003 12:44 pm</h4>
    <div class="postbody"><span class="postbody">Assuming you use GCC, check this out. <a class="postlink" href="http://gcc.gnu.org/onlinedocs/gcc-3.0.4/gcc_21.html#SEC258" target="_blank">http://gcc.gnu.org/onlinedocs/gcc-3.0.4/gcc_21.html#SEC258</a>
<br/>
<br/>
This is where your parameters go when calling your function:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">param1 - r0
<br/>
param1 - r1
<br/>
param2 - r2
<br/>
param3 - r3
<br/>
param4 - sp+0
<br/>
param5 - sp+4</td> </tr></table><span class="postbody">
<br/>
<br/>
Return value to your C function should be in r0. This would return 160. :)</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mov   r0, #160
<br/>
bx    lr</td> </tr></table><span class="postbody"><br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2187 - animension - Thu Jan 30, 2003 7:56 pm</h4>
    <div class="postbody"><span class="postbody">Thanks! :)<br/>_________________<br/>"Beer is proof that God loves us and wants us to be happy."
<br/>
-- Benjamin Franklin</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
