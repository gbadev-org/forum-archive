<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>syntax question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > syntax question</h2>
<div id="posts">
<div class="post">
    <h4>#164263 - moonlightcheese - Fri Oct 24, 2008 7:55 pm</h4>
    <div class="postbody"><span class="postbody">i'm looking at this code snippet from prex, trying to reverse engineer the steps necessary to load ELF binaries and i don't get the syntax for the name## label and the #SYS_##name label.  what do those hash signs do there?  the rest of it i can read...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SYSCALL0(name) \
<br/>
   .global name; .align; \
<br/>
name##: \
<br/>
   stmfd sp!, {r4, r5, lr}; \
<br/>
   mov r4, #SYS_##name; \
<br/>
   ldr r5, =0x200007c; \
<br/>
   add lr, pc, #2; \
<br/>
   mov pc, r5; \
<br/>
   ldmfd sp!, {r4, r5, pc};</td> </tr></table><span class="postbody">
<br/>
also what does =0x200007c mean?
<br/>
<br/>
edit: i think i figured out the first question although i'm still don't know the exact syntax.  looks like SYS_msg_send and other defines exist in the system call header file and it looks like the hashes do some kind of variable name replacement.  still not sure exactly how it works...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164264 - Kyoufu Kawa - Fri Oct 24, 2008 8:28 pm</h4>
    <div class="postbody"><span class="postbody">I'm not sure about the ## thing, but it reminds me of a trick with string concatenation in the C preprocessor. In short, I think writing SYSCALL0(Foo) would result in a Foo label and the statement "mov r4, #SYS_Foo;".
<br/>
<br/>
As for your second question, that seems like a straigthforward "load from this specific address". Ofcourse, it's unclear what that is.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164267 - strat - Sat Oct 25, 2008 12:57 am</h4>
    <div class="postbody"><span class="postbody">ldr r5, =0x200007c
<br/>
<br/>
This actually stores the address 0x200007c in another rom address and loads r5 with the contents of that address.  It would assemble to something like this:
<br/>
<br/>
200029a:	4c05      	ldr	r5, [pc, #20]
<br/>
<br/>
20 bytes up you'd find
<br/>
<br/>
 20002b0:	007c           ; shows up as false code
<br/>
 20002b2:	0200          ; in a disassembly
<br/>
<br/>
Arm/Thumb can't load immediate values greater than 0xFF.  That's a feature of the assembler, not legal machine code.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
