<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>16 bit or 8 bit negative numbers + Burning a ROM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>ASM > 16 bit or 8 bit negative numbers + Burning a ROM</h2>
<div id="posts">
<div class="post">
    <h4>#7956 - funkeejeffou - Sun Jun 29, 2003 1:00 pm</h4>
    <div class="postbody"><span class="postbody">Let's say that I store in RAM 16 bit negative numbers like :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">variable
<br/>
@DCW 0xFFFF    ;this equals -1</td> </tr></table><span class="postbody">
<br/>
if I load it's value to a register like this : 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mov r0, variable
<br/>
ldrh r1, [r0]</td> </tr></table><span class="postbody">then r1 = 0x0000FFFF = 65535 and not -1 !!!
<br/>
<br/>
That's annoying me a little bit and I'd like to figure out a fast way to load 8 or 16 bits variable into a register.
<br/>
I thought about doing this for 16 bit variables(would be the same for 8bits with 24 shifts):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mov r1, r1 lsl#16
<br/>
mov r1, r1 asr#16</td> </tr></table><span class="postbody">so that the upper bits will be fixed, but it's kinda slow...
<br/>
Anybody has a suggestion ?
<br/>
<br/>
I also have another problem, my code works fine on VisualBoy but some graphic bugs occurs on harware (my bitmaps wich are stored in ROM are buggy when reaching the last pixels).
<br/>
Since I'm using Goldroad, must I patch the rom?
<br/>
I'm also suspecting the F2A config; the fixdata an 32K options are unfamiliar to me... 
<br/>
How do you burn in the right way a ROM?
<br/>
<br/>
Help will be much and much appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7963 - DekuTree64 - Sun Jun 29, 2003 4:02 pm</h4>
    <div class="postbody"><span class="postbody">Use ldrsh/ldrsb. They repeat the upper bit of the number through the rest of the register's bits. You don't get as many addressing modes, but you can usually calculate those with one add anyway, so it's still faster than 2 shifts.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8034 - GbaGuy - Tue Jul 01, 2003 1:57 am</h4>
    <div class="postbody"><span class="postbody">Wouldn't loading 0x8000FFFF be -1, or would that
<br/>
be -0xFFFF ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8037 - tepples - Tue Jul 01, 2003 2:15 am</h4>
    <div class="postbody"><span class="postbody">0x8000ffff is 0x80000000 + 0x0000ffff, or -2^31 + 65535, or -2147418113.
<br/>
<br/>
If you want -65535, then you want 0x100000000LL - 0xffff = 0xffff0001.
<br/>
<br/>
If you want -1, then you want 0xffffffff.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8069 - funkeejeffou - Tue Jul 01, 2003 4:01 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Deku, it works again (even on goldroad, hehe).
<br/>
As for burning the rom, I've found out that I had to leave clean the first 0xBFh bits of the rom, so that the header won't overwrite some data(wich was my texture, that's why the first bits were wrong). Goldraod doesn't do it itself, so if you also have this problem, just do:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bstart                         ;first adress of the ROM is always the jump call to
<br/>
                                 ;to your first line of code IN ARM!!!
<br/>
@org 0x80000C0h       ;jump 0xBF bits
<br/>
;beginning of code</td> </tr></table><span class="postbody">
<br/>
Hope this wil help out some other Goldroad users</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
