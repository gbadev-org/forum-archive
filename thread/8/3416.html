<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Self modifying code... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Self modifying code...</h2>
<div id="posts">
<div class="post">
    <h4>#20802 - MumblyJoe - Tue May 18, 2004 3:12 am</h4>
    <div class="postbody"><span class="postbody">Some of you may have seen the argument I have been having over the efficiency differences between using refrences and #defines in C++. While messing with alot of compiled asm to see who was right I thought about the fact that I haven't done any self modifying code since the 486.
<br/>
<br/>
Has anyone done any self modifying code on the gba (obviously in ewram/iwram)? I think it could open a couple of improvements on my code if anyone could tell me the pitfalls they have run into etc.<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20804 - Miked0801 - Tue May 18, 2004 3:53 am</h4>
    <div class="postbody"><span class="postbody">Self modifying code is much stronger on the x86 with its caching ability (minor), its reduced register space (meaning less room for work), and its really expensive jumps (cache killing and insane overhead for benefit).  A write to the GBA takes 2 cycles which isn't too bad - but the reason most people would write a self-modifying routine would be to get away from jump/loops.  In ARM, each intruction can be conditionaly executed so it steals much of the thunder of self-modifying code.  Why write a routine to update every 4th byte depending on a table or algorithm  (2 cycles per write plus setup code and read code), when a conditinonal execution of each instruction takes only 1 extra intruction (1 for skipped, 1 for execution.)
<br/>
<br/>
I've thought about this, but from the above, I've not seen much need for it...
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20832 - Lupin - Tue May 18, 2004 3:36 pm</h4>
    <div class="postbody"><span class="postbody">I thought of using it for a scanline filler where you don't know if you have to go left or right on the scanline you can just change the loop structure before entering the loop, if you have a lot of itterations it might pay off.<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20847 - Miked0801 - Tue May 18, 2004 6:35 pm</h4>
    <div class="postbody"><span class="postbody">Could be - this was a popular application of it in 386/486 early 3D days.  I'd have to see it to know if it was better though...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20870 - keldon - Tue May 18, 2004 9:44 pm</h4>
    <div class="postbody"><span class="postbody">self modifying code is useful only when needed to break through a bottlekneck. Other than that - - forget abowt it - that's my al pachino expression :-)
<br/>
<br/>
For code such as sequencers / event based engines, this can be useful, far faster than address[10] = event[3] - - then push address[10]; ret when you can simply write address [10] = event[3] and the code immediately jumps to event 3
<br/>
<br/>
but having said that how much time will be saved ?!?? like I said only if it breaks through a bottlekneck</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21003 - sasq - Fri May 21, 2004 2:25 pm</h4>
    <div class="postbody"><span class="postbody">It is good when you run out of registers in the inner loop and can replace a register operand with a "constant". It is good for jumping out of an unrolled loop (when you cant just jump into it n iterations from the end). 
<br/>
<br/>
The scanline left or right case sounds strange, in that situation I would duplicate the code instead. On GBA this might be a memory problem but surely not on a PC.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21022 - jd - Fri May 21, 2004 6:41 pm</h4>
    <div class="postbody"><span class="postbody">Self-modified code can get you some big gains in certain situations (my tmapper and audio mixer both use self-modified code extensively) but for most routines the gains are relatively small.
<br/>
<br/>
It's fairly straightforward to do on the GBA as there's no instruction cache and the opcodes are fairly logical - the only thing you've got to look out for is modifying instructions that are already in the pipeline although that's only a few instructions long so it's rarely a problem.
<br/>
<br/>
It's definitely something you should only consider if the code is performance critical.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
