<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>forgive me for being an IDIOT - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>ASM > forgive me for being an IDIOT</h2>
<div id="posts">
<div class="post">
    <h4>#7917 - superx10 - Sat Jun 28, 2003 5:34 pm</h4>
    <div class="postbody"><span class="postbody">alright, i read stuff on here about how to make functions in a .S file and how to do inline asm (like <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=1430" target="_blank">http://forum.gbadev.org/viewtopic.php?t=1430</a> ) and i've tried both but I cant seem to get it to work.. a couple of times i've started to say |= (_) ( |&lt; it and code entirely in c again.. but then when i realized how slow it would be i've gone back to trying to get this to work
<br/>
<br/>
i mean, i dont want to code in pure asm either..<br/>_________________<br/>"Two wolves are fighting. One wolf is all evil, hate, jealousy and discontent, and the other good, love, happiness and is content." "Sounds like a tough battle. Who wins?" said the old man. “The one I feed”</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7919 - tepples - Sat Jun 28, 2003 6:00 pm</h4>
    <div class="postbody"><span class="postbody">Here's a sample .s file, taken straight from <span style="font-style: italic">TOD</span>.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@ fixed fastfmul(fixed x, fixed y)
<br/>
@ Multiply two 16.16 fixed-point numbers.
<br/>
<br/>
.ARM
<br/>
.ALIGN
<br/>
.GLOBL  fastfmul
<br/>
<br/>
fastfmul:
<br/>
  smull r1,r2,r0,r1
<br/>
  mov r0,r2,LSL#16
<br/>
  orr r0,r0,r1,LSR#16
<br/>
  bx lr
<br/>
<br/>
<br/>
@ int dv(int num, int den)
<br/>
@ Divide two signed integers.
<br/>
<br/>
.THUMB
<br/>
.THUMB_FUNC
<br/>
.ALIGN
<br/>
.GLOBL  dv
<br/>
<br/>
dv:
<br/>
  cmp r1, #0
<br/>
  beq 0f
<br/>
  swi 6
<br/>
  bx lr
<br/>
0:
<br/>
  ldr r0, =0x7fffffff
<br/>
  bx lr
<br/>
<br/>
<br/>
@ int fracmul(signed int x, signed int frac)
<br/>
@ Multiply by a 0.32 fractional number between -0.5 and 0.5.
<br/>
@ Used for fast division by a constant.
<br/>
<br/>
.ARM
<br/>
.ALIGN
<br/>
.GLOBL  fracmul
<br/>
<br/>
fracmul:
<br/>
  smull r1,r2,r0,r1
<br/>
  mov r0, r2
<br/>
  bx lr
<br/>
<br/>
<br/>
@ int fracumul(unsigned int x, unsigned int frac)
<br/>
@ Multiply by a 0.32 fractional number between 0 and 1.
<br/>
@ Used for fast division by a constant.
<br/>
<br/>
.ARM
<br/>
.ALIGN
<br/>
.GLOBL  fracumul
<br/>
<br/>
fracumul:
<br/>
  umull r1,r2,r0,r1
<br/>
  mov r0, r2
<br/>
  bx lr
<br/>
<br/>
<br/>
@ void gblz_unpack(const void *src, void *dst)
<br/>
@ Unpack GB LZSS format data.
<br/>
<br/>
.THUMB
<br/>
.THUMB_FUNC
<br/>
.ALIGN
<br/>
.GLOBL  _gblz_unpack
<br/>
<br/>
_gblz_unpack:
<br/>
  swi 0x11  @ LZ77UnCompWRAM
<br/>
  bx lr
<br/>
</td> </tr></table><span class="postbody">
<br/>
Save this as something.S and then compile it with 'gcc' as if it were a C program. The 'gcc' driver will know what to do.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
