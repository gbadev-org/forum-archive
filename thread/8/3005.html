<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ASM Draw Horizontal Line - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>ASM > ASM Draw Horizontal Line</h2>
<div id="posts">
<div class="post">
    <h4>#17437 - Gordon - Mon Mar 08, 2004 5:14 am</h4>
    <div class="postbody"><span class="postbody">Need a ASM Draw Horizontal Line function in Mode3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17444 - Miked0801 - Mon Mar 08, 2004 7:22 am</h4>
    <div class="postbody"><span class="postbody">Need a poly filler next?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17447 - batblaster - Mon Mar 08, 2004 1:42 pm</h4>
    <div class="postbody"><span class="postbody">On devrs web site <a href="http://www.devrs.com" target="_blank">www.devrs.com</a> is possible to find a graphics library in asm where are some sources of line and fill for mode 3 and 5 , i'm tring to convert for mode 4 if anyone do before please post me...
<br/>
<br/>
Thanks a lot...<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17449 - poslundc - Mon Mar 08, 2004 3:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">Need a poly filler next?</td> </tr></table><span class="postbody">
<br/>
<br/>
Haha, I was going to make a post like this but thought better of it (I've been enough of a jerk lately). Glad to see I'm not the only one who gets annoyed when people don't bother to observe basic posting ettiquette.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17453 - batblaster - Mon Mar 08, 2004 5:07 pm</h4>
    <div class="postbody"><span class="postbody">This is a line Drawing on mode 3/5
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
@*******************************
<br/>
@* GBA Graphics Library        *
<br/>
@*  by Jeff Frohwein           *
<br/>
@* http://www.devrs.com        *
<br/>
@*******************************
<br/>
@ v1.0223 - Original release
<br/>
@ v1.0225 - Speeded up angular line draw with optimization
<br/>
@           suggestion from Dennis Ranke (exoticorn/icebird)
<br/>
@ v1.0315 - No longer saving r14 on stack since not required.
<br/>
@
<br/>
@  This version, on average, has the same rendering speed
<br/>
@ as line3.s but it has the accuracy of line2.s.
<br/>
@ Even length horizontal lines are now almost twice as fast.
<br/>
@ It is now the preferred code.
<br/>
<br/>
@ Vertical lines - 3 instrs/pixel
<br/>
@ Horizontal lines - 3 instr/2 pixels
<br/>
@ Angular lines  - 6 instrs/pixel
<br/>
<br/>
@ Draw a solid line in GBA graphics modes 3/5 in ARM asm
<br/>
@ Entry: x1 = pixel x1 coordinate
<br/>
@        y1 = pixel y1 coordinate
<br/>
@        x2 = pixel x2 coordinate
<br/>
@        y2 = pixel y2 coordinate
<br/>
@     color = pixel color
<br/>
@      addr = screen base address
<br/>
@ (void) gfxLine (u8 x1, u8 y1, u8 x2, u8 y2, u16 color, u32 addr);
<br/>
<br/>
        .ARM
<br/>
        .ALIGN
<br/>
        .GLOBL  gfxLine
<br/>
<br/>
@ r0 = x1
<br/>
@ r1 = y1
<br/>
@ r2 = x2 / pixel color
<br/>
@ r3 = y2 / pixel address
<br/>
@ r4 = temp / de
<br/>
@ r5 = deldx
<br/>
@ r6 = deldy
<br/>
@ r7 = dy /
<br/>
@ r8 = total pixel count
<br/>
@ r9 = delsx
<br/>
@ r10 = delsy
<br/>
@ r11 = delse
<br/>
@ r12 = delde
<br/>
<br/>
gfxLine:
<br/>
        sub     sp,sp,#8         @ protect the stack so color
<br/>
                                 @  doesn't get overwritten.
<br/>
<br/>
        cmp     r1,r3            @ Is the line horizontal ?
<br/>
        beq     _2               @ yes
<br/>
        cmp     r0,r2            @ Is the line vertical ?
<br/>
        beq     _8               @ yes
<br/>
<br/>
        stmfd   r13!,{r0-r12}
<br/>
        mov     r5,#2            @ deldx
<br/>
        mov     r6,#480          @ deldy
<br/>
<br/>
        subs    r7,r3,r1         @ delp = y2 - y1
<br/>
        rsbmi   r6,r6,#0         @ di=-1 if r7 is negative
<br/>
        rsbmi   r7,r7,#0         @ make r7 positive
<br/>
        mov     r10,r6           @ delsy
<br/>
<br/>
        subs    r8,r2,r0         @ r8 = x2 - x1
<br/>
        rsbmi   r5,r5,#0         @ di=-1 if r8 is negative
<br/>
        rsbmi   r8,r8,#0         @ make r8 positive
<br/>
        mov     r9,r5            @ delsx
<br/>
<br/>
        subs    r4,r8,r7
<br/>
        movmi   r4,r8,lsl #0     @ exchange r7 &amp; r8 if r8 is smaller
<br/>
        movmi   r8,r7,lsl #0
<br/>
        movmi   r7,r4,lsl #0
<br/>
        movmi   r9,#0
<br/>
        movpl   r10,#0
<br/>
        movmi   r6,#0            @@@@ to support new angular line loop
<br/>
        movpl   r5,#0            @@@@ to support new angular line loop
<br/>
<br/>
        mov     r11,r7,lsl #1    @ delse = delp * 2
<br/>
        sub     r4,r11,r8        @ de = delse - dels
<br/>
        sub     r12,r4,r8        @ delde = delse - (dels * 2)
<br/>
        sub     r4,r12,r8        @ error = delse - (dels * 3)
<br/>
<br/>
        sub     r12,r12,r11      @@@@ to support new angular line loop
<br/>
<br/>
        add     r8,r8,#1         @ r8 = total pixel count
<br/>
        ldr     r2,[r13,#60]     @ r2 = color off stack
<br/>
<br/>
        add     r9,r9,r10        @ r9 = straight pixel move
<br/>
        add     r5,r5,r6         @ r5 = diagonal pixel move
<br/>
<br/>
        ldr     r6,[r13,#64]     @ Get the screen base address
<br/>
<br/>
@ calculate pixel address
<br/>
<br/>
        mov     r3,#480
<br/>
        mul     r7,r3,r1
<br/>
        add     r7,r7,r0,lsl #1
<br/>
        add     r3,r7,r6         @ r3 = start pixel addr
<br/>
<br/>
_0:
<br/>
        strh    r2,[r3],r9       @ store pixel and move straight
<br/>
        adds    r4,r4,r11        @ update error value
<br/>
        addpl   r4,r4,r12        @ update again if error positive
<br/>
        addpl   r3,r3,r5         @ move diagonal if error positive
<br/>
        subs    r8,r8,#1         @ dec counter
<br/>
        bne     _0
<br/>
<br/>
        ldmfd   r13!,{r0-r12}
<br/>
        add     sp,sp,#8
<br/>
        bx      lr
<br/>
<br/>
@ ******** Draw a horizontal line ********
<br/>
<br/>
_2:     stmfd   r13!,{r2-r8}
<br/>
        mov     r5,r0
<br/>
        mov     r6,r1
<br/>
<br/>
        subs    r4,r2,r0
<br/>
        rsbmi   r4,r4,#0         @ make r4 positive
<br/>
        movmi   r5,r2
<br/>
        movmi   r6,r3            @ make r5,r6 left most point
<br/>
<br/>
        add     r4,r4,#1         @ r4 = pixel count
<br/>
<br/>
        ldr     r2,[r13,#36]     @ Get the color off stack
<br/>
        ldr     r8,[r13,#40]     @ Get the screen base address
<br/>
<br/>
@ calculate pixel address
<br/>
<br/>
        mov     r3,#480
<br/>
        mul     r7,r3,r6
<br/>
        add     r7,r7,r5,lsl #1
<br/>
        add     r3,r7,r8
<br/>
<br/>
        mov     r6,#4
<br/>
        add     r2,r2,r2,lsl #16
<br/>
        mov     r5,r4
<br/>
<br/>
        tsts    r3,#2            @ Is the start position 4 byte aligned?
<br/>
        bne     _5               @ no
<br/>
@ 4 byte aligned
<br/>
<br/>
        movs    r4,r4,lsr #1     @ Is there only 1 pixel?
<br/>
        beq     _h1p             @ yes, exit
<br/>
<br/>
@ Plot pixel [r3] with color r2
<br/>
_3:     str     r2,[r3],r6
<br/>
        subs    r4,r4,#1
<br/>
        bne     _3
<br/>
<br/>
        tsts    r5,#1            @ Is there an even number of pixels?
<br/>
        beq     _4               @ yes
<br/>
_h1p:
<br/>
        strh    r2,[r3]          @ plot one pixel
<br/>
<br/>
_4:     ldmfd   r13!,{r2-r8}
<br/>
        add     sp,sp,#8
<br/>
        bx      lr
<br/>
<br/>
@ not 4 byte aligned
<br/>
_5:
<br/>
        strh    r2,[r3],#2       @ plot first pixel
<br/>
<br/>
        movs    r4,r4,lsr #1     @ Is there only 1 pixel?
<br/>
        beq     _7               @ yes, exit
<br/>
<br/>
        cmps    r5,#2            @ Is there 2 pixels?
<br/>
        beq     _h2p             @ yes
<br/>
<br/>
@ Plot pixel [r3] with color r2
<br/>
_6:     str     r2,[r3],r6
<br/>
        subs    r4,r4,#1
<br/>
        bne     _6
<br/>
<br/>
        tsts    r5,#1            @ Is there an odd number of pixels?
<br/>
        bne     _7               @ yes
<br/>
_h2p:
<br/>
        strh    r2,[r3]          @ plot one pixel
<br/>
<br/>
_7:     ldmfd   r13!,{r2-r8}
<br/>
        add     sp,sp,#8
<br/>
        bx      lr
<br/>
<br/>
@ ******** Draw a vertical line ********
<br/>
<br/>
_8:     stmfd   r13!,{r2-r8}
<br/>
        mov     r5,r0
<br/>
        mov     r6,r1
<br/>
<br/>
        subs    r4,r3,r1
<br/>
        rsbmi   r4,r4,#0         @ make r4 positive
<br/>
        movmi   r5,r2
<br/>
        movmi   r6,r3            @ make r5,r6 top most point
<br/>
<br/>
        add     r4,r4,#1         @ r4 = pixel count
<br/>
<br/>
        ldr     r2,[r13,#36]     @ Get the color off stack
<br/>
        ldr     r8,[r13,#40]     @ Get the screen base address
<br/>
<br/>
@ calculate pixel address
<br/>
<br/>
        mov     r3,#480
<br/>
        mul     r7,r3,r6
<br/>
        add     r7,r7,r5,lsl #1
<br/>
        add     r3,r7,r8
<br/>
<br/>
        mov     r5,#480
<br/>
<br/>
@ Plot pixel [r3] with color r2
<br/>
_9:     strh    r2,[r3],r5
<br/>
        subs    r4,r4,#1
<br/>
        bne     _9
<br/>
<br/>
        ldmfd   r13!,{r2-r8}
<br/>
        add     sp,sp,#8
<br/>
        bx      lr
<br/>
<br/>
@ r0 = line length
<br/>
@ send bit 7 of r0 to c flag
<br/>
@ stmcsia r1!,{r2-r9} &lt;- do 8 times
<br/>
@ send bit 6 of r0 to c flag
<br/>
@ stmcsia r1!,{r2-r9} &lt;- do 4 times
<br/>
@ send bit 5 of r0 to c flag
<br/>
@ stmcsia r1!,{r2-r9} &lt;- do 2 times
<br/>
@ ...
<br/>
@ send bit 0 of r0 to c flag
<br/>
@ strcsh r2,{r1},#2
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Enjoy and if someone make it faster and for mode 4 give back to me hehehe...<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17454 - Lupin - Mon Mar 08, 2004 5:28 pm</h4>
    <div class="postbody"><span class="postbody">he is requesting a horizontal line function... well, writing a horizontal line function in mode3 is very easy actually but i don't have any code here.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17459 - Miked0801 - Mon Mar 08, 2004 8:11 pm</h4>
    <div class="postbody"><span class="postbody">The reason I put the poly thing up is that is the next logical step to ask for (doing so gratis breaking the unspoken forum rules of no give - no take.)
<br/>
<br/>
1. Get a pixel plotter
<br/>
2. Get a horizontal line drawer
<br/>
3. Get a fast any line drawer
<br/>
4. Use 3 to create an edge list and use 2 to fill it.
<br/>
<br/>
Instant convex poly filler.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17461 - mathieu - Mon Mar 08, 2004 8:42 pm</h4>
    <div class="postbody"><span class="postbody">I have been wondering... What is the use of drawing the edges when you fill up the polygons with horizontal color lines anyway ?
<br/>
<br/>
(I'm so clueless when it comes to 3D...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17462 - jma - Mon Mar 08, 2004 9:23 pm</h4>
    <div class="postbody"><span class="postbody">You don't. Just the algorithm used for finding the edge is how you know where to start and stop the line.
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17487 - batblaster - Tue Mar 09, 2004 2:31 pm</h4>
    <div class="postbody"><span class="postbody">Hi jma, do you have the implementation of bresenham line drawing in mode4 ??? I read somethings on your Basic routine...
<br/>
<br/>
Thanks...<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17495 - FluBBa - Tue Mar 09, 2004 4:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@ ******** Draw a vertical line ********
<br/>
<br/>
_8:     stmfd   r13!,{r2-r3}
<br/>
                                 @ r0=r2=X1=X2, r1=Y1, r3=Y2
<br/>
        subs    r2,r3,r1         @ r2=height
<br/>
        rsbmi   r2,r2,#0         @ make r2 positive
<br/>
        movmi   r1,r3            @ make r1 top most Y value
<br/>
<br/>
@ calculate pixel address
<br/>
<br/>
        rsb     r1,r1,r1,lsl #4  @ r1=Y*15
<br/>
        add     r0,r0,r1,lsl #4  @ r0=Y*240 + X
<br/>
        ldr     r1,[r13,#20]     @ Get the screen base address (changes depending on stack pointer)
<br/>
        add     r0,r1,r0,lsl #1  @ r0=Y*480 + X*2 + base
<br/>
<br/>
        ldr     r1,[r13,#16]     @ Get the color off stack (changes depending on stack pointer)
<br/>
<br/>
        mov     r3,#480          @ bytes per row
<br/>
<br/>
@ Plot pixel [r0] with color r4
<br/>
_9:     strh    r1,[r0],r3
<br/>
        subs    r2,r2,#1
<br/>
        bpl     _9               @ instead of bne so a lenght of 0 doesn't screw up the loop
<br/>
<br/>
        ldmfd   r13!,{r2-r3}
<br/>
        add     sp,sp,#8
<br/>
        bx      lr </td> </tr></table><span class="postbody">
<br/>
Not much speed difference if the the line is long, not sure that you should need to conserve r2 &amp; r3 ?
<br/>
Might give the Horizontal version a go also.<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17507 - batblaster - Tue Mar 09, 2004 7:18 pm</h4>
    <div class="postbody"><span class="postbody">Yes but how i can do to use this routine on mode 4 ?? I'm sorry if i'm stupid but i've tried to convert without luck...
<br/>
<br/>
thanks...<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
