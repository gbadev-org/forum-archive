<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>strb doesn't seem to work - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>ASM > strb doesn't seem to work</h2>
<div id="posts">
<div class="post">
    <h4>#77950 - HyperHacker - Tue Apr 04, 2006 5:11 am</h4>
    <div class="postbody"><span class="postbody">This little piece of code here, on the DS's ARM9 in ARM:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ldr r3, =0xEEEEEEEE
<br/>
strb r3, [r1, #1]!</td> </tr></table><span class="postbody">
<br/>
always seems to store 0 at r1. Doesn't appear to make any difference what I do to r3. Making it a str instead of strb does it fine, but that's not what I need to do. r1 is word-aligned.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#77954 - poslundc - Tue Apr 04, 2006 5:38 am</h4>
    <div class="postbody"><span class="postbody">The address format you're using is doing pre-indexing. This means it's adding 1 to r1 <span style="font-style: italic">before</span> it stores out the value, so you're going to write out to 1 byte further ahead in memory than what you're intending.
<br/>
<br/>
You want to use a post-indexing format:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">strb    r3, [r1], #1</td> </tr></table><span class="postbody">
<br/>
<br/>
You should be able to achieve the same effect with the writeback flag:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">strb    r3, [r1]!</td> </tr></table><span class="postbody">
<br/>
<br/>
... but I've run into trouble with it not always behaving as I expect it to depending on the opcode I'm using, so I almost always explicitly specify the amount to post-index in the writeback.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#77955 - DekuTree64 - Tue Apr 04, 2006 5:40 am</h4>
    <div class="postbody"><span class="postbody">You do know that putting the #1 inside the brackets means pre-indexing, right? So the byte will be stored at r1 + 1, and then the ! says to write that address back to r1. Or is it just not storing anything at all?
<br/>
<br/>
EDIT: Curse you, Dan.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#77958 - HyperHacker - Tue Apr 04, 2006 6:08 am</h4>
    <div class="postbody"><span class="postbody">I used pre-indexing because if I just did <span style="font-style: italic">strb r3, [r1]!</span> it seemed to not increment at all. (Doesn't the ! mean to add the index amount? So if you don't specify one, then it's adding zero.) I tried subtracting one from r1 before doing the store to compromise, but it's not helping. It just always seems to store zero.
<br/>
<br/>
...Shoot. You can't do 8-bit writes to DS VRAM, can you? &gt;_&lt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#77966 - gladius - Tue Apr 04, 2006 7:50 am</h4>
    <div class="postbody"><span class="postbody">Vram needs 16 bit writes.
<br/>
<br/>
strb r0,[r1]! does not increment r1, it is the semantic equivalent of strb r0,[r1,#0]! which does nothing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#78050 - HyperHacker - Tue Apr 04, 2006 9:56 pm</h4>
    <div class="postbody"><span class="postbody">Bah, I knew it was some stupid mistake like that. (Can you do 32 bit writes? Just curious.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#78073 - poslundc - Wed Apr 05, 2006 12:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Bah, I knew it was some stupid mistake like that. (Can you do 32 bit writes? Just curious.)</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, although memory is still only being accessed 16 bits at a time.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
