<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>strb and strh - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>ASM > strb and strh</h2>
<div id="posts">
<div class="post">
    <h4>#11023 - jimmy-bucket - Tue Sep 23, 2003 6:32 pm</h4>
    <div class="postbody"><span class="postbody">Hi all, ive been playing around with GBA asm for a while and I'm currently trying to plot pixels on the screen.
<br/>
<br/>
I did try using str, but it plotted one pixel, and set the ajacent one black, no good when overlayed over another line.
<br/>
<br/>
I'm using strb and it plots just the single pixel (or line of them) but turns the pixels a different colour. Here is the code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
@include screen.h
<br/>
; Setup screen
<br/>
ldr r1,=REG_DISPCNT
<br/>
ldr r2,=(MODE_3|BG2_ENABLE)
<br/>
str r2,[r1]
<br/>
; red pixel, screen cordinates and amount
<br/>
ldr r1,=0x00F
<br/>
ldr r0,=VRAM+2410
<br/>
ldr r10,=230
<br/>
; draws a horizontal line
<br/>
label2:
<br/>
strh r1,[r0]+2!
<br/>
subs r10, r10, 1
<br/>
bne label2
<br/>
<br/>
ldr r0,=VRAM+2410
<br/>
ldr r10,=150
<br/>
; draws a vertical line but the colours are wrong
<br/>
label1:
<br/>
strb r1,[r0]+480!
<br/>
subs r10, r10, 1
<br/>
bne label1
<br/>
<br/>
infiniteloop
<br/>
b infiniteloop
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
How can i have a single pixel of the same colour?
<br/>
<br/>
Thanks, Kieren</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11026 - DekuTree64 - Tue Sep 23, 2003 7:34 pm</h4>
    <div class="postbody"><span class="postbody">Why are you using strh on the horizontal line and strb on the vertical? Pixels in mode3 are 2 bytes each, so just replace the strb on the vertical with strh and everything should be fine.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11027 - jimmy-bucket - Tue Sep 23, 2003 7:39 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the help, but that doesnt work... it returns an
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">error : line 29 : operand size conflict
<br/>
        strh r1,[r0+480]!</td> </tr></table><span class="postbody">
<br/>
<br/>
error... i know i need to load 2 bytes of data, because its one pixel, but ldrh doesnt work!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11036 - tepples - Wed Sep 24, 2003 12:04 am</h4>
    <div class="postbody"><span class="postbody">I don't think [some of the load/store instructions] can be used with as many addressing modes as the others.
<br/>
<br/>
EDIT: I was wrong as to which were which.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Thu Sep 25, 2003 1:38 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#11045 - torne - Wed Sep 24, 2003 11:20 am</h4>
    <div class="postbody"><span class="postbody">The number '480' is too big to use as a preincrement in a strh instruction. You will have to restructure your code so that preincrements are not used or are smaller.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11051 - jimmy-bucket - Wed Sep 24, 2003 6:16 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, I was playing arond with my syntax after I posted last night.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">strh r1,[r0]
<br/>
add r0, r0, 480</td> </tr></table><span class="postbody">
<br/>
<br/>
That seems to work, but I don't understand why a +480! writeback works with ldr and ldrb but not h.
<br/>
<br/>
Any suggestions?
<br/>
<br/>
Kieren</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11052 - DekuTree64 - Wed Sep 24, 2003 7:28 pm</h4>
    <div class="postbody"><span class="postbody">ldr and ldrb are the same instruction, just with a different 'parameter', for byte or word, so you can use the same addressing modes with either of them. They allow a shifted register/shifted 8-bit immediate, so 480 is actually stored as 240&lt;&lt;1, because 240 fits in 8 bits. ldrh/ldrsh/ldrsb are all forms of the ldrh instruction, which is different than ldr, because there aren't enough bits in the ldr instruction to include all those variations. ldrh doesn't have a shift value, so you can only have immediate offsets that fit into 8 bits, and 480 doesn't.
<br/>
So yeah, there's not much way of getting around doing a seperate add.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
