<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Beginner pixel plotting problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Beginner pixel plotting problem</h2>
<div id="posts">
<div class="post">
    <h4>#5674 - bakery2k - Mon May 05, 2003 8:34 pm</h4>
    <div class="postbody"><span class="postbody">I am currently taking my first steps into GBA assembly, using gbaguy's tutorials. I have performed a small modification to tutorial 1, in order to get it to display a line of pixels, rather than just a single one.
<br/>
<br/>
However, I do not get 32 consecutive pixels lit, rather 17 with a gap between each. On changing the address increment value to 4, I get the 32 pixels, with a gap between each. What have I done wrong?
<br/>
<br/>
Here is my code:
<br/>
<br/>
@include screen.h
<br/>
@textarea
<br/>
<br/>
;Set mode 3, enabling BG2
<br/>
ldr r1,=REG_DISPCNT
<br/>
ldr r2,=(BG2_ENABLE|MODE_3)
<br/>
str r2,[r1]
<br/>
<br/>
;Load color (green) into r1
<br/>
ldr r1,=(0x1F &lt;&lt; 5)
<br/>
<br/>
;Load address into r2
<br/>
ldr r2,=vram+2410
<br/>
<br/>
;Load number of pixels to fill into r3
<br/>
ldr r3,=0x20
<br/>
<br/>
<br/>
startloop:
<br/>
<br/>
;Paint pixel
<br/>
str r1,[r2]
<br/>
<br/>
;update position
<br/>
add r2, r2, 2
<br/>
<br/>
;Update loop
<br/>
subs r3, r3, 1
<br/>
<br/>
;branch if non-zero
<br/>
bne startloop
<br/>
<br/>
<br/>
;Infinite loop
<br/>
label1
<br/>
B label1
<br/>
<br/>
@pool
<br/>
@endarea
<br/>
<br/>
Thanks for your help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5675 - niltsair - Mon May 05, 2003 8:46 pm</h4>
    <div class="postbody"><span class="postbody">As you could read on the Beginer Forum Faq, video memory is only accessible in 16/32bits. Which mean that you need to write 2/4pixel at a time.
<br/>
<br/>
So write 2 pixels at a time and increment your pointer by 2.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5677 - bakery2k - Mon May 05, 2003 9:10 pm</h4>
    <div class="postbody"><span class="postbody">As far as I was aware, I was accessing video memory 16bits at a time, i.e. a pixel at a time.
<br/>
It seems I was actually accessing it 32 bits at a time, since the following works:
<br/>
<br/>
;Load color (green) into r1
<br/>
ldr r1,=((0x1F &lt;&lt; 5) | (0x1F &lt;&lt; 21))
<br/>
<br/>
...
<br/>
<br/>
startloop:
<br/>
<br/>
;Paint pixel
<br/>
str r1,[r2]
<br/>
<br/>
;update position
<br/>
add r2, r2, 4
<br/>
<br/>
;Update loop
<br/>
subs r3, r3, 1
<br/>
<br/>
;branch if non-zero
<br/>
bne startloop
<br/>
<br/>
How do I access vram a pixel at a time?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5679 - niltsair - Mon May 05, 2003 9:38 pm</h4>
    <div class="postbody"><span class="postbody">Ah, yes.
<br/>
<br/>
I think the problem is, you're using 32bits registers with 32bits command. 
<br/>
<br/>
Look for a 'Ldr' that only works on 16bits. I don't know the exact name for it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5683 - Touchstone - Mon May 05, 2003 10:45 pm</h4>
    <div class="postbody"><span class="postbody">LDRH (Load register halfword, 16bit)
<br/>
LDRB (Load register byte, 8bit)<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5698 - bakery2k - Tue May 06, 2003 11:32 am</h4>
    <div class="postbody"><span class="postbody">Thanks.
<br/>
<br/>
What I actually needed was STRH, i.e. send a 16 bit value to vram, rather than loading the register with a 16 bit value.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
