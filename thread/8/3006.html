<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Need a ASM Draw PlotPixel function - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>ASM > Need a ASM Draw PlotPixel function</h2>
<div id="posts">
<div class="post">
    <h4>#17438 - Gordon - Mon Mar 08, 2004 5:16 am</h4>
    <div class="postbody"><span class="postbody">Need a ASM Draw Plot Pixel function in Mode3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17440 - DekuTree64 - Mon Mar 08, 2004 6:02 am</h4>
    <div class="postbody"><span class="postbody">As you may have seen, there was a nice post going on about plotting pixels in mode4. Mode3 is much simpler, I'll have a go at doing a fast one.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@r0 = x
<br/>
@r1 = y
<br/>
@r2 = color
<br/>
.global PlotPixel
<br/>
.arm
<br/>
.align 2
<br/>
.section .iwram, "ax", %progbits
<br/>
PlotPixel:
<br/>
rsb   r1, r1, r1, LSL #4    @r1 = y*15
<br/>
add   r1, r0, r1, LSL #5    @r1 = x+y*15*32 = x+y*480
<br/>
add   r0, r0, #0x6000000  @r0 = x+VRAM base
<br/>
strh   r2, [r0, r1]            @this comes out to VRAM base+x*2+y*480
<br/>
bx     lr</td> </tr></table><span class="postbody">
<br/>
What do you think? Aside from inlining to get rid of the bx, I don't see how you could do it any faster.
<br/>
As for your horizontal line post, you might want to try doing that one yourself. I'd be happy to give it a try later, but it's a pretty simple problem and could be optimized quite nicely. A very good chance to practice. A few tips: First, get your base address similar to this pixel plotter. Then store with writeback on the first pixel before going into a loop. That way you can use strh r2, [r0, #2]! for each consecutive pixel.
<br/>
Or you can orr the color into the upper 16 bits and store 2 pixels at a time. You'll have to check for odd endpoints though.
<br/>
Also, unroll your loop a few times to save a lot of comparing.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
