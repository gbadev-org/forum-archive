<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Nested interrupts, "Undefined" instruction? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Nested interrupts, "Undefined" instruction?</h2>
<div id="posts">
<div class="post">
    <h4>#177835 - WriteASM - Sun Mar 31, 2013 12:54 pm</h4>
    <div class="postbody"><span class="postbody">Does anyone know if nested interrupts are possible when the CPU is in IRQ mode?  In my experience, if the CPU gets hung in IRQ mode, then interrupts don't work.  GBA PanDocs say, "If user wants to allow nested interrupts, save SPSR_irq, then enable IRQs."  Perhaps the interrupt handler needs to be in a different CPU mode?  If so, how do I ensure that the CPU runs the ARM subset when switching to modes that might have been running THUMB?
<br/>
<br/>
Also, can the "ARM7TDMI Undefined Instruction" trap be used in the GBA?  According to VisualBoyAdvance, the BIOS has a branch instruction at the trap's address of $00000004, but the GBA documentation that I have doesn't mention any interface for the trap.  If the undefined instruction trap is useable, can the unused bits in the instruction be set to a custom value?  ("User SWI")  
<br/>
<br/>
Thanks for any help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177842 - WriteASM - Fri Apr 05, 2013 12:50 pm</h4>
    <div class="postbody"><span class="postbody">OK, I've figured it out.  To enable nested interrupts, the "IRQ" disable bit in the CPSR must be cleared in the interrupt service routine.  (That makes a third interrupt enable.)
<br/>
<br/>
And the "Undefined instruction" trap is reserved for Nintendo's hardware debugger.  Oh, well...<br/>_________________<br/>"Finally, brethren, whatever is true, whatever is honorable, whatever is right, whatever is pure, whatever is lovely, whatever is of good repute, if there is any excellence and if anything worthy of praise, dwell on these things." (Philippians 4:8)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
