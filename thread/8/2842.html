<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Using ASM mixed wih C (external files) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>ASM > Using ASM mixed wih C (external files)</h2>
<div id="posts">
<div class="post">
    <h4>#16234 - x86asm - Wed Feb 11, 2004 1:37 am</h4>
    <div class="postbody"><span class="postbody">Hi, I'm surprised at how easy ARM7 assembly is, I would like to try and use it along with C, just to try programming an embedded system. I have a few questions (I use VisualHAM) and prefer to use external ASM files (less red tape)
<br/>
<br/>
1. How do I declare say a 32-bit variable in an ASM source file, I tried .DCD but didnt work for me :*(
<br/>
<br/>
2. How would I reference external variables in C source files (using the .EXTERN keyword?)
<br/>
<br/>
3. How do you get the C compiler to compile THUMB code instead of ARM code? 
<br/>
<br/>
These are the only two stumbling blocks I have come across (kind of embarassing actually :) ), but with your guys help I can get back on track.<br/>_________________<br/>Hello Everyone :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16240 - poslundc - Wed Feb 11, 2004 3:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>x86asm wrote:</b></span></td> </tr> <tr> <td class="quote">Hi, I'm surprised at how easy ARM7 assembly is, I would like to try and use it along with C, just to try programming an embedded system. I have a few questions (I use VisualHAM) and prefer to use external ASM files (less red tape)
<br/>
<br/>
1. How do I declare say a 32-bit variable in an ASM source file, I tried .DCD but didnt work for me :*(</td> </tr></table><span class="postbody">
<br/>
<br/>
Declare a label where you want your variable, then use the .word directive. Check out the GAS ARM asm reference (downloadable from <a class="postlink" href="http://re-eject.gbadev.org/" target="_blank">http://re-eject.gbadev.org/</a>) for a bunch of other directives.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">2. How would I reference external variables in C source files (using the .EXTERN keyword?)</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   ldr   r0, GLOBALS      @ r0 &lt;- pointer to myCVariable
<br/>
   ldr   r0, [r0]      @ r0 &lt;- myCVariable
<br/>
GLOBALS:
<br/>
   .word   myCVariable</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">3. How do you get the C compiler to compile THUMB code instead of ARM code?</td> </tr></table><span class="postbody">
<br/>
<br/>
Use the -mthumb command-line switch when calling gcc with your input files. To write Thumb code in assembler, precede your code with the .thumb directive.
<br/>
<br/>
Cheers,
<br/>
<br/>
Dan (did I win?).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16242 - torne - Wed Feb 11, 2004 3:17 am</h4>
    <div class="postbody"><span class="postbody">One further thing to remember: if you want to be able to call thumb from ARM and vice versa, then all your C modules need to be compiled with -mthumb-interwork, and you must use interworking return sequences in your assembly code. Read the ARM/Thumb procedure call standard (and previous posts in this forum) for details.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16296 - x86asm - Wed Feb 11, 2004 10:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>x86asm wrote:</b></span></td> </tr> <tr> <td class="quote">Hi, I'm surprised at how easy ARM7 assembly is, I would like to try and use it along with C, just to try programming an embedded system. I have a few questions (I use VisualHAM) and prefer to use external ASM files (less red tape)
<br/>
<br/>
1. How do I declare say a 32-bit variable in an ASM source file, I tried .DCD but didnt work for me :*(</td> </tr></table><span class="postbody">
<br/>
<br/>
Declare a label where you want your variable, then use the .word directive. Check out the GAS ARM asm reference (downloadable from <a class="postlink" href="http://re-eject.gbadev.org/" target="_blank">http://re-eject.gbadev.org/</a>) for a bunch of other directives.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">2. How would I reference external variables in C source files (using the .EXTERN keyword?)</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   ldr   r0, GLOBALS      @ r0 &lt;- pointer to myCVariable
<br/>
   ldr   r0, [r0]      @ r0 &lt;- myCVariable
<br/>
GLOBALS:
<br/>
   .word   myCVariable</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">3. How do you get the C compiler to compile THUMB code instead of ARM code?</td> </tr></table><span class="postbody">
<br/>
<br/>
Use the -mthumb command-line switch when calling gcc with your input files. To write Thumb code in assembler, precede your code with the .thumb directive.
<br/>
<br/>
Cheers,
<br/>
<br/>
Dan (did I win?).</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I what you suggested and it worked, but trying it in VisualHAM's debugger, it crashes with illegal instruction, I guess I need to jump somewhere cause its trying to execute what is in the variable. Thanks alot posluns, explains alot ;)<br/>_________________<br/>Hello Everyone :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16297 - poslundc - Wed Feb 11, 2004 11:18 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, you need to stick your variables somewhere close enough to your code that they can be referenced local to the program counter but still somewhere they won't get executed. :P
<br/>
<br/>
So usually that means sticking them after the end of a function or routine, after you bx lr.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16348 - x86asm - Fri Feb 13, 2004 2:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Yeah, you need to stick your variables somewhere close enough to your code that they can be referenced local to the program counter but still somewhere they won't get executed. :P
<br/>
<br/>
So usually that means sticking them after the end of a function or routine, after you bx lr.
<br/>
<br/>
Dan.</td> </tr></table><span class="postbody">
<br/>
<br/>
Hey thats fixes everything thanks a bunch! BTW, I'm a high school student looking to enter the software programming field and I noticed that on your page you were educated at McMaster U, how was it there and how is the software programming job market here in Toronto? 
<br/>
<br/>
Thanks ;)<br/>_________________<br/>Hello Everyone :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16352 - poslundc - Fri Feb 13, 2004 3:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>x86asm wrote:</b></span></td> </tr> <tr> <td class="quote">BTW, I'm a high school student looking to enter the software programming field and I noticed that on your page you were educated at McMaster U, how was it there and how is the software programming job market here in Toronto? </td> </tr></table><span class="postbody">
<br/>
<br/>
Ugh, you don't want to know... :P Go to college instead and maybe get yourself a real job. Or not. It depends on what you're interested in doing, I guess.
<br/>
<br/>
If you really want to know the ugly details, send me an e-mail and I'll relate it to you.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
