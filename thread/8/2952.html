<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>20 12 fixed mult -  sharing registers? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > 20 12 fixed mult -  sharing registers?</h2>
<div id="posts">
<div class="post">
    <h4>#17041 - corranga - Sun Feb 29, 2004 12:55 pm</h4>
    <div class="postbody"><span class="postbody">I'm working on 20 12 fixed point multiplication now (after discovering my current routine was only working out the whole number part and no fraction!
<br/>
<br/>
I used to use the routine below when I dabbled a little into mips asm for the sony playstation:
<br/>
<br/>
//multiply the numbers together
<br/>
mult a0, a1
<br/>
//store the low part in v0
<br/>
mflo v0
<br/>
//and the high in v1
<br/>
mfhi v1
<br/>
// shift the high part into place 
<br/>
srl t0,v0,12
<br/>
// and the low part
<br/>
sll t1,v1,20	
<br/>
// or them together for the answer
<br/>
or   v0,t0,t1
<br/>
<br/>
is it possible to do something similar on the gba?
<br/>
<br/>
Essentially i'm asking how to do, 32bit * 32bit = 64bit (in 2 32 bit registers) if it is possible
<br/>
<br/>
If it can't be done, can someone point me in the direction of a fixed point 20 12 routine that I can modify / use.  I'm going bald having worked on this for about 3 weeks!
<br/>
<br/>
Chris<br/>_________________<br/>If virtual reality is ever on a par with reality, I want to be Bomberman! :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17046 - Lupin - Sun Feb 29, 2004 2:13 pm</h4>
    <div class="postbody"><span class="postbody">i think the instruction is mull or smull (i think it's both the same, not sure maybe mull doesn't even exist).
<br/>
<br/>
Maybe someone got an explanation about how to use the instruction.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17051 - Paul Shirley - Sun Feb 29, 2004 2:44 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:05 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#17052 - Lupin - Sun Feb 29, 2004 2:59 pm</h4>
    <div class="postbody"><span class="postbody">but he asked for asm :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17053 - Large Metal Teeth - Sun Feb 29, 2004 3:06 pm</h4>
    <div class="postbody"><span class="postbody">No need for 16-bit partials.  There is a 32 * 32 = 64 bit instruction like Lupin said.  It is an ARM mode only instruction
<br/>
<br/>
SMULL is signed multiply long.
<br/>
UMULL is unsigned multiply long.
<br/>
<br/>
It takes four register operands (some of which can overlap):  2 dests and 2 sources.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17072 - tepples - Sun Feb 29, 2004 6:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Paul Shirley wrote:</b></span></td> </tr> <tr> <td class="quote">Easiest way: use <span style="font-weight: bold">long long</span> variables and let the compiler sort it out for you.</td> </tr></table><span class="postbody">
<br/>
Are you sure that GCC will generate proper 'smull' instructions for s32xs32=s64 multiplies rather than sign-extending the s32s to s64 and then doing s64xs64=s64 using a library call? If it varies by version, which version are you using?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17142 - corranga - Tue Mar 02, 2004 9:59 am</h4>
    <div class="postbody"><span class="postbody">Thanks very much to all you guys.  I knew about the long long, and therefore presumed there was some form of asm instruction to do something with 64 bits.
<br/>
<br/>
I used smull and (I think) it works fine
<br/>
<br/>
Chris<br/>_________________<br/>If virtual reality is ever on a par with reality, I want to be Bomberman! :D</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
