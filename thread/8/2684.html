<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ASM Line Drawing Routine - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > ASM Line Drawing Routine</h2>
<div id="posts">
<div class="post">
    <h4>#15106 - frag - Sat Jan 17, 2004 6:15 am</h4>
    <div class="postbody"><span class="postbody">Does anyone have an implementation of Bresenham's line algorithm (or whatever) written in asm using Mode 4 pixels, handy? (really specific request... sorry.  :) )
<br/>
<br/>
I'm starting to run into speed problems with a mode 4 vector program I'm working on.  I have a starfield in the background of the vector graphics and I don't know if a dirty rectangle scheme would be efficient with such a setup.
<br/>
<br/>
I'm hoping someone out there has an asm line drawing routine they'd be willing to share so I can see if that will help with the speed.
<br/>
<br/>
If worse comes to worse I'll just drop the starfield and use dirty rectangles but I like my starfield ;)  So I want to see what other options there are first.
<br/>
<br/>
Any help would be greatly appreciated!
<br/>
<br/>
Thanks,
<br/>
Frag</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15110 - momo - Sat Jan 17, 2004 10:48 am</h4>
    <div class="postbody"><span class="postbody">I have written a Bresenham-Routine for Goldroad, I thinks it was  for mode-4 (Because, its easy to Change it). Look at my small Homepage :)
<br/>
<br/>
<a href="http://www.angelfire.com/droid/goldmomo/" target="_blank">http://www.angelfire.com/droid/goldmomo/</a>
<br/>
<br/>
(Press on the English Flag, for English (or notr if you can read german :) ))</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16870 - Gordon - Thu Feb 26, 2004 5:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/////////////////////Line//////////////////////////
<br/>
//An implementation of the Bresenham Line algorithm
<br/>
void Line(int x1, int y1, int x2, int y2, u16 color)
<br/>
{
<br/>
   //Variables
<br/>
   int i, deltax, deltay, numpixels;
<br/>
   int d, dinc1, dinc2;
<br/>
   int x, xinc1, xinc2;
<br/>
   int y, yinc1, yinc2;
<br/>
<br/>
   //Calculate deltaX and deltaY
<br/>
   deltax = abs(x2 - x1);
<br/>
   deltay = abs(y2 - y1);
<br/>
<br/>
   //Init vars
<br/>
   if(deltax &gt;= deltay)
<br/>
   {
<br/>
      //If x is independent variable
<br/>
      numpixels = deltax + 1;
<br/>
      d = (2 * deltay) - deltax;
<br/>
      dinc1 = deltay &lt;&lt; 1;
<br/>
      dinc2 = (deltay - deltax) &lt;&lt; 1;
<br/>
      xinc1 = 1;
<br/>
      xinc2 = 1;
<br/>
      yinc1 = 0;
<br/>
      yinc2 = 1;
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      //If y is independant variable
<br/>
      numpixels = deltay + 1;
<br/>
      d = (2 * deltax) - deltay;
<br/>
      dinc1 = deltax &lt;&lt; 1;
<br/>
      dinc2 = (deltax - deltay) &lt;&lt; 1;
<br/>
      xinc1 = 0;
<br/>
      xinc2 = 1;
<br/>
      yinc1 = 1;
<br/>
      yinc2 = 1;
<br/>
   }
<br/>
<br/>
   //Move the right direction
<br/>
   if(x1 &gt; x2)
<br/>
   {
<br/>
      xinc1 = -xinc1;
<br/>
      xinc2 = -xinc2;
<br/>
   }
<br/>
   if(y1 &gt; y2)
<br/>
   {
<br/>
      yinc1 = -yinc1;
<br/>
      yinc2 = -yinc2;
<br/>
   }
<br/>
<br/>
   x = x1;
<br/>
   y = y1;
<br/>
<br/>
   //Draw the pixels
<br/>
   for(i = 1; i &lt; numpixels; i++)
<br/>
   {
<br/>
      PlotPixel(x, y, color);
<br/>
<br/>
      if(d &lt; 0)
<br/>
      {
<br/>
         d = d + dinc1;
<br/>
         x = x + xinc1;
<br/>
         y = y + yinc1;
<br/>
      }
<br/>
      else
<br/>
      {
<br/>
         d = d + dinc2;
<br/>
         x = x + xinc2;
<br/>
         y = y + yinc2;
<br/>
      }
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Code downloaded from staringmonkey's Demo Readme
<br/>
Saturday, September 08, 2001
<br/>
<a href="mailto:staringmonkey@hotmail.com">staringmonkey@hotmail.com</a></td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16872 - poslundc - Thu Feb 26, 2004 5:40 am</h4>
    <div class="postbody"><span class="postbody">No offense, Gordon, but that's not exactly assembly code... ;)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16875 - torne - Thu Feb 26, 2004 6:33 am</h4>
    <div class="postbody"><span class="postbody">So run it through gcc -O2 -S. *grin*</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17254 - batblaster - Fri Mar 05, 2004 2:45 am</h4>
    <div class="postbody"><span class="postbody">I'm Sorry to disturb but the routine showed are only for mode 3 the plotpixel function did not work on mode 4 , mode 4 are addressed like (u16*) pointer but work on 8bit color go from 0 to 255 and you need to check if the point you want to plot are odd or even... I'm writing a good plot pixel for mode 4 but at the moment did not work...<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17255 - batblaster - Fri Mar 05, 2004 2:50 am</h4>
    <div class="postbody"><span class="postbody">This is an asm routine to plot pixel maded by MrMr[iCE]
<br/>
<br/>
i founded in a collection of sources enjoy and tell me if someone make a good modify... Work on 120 x 160
<br/>
<br/>
<br/>
	.SECTION    .iwram, "ax", %progbits
<br/>
<br/>
	.GLOBAL plotPixels
<br/>
	.THUMB_FUNC
<br/>
<br/>
plotPixels:
<br/>
	push	{r1, r2, r4, r5, r6, r7}
<br/>
<br/>
	adr	r0, pixel_pool
<br/>
	ldmia	r0!, {r2-r5}				@@ r2 = screen array, r3 = loop count, r4 = vram, r5 = address mask
<br/>
<br/>
pixel_loop:
<br/>
	ldmia r2!, {r0, r1}
<br/>
<br/>
	cmp	r0, #120						@@ quick unsigned x/y range tests
<br/>
	bcs	next_pixel
<br/>
	cmp	r1, #160
<br/>
	bcs	next_pixel
<br/>
<br/>
	ldr	r6, =xbase
<br/>
	ldr	r7, [r6]
<br/>
	add	r7, r0
<br/>
	lsl	r1, #8
<br/>
	add	r7, r1
<br/>
	lsr	r1, #4
<br/>
	sub	r7, r1
<br/>
	and	r7, r5
<br/>
<br/>
	ldrh	r1, [r4, r7]				@@ load pixel pair from vram
<br/>
	mov	r6, #0xFF
<br/>
	lsr   r0, #1						@@ use x to test for odd/even masks
<br/>
	mov	r0, #13
<br/>
	bcc	plot2
<br/>
<br/>
	lsl	r0, #8
<br/>
	and	r1, r6
<br/>
	orr	r1, r0
<br/>
	b		draw_pixel	
<br/>
<br/>
plot2:
<br/>
	lsl	r6, #8
<br/>
	and	r1, r6
<br/>
	orr	r1, r0
<br/>
<br/>
draw_pixel:
<br/>
	strh	r1, [r4, r7]
<br/>
<br/>
next_pixel:
<br/>
	sub	r3, #1
<br/>
	bne	pixel_loop
<br/>
<br/>
	pop	{r1, r2, r4, r5, r6, r7}
<br/>
	mov	pc, lr
<br/>
<br/>
	.POOL
<br/>
	.ALIGN
<br/>
<br/>
pixel_pool:
<br/>
	.word screen
<br/>
	.word 1000
<br/>
	.word 0x600A000
<br/>
	.word 0xFFFFFFFE<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17261 - Large Metal Teeth - Fri Mar 05, 2004 4:51 am</h4>
    <div class="postbody"><span class="postbody">That code would be a lot better in ARM assembly.  In ARM mode you can use conditional instructions to get rid of all those branches except for maybe a loop branch.
<br/>
<br/>
-Teeth</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17270 - batblaster - Fri Mar 05, 2004 3:22 pm</h4>
    <div class="postbody"><span class="postbody">Is not mine but if you have a better rotine post here for everyone...<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17273 - poslundc - Fri Mar 05, 2004 3:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Large Metal Teeth wrote:</b></span></td> </tr> <tr> <td class="quote">That code would be a lot better in ARM assembly.  In ARM mode you can use conditional instructions to get rid of all those branches except for maybe a loop branch.</td> </tr></table><span class="postbody">
<br/>
<br/>
It would also take advantage of 32-bit loading from IWRAM (since that's the section it was put in.)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
