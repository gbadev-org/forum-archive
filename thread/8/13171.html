<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>structures in GNU as? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > structures in GNU as?</h2>
<div id="posts">
<div class="post">
    <h4>#128315 - kusma - Thu May 10, 2007 3:20 pm</h4>
    <div class="postbody"><span class="postbody">I've been looking at porting Goomba to the GNU toolchains, and I'm currently having issues with the assembly-sources using structures. I can't seem to find any easy way of converting those to GNU as. Does anyone know any tricks I could use? The syntax of the structures in armasm that I'm trying to rewrite is the following:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">MAP 0,gb_zpage
<br/>
xgb_ram # 0x2000
<br/>
xgb_hram # 0x80
<br/>
chr_decode # 0x400
<br/>
oam_buffer1 # 0x200
<br/>
oam_buffer2 # 0x200
<br/>
oam_buffer3 # 0x200
<br/>
</td> </tr></table><span class="postbody">
<br/>
Where gb_zpage is defined as this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gb_zpage   RN r11 ;=XGB_RAM
<br/>
</td> </tr></table><span class="postbody">
<br/>
So, if I understand this correctly, something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">adr r2,chr_decode</td> </tr></table><span class="postbody">
<br/>
would bascily do:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">adr r2, [r11, 0x400]</td> </tr></table><span class="postbody">
<br/>
Right? Is there any way of doing things like this in GNU as?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128316 - kusma - Thu May 10, 2007 3:38 pm</h4>
    <div class="postbody"><span class="postbody">After disassembling the following armasm-code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gb_zpage   RN r11
<br/>
<br/>
 MAP 0,gb_zpage
<br/>
xgb_ram # 0x2000
<br/>
xgb_hram # 0x80
<br/>
chr_decode # 0x400
<br/>
oam_buffer1 # 0x200
<br/>
oam_buffer2 # 0x200
<br/>
oam_buffer3 # 0x200
<br/>
<br/>
 AREA rom_code, CODE, READONLY
<br/>
   adr r2,chr_decode
<br/>
 END
<br/>
</td> </tr></table><span class="postbody">
<br/>
I get this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ADD      r2,r11,#0x2080
<br/>
</td> </tr></table><span class="postbody">
<br/>
Not quite what I expected, I guess the values after the hash is lengths and not offsets. Still, anyone know of something similar in gcc, or do I need to rewrite this all to non-structs?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128320 - Dwedit - Thu May 10, 2007 4:16 pm</h4>
    <div class="postbody"><span class="postbody">I've already ported that part of Goomba Color to GCC, but I'm still stuck on other parts.  See the thread: <a href="http://forum.gbadev.org/viewtopic.php?t=12929" target="_blank">http://forum.gbadev.org/viewtopic.php?t=12929</a>
<br/>
<br/>
The problems I'm having now are basically "How do I make makefiles", "How do I make CRT0.S" and "How to I make linkscripts".<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128325 - kusma - Thu May 10, 2007 5:10 pm</h4>
    <div class="postbody"><span class="postbody">Okay, neat. I see we've taken to quite different approaches here. I've tried to keep a working build all the time, so I can verify that it works. I can't seem to get your code to compile at all. For instance wram_globals_start is only found in cart.s, gbz80.s and lcd.s. Where do you get the symbol from, and why isn't it declared anywhere?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128336 - Dwedit - Thu May 10, 2007 7:23 pm</h4>
    <div class="postbody"><span class="postbody">Because of a limitation of gnu assembler (ADR instruction does not support linking to other files), I ended up making a container file "all.s", which .includes each asm file.  I know that it's a very ugly and dirty hack, and completely negates the point of having separate source files.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
