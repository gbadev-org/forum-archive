<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Goldroad bug? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>ASM > Goldroad bug?</h2>
<div id="posts">
<div class="post">
    <h4>#8194 - funkeejeffou - Fri Jul 04, 2003 5:35 am</h4>
    <div class="postbody"><span class="postbody">Can't get to compile a load instructiun indexed and shifted :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ldr r0, [r1, r2, lsl#1]</td> </tr></table><span class="postbody">
<br/>
<br/>
Is it a syntax problem, or is it unimplemented in Goldroad?
<br/>
thanks to anyone who will help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8204 - TurboHz - Fri Jul 04, 2003 12:27 pm</h4>
    <div class="postbody"><span class="postbody">That must be a syntax problem. I've used that kind of adressing ... try replacing the "#" character with a " " (space).,</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8205 - Lupin - Fri Jul 04, 2003 12:34 pm</h4>
    <div class="postbody"><span class="postbody">ldr r0, [r1, r2, lsl #1]!
<br/>
<br/>
I think that's it</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8208 - funkeejeffou - Fri Jul 04, 2003 2:33 pm</h4>
    <div class="postbody"><span class="postbody">Hum... Neither works.
<br/>
Please TurboHz, if you've used that kind of adressing, could you just check the syntax in your code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8222 - GbaGuy - Fri Jul 04, 2003 7:18 pm</h4>
    <div class="postbody"><span class="postbody">Goldroad can be wierd sometimes...
<br/>
<br/>
Maybe put the ", lsl#1" outside of the []s?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8257 - funkeejeffou - Sat Jul 05, 2003 10:10 pm</h4>
    <div class="postbody"><span class="postbody">Nope, it's still not working...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8259 - Dev - Sun Jul 06, 2003 3:19 am</h4>
    <div class="postbody"><span class="postbody">Try using all caps on LSL and have a space between the , and #
<br/>
<br/>
i.e.   LDR R0,[R1,R2,LSL #1]
<br/>
<br/>
It's always possible that the assembler is looking for case-specific "LSL" ?
<br/>
<br/>
Either way, you're using a valid opcode format, and if it doesn't work, it's a bug...
<br/>
<br/>
Have you checked Goldroad's home page to see if it's a known issue?
<br/>
(I don't use GR myself, so I can't offer any advice on where to contact the author, sorry).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8266 - funkeejeffou - Sun Jul 06, 2003 2:19 pm</h4>
    <div class="postbody"><span class="postbody">Ok; found what it is by looking at some source codes :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ldr r0,[r1,r2,lsl #1]</td> </tr></table><span class="postbody">There is only one space after the lsl(so before the #1).
<br/>
This works for ldr and ldrb, but not for ldrh(and of course, it was the opcode that I used in my code).
<br/>
Is it normal that loading or storing a halfword with a shifted address doesn't work on the ARM processor?
<br/>
<br/>
By the way, let's say I load a 4 bytes value like this :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ldr r0,[r1,r2,lsl #1]</td> </tr></table><span class="postbody">
<br/>
then I store it
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">strh r0,[r1]</td> </tr></table><span class="postbody">
<br/>
<br/>
Will only the less significant bytes will be copied, or should I mask my value before storing it:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">and r0, r0, 0x0000FFFF</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks for all of you for helping me out</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8274 - torne - Sun Jul 06, 2003 7:51 pm</h4>
    <div class="postbody"><span class="postbody">This is normal. The ldrh, lrdsh, ldrsb, and the corresponding str instructions use a different addressing mode to normal load/store instructions, which only allows the following 6 addressing modes:
<br/>
Immediate offset: [&lt;Rn&gt;, #+/-&lt;offset_8&gt;]
<br/>
Register offset: [&lt;Rn&gt;, +/-&lt;Rm&gt;]
<br/>
Immediate preindexed: [&lt;Rn&gt;, #+/-&lt;offset_8&gt;]!
<br/>
Register preindexed: [&lt;Rn&gt;], +/-&lt;Rm&gt;
<br/>
Immediate postindexed: [&lt;Rn&gt;], #+/-&lt;offset_8&gt;
<br/>
Register postindexed: [&lt;Rn&gt;], +/-&lt;Rm&gt;
<br/>
<br/>
The normal ldr/str instructions have all the above addressing modes, and also three more:
<br/>
Scaled register offset: [&lt;Rn&gt;, #+/-&lt;offset_8&gt;, &lt;shift&gt; #&lt;shift_imm&gt;]
<br/>
Scaled register preindexed: [&lt;Rn&gt;, #+/-&lt;offset_8&gt;, &lt;shift&gt; #&lt;shift_imm&gt;]!
<br/>
Scaled register postindexed: [&lt;Rn&gt;], #+/-&lt;offset_8&gt;, &lt;shift&gt; #&lt;shift_imm&gt;
<br/>
<br/>
Get a copy of the ARM Architectural Reference Manual from here: <a href="http://www.altera.com/literature/third-party/ddi0100e_arm_arm.pdf" target="_blank">http://www.altera.com/literature/third-party/ddi0100e_arm_arm.pdf</a> as it contains exact details of the ARM instruction set, from the official source. =)
<br/>
<br/>
As for your second question, if you store a halfword from a register, the bottom 16 bits will be stored, as if you had masked it. If the value is signed, use strsh, as otherwise the sign will be destroyed.
<br/>
<br/>
Torne</span><span class="gensmall"><br/><br/>Last edited by torne on Wed Aug 06, 2003 12:34 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#9458 - hzx - Tue Aug 05, 2003 1:27 pm</h4>
    <div class="postbody"><span class="postbody">I think I met with an error in GoldRoad. Please, report if I am wrong.
<br/>
<br/>
I have 3 files, main.asm, library.asm and predef.asm. Main.asm contains the main code, the library.asm contains the functions like PutPixel, etc., and predef.asm the predefined variable data. 
<br/>
<br/>
predef.asm:
<br/>
<br/>
variable1 @DCD 5, 5, 6, 6 
<br/>
variable2 @DCD ...
<br/>
<br/>
main.asm:
<br/>
<br/>
...
<br/>
@textarea 0x08000000 ; it seems to be necessary for defining data in the ROM space
<br/>
<br/>
...
<br/>
ldr r0, =variable1
<br/>
...
<br/>
<br/>
@include library.asm
<br/>
@include predef.asm
<br/>
@pool
<br/>
@endarea
<br/>
<br/>
When I load this code into the emulator and disassemble it, it gives:
<br/>
<br/>
...
<br/>
08000014 ldr r0, [$080001ac] (=$08000178)
<br/>
...
<br/>
08000178 mov pc, lr ; the last line of code in the library asm
<br/>
0800017c 00000005
<br/>
08000180 00000005
<br/>
08000184 00000006
<br/>
08000188 00000006
<br/>
...
<br/>
<br/>
So. As you can see in the 08000014 line, the ldr loads a constant from the pool. The constant should has the address of the first byte of variable1, thought, it hasn't. It contains a lower (illegal) address . Is it a bug or a feature?<br/>_________________<br/>.hzx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9461 - funkeejeffou - Tue Aug 05, 2003 2:19 pm</h4>
    <div class="postbody"><span class="postbody">Could you please put your entire code of the main.asm file?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9470 - momo - Tue Aug 05, 2003 4:42 pm</h4>
    <div class="postbody"><span class="postbody">@hzx
<br/>
<br/>
I have the the same problem with goldroad. If use the @pool keyword,
<br/>
goldroad get any adressproblems. So, I use no ldr xx,=xx Commands.
<br/>
The main problem is (I think), the goldroad development is stopped (no update since more then a year). There are much more problems, for example incbin and folders, wrong thumbcode check (add r0,r0,r9 is not possible but goldroad assemble it to sub r0,r0,r1), ....
<br/>
<br/>
I hope it comes a new Version of goldroad, because I dont like the gas/armasm Syntax.
<br/>
<br/>
Please forgive me, my bad English X)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9490 - hzx - Wed Aug 06, 2003 9:52 am</h4>
    <div class="postbody"><span class="postbody">@arm
<br/>
@fsize  32
<br/>
@include gba.asm
<br/>
<br/>
@textarea 0x02000000
<br/>
<br/>
     stack @DCD
<br/>
<br/>
@endarea
<br/>
<br/>
@textarea 0x08000000
<br/>
<br/>
     ldr r13, =stack                            ; setting up stack
<br/>
<br/>
     ldr r1, =REG_DISPCNT
<br/>
     ldr r2, =(BG2_ENABLE | MODE_3)
<br/>
     str r2, [r1]                                  ; init video mode
<br/>
<br/>
     ldr r0, =linenumber
<br/>
     add r0, r0, #4                             ; necessary because of goldroad bug
<br/>
     ldr r12, [r0]+4
<br/>
<br/>
   .loop
<br/>
     cmp r12, #0
<br/>
     beq labx
<br/>
     sub r12, r12, #1
<br/>
     ldr r1, [r0]+4
<br/>
     ldr r2, [r0]+4
<br/>
     ldr r3, [r0]+4
<br/>
     ldr r4, [r0]+4
<br/>
     mov r5, #255
<br/>
     bl DrawLine
<br/>
     b loop
<br/>
<br/>
  .labx:
<br/>
     b labx
<br/>
<br/>
@include predefs.asm
<br/>
@include library.asm
<br/>
<br/>
@pool
<br/>
@endarea<br/>_________________<br/>.hzx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9491 - hzx - Wed Aug 06, 2003 9:53 am</h4>
    <div class="postbody"><span class="postbody">Sorry, 
<br/>
<br/>
@include library.asm
<br/>
@include predefs.asm 
<br/>
<br/>
is the right order<br/>_________________<br/>.hzx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9510 - hzx - Wed Aug 06, 2003 9:29 pm</h4>
    <div class="postbody"><span class="postbody">It seems the misaddressing can be triggered variously:
<br/>
<br/>
subroutine1
<br/>
...
<br/>
subroutine2
<br/>
...
<br/>
sub2data @DCD 0,0,0,0
<br/>
<br/>
and 
<br/>
<br/>
subroutine1
<br/>
...
<br/>
sub2data @DCD 0,0,0,0
<br/>
subroutine2
<br/>
...
<br/>
<br/>
codes has the same problem, if they are present in an included file.<br/>_________________<br/>.hzx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9516 - funkeejeffou - Thu Aug 07, 2003 11:25 am</h4>
    <div class="postbody"><span class="postbody">I don't really understand your code organization, but some things seems wrong.
<br/>
<br/>
When you do not put a textarea in goldroad, it will assume your code or data will be in ROM, so it will assume a "@textarea 0x8000000". The first instruction of your code in ROM must be a branch to your start label, it is the address of the first line of code that will be executed.
<br/>
In your code, there is not such a label.
<br/>
Secondly, you include gba.asm in ROM, then you redefine some other code in ROM after the "textarea 0x2000000". This code will overwrite gba.asm.
<br/>
When you use a "textarea", always spill the litteral pool at the end of its definition then put "@endarea". When your data is not in ROM (ie in IWRAM), you must copy it manually in its location by using a loop of ldr and str(there are some previous posts on this topic).
<br/>
<br/>
I'm using goldroad 1.7 and coded more than 3000 lines for a 3D engine. It works perfectly, so I doubt that golroad is so buggy. Your code presented like you did cannot work, try changing the things said below and tell me if it works. I'll try to help you as much as I can.
<br/>
<br/>
Cheers</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9523 - hzx - Thu Aug 07, 2003 5:02 pm</h4>
    <div class="postbody"><span class="postbody">Hm, let me see.
<br/>
<br/>
When I use include files, I assume that the compiler will copy all sources into the main file and will process it as a whole. So if I have a main.asm
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
@textarea 0x08000000
<br/>
<br/>
 mov r0, #0
<br/>
 @include library.asm
<br/>
<br/>
@pool
<br/>
@endarea
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and a library.asm
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
 sub r0, r0, #1
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
the compiler will create a big file to work on
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
@textarea
<br/>
<br/>
 mov r0, #0
<br/>
 sub r0, r0, #1
<br/>
<br/>
@pool
<br/>
@endarea
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and compile it as a whole.  In this case the mov r0, #0 instruction it the first instr. of my code, since the execution of the code will begin at 0x08000000. Thus, no label is necessary. When I define @textarea 0x02000000 and a label in it, IMHO it is nothing more then a label I can address later. My problem is, that if you use include files, the GoldRoad sometimes misses addresses of code and data. Let me show you an example. Library.asm:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
subroutine1:
<br/>
 &lt;stack stuff&gt;
<br/>
 ldr r0, =subroutine_data
<br/>
 ldr r1, [r0]+4
<br/>
 &lt;more code&gt;
<br/>
 &lt;stack stuff&gt;
<br/>
 mov r15, r14
<br/>
 subroutine_data @DCD 0,0,10,10,100,100,1000,1000
<br/>
subroutine2:
<br/>
 &lt;stack stuff&gt;
<br/>
 ...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
then you include this file into main.asm, just right before the @pool keyword. Compile it,  disassemble and watch, as the =subroutine_data constant on the constant pool will be illegal, and pointing to the mov r15, r14 line, not to the data. The difference is always on line of code, 4 bytes.<br/>_________________<br/>.hzx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9524 - momo - Thu Aug 07, 2003 5:08 pm</h4>
    <div class="postbody"><span class="postbody">I think I have found the Problem, if the @pool is more then 2kByte away from a ldr rx,=xxx Comand, the Address is set to 2k, because there is no higher adress possible (11Bit). But Goldroad dont notice that, and will generate confuse addresses. According to circumstances goldroad print a "pool out of range" Message, but NOT always!!
<br/>
<br/>
-&gt;hzx
<br/>
<br/>
Replace your @pool, with this:
<br/>
<br/>
poolstart	@pool
<br/>
poolend	
<br/>
@echo   "Poolentrys = $",(poolend-poolstart)/4
<br/>
<br/>
<br/>
If goldroad print out an Poolentrys = $0, then the pool is to far away and goldroad dont notice that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9525 - funkeejeffou - Thu Aug 07, 2003 5:51 pm</h4>
    <div class="postbody"><span class="postbody">I don't know what your code is supposed to do but try this as your main file :
<br/>
<br/>
<br/>
b start
<br/>
@ltorg
<br/>
<br/>
@textarea 0x02000000 
<br/>
stack @DCD 0    ;this is a dummy value
<br/>
@ltorg
<br/>
@endarea 
<br/>
<br/>
<br/>
start
<br/>
;this will copy stack in EWRAM
<br/>
mov r0, stack
<br/>
mov r1, 0x2000000
<br/>
ldr r2, [r0]
<br/>
str r2, [r1]
<br/>
<br/>
ldr r13, =stack ; setting up stack 
<br/>
<br/>
ldr r1, =REG_DISPCNT 
<br/>
ldr r2, =(BG2_ENABLE | MODE_3) 
<br/>
strh r2, [r1] ; init video mode         ;this is a 16bit register, not a 32 
<br/>
<br/>
ldr r0, =linenumber 
<br/>
ldr r12, [r0]+4!      ;if there is no "!", r0 won't be modified 
<br/>
<br/>
loop 
<br/>
cmp r12, #0 
<br/>
beq labx 
<br/>
sub r12, r12, #1 
<br/>
ldr r1, [r0]+4! 
<br/>
ldr r2, [r0]+4! 
<br/>
ldr r3, [r0]+4! 
<br/>
ldr r4, [r0]+4! 
<br/>
mov r5, #255 
<br/>
bl DrawLine 
<br/>
b loop 
<br/>
<br/>
labx 
<br/>
b labx 
<br/>
@include gba.asm 
<br/>
@include predefs.asm 
<br/>
@include library.asm 
<br/>
<br/>
@ltorg 
<br/>
@endarea</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9536 - hzx - Thu Aug 07, 2003 9:22 pm</h4>
    <div class="postbody"><span class="postbody">What is @ltorg?
<br/>
<br/>
The GbaGuy tutorial states that you have to place your code between @textarea and @endarea labels. It seems to be missing from your code. The @textarea 0x08000000 will place your code to the beginning of the ROM memory, so defining a textarea for 03000000 is ony for convenience. By the way, it seems that the pool &amp; include illegal memory addressing problem exists anyway: looking around some GoldRoad forums a lot of people have noticed it already. It is a luck that you have not.<br/>_________________<br/>.hzx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9541 - funkeejeffou - Fri Aug 08, 2003 12:32 am</h4>
    <div class="postbody"><span class="postbody">@ltorg is the same as @pool, it spills the litteral. Many other people have done great code with goldroad, and believe me, the code was more complicated than the one you show.
<br/>
I think the error you got comes from the fact that you don't put a @ltorg before your @endarea of EWRAM.
<br/>
By the way, when you do not put any @textarea, goldroad considers it as if it was in ROM, so the @textarea 0x8000000 is implicit(look at the manual).
<br/>
Your code cannot work, too many details are ommited. Why don't you try what I said?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9549 - hzx - Fri Aug 08, 2003 7:50 am</h4>
    <div class="postbody"><span class="postbody">I will try it :) Thx for helping me. I think I will have some more questions later :)
<br/>
<br/>
First of all, you said, you have to use ! for writeback. But I used a simple ldr r1, [r0]+#4, and it worked, and the official ARM docs used it on the same way.<br/>_________________<br/>.hzx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9550 - momo - Fri Aug 08, 2003 9:27 am</h4>
    <div class="postbody"><span class="postbody">ldr     r0,[r1]+#4! is a wrong syntax!! Because you add 4 to r1 after transfer and auto-index it too?
<br/>
<br/>
-------------
<br/>
<br/>
ldr	r0,[r1,#4]	;r0 = mem[r1 + 4]
<br/>
<br/>
 "auto-indexing"
<br/>
<br/>
ldr	r0,[r1,#4]!	;r0 = mem[r1 + 4]
<br/>
				;r1 = r1 + 4
<br/>
"post-indexed" 
<br/>
<br/>
ldr	r0,[r1],#4	;r0 = mem[r1]	
<br/>
			        ;r1 = r1 + 4
<br/>
<br/>
--------------
<br/>
<br/>
I have found another bug in pool addressing,  under any circumstances goldroad set a ldr  r0,=anyvariable is assembled to ldr r0,0. But if I use a mov r0,anyvariable, goldroad change it internally to ldr r0,=anyvariable, so the bug is no more. Now I use, only mov r0,anyvariable for Addressloading and if use constants I write ldr r0,=$12345 (this works ever in goldroad). And I  guarantee that is no pool outside a 2k Space. I hope goldroad will be fixed sometimes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9553 - funkeejeffou - Fri Aug 08, 2003 11:32 am</h4>
    <div class="postbody"><span class="postbody">Momo is right.
<br/>
For post indexed load/store instructiuns, goldroad uses :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ldr r0, [r1]+4!
<br/>
or
<br/>
ldr r0, [r1],#4</td> </tr></table><span class="postbody">
<br/>
<br/>
this will store in r0 the value contained at the adress contained in r1. After the affectation of r0, r1 is incremented by 4 bytes.
<br/>
I use the first syntax and it always worked.
<br/>
<br/>
For preindexed, if you do not put a "!",  r1 won't be modified after the allocation.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9862 - hzx - Wed Aug 20, 2003 2:24 pm</h4>
    <div class="postbody"><span class="postbody">So, let's see.
<br/>
<br/>
The ldr reg, =label illegal address problem seems to be exist, and I can not figure out how could I workaround it with organizing code, data and the constant pool. Momo's solution worked perfectly: using mov r0, #label compiles to legal ldr reg, =label assembler code, and it seems that the author of GoldRoad prefers this way of coding in his documentation too. 
<br/>
<br/>
The 
<br/>
<br/>
@textarea 0x03000000
<br/>
variable @DCD 0
<br/>
@endarea
<br/>
<br/>
@textarea 0x08000000
<br/>
...code...
<br/>
<br/>
though seems logical, the GoldRoad assemlies the variable at the 0x08000000 address, and code begins with 0x08000004 position. It is not a bug, just a bit confusing IMHO.<br/>_________________<br/>.hzx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9867 - torne - Wed Aug 20, 2003 4:12 pm</h4>
    <div class="postbody"><span class="postbody">If you mean it assembles the VALUE of the variable at 0x80000000 that's definately a bug, as that clearly is not what the section directives specify. If you mean it puts the ADDRESS of the varaible at 0x80000000, then that's a plausible but uncommon place to put a literal pool. =)
<br/>
<br/>
Torne</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9902 - hzx - Thu Aug 21, 2003 1:21 pm</h4>
    <div class="postbody"><span class="postbody">Yes, it assembles the value of the variable. So
<br/>
<br/>
@textarea 0x03000000
<br/>
variable @DCD 0xff
<br/>
@endarea
<br/>
<br/>
@textarea 0x08000000
<br/>
...code...
<br/>
@endarea
<br/>
<br/>
gives you a code
<br/>
<br/>
08000000 000000ff
<br/>
08000004 &lt;code&gt;
<br/>
<br/>
But if you do an ldr r0, =variable, then it loads the proper 0x03000000 value into r0 :)<br/>_________________<br/>.hzx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12611 - jdxpolygon - Wed Nov 19, 2003 4:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">If you mean it assembles the VALUE of the variable at 0x80000000 that's definately a bug, as that clearly is not what the section directives specify. If you mean it puts the ADDRESS of the varaible at 0x80000000, then that's a plausible but uncommon place to put a literal pool. =)
<br/>
<br/>
Torne</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
It's not a bug. It's doing what the @textarea directive is supposed to do. It's purpose is to change the way labels are defined in the assembly by offsetting them. For example, if @textarea 0x03000000 was used, any labels (and possibly other aspects of the code) will be generated as if they were in the range specified, but the instructions or data bytes will still go into the 'cartridge' at the same place as they would have without the @textarea directive, presumably somewhere above 0x08000000. I think the main point of @textarea directives is so you can write, for example, an assembly routine, which obviously has to be stored on the cartridge (above 0x08000000) but can be transfered to IWRAM once the program is running, and everything will be set up right.
<br/>
<br/>
If you actually want to change where on the cartridge the next instructions or data will be positioned, you need to use the @org directive. For example:
<br/>
<br/>
@org 0x08001000
<br/>
<br/>
I don't know if you can use something like @org 0x03000000 but that would be handy for creating label definitions there without having to store blank space on the cartridge at the same time.
<br/>
<br/>
JD</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12614 - torne - Wed Nov 19, 2003 5:33 pm</h4>
    <div class="postbody"><span class="postbody">OK, that's rather silly. In 'real' assembly we let the linker handle relocation =)
<br/>
<br/>
Makes sense now. Not that it was me who had the problem to begin with.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
