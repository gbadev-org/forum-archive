<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>OBJDUMP Arm disassembly contiains garbage instructions - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>ASM > OBJDUMP Arm disassembly contiains garbage instructions</h2>
<div id="posts">
<div class="post">
    <h4>#168629 - Dwedit - Tue May 12, 2009 3:17 am</h4>
    <div class="postbody"><span class="postbody">I'm trying to use objdump to disassemble an ARM binary file.
<br/>
For some reason, the disassembler does some nasty stuff like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
 30028a0:   e1a03c45    asr   r3, r5, #24
<br/>
 30028a4:   e2588c09    subs   r8, r8, #2304   ; 0x900
<br/>
 30028a8:   0001         lsls   r1, r0, #0
<br/>
 30028aa:   f10054d9    undefined instruction 0xf10054d9
<br/>
</td> </tr></table><span class="postbody">
<br/>
It's marking part of a 32-bit instruction as a 16-bit instruction, and that's throwing off the disassembly into unaligned territory.  How do I stop objdump from doing that?
<br/>
<br/>
<br/>
EDIT:
<br/>
Using an older version of objdump (GNU objdump 2.17 from 2005) works fine.
<br/>
The version I was using (GNU objdump (GNU Binutils) 2.19.1) included with the new devkitpro is broken!<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168641 - Tyler24 - Tue May 12, 2009 8:36 pm</h4>
    <div class="postbody"><span class="postbody">Odd... its working for me...
<br/>
<br/>
arm-eabi-objdump -D file.obj produces
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">drawsquare.o:     file format elf32-littlearm
<br/>
<br/>
<br/>
Disassembly of section .text:
<br/>
<br/>
00000000 &lt;drawsquare&gt;:
<br/>
   0:   e12fff1e    bx   lr
<br/>
   4:   e1a00000    nop         (mov r0,r0)
<br/>
   8:   e1a00000    nop         (mov r0,r0)
<br/>
   c:   e1a00000    nop         (mov r0,r0)
<br/>
<br/>
Disassembly of section .ARM.attributes:
<br/>
<br/>
00000000 &lt;.ARM.attributes&gt;:
<br/>
   0:   00001341    andeq   r1, r0, r1, asr #6
<br/>
   4:   61656100    cmnvs   r5, r0, lsl #2
<br/>
   8:   01006962    tsteq   r0, r2, ror #18
<br/>
   c:   00000009    andeq   r0, r0, r9
<br/>
  10:   01080206    tsteq   r8, r6, lsl #4
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
What parameters are you passing to objdump?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168644 - Dwedit - Wed May 13, 2009 3:55 am</h4>
    <div class="postbody"><span class="postbody">It's choking on the "ldrplb r0, [r9], #1" instruction, treating the first 16 bits as a THUMB instruction.
<br/>
<br/>
I created a binary file containing that instruction, and disassembled it using the options -D -b binary --architecture=arm, and it disassembled it with no problem.  But it consistently screws up when I give it my ELF file.  The ELF file I'm disassembling has a mixture of ARM and THUMB code in it.  Some symbols are ARM symbols and some are THUMB.  But the mistaken instruction doesn't have any symbols pointing there.
<br/>
<br/>
The paramaters I'm passing in are just -D filename.elf, and an output redirection to a .s file.  I tried playing around with the --architecture=arm switch, that did nothing.  I see there is a "force thumb" option, but no corresponding "Force ARM" option.
<br/>
<br/>
Should I go upload my ELF file somewhere?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
