<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Stack Issues [Solved, but confused] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>ASM > Stack Issues [Solved, but confused]</h2>
<div id="posts">
<div class="post">
    <h4>#168516 - Tyler24 - Sat May 02, 2009 5:10 am</h4>
    <div class="postbody"><span class="postbody">I don't know what this syntax means, and my program doesn't work without it. I was googling after a lot of frustration and found that I needed to put an exclamation point after sp when using stmfd/ldmfd...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> stmfd sp!, {r9-r12, lr}
<br/>
 bl drawpixel
<br/>
 ldmfd sp!, {r9-r12, lr}</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">Edit:</span> Okay, so it updates sp after the pushes occur... but why wouldn't something like that be assumed? Is there ever a time where you wouldn't want the sp to be updated after a push? I'm kind used to 80x86 assembly where you'd just push eax or something, and not have to worry about sp being updated like that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168518 - Ruben - Sat May 02, 2009 7:46 am</h4>
    <div class="postbody"><span class="postbody">The reason for the write-back (exclamation mark) is because stmfd is not only used for sp; it can be used for any other register.
<br/>
<br/>
EDIT: Oh yeah, depending on your devkit, you may be able to use push {foo} and pop {foo}</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168525 - Tyler24 - Sat May 02, 2009 3:40 pm</h4>
    <div class="postbody"><span class="postbody">Thanks.
<br/>
<br/>
I'm just using open source arm-eabi tools, not sure of their limitations.
<br/>
<br/>
Yeah, I realized it could be used in conjunction with any register (but is normally used with the sp), just can't think of why you wouldn't want to update the pointer after you copied stuff to it. :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168527 - Ruben - Sat May 02, 2009 3:49 pm</h4>
    <div class="postbody"><span class="postbody">Consider this example...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@ r0: &amp;MySoundChannel
<br/>
<br/>
ldmia r0, {r1-r4} @ Fetch data from the channel into r1-r4 but don't write back.
<br/>
<br/>
@ THen there's some huge loop that updates the registers
<br/>
<br/>
stmia r0!, {r1-r4} @ Store the modified data back and THEN writeback so I can go to the next channel in line</td> </tr></table><span class="postbody">
<br/>
<br/>
Or basically, you'll want to use that if you're going to modify stuff from the registers later on, unless you don't mind using sub/add.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168529 - Tyler24 - Sat May 02, 2009 4:51 pm</h4>
    <div class="postbody"><span class="postbody">Ok, that makes sense, thanks!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
