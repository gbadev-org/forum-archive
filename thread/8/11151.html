<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How do you do Hard Reset? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > How do you do Hard Reset?</h2>
<div id="posts">
<div class="post">
    <h4>#102643 - Kirby - Fri Sep 15, 2006 9:21 pm</h4>
    <div class="postbody"><span class="postbody">How do you do a proper Hard Reset in BIOS? I've tried adding asm("swi 0x26"); to my code, but it just freezes the game.
<br/>
<br/>
If you're wondering why I need it, it's because my game uses tileset maps that sometimes get changed, and switches and variables that get flipped. When someone gets a game over, I'd prefer to just Hard Reset the game so everything's new. Otherwise, I'd have to go around turing off EVERY switch and variable, and have Maps taking up twice as much memory, so I can reset maps like that.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102653 - tepples - Fri Sep 15, 2006 11:08 pm</h4>
    <div class="postbody"><span class="postbody">If you want to jump back to the state at which the BIOS enters your program, I'd say just do a RegisterRamReset followed by a SoftReset.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102688 - Kirby - Sat Sep 16, 2006 4:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">If you want to jump back to the state at which the BIOS enters your program, I'd say just do a RegisterRamReset followed by a SoftReset.</td> </tr></table><span class="postbody">
<br/>
<br/>
I can't get the swi to work. I wrote a short program to test out the reset:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "gba_types.h"
<br/>
#include "gba_regs.h"
<br/>
#include "Bg.h"
<br/>
#include "gba_video.h"
<br/>
#include "gba_sprites.h"
<br/>
#include "gba_keys.h"
<br/>
#include "dispcnt.h"
<br/>
#include "gba_defines.h"
<br/>
#include "textsys.h"
<br/>
<br/>
int main()
<br/>
{
<br/>
   SetMode( MODE_0 | BG0_ENABLE );
<br/>
   InitText();
<br/>
   PlotText("Hi",1,1);
<br/>
   while (1)
<br/>
   {
<br/>
      if (!(keyDown(KEY_A))) {break;}
<br/>
      WaitForVsync();
<br/>
   }
<br/>
   while (1)
<br/>
   {
<br/>
      if (keyDown(KEY_A)) {break;}
<br/>
      WaitForVsync();
<br/>
   }
<br/>
   PlotText("there",4,1);
<br/>
   while (1)
<br/>
   {
<br/>
      if (!(keyDown(KEY_A))) {break;}
<br/>
      WaitForVsync();
<br/>
   }
<br/>
   while (1)
<br/>
   {
<br/>
      if (keyDown(KEY_A)) {break;}
<br/>
      WaitForVsync();
<br/>
   }
<br/>
   asm("swi 01");
<br/>
   asm("swi 00");
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
gba_**** are just the normal gba_defines things... Textsys is a text system I created, and the program just writes "Hi", then press A, then "there", then press A, then reset to just saying "Hi". But when I test it anywhere, it crashes after the last A!
<br/>
<br/>
Basically what I'm trying to say it: What is the correct syntax of exceuting a BIOS function?<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102740 - zzo38computer - Sat Sep 16, 2006 3:40 pm</h4>
    <div class="postbody"><span class="postbody">I think it is different in ARM mode and THUMB mode, you have to be careful!<br/>_________________<br/><span style="font-weight: bold">Important:</span> Please send messages about FWNITRO to the public forum, not privately to me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102748 - tepples - Sat Sep 16, 2006 5:55 pm</h4>
    <div class="postbody"><span class="postbody">You may also have to set up registers before each SWI.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102777 - Kirby - Sat Sep 16, 2006 10:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zzo38computer wrote:</b></span></td> </tr> <tr> <td class="quote">I think it is different in ARM mode and THUMB mode, you have to be careful!</td> </tr></table><span class="postbody">
<br/>
I think I am using THUMB mode, does it mean THUMB when I use:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">-mthumb-interwork</td> </tr></table><span class="postbody">
<br/>
Or do I have do do:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">-mthumb -mthumb-interwork</td> </tr></table><span class="postbody">
<br/>
I'm pretty sure the difference is that in THUMB, it's swi 0x01, while in ARM it's swi 0x010000.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">You may also have to set up registers before each SWI.</td> </tr></table><span class="postbody">
<br/>
What kind of registers? You mean the r0, r1 things? I've been reading up on SWI because I have NO ASM experience, mixed or pure, so even  "mov r0,1%" mystifies me.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102790 - tepples - Sat Sep 16, 2006 11:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zzo38computer wrote:</b></span></td> </tr> <tr> <td class="quote">I think it is different in ARM mode and THUMB mode, you have to be careful!</td> </tr></table><span class="postbody">
<br/>
I think I am using THUMB mode, does it mean THUMB when I use:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">-mthumb-interwork</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
This does ARM with interworking.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Or do I have do do:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">-mthumb -mthumb-interwork</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
This does Thumb with interworking.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I'm pretty sure the difference is that in THUMB, it's swi 0x01, while in ARM it's swi 0x010000.</td> </tr></table><span class="postbody">
<br/>
Correct.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102797 - Kirby - Sun Sep 17, 2006 1:26 am</h4>
    <div class="postbody"><span class="postbody">But how do you do the input thing? What, actually, do you have to input for RegisterRamReset and SoftReset if I just want to reset the game?<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102808 - tepples - Sun Sep 17, 2006 3:57 am</h4>
    <div class="postbody"><span class="postbody">How about this? (untested)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void resetGBA(void) {
<br/>
<br/>
  // Set entry point for SoftReset (0: ROM; 1: EWRAM)
<br/>
  *(volatile char *)0x03007FFA = 0;
<br/>
<br/>
  asm volatile (
<br/>
<br/>
    // RegisterRamReset:
<br/>
    // Reset RAM and registers to power on state
<br/>
    "ldr r0, #0xFF; swi 1;"
<br/>
<br/>
    // SoftReset:
<br/>
    // Reset stack pointer and CPU control registers
<br/>
    // and jump to the entry point selected by 0300:7FFA
<br/>
    "swi 0;"
<br/>
  );
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102810 - Kirby - Sun Sep 17, 2006 4:48 am</h4>
    <div class="postbody"><span class="postbody">Thanx for your help, but what you said didn't really work. First, I found I WAS using ARM, so I had to change the SWI values. And then I prodded your code a bit... and:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void resetGBA(u16 para) { 
<br/>
<br/>
  // Set entry point for SoftReset (0: ROM; 1: EWRAM) 
<br/>
  *(volatile char *)0x03007FFA = 0; 
<br/>
<br/>
  asm volatile ( 
<br/>
<br/>
    // RegisterRamReset: 
<br/>
    // Reset RAM and registers to power on state 
<br/>
   "swi 0x010000;" 
<br/>
<br/>
    // SoftReset: 
<br/>
    // Reset stack pointer and CPU control registers 
<br/>
    // and jump to the entry point selected by 0300:7FFA 
<br/>
    "swi 0x000000;" 
<br/>
  ); 
<br/>
}</td> </tr></table><span class="postbody">
<br/>
para is set to 255. I don't know if that's doing anything or not, but now, when I test the game, get a gameover, and press A, the game (seems to, at least) reset!<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102812 - tepples - Sun Sep 17, 2006 5:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Thanx for your help, but what you said didn't really work. First, I found I WAS using ARM, so I had to change the SWI values. And then I prodded your code a bit... and:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void resetGBA(u16 para) { 
<br/>
<br/>
  // Set entry point for SoftReset (0: ROM; 1: EWRAM) 
<br/>
  *(volatile char *)0x03007FFA = 0; 
<br/>
<br/>
  asm volatile ( 
<br/>
<br/>
    // RegisterRamReset: 
<br/>
    // Reset RAM and registers to power on state 
<br/>
   "swi 0x010000;" 
<br/>
<br/>
    // SoftReset: 
<br/>
    // Reset stack pointer and CPU control registers 
<br/>
    // and jump to the entry point selected by 0300:7FFA 
<br/>
    "swi 0x000000;" 
<br/>
  ); 
<br/>
}</td> </tr></table><span class="postbody">
<br/>
para is set to 255.</span></td> </tr></table><span class="postbody">
<br/>
Trouble is that it might not stay that way if GCC overwrites r0 while performing the *(volatile char *)0x03007FFA = 0; . But the RegisterRamReset isn't quite as critical as the SoftReset, so it might work anyway.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
