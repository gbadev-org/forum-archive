<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ASM and multiboot related problem... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > ASM and multiboot related problem...</h2>
<div id="posts">
<div class="post">
    <h4>#82910 - Natso - Thu May 11, 2006 3:19 am</h4>
    <div class="postbody"><span class="postbody">&lt;i moved this from the coding forum, I realized that this forum specializes in ASM&gt;
<br/>
<br/>
Ok, I got the multiboot demo from this site... I was able to change the demo up some and keep it working good. I implimented it into my space game (www.gamesforfree.net/natso/sea/)(yes, the full game will end up easily within the limits of multiboot-dom) and have but a single problem now,
<br/>
<br/>
I get these errors when running my makefile:
<br/>
<br/>
c:\windows\TEMP/ccDVX3fb.s: Assembler messages:
<br/>
c:\windows\TEMP/ccDVX3fb.s:524: Error: invalid offset, target not word aligned (
<br/>
0x000078F2)
<br/>
c:\windows\TEMP/ccDVX3fb.s:524: Error: invalid offset, value too big (0x000075BC
<br/>
)
<br/>
c:\windows\TEMP/ccDVX3fb.s:524: Error: cannot represent THUMB_OFFSET relocation
<br/>
in this object file format
<br/>
<br/>
<br/>
And also, the errors dissapear when I comment out this code. However this code is vital to making multiboot work, so its not something I want to keep commented ;)
<br/>
<br/>
asm volatile (
<br/>
" ldr r0,=mp\n"
<br/>
" mov r1,#1\n"
<br/>
" swi 0x25\n"
<br/>
::: "r0","r1","r2","r8","r9","r10","r11","r12"
<br/>
);
<br/>
<br/>
(this came directly from the demo)
<br/>
<br/>
<br/>
Any clues as to what I should do?<br/>_________________<br/>I'm a bomb technitian. If you see me running, try to keep up ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#82911 - tepples - Thu May 11, 2006 3:30 am</h4>
    <div class="postbody"><span class="postbody">I tend to distrust the kludgy way GCC goes about supporting inline assembly language code. Have you tried making it a separate function in a separate assembly file? Put all this into swi25.s:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
.THUMB
<br/>
.THUMB_FUNC
<br/>
.ALIGN
<br/>
.GLOBL  swi25
<br/>
<br/>
swi25:
<br/>
  swi 0x25
<br/>
  bx lr
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then in your C code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int swi25(void *r0, int r1);
<br/>
<br/>
int vitalFunction() {
<br/>
  swi25(mp, 1);
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#82948 - Natso - Thu May 11, 2006 12:37 pm</h4>
    <div class="postbody"><span class="postbody">2 things:
<br/>
<br/>
1. I could never get your code to work
<br/>
2. The errors I got from your code helped me to figure out to do with my original code &amp; I just had to place it as one of the first two files and it started working perfect.
<br/>
<br/>
So... Thank You tepples!
<br/>
<br/>
 - Zach<br/>_________________<br/>I'm a bomb technitian. If you see me running, try to keep up ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83041 - gladius - Fri May 12, 2006 8:02 am</h4>
    <div class="postbody"><span class="postbody">Tepples' solution should be fine.  But in any case, if you happen to run into that error again it's because "ldr, =mp" actually ends up being compiled to a pc-relative offset.  Basically that means you need to have mp declared close to where you use the ldr.
<br/>
<br/>
If moving the source files order around works, then great :).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
