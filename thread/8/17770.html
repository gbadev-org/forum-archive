<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>asm noob, where is asm appropriate - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>ASM > asm noob, where is asm appropriate</h2>
<div id="posts">
<div class="post">
    <h4>#176978 - blessingta@hotmail.co.uk - Sun Nov 13, 2011 10:44 pm</h4>
    <div class="postbody"><span class="postbody">hi 
<br/>
<br/>
What are simple examples  or a simple example of where asm is appropriate?
<br/>
<br/>
Plus any recommended good tutorials? I've barely got 3weeks left till the deadline</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176980 - Miked0801 - Mon Nov 14, 2011 5:40 pm</h4>
    <div class="postbody"><span class="postbody">Honestly, I wouldn't worry about asm until forced.  The only place you probably should have it is in your bootstrap/vector table code and perhaps in a few, very high usage areas.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176982 - headspin - Tue Nov 15, 2011 8:39 am</h4>
    <div class="postbody"><span class="postbody">If you're interested in learning ARM ASM we have some instructions and examples in <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=17305&amp;sid=2260666d5852cc71673d31714851ce4a" target="_blank">this thread</a><br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176990 - blessingta@hotmail.co.uk - Wed Nov 16, 2011 7:51 pm</h4>
    <div class="postbody"><span class="postbody">i just need this for the coursework criteria so I can get higher marks (one of those annoying uni requirements) otherwise I would try to be as realistic as possible in approaching it and knowing that time would be required before I can get anything decent out of it</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176991 - Dwedit - Wed Nov 16, 2011 10:56 pm</h4>
    <div class="postbody"><span class="postbody">A good example of ASM is writing your own unrolled memcpy function.  You can subtract 32 bytes from the bytes remaining, then copy 8 words using ldmia/stmia instructions.  Tonc even includes an example.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176997 - blessingta@hotmail.co.uk - Fri Nov 18, 2011 8:12 pm</h4>
    <div class="postbody"><span class="postbody">thanks
<br/>
<br/>
Whats the psuedo code for memory copying? 
<br/>
<br/>
Is it as simple as taking void data and then typecasting it to the address of what you want to send it too?
<br/>
<br/>
 I'm planning to learn how to do it in c++, before I adapt it to gba asm</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177008 - Miked0801 - Mon Nov 21, 2011 5:44 pm</h4>
    <div class="postbody"><span class="postbody">Memcopy, written from memory here for you:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
void memByteCopy(void *dest, const void *src, int bytes);
<br/>
void memCopy(void *dest, const void *src, int bytes);
<br/>
<br/>
void memCopy(void *dest, const void *src, int bytes)
<br/>
{
<br/>
    if(((int)(dest) &amp; 0x03) != 0 || ((int)(src) &amp; 0x03) != 0)
<br/>
    {
<br/>
        memByteCopy(dest, src, bytes);
<br/>
        return;
<br/>
    }
<br/>
<br/>
    unsigned int *destAlign = (unsigned int *)dest;
<br/>
    unsigned int *srcAlign = (unsigned int *)src;
<br/>
<br/>
    int numWords = bytes / 4;
<br/>
<br/>
    while(numWords--)
<br/>
    {
<br/>
        *destAlign++ = *srcAlign++;
<br/>
    }
<br/>
<br/>
    bytes &amp;= 0x3;
<br/>
<br/>
    memByteCopy(destAlign, srcAlign, bytes);
<br/>
}
<br/>
<br/>
void memByteCopy(void *dest, const void *src, int bytes)
<br/>
{
<br/>
    unsigned char *byteSrc = (unsigned char *)src;
<br/>
    unsigned char *byteDest = (unsigned char *)dest;
<br/>
<br/>
    while(bytes--)
<br/>
    {
<br/>
        *byteDest++ = *byteSrc++;
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
MemCopy handled by the compiler:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct _generic_32_bytes
<br/>
{
<br/>
    unsigned int val[8];
<br/>
} GENERIC_32_BYTES;
<br/>
<br/>
void foo(void *dest, const void *src)
<br/>
{
<br/>
    // Assumes 4-byte alignment or else bad things will happen...
<br/>
    GENERIC_32_BYTES *destPtr = (GENERIC_32_BYTES *) dest;
<br/>
    GENERIC_32_BYTES *srcPtr  (GENERIC_32_BYTES *) src;
<br/>
<br/>
    // Copy 32-bytes using very efficient compiler generated code.
<br/>
    *destPtr = *srcPtr;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
For bonus points, go look up Duff's Device.  It is a very efficient way of getting large amounts of data copied without much looping overhead - like the above memCopy does.
<br/>
<br/>
The above code can also be hand assembled, but you won't get that much benefit.  The above C code so closely emulates the low level that any good compiler should be able to match a novice hand attempt.  Unrolling and jump tables can be also coded on the C side for similar performance as asm as well.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
