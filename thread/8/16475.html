<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Newbie question... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>ASM > Newbie question...</h2>
<div id="posts">
<div class="post">
    <h4>#166932 - sverx - Tue Feb 24, 2009 11:06 am</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
  let's imagine you've got somebody who already knows ASM programming on a different system (say the x86).
<br/>
<br/>
What this person should read to start his approach to ARM assembler? Online resources links very welcome :) Starting from what's inside an ARM processor is advised ;)
<br/>
<br/>
Thanks from that person who needs it ;)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166933 - Dwedit - Tue Feb 24, 2009 11:10 am</h4>
    <div class="postbody"><span class="postbody">Download the source code to something written in ARM ASM and try to add features to it.  If you look at surrounding code, you can very quickly pick up which instructions are used for the various tasks.  I learned ARM by hacking PocketNES.
<br/>
<br/>
Also, grab this file:
<br/>
<a href="http://www.eecs.umich.edu/~panalyzer/pdfs/ARM_doc.pdf" target="_blank">http://www.eecs.umich.edu/~panalyzer/pdfs/ARM_doc.pdf</a>
<br/>
Even though it's really old, and doesn't have inline hyperlinks, it's a very good document.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166934 - eKid - Tue Feb 24, 2009 11:14 am</h4>
    <div class="postbody"><span class="postbody">GBATek has a friendly reference (in my opinion) of the instruction set. The official ARM docs contain more technical info for their processors.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166948 - sverx - Tue Feb 24, 2009 5:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Also, grab this file</td> </tr></table><span class="postbody">
<br/>
<br/>
reading it, seems very interesting...
<br/>
<br/>
see you soon! ;)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168116 - sverx - Fri Apr 10, 2009 2:21 pm</h4>
    <div class="postbody"><span class="postbody">Replying to this old topic of mine because the question I'm going to ask it's somehow related to this 3d...
<br/>
<br/>
So, when I write C code, it's better if I use <span style="font-style: italic">int</span> instead of, for instance, u8 or u16, when I need 'temporary' variables? I mean, say I need to repeat a task some 200 times:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u8 i;
<br/>
for(i=0;i&lt;200;i++)
<br/>
  do_something();</td> </tr></table><span class="postbody">
<br/>
<br/>
will the compiler produce better code if I declare that variable <span style="font-style: italic">int</span>, instead of u8? Or am I wrong and it's the same?
<br/>
<br/>
Thanks :)
<br/>
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">EDIT: lol... funny, this is exactly the 200th post of mine on this forum... and I didn't notice before!!! :D :D</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168131 - Dwedit - Fri Apr 10, 2009 6:18 pm</h4>
    <div class="postbody"><span class="postbody">Yep, if you use u8, the compiler will throw in AND 255 every time it stores it into the variable.  You want to use ints.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168137 - Ruben - Fri Apr 10, 2009 8:37 pm</h4>
    <div class="postbody"><span class="postbody">Not necessarily "and r0, r0, #255" since you could be in THUMB mode or, for some odd reason using s8..
<br/>
<br/>
Though it depends on the compiler, most compilers will try to keep the code to exactly what you told it; that is, keep it to 8-bits for u8, 16 for u16, etc.
<br/>
<br/>
If I remember right, THUMB, in uN, will use lsl/lsr pairs or simply a preloaded register and an and instruction. For sN, however, I think it *has* to use lsl/asr pairs, unless it's s32, in which case the sign bit doesn't need to be extended.
<br/>
<br/>
For ARM, if it can, it will use an immediate mask, use a preloaded register and a mask, be silly and clear the bits manually (see TTE) or use LSL/ASR/LSR pairs.
<br/>
<br/>
EDIT:
<br/>
<br/>
So yeah, in summary, int = good, u8/u16 = bad.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168152 - sgeos - Sat Apr 11, 2009 3:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">So yeah, in summary, int = good, u8/u16 = bad.</td> </tr></table><span class="postbody">
<br/>
Unless you absolutely need u8 or u16.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168153 - Ruben - Sat Apr 11, 2009 3:58 pm</h4>
    <div class="postbody"><span class="postbody">.. That too :P
<br/>
<br/>
Though.. you may get away with using u/s32 and casting to u/s8/16 if the need arises, only when it's necessary (as in, so the compiler doesn't do creepy stuff)
<br/>
<br/>
Ok, rephrase time :P
<br/>
<br/>
You may be able to get away with using 32-bits all the time and typecast when you must (like adding 2x 8-bit variables into a 16-bit one)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168189 - sverx - Tue Apr 14, 2009 9:32 am</h4>
    <div class="postbody"><span class="postbody">Thanks! :) Good explanations :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168411 - sverx - Tue Apr 28, 2009 10:00 am</h4>
    <div class="postbody"><span class="postbody">Another question... again about writing 'better' C code keeping in mind where's the code going to run (NDS, in this case)
<br/>
<br/>
Do I obtain <span style="font-style: italic">better</span> code if I declare variables "very locally" (meaning declaring it only if I'm going to use it and <span style="font-style: italic">as close as possible</span> to the moment I'm going to use it) ?
<br/>
<br/>
For example, if I write
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (&lt;condition1&gt;) {
<br/>
  int i;
<br/>
  for (i=0;i&lt;200;i++)
<br/>
    doSomething1();
<br/>
}
<br/>
<br/>
doSomethingE();
<br/>
<br/>
if (&lt;condition2&gt;) {
<br/>
  int i;
<br/>
  for (i=0;i&lt;200;i++)
<br/>
    doSomething2();
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
will (would?) the compiler make <span style="font-style: italic">better</span> code than
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int i;
<br/>
if (&lt;condition1&gt;) {
<br/>
  for (i=0;i&lt;200;i++)
<br/>
    doSomething1();
<br/>
}
<br/>
<br/>
doSomethingE();
<br/>
<br/>
if (&lt;condition2&gt;) {
<br/>
  for (i=0;i&lt;200;i++)
<br/>
    doSomething2();
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks in advance for your comments :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168420 - Dwedit - Tue Apr 28, 2009 8:23 pm</h4>
    <div class="postbody"><span class="postbody">I've seen compilers change this:
<br/>
<br/>
int row=0;
<br/>
some_function(row,"text 1");
<br/>
row++;
<br/>
some_function(row,"more text");
<br/>
row++;
<br/>
some_function(row,"even more text");
<br/>
row++;
<br/>
<br/>
into this:
<br/>
<br/>
some_function(0,"text 1");
<br/>
some_function(1,"more text");
<br/>
some_function(2,"even more text");
<br/>
<br/>
Whenever you ask about what compilers do, always use the -S option to see what it does.
<br/>
<br/>
<br/>
<br/>
However, always declare a local copies of global variables if you know they won't be modified outside this function.  Whenever you do a function call, the compiler has to assume that all global variables may change before the function returns, so it will re-read the variable between function calls.  Keeping a local copy makes the compiler know your intention better, so it may save it in the registers instead of rereading it.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168429 - Ruben - Wed Apr 29, 2009 3:18 am</h4>
    <div class="postbody"><span class="postbody">Oo, I know that~
<br/>
<br/>
If you don't want the compiler doing that, use -fno-peel-loops, I think. Loop peeling is when it fully unrolls a loop.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168435 - sverx - Wed Apr 29, 2009 10:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Whenever you ask about what compilers do, always use the -S option to see what it does.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's interesting... anyway my question was more on the side of "how to write better C code", I still do not have enough knowledge to compare two ASM sources and judge... :|
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">However, always declare a local copies of global variables if you know they won't be modified outside this function.  Whenever you do a function call, the compiler has to assume that all global variables may change before the function returns, so it will re-read the variable between function calls.  Keeping a local copy makes the compiler know your intention better, so it may save it in the registers instead of rereading it.</td> </tr></table><span class="postbody">
<br/>
<br/>
Sorry, I really can't get what you mean :| How can a global be modified outside the function I'm in? :| What can change a global variable before the function returns? I'm missing something important? :| :| :|</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168437 - Ruben - Wed Apr 29, 2009 11:12 am</h4>
    <div class="postbody"><span class="postbody">For example..
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(int i = 0 ; i &lt; 512 ; i++) {
<br/>
    u32 MyVal1 = SomeSrc[2] * 45;
<br/>
    u32 MyVal2 = SomeSrc[2] * 87;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Usually, the compiler will perform 2 loads, just to be sure they won't get modified (by interrupts, for example). By preloading, you can make sure it won't do that.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(int i = 0 ; i &lt; 512 ; i++) {
<br/>
    u32 MyVal0 = SomeSrc[2];
<br/>
    u32 MyVal1 = MyVal0 * 45;
<br/>
    u32 MyVal2 = MyVal0 * 87;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT: Please delete multiple posts if they appear.. they are accidental, because my internet hasn't been working nicely.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168453 - Dwedit - Wed Apr 29, 2009 2:07 pm</h4>
    <div class="postbody"><span class="postbody">More like
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int what_i_selected;
<br/>
<br/>
void some_function
<br/>
{
<br/>
  if (what_i_selected==5)
<br/>
    foo();
<br/>
  if (what_i_selected==2)
<br/>
    bar();
<br/>
  if (what_i_selected==8)
<br/>
    foobar();
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
what_i_selected needs to be reloaded every time.  If you made a local copy, it won't be.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168460 - sverx - Wed Apr 29, 2009 4:27 pm</h4>
    <div class="postbody"><span class="postbody">Cool, I didn't know that, thanks both. But... ok, globals could change because of an interrupt, but why locals won't? Because they're in the stack, I guess, but I'm not really sure that this is the reason...
<br/>
<br/>
Stack is also faster than main ram on a NDS, right?
<br/>
<br/>
And how can you do that thing:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(int i = 0 ; i &lt; 512 ; i++) {
<br/>
...</td> </tr></table><span class="postbody">
<br/>
? My compiler always stops and say I can't declare that variable there!!! I'm using devKitPro, latest version...
<br/>
<br/>
Thanks! :)
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">I believe I really have to move my topics to the "Beginner" section... forgive my many questions, but you all have got a lot of good answers, and it just makes me more curious...</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168461 - kusma - Wed Apr 29, 2009 4:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">And how can you do that thing:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(int i = 0 ; i &lt; 512 ; i++) {
<br/>
...</td> </tr></table><span class="postbody">
<br/>
? My compiler always stops and say I can't declare that variable there!!! I'm using devKitPro, latest version...
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
That's C++ code. The C-way of doing this is 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int i;
<br/>
for(i = 0 ; i &lt; 512 ; i++) {</td> </tr></table><span class="postbody">
<br/>
<br/>
I hope this helps.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168463 - sverx - Wed Apr 29, 2009 4:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">That's C++ code. The C-way of doing this is ... [...]</td> </tr></table><span class="postbody">
<br/>
<br/>
AHAHAHAHAH... ops ;) Please delete my post... all of them ;)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
