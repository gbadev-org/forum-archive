<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DS Assembly - Select processor does not support.....SMLAWx - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>ASM > DS Assembly - Select processor does not support.....SMLAWx</h2>
<div id="posts">
<div class="post">
    <h4>#139695 - DiscoStew - Sat Sep 08, 2007 11:51 pm</h4>
    <div class="postbody"><span class="postbody">At the end of my thread of glRestoreMatrix in the DS Development section, I ended with the problem involving the use of 'smlawb', saying that the select processor does not support it.
<br/>
<br/>
An example...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">c:/My_Projects/DS_Projects/Test_Project/arm9/src/BoneVertMult_asm.s(38): Error: selected processor does not support `smlawb r0,r8,r5,r0'</td> </tr></table><span class="postbody">
<br/>
<br/>
Any thoughts? Perhaps I'm not doing something correctly with the Make file?<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139698 - DekuTree64 - Sun Sep 09, 2007 12:43 am</h4>
    <div class="postbody"><span class="postbody">Hmm, I remember back in the early days that you had to compile for arm9tdmi instead of arm946e-s, due to some floating point library conflict or something. I just tried it though, and it seems to be ok now.
<br/>
<br/>
In your makefile, where it defines CFLAGS, change -mcpu=arm9tdmi to -mcpu=arm946e-s and see if that works.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139701 - DiscoStew - Sun Sep 09, 2007 1:30 am</h4>
    <div class="postbody"><span class="postbody">Well, I tried making the change, but nothing changed as far as compiling. I'm still getting the unsupported errors.
<br/>
<br/>
This is the Make file for the arm9 of the combined arm9/arm7 Make file I use (which includes the change you suggested). I even tried changing -mtune also (and tried all 4 combos with -mcpu) to see if it worked, but it didn't.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#---------------------------------------------------------------------------------
<br/>
.SUFFIXES:
<br/>
#---------------------------------------------------------------------------------
<br/>
ifeq ($(strip $(DEVKITARM)),)
<br/>
$(error "Please set DEVKITARM in your environment. export DEVKITARM=&lt;path to&gt;devkitARM")
<br/>
endif
<br/>
<br/>
include $(DEVKITARM)/ds_rules
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# BUILD is the directory where object files &amp; intermediate files will be placed
<br/>
# SOURCES is a list of directories containing source code
<br/>
# INCLUDES is a list of directories containing extra header files
<br/>
# DATA is a list of directories containing binary files
<br/>
# all directories are relative to this makefile
<br/>
#---------------------------------------------------------------------------------
<br/>
BUILD      :=   build
<br/>
SOURCES      :=   src
<br/>
INCLUDES   :=   header
<br/>
DATA      :=   data
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# options for code generation
<br/>
#---------------------------------------------------------------------------------
<br/>
ARCH   :=   -mthumb-interwork
<br/>
<br/>
# note: arm9tdmi isn't the correct CPU arch, but anything newer and LD
<br/>
# *insists* it has a FPU or VFP, and it won't take no for an answer!
<br/>
CFLAGS   :=   -g -Wall -O3\
<br/>
          -mcpu=arm9tdmi -mtune=arm9tdmi -fomit-frame-pointer\
<br/>
         -ffast-math \
<br/>
         $(ARCH)
<br/>
<br/>
CFLAGS      +=   $(INCLUDE) -DARM9
<br/>
CXXFLAGS   :=   $(CFLAGS) -fno-rtti -fno-exceptions
<br/>
<br/>
ASFLAGS   :=   -g $(ARCH)
<br/>
LDFLAGS   =   -specs=ds_arm9.specs -g $(ARCH) -mno-fpu -Wl,-Map,$(notdir $*.map)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# any extra libraries we wish to link with the project
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBS   := -lnds9
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# list of directories containing libraries, this must be the top level containing
<br/>
# include and lib
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBDIRS   :=   $(LIBNDS)
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# no real need to edit anything past this point unless you need to add additional
<br/>
# rules for different file extensions
<br/>
#---------------------------------------------------------------------------------
<br/>
ifneq ($(BUILD),$(notdir $(CURDIR)))
<br/>
#---------------------------------------------------------------------------------
<br/>
 
<br/>
export ARM9BIN   :=   $(TOPDIR)/$(TARGET).arm9
<br/>
export ARM9ELF   :=   $(CURDIR)/$(TARGET).arm9.elf
<br/>
export DEPSDIR   := $(CURDIR)/$(BUILD)
<br/>
<br/>
export VPATH   :=   $(foreach dir,$(SOURCES),$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(DATA),$(CURDIR)/$(dir))
<br/>
 
<br/>
CFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
<br/>
CPPFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.cpp)))
<br/>
SFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.s)))
<br/>
BINFILES   :=   $(foreach dir,$(DATA),$(notdir $(wildcard $(dir)/*.*)))
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# use CXX for linking C++ projects, CC for standard C
<br/>
#---------------------------------------------------------------------------------
<br/>
ifeq ($(strip $(CPPFILES)),)
<br/>
#---------------------------------------------------------------------------------
<br/>
   export LD   :=   $(CC)
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
#---------------------------------------------------------------------------------
<br/>
   export LD   :=   $(CXX)
<br/>
#---------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
export OFILES   :=   $(addsuffix .o,$(BINFILES)) \
<br/>
               $(CPPFILES:.cpp=.o) $(CFILES:.c=.o) $(SFILES:.s=.o)
<br/>
 
<br/>
export INCLUDE   :=   $(foreach dir,$(INCLUDES),-I$(CURDIR)/$(dir)) \
<br/>
         $(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
         -I$(CURDIR)/$(BUILD)
<br/>
 
<br/>
export LIBPATHS   :=   $(foreach dir,$(LIBDIRS),-L$(dir)/lib)
<br/>
 
<br/>
.PHONY: $(BUILD) clean
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
$(BUILD):
<br/>
   @[ -d $@ ] || mkdir -p $@
<br/>
   @make --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
clean:
<br/>
   @echo clean ...
<br/>
   @rm -fr $(BUILD) *.elf *.nds* *.bin 
<br/>
 
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
 
<br/>
DEPENDS   :=   $(OFILES:.o=.d)
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# main targets
<br/>
#---------------------------------------------------------------------------------
<br/>
$(ARM9BIN)   :   $(ARM9ELF)
<br/>
   @$(OBJCOPY) -O binary $&lt; $@
<br/>
   @echo built ... $(notdir $@)
<br/>
<br/>
$(ARM9ELF)   :   $(OFILES)
<br/>
   @echo linking $(notdir $@)
<br/>
   @$(LD)  $(LDFLAGS) $(OFILES) $(LIBPATHS) $(LIBS) -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# you need a rule like this for each extension you use as binary data 
<br/>
#---------------------------------------------------------------------------------
<br/>
%.bin.o   :   %.bin
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.pcx.o   :   %.pcx
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.mod.o   :   %.mod
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o)
<br/>
<br/>
   
<br/>
-include $(DEPENDS)
<br/>
<br/>
-include $(DEPENDS)
<br/>
 
<br/>
#---------------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------------</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139703 - DekuTree64 - Sun Sep 09, 2007 2:41 am</h4>
    <div class="postbody"><span class="postbody">Hmm, maybe try adding -mcpu=arm946e-s to ASFLAGS too<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139859 - DiscoStew - Mon Sep 10, 2007 11:39 pm</h4>
    <div class="postbody"><span class="postbody">Yep, that did it. Now the project can compile, but I'm not getting anything on the screen anymore. I'll have to tinker with assembly a little to figure out what's going on with it. Maybe trying individual commands first with some data given to them to check on the results.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
