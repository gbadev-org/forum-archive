<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>backbuffer - again - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>ASM > backbuffer - again</h2>
<div id="posts">
<div class="post">
    <h4>#37049 - anoneem - Sat Mar 05, 2005 6:23 pm</h4>
    <div class="postbody"><span class="postbody">Sorry if there was topic like this, but in my country internet is still so expensive, that I wasn't able to check... Don't kick me, please.
<br/>
<br/>
Now the main message:
<br/>
<br/>
Hi! Problems again...
<br/>
I am working in Mode 3 and trying to:
<br/>
a)clear backbuffer (located at $02000000)
<br/>
b)plot in it pixel
<br/>
c)copy buffer to vram
<br/>
<br/>
Problems are:
<br/>
1.if procedure czysc (clearbuff) is included, screen is black
<br/>
2.if the procedure isn't called, effect is better, but not the best, becaouse 3.plotted dot is flashing - i tought that maybe vblnk could fix it, but I was wrong
<br/>
4.when i tried to draw a simple horizontal line by that way:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">rysuj:
<br/>
   stmfd r13!, {r14}
<br/>
   ldr r6, =#10
<br/>
   ldr r0, =$02000000
<br/>
   ldr r1, =#120
<br/>
   ldr r2, =#80
<br/>
   ldr r3, =#240
<br/>
   ldr r4, =$ffff
<br/>
.plot   mla r5, r2, r3, r1
<br/>
   add r0, r0, r5, lsl#1
<br/>
   strh r4, [r0]
<br/>
   add r1, r1, #1
<br/>
   sub r6, r6, #1
<br/>
   bne plot
<br/>
   ldmfd r13!, {r14}</td> </tr></table><span class="postbody">
<br/>
...the screen was all filled by $ffff.
<br/>
<br/>
WHY?!?
<br/>
<br/>
Here goes the code. Please, help me to fix bugs listed above.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@textarea
<br/>
<br/>
   ldr r0, =0x403
<br/>
   ldr r1, =0x4000000
<br/>
   str r0, [r1]         ;mode 3
<br/>
main:
<br/>
   stmfd r13!, {r14}
<br/>
   bl czysc         ;clear backbuffer
<br/>
   bl rysuj         ;plot a point
<br/>
   bl vblnk         ;wait for vblank
<br/>
   bl naekr         ;copy backbuff to vram
<br/>
   ldmfd r13!, {r14}
<br/>
<br/>
   b main
<br/>
czysc:
<br/>
   stmfd r13!, {r14}
<br/>
   ldr r0, =$02000000
<br/>
   ldr r1, =$0000
<br/>
   ldr r2, =#38400
<br/>
<br/>
.clear   strh r1, [r0, #2]!
<br/>
   sub r2, r2, #1
<br/>
<br/>
   bne clear
<br/>
   ldmfd r13!, {r14}
<br/>
rysuj:
<br/>
   stmfd r13!, {r14}
<br/>
   ldr r0, =$02000000
<br/>
   ldr r1, =#120
<br/>
   ldr r2, =#80
<br/>
   ldr r3, =#240
<br/>
   ldr r4, =$ffff
<br/>
<br/>
   mla r5, r2, r3, r1
<br/>
   add r0, r0, r5, lsl#1
<br/>
   strh r4, [r0]
<br/>
<br/>
   ldmfd r13!, {r14}
<br/>
naekr:
<br/>
   stmfd r13!, {r14}
<br/>
   ldr r0, =$02000000
<br/>
   ldr r1, =$06000000
<br/>
   ldr r2, =#38400
<br/>
<br/>
.onscr   ldrh r3, [r0, #2]!
<br/>
   strh r3, [r1, #2]!
<br/>
   sub r2, r2, #1
<br/>
<br/>
   bne onscr
<br/>
   ldmfd r13!, {r14}
<br/>
vblnk:
<br/>
   stmfd r13!, {r14}
<br/>
   ldr r0, =#$04000000
<br/>
.wait1
<br/>
   ldrh r1, [r0, #4]
<br/>
   tst r1, #1
<br/>
   bne wait1
<br/>
.wait2
<br/>
   ldrh r1, [r0, #4]
<br/>
   tst r1, #1
<br/>
   beq wait2
<br/>
   ldmfd r14!, {r14}
<br/>
<br/>
@pool
<br/>
@endarea</td> </tr></table><span class="postbody">
<br/>
As always sorry for my english bugs :p.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37055 - ector - Sat Mar 05, 2005 9:05 pm</h4>
    <div class="postbody"><span class="postbody">use subs instead of sub, sub doesn't set the flags</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37087 - anoneem - Sun Mar 06, 2005 7:39 pm</h4>
    <div class="postbody"><span class="postbody">Oh man... What a shame. :)
<br/>
<br/>
Anyway, THX (or even THC :))!
<br/>
<br/>
But when I was trying to fix problems on my own by experimenting with dma, another thing started to making me sick. Can You or someone have a look?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">naekr:
<br/>
   stmfd r13!, {r14}
<br/>
.srcrg
<br/>
   ldr r0, =$040000d4
<br/>
   ldr r1, =$02000000
<br/>
   str r1, [r0]+4!
<br/>
.dstrg
<br/>
   ldr r1, =$06000000
<br/>
   str r1. [r0]+4!
<br/>
.cntrg
<br/>
   ldr r1, =#19200
<br/>
   strh r1, [r0]+2!
<br/>
.dmarg
<br/>
   ldr r1, =$940      ;bit 12 set - start in a v-blank interval
<br/>
   strh r1, [r0]
<br/>
   ldmfd r13!, {r14}</td> </tr></table><span class="postbody">
<br/>
<br/>
And the screen is dark...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
