<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Weird Error Message.... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>ASM > Weird Error Message....</h2>
<div id="posts">
<div class="post">
    <h4>#4107 - regularkid - Wed Mar 19, 2003 5:57 am</h4>
    <div class="postbody"><span class="postbody">Hi, I am using some code that had been working perfectly before:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
ldr r1, =videoBuffer   @ r1 = &amp;videoBuffer
<br/>
ldr r1, [r1]      @ r1 = videoBuffer
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then, the size of my assembly source code file increased by a huge amount and now I am getting this error for that same piece of code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Gfx.s:1026: Error: invalid literal constant: pool needs to be closer
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any ideas?<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4108 - pelrun - Wed Mar 19, 2003 6:11 am</h4>
    <div class="postbody"><span class="postbody">The ARM can't load arbitrary constants into registers directly.
<br/>
<br/>
If the constant can't be put in the form (C&amp;0xFF)&lt;&lt;(S*2) for some integers C and S (I think, I'm working from memory here)  then the constant is placed after the current function (in what is called the "pool") and the instruction is transparently changed to load the constant from there.
<br/>
<br/>
However, the new load instruction can only reach memory locations within a finite distance either side of it, so if your function gets too large then the pool moves out of range. To work around this, try splitting your code up into smaller functions, so the pools can live closer to the instructions that reference them.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4109 - regularkid - Wed Mar 19, 2003 7:12 am</h4>
    <div class="postbody"><span class="postbody">Since I need to be able to load these variables into registers and I don't want to change the size of my function, is there another way that I can load these variables into registers?<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4115 - joet - Wed Mar 19, 2003 2:10 pm</h4>
    <div class="postbody"><span class="postbody">Back in the days of the Acorn Archimedes (also an ARM machine) I used to get round this by loading address offsets from memory.
<br/>
<br/>
So further down the code I used to store the destination address in a memory location and load it from there ... pretty nasty, but it worked ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4117 - tepples - Wed Mar 19, 2003 4:33 pm</h4>
    <div class="postbody"><span class="postbody">Have you added more functions to your assembly file?  Try placing more .pool directives between the functions, or possibly a .pool at the beginning of the file.
<br/>
<br/>
Do you have a single function that has grown to 1 KB in size?  You'll have to break it up, or load the video buffer address manually.  If "videoBuffer" is 0x06000000 as I suspect (and not some sort of back buffer at some odd address in EWRAM), you can load it manually.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4119 - regularkid - Wed Mar 19, 2003 6:11 pm</h4>
    <div class="postbody"><span class="postbody">Good advice, I will try to add .pool statements and if that doesn't work, I can try breaking up my code. Thanks<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
