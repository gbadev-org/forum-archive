<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Complete Control with ARM ASM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Complete Control with ARM ASM</h2>
<div id="posts">
<div class="post">
    <h4>#110428 - alwbsok - Tue Nov 28, 2006 4:08 pm</h4>
    <div class="postbody"><span class="postbody">BEWARE: I'm a complete noob to assembling/assembly/GBA development
<br/>
<br/>
I would like to learn how to program the GBA with <span style="font-style: italic">complete</span> control over the hardware. No automatic boot code, no stack dictating where I store my memory, no functions I didn't write, etc. I know I need arm assembly, and I know some of the basic mnemonics (and have the resources to learn the rest - that isn't the issue).
<br/>
<br/>
What I'd like, is a link to something that can teach me the necessary code for booting up the machine, for hardware and software interrupts, and where memory is being used and where it isn't. Does anyone know how to program the GBA <span style="font-weight: bold">completely from scratch?</span>
<br/>
<br/>
Also, could anyone devise a make file to assemble such ASM programs properly with DevKitAdv, without introducing any foreign code? (please excuse the noobish question)
<br/>
<br/>
Thanks in advance...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110437 - Legolas - Tue Nov 28, 2006 5:15 pm</h4>
    <div class="postbody"><span class="postbody">Look at this <a class="postlink" href="http://nocash.emubase.de/magicflr.htm" target="_blank">example</a> ;)<br/>_________________<br/><a class="postlink" href="http://itaprogaming.free.fr/" target="_blank">My homepage</a>!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110485 - Miked0801 - Tue Nov 28, 2006 9:11 pm</h4>
    <div class="postbody"><span class="postbody">Curious - why do you want complete control over said system?  It's hard enough developing for it with the little gems created here and there...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110490 - sajiimori - Tue Nov 28, 2006 9:36 pm</h4>
    <div class="postbody"><span class="postbody">Because it's fun.  :)  I did it myself, then threw out the result and used prefab stuff.  The hardest (and most boring) part is learning GCC specifics, and in retrospect I would have been better off writing my own assembler, from an educational standpoint.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110493 - Dwedit - Tue Nov 28, 2006 10:21 pm</h4>
    <div class="postbody"><span class="postbody">To see how devkitpro sets up the GBA, look at devkitarm/arm-eabi/lib/gba_ctr0.s
<br/>
It is specific to devkitpro, so to see one for a different compiler, look at boot.s which comes with PocketNES.
<br/>
<br/>
What gba_crt0.s does:
<br/>
* Contain the required GBA header
<br/>
* Disable interrupts
<br/>
* Initialize the stacks (IRQ and USER)
<br/>
* If program should run from RAM, copy it from the cartridge to RAM.
<br/>
* Copy the data sections from ROM to RAM, both IWRAM and EWRAM.
<br/>
* Clear the rest of ram
<br/>
* Some stuff specific to devkitpro, like setting up the heap, and initializations for libc.
<br/>
* Call "main"
<br/>
<br/>
And that's it.  Nothing else, just your usual required startup code.
<br/>
<br/>
There is no way to bypass the GBA Bios.  You GBA will always display "Game Boy", play the sound effect, allow select+start for multiboot mode, etc.  You will need a valid ROM header and Nintendo logo.  The BIOS also has its own interrupt handler which always pushes r0-r3 onto the interrupt stack, then finally calls your interrupt handler.
<br/>
<br/>
As for "where memory is being used", here are the "reserved" memory areas:
<br/>
IN ROM:
<br/>
* Cartridge Header at 0x08000000 (224 bytes long)
<br/>
* Optional illegal instruction trap at 0x9ffc000
<br/>
<br/>
IN IWRAM:
<br/>
* The interrupt vector at 0x03007FFC  (this is the last word of IWRAM)
<br/>
Everything else is free for whatever you want to use it for.
<br/>
* Usually the stack is at 0x03007F00, and grows downwards, you don't need to put it there.
<br/>
* Usually the interrupt stack is at 0x03007F00-0x03007F9F, you don't need to put it there.
<br/>
* 0x03007FA0-0x03007FFB is used by some bios functions.
<br/>
<br/>
All of EWRAM and VRAM is free and you can do whatever you want with it.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110537 - alwbsok - Wed Nov 29, 2006 1:58 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the help, guys. I appreciate it. I certainly like the idea of doing my own compiler, so I might try that.
<br/>
<br/>
I also looked through a bit of CRT0.S, and it constantly wanted to copy things to the EWRAM or the stack. I don't know the code, what it does, what it uses in memory. I don't know if I want interrupts disabled. If anyone could help me understand not only what it does, but how it does it, I'd be very grateful.
<br/>
<br/>
Incidentally, I'm also in the market for a programmable cartridge to put my binaries on. I had my eye on this:
<br/>
SuperCard SD <span style="font-weight: bold">[state the product's name, not a retailer's URL -- MOD]</span>
<br/>
I'm wondering if it will act like a cartridge (and run from ROM), or a linker cable (and copy the code into the EWRAM). The latter could interfere with my  code. Could anyone help me there?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110557 - tepples - Wed Nov 29, 2006 5:54 am</h4>
    <div class="postbody"><span class="postbody">SuperCard copies the entire program into a RAM <span style="font-style: italic">on the adapter</span>. This RAM fills the same function as a traditional GBA flash card.
<br/>
<br/>
The adapter that runs only GBA multiboot programs is the GBA Movie Player v2.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110559 - Ant6n - Wed Nov 29, 2006 6:29 am</h4>
    <div class="postbody"><span class="postbody">why is there a second stack for irq?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110604 - Miked0801 - Wed Nov 29, 2006 9:16 pm</h4>
    <div class="postbody"><span class="postbody">This is a question I've wondered about myself and would like to hear a good answer for.  In the past and on other platofrms, one stack is fine.  Why 2 on ARM?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110620 - DekuTree64 - Wed Nov 29, 2006 11:28 pm</h4>
    <div class="postbody"><span class="postbody">The only reason I've come up with is to keep with the philosophy that all registers can be used as general-purpose if you want, including the stack pointer. So if you have the user mode r13 storing your loop counter or whatever, an interrupt can still safely occur.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110621 - tepples - Wed Nov 29, 2006 11:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">So if you have the user mode r13 storing your loop counter or whatever</td> </tr></table><span class="postbody">
<br/>
Then where would you store the stack pointer during the loop?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110622 - DekuTree64 - Wed Nov 29, 2006 11:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Then where would you store the stack pointer during the loop?</td> </tr></table><span class="postbody">
<br/>
Store it in a global variable, do your loop, and then load it back. And if you're executing from RAM, you can save a couple more cycles by putting that global variable near the loop so you can use PC-relative load/store.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110629 - gmiller - Thu Nov 30, 2006 12:19 am</h4>
    <div class="postbody"><span class="postbody">Each of the different processor modes has it own set of "banked" registers  and for interrupts the link register and stack pointer are the ones banked.  There are actually 37 registers and some of these other registers "become" standard registers based on the processor mode.
<br/>
<br/>
Some of the modes:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
User and System
<br/>
Fast Interrupt Request
<br/>
Interrupt Request
<br/>
Supervisor
<br/>
Undefined
<br/>
Abort
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Some of the ARM models may not have all of these modes but the basic architecture is this way.  My paraphrase may not be completely accurate but this is from the ARM System Developer's Guide ISBN 1-55860-874-5.  I use this book frequently because it covers the entire ARM core set.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110635 - tepples - Thu Nov 30, 2006 12:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Then where would you store the stack pointer during the loop?</td> </tr></table><span class="postbody">
<br/>
Store it in a global variable, do your loop, and then load it back.</span></td> </tr></table><span class="postbody">
<br/>
And lose <a class="postlink" href="http://en.wikipedia.org/wiki/Reentrant" target="_blank">reentrancy</a>, meaning you can't safely call such a routine from within an interrupt handler.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110638 - simonjhall - Thu Nov 30, 2006 12:47 am</h4>
    <div class="postbody"><span class="postbody">If you use two stacks then you can be sure that when an interrupt occurs there's no chance of trashing the regular user stack.
<br/>
If you build with (I think it's) -fomit-frame-pointer then leaf functions don't properly follow the ABI (in order to save a few instructions) and the stack is then handled slightly differently.
<br/>
If you happened to have an interrupt in one of these functions you can't be sure where the actual bottom of the stack is. By having two stacks you never have to deal with this sort of problem.
<br/>
<br/>
Does this make any sense? :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110642 - DekuTree64 - Thu Nov 30, 2006 1:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Then where would you store the stack pointer during the loop?</td> </tr></table><span class="postbody">
<br/>
Store it in a global variable, do your loop, and then load it back.</span></td> </tr></table><span class="postbody">
<br/>
And lose <a class="postlink" href="http://en.wikipedia.org/wiki/Reentrant" target="_blank">reentrancy</a></span></td> </tr></table><span class="postbody">
<br/>
Then reserve a larger area for that global, and treat it like a stack itself.
<br/>
<br/>
Simon has a good point too, that it does allow you to break the rule of "anything below the stack pointer is unpredictable". Still, there must be some reason for it beyond allowing you to get away with dirty hacks.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110645 - simonjhall - Thu Nov 30, 2006 1:23 am</h4>
    <div class="postbody"><span class="postbody">I guess also on other architectures the interrupts are handled in supervisor mode, which has its own memory space. So I'm sure there is more than one stack.
<br/>
<br/>
And this is probably overkill: interrupt handlers can often deal with 'sensitive' data and if there was only one stack then it'd have to be cleared off first before returning to the user program. Else the user program could look through the stack for something juicy!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110651 - keldon - Thu Nov 30, 2006 3:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">Else the user program could look through the stack for something juicy!</td> </tr></table><span class="postbody">
<br/>
<br/>
That is not very plausible. How would the program know when it has been interrupted and whether or not it will be interrupted again in between reading the stack? Although interrupts can be disabled how can it be ensured that an interrupt has occured and how to interpret any data that is found? How can it be detirmined what is random, what is from a called function, and what is from an interrupt?
<br/>
<br/>
Conceptually two stacks operate almost like two seperate CPU states. But again what is the need? What cannot be achieved by one stack that can be achieved with more? The only reason I can think of [so far] is a failsafe for errors that occur during interrupts meaning that an incorrect return will always return to the right line of code! Exceptions can be issued on the event, but the code can still resume from the correct place.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110669 - simonjhall - Thu Nov 30, 2006 8:46 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">That is not very plausible. How would the program know when it has been interrupted and whether or not it will be interrupted again in between reading the stack?</td> </tr></table><span class="postbody">
<br/>
<br/>
Ooh, I dunno! If I knew that the operating system shared the same stack as the user program then this'd be one of the first places I might look for some way into a system. And you're right - you wouldn't know when an interrupt occurs. So you could continually scan until something good appears - and you'd roughly know the format of the data you were looking for.
<br/>
<br/>
Although it's not an issue with homebrew on the DS, if the operating system were to share its stack with a user program that'd be a big hole for people to exploit. But as you say, it's not too plausible :-)
<br/>
<br/>
One more suggestion - by having a second stack you can be sure of the size of that stack. If you use the user stack there may not be the minimum amount of memory available for your interrupt to function. I've <span style="font-style: italic">definately</span> seen this problem before on consoles.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110674 - keldon - Thu Nov 30, 2006 9:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">Ooh, I dunno! If I knew that the operating system shared the same stack as the user program then this'd be one of the first places I might look for some way into a system. And you're right - you wouldn't know when an interrupt occurs. So you could continually scan until something good appears - and you'd roughly know the format of the data you were looking for.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But you can never be sure that you are seeing data and not random numbers or something that is irrelevant. You would also have to know where in the stack to find your data. Was it the first parameter? Second parameter? If it was the second parameter, how many bytes were the previous parameters?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110678 - simonjhall - Thu Nov 30, 2006 10:17 am</h4>
    <div class="postbody"><span class="postbody">You're right: that's a good point. Although I was really just thinking about strings of text, like char arrays.
<br/>
Aaaaanyway....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110741 - Miked0801 - Fri Dec 01, 2006 2:44 am</h4>
    <div class="postbody"><span class="postbody">Ok, for OS security I can definately see a use for 2 stacks.  Let the user stack go to hell or whatever, but the supervisor stack is secure and can recover.  Not an issue on GBA/DS, but ARM procs are used elsewhere as well :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110748 - Ant6n - Fri Dec 01, 2006 6:16 am</h4>
    <div class="postbody"><span class="postbody">regarding the initial post, asking for 'complete control'. I'd rather have it in C.
<br/>
Soo...
<br/>
Is there any good tutorial on how to put data and functions in different memory areas, how to put them in specific spots in memory, how to load them there temporarily (does 'sizeof' work on functions?) and how to keep memory areas clear so that I as a programmer can mess with them as i want without corrupting data that was put ther by the gcc. I remember reading some information regarding __atttr___, but all this information seems really scattered about.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110840 - Miked0801 - Sat Dec 02, 2006 3:01 am</h4>
    <div class="postbody"><span class="postbody">A few ways.  The easiest is to physically create a pointer to memory and "copy" the function to that area.  You can also create a memalloc system and do it that way.  Another way (probably the correct way) is to use the  link script to create sections and tell the compiler via the section attrib where to place the code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110856 - Ant6n - Sat Dec 02, 2006 7:10 am</h4>
    <div class="postbody"><span class="postbody">well, and how would one go about that...
<br/>
why is it called 'link' script, anyway? I thought its run before calling main, and should be a 'load' script?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110858 - poslundc - Sat Dec 02, 2006 7:55 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">well, and how would one go about that...
<br/>
why is it called 'link' script, anyway? I thought its run before calling main, and should be a 'load' script?</td> </tr></table><span class="postbody">
<br/>
<br/>
The link script is used as part of the build process; it's never "run" on target. It's called the link script because it informs the linker of things it needs to know, such as what memory sections are in what physical address locations. So the link script knows that section .ewram starts at 0x02000000 and is 256Kbytes long, section .iwram starts at 0x03000000 and is 32Kbytes long, etc.
<br/>
<br/>
(crt0 is probably what you were thinking of; it generally contains the setup code that is run before main.)
<br/>
<br/>
The only advice I can give for attempting to set up custom memory sections (other than reading the GNU man pages) is to examine the link script and try to understand how it works. It's not impossible to do, although there is some serious voodoo going on in there if you are unfamiliar with the process.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111231 - keldon - Tue Dec 05, 2006 12:59 am</h4>
    <div class="postbody"><span class="postbody">One thought though; how does ASM give you more control if you do not have much control over your ASM?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111242 - Ant6n - Tue Dec 05, 2006 4:20 am</h4>
    <div class="postbody"><span class="postbody">is there no simple way to reserve memory areas in gcc?
<br/>
something like
<br/>
'reserve  0x02000000 -  0x02000100 for user junk'
<br/>
how would one move a function during runtime?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111253 - poslundc - Tue Dec 05, 2006 8:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">is there no simple way to reserve memory areas in gcc?
<br/>
something like
<br/>
'reserve  0x02000000 -  0x02000100 for user junk'</td> </tr></table><span class="postbody">
<br/>
<br/>
Part of the whole idea behind sections is to avoid the code having to know the implementation specifics of where a region is located.
<br/>
<br/>
That said, when it comes to EWRAM there's nothing to prevent you from "reserving" that section of memory so long as it isn't being used for some overlapping purpose. That would include: compiling in multiboot, dynamic allocation with malloc/free, and anything you declare as being in section .ewram. If you aren't using any of those features, then feel free to grab a pointer to 0x02000000 and do what you will with it.
<br/>
<br/>
If you want to be compatible with GCC's comprehension of the GBA's memory regions, though, you're pretty much consigned to modifying the link script to add a section.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">how would one move a function during runtime?</td> </tr></table><span class="postbody">
<br/>
<br/>
Grab a pointer to the function, and copy from the pointer to your destination. Knowing the length of the function is a bit tricky if the function isn't in assembly, though. One technique is to declare a function immediately following your function that marks the end of it, although you have to be careful that function doesn't get optimized out. In sum: don't do it unless you absolutely have to.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111262 - chishm - Tue Dec 05, 2006 10:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">how would one move a function during runtime?</td> </tr></table><span class="postbody">
<br/>
<br/>
Grab a pointer to the function, and copy from the pointer to your destination. Knowing the length of the function is a bit tricky if the function isn't in assembly, though. One technique is to declare a function immediately following your function that marks the end of it, although you have to be careful that function doesn't get optimized out. In sum: don't do it unless you absolutely have to.</span></td> </tr></table><span class="postbody">
<br/>
Even if the dummy function doesn't get optimised out, there's no guarantee it'll be placed immediately after the desired function. The way I do it is get gcc to output the memory map, use that to calculate the length of the function, then hardcode that into the program as a constant. Even if you get the function moved correctly, you'll still have trouble with calls to other functions and using data in the literal pool. It is probably easiest to compile it as -fPIC.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111353 - Miked0801 - Tue Dec 05, 2006 7:51 pm</h4>
    <div class="postbody"><span class="postbody">Asserts will catch a change in function length if one uses constants for size - but it's sooo much easier to just declare a function to live in a certain section and letting crt0.s do the copy for you on bootup.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int foo(void)  __attribute__ ((section (".iwram")));
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111392 - tepples - Wed Dec 06, 2006 4:45 am</h4>
    <div class="postbody"><span class="postbody">What if you only want to have a function around in RAM while it is executing, such as if you want to load GSM or S3M or JPEG or video decoders at various times? Are there any code examples involving the support for overlays in devkitARM's GBA link script?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111398 - Ant6n - Wed Dec 06, 2006 6:09 am</h4>
    <div class="postbody"><span class="postbody">it seems at the end of the day, when one wants functions temporarily in ram (i.e. on the stack) one could always compile with -o0 -s and count how long the function is in assembler. then insert some padding (i.e. 2x) and that can be copied, cuz it doesn't matter if one copies too much (as far as i know). I do believe it could make sense at times to have functions use up precious fast memory only temporarily (i.e. for big library functions).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112525 - nornagon - Sun Dec 17, 2006 2:40 pm</h4>
    <div class="postbody"><span class="postbody">I, too, am interested in having "complete control" over the DS using ASM. I'd love to code everything up from scratch (not that I'd do anything serious with it; it'd be purely for educational purposes). What's the best way of going about it? If I have a .s file (or some .s files), how do I link them all and drop them on the DS, <span style="font-weight: bold">without anything else</span>?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112529 - keldon - Sun Dec 17, 2006 4:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">One thought though; how does ASM give you more control if you do not have much control over your ASM?</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112537 - Ant6n - Sun Dec 17, 2006 7:33 pm</h4>
    <div class="postbody"><span class="postbody">.s files can be compiled and linked like .c files with gcc. So it shouldnt make much of a difference whether you use c or asm.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112550 - nornagon - Sun Dec 17, 2006 9:54 pm</h4>
    <div class="postbody"><span class="postbody">Point is, dkA and libnds still add things behind the scene. Can I write the whole shebang, from startup to power off, in assembler?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112552 - keldon - Sun Dec 17, 2006 9:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">Point is, dkA and libnds still add things behind the scene. Can I write the whole shebang, from startup to power off, in assembler?</td> </tr></table><span class="postbody">
<br/>
<br/>
If you are capable of coding this in complete assembler then it should not be too difficult to write your own assembler that can deal with this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112554 - nornagon - Sun Dec 17, 2006 10:00 pm</h4>
    <div class="postbody"><span class="postbody">Sure; but if there's already one that can do it, why?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112557 - keldon - Sun Dec 17, 2006 10:06 pm</h4>
    <div class="postbody"><span class="postbody">Because you can make yourself something better for you that can help you to write better more managable code. Take a look at <a class="postlink" href="http://betov.free.fr/" target="_blank">rosasm</a> for an example of what an assembler can be.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112560 - nornagon - Sun Dec 17, 2006 10:19 pm</h4>
    <div class="postbody"><span class="postbody">It looks like a glorified IDE with NASM-like syntax to me. Am I missing something?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112570 - keldon - Sun Dec 17, 2006 11:31 pm</h4>
    <div class="postbody"><span class="postbody">Check out its macros!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112581 - nornagon - Mon Dec 18, 2006 5:03 am</h4>
    <div class="postbody"><span class="postbody">Man, the website is horrible...
<br/>
<br/>
I found some short examples of the macro syntax, but I'm not quite sure what's going on. Enlighten me?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112582 - Ant6n - Mon Dec 18, 2006 5:54 am</h4>
    <div class="postbody"><span class="postbody">macros on asm?
<br/>
C is bunch of asm macros.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112591 - keldon - Mon Dec 18, 2006 11:04 am</h4>
    <div class="postbody"><span class="postbody">The macro syntax is so powerful I managed to write one that allows you to reference data like in c.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">d = b . c . d . e . f</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Proc mainWinProc:
<br/>
    Arguments @hWnd @uMsg @wParam @lParam
<br/>
    Local @MyScreenText</td> </tr></table><span class="postbody">
<br/>
Those 3 lines are done via macros. So you can usually make use of just the default macros, but the versatility of them allows you to make macros as powerful as that.
<br/>
<br/>
The syntax has funny characters for good reason, once you get past that it would [obviously] make complete sense. The <a class="postlink" href="http://nessie.emubase.de/" target="_blank">nessie</a> NES emulator was written entirely using this IDE.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119555 - werty - Sat Feb 24, 2007 7:53 am</h4>
    <div class="postbody"><span class="postbody">If you use what others have programmed , 
<br/>
 you must learn their methods .  
<br/>
         This is slow way .  
<br/>
   You must learn their secrets , even Linux
<br/>
  is hard to work with .
<br/>
<br/>
<br/>
  BUT ! If you start your own Op System ,
<br/>
  from scratch , you will be able to perfect it
<br/>
  quickly , because no dependencies on others.
<br/>
<br/>
    Thats what im doin .  
<br/>
  I have 10 NDS lites  and many ARM EVB's
<br/>
<br/>
  I will start with zero , no ARM loader , no
<br/>
 ANGEL debugger , no assembler , no CAPS
<br/>
 no C++ , not even Basic !
<br/>
   I tried to use ATMELs Sam-Ba to load
<br/>
 code to my Olimex ARM H256 .
<br/>
  It does NOT work , and ATMEL has 100 excuses.
<br/>
<br/>
   So i'll boot external , and load my hand assembled
<br/>
  500 bytes of code , to boot to SRAM and scan
<br/>
  for a 16 keypad .
<br/>
    The 500 bytes will be able to create a dictionary .
<br/>
  If i test a small asm code , and it works , 
<br/>
  i'll save it to dictionary .  Now i can enter
<br/>
  a hex code to execute that code fragment !
<br/>
<br/>
  This is called software "leverage" .
<br/>
<br/>
  I'll hook 32  LEDs to a port .
<br/>
  Or maybe a BW LCD .
<br/>
<br/>
  There is no faster nor more accurate method
<br/>
 to learn op codes .  Studying assemblers , will take
<br/>
 longer and you will not understand op codes
<br/>
 as fast because assemblers make you wait til
<br/>
 it's linked and then you load the debugger 
<br/>
 and then , and then , and then , and then ....
<br/>
<br/>
   My method crashes and you look at the
<br/>
 12 op codes you tested and guess at one 
<br/>
  and try again .  There is no better way
<br/>
 to learn Machine language !
<br/>
   Naturally you will start to learn the
<br/>
  easiest codes , first , so you can use
<br/>
 them to leverage the others .
<br/>
<br/>
<br/>
   Now you create 64 bit images for the stuff
<br/>
  in the Dictionary , so you can assemble ML
<br/>
  w/o ASCII text .  Your keypad is only 16 keys
<br/>
  it can't do ASCII text .
<br/>
   You can create a simple MRU , MostRecentlyUsed
<br/>
  stack , to display your Images on the LCD .
<br/>
<br/>
  Here is where many make the mistake to
<br/>
 think they must copy C++ or Basic methods .
<br/>
<br/>
    In only 8 KB , you have a Op System , that
<br/>
  can create ML in minutes , with typing text at a 
<br/>
  QWERTY keyboard .    
<br/>
<br/>
 It is missing some OpCodes , but no problem , 
<br/>
 and the dictionary is expanding into the 64KB SRAM
<br/>
 in my Olimex   AR91SAM7S256  ARM7 EVB .
<br/>
<br/>
   When you perfect the lower part of the dictionary
<br/>
  you can flash it into the 256KB of NOR flash .
<br/>
    I will not be copying FAT32 nor NDS OpSys 
<br/>
  everything will be new .
<br/>
<br/>
   More on Dictionary ...
<br/>
  When you have 100 "primatives" that help you
<br/>
 to code ML , next create "mid levels" , that can 
<br/>
 "Macro" the Primatives together , then create an
<br/>
  image so you can run it .
<br/>
  Now you have more leverage .
<br/>
<br/>
  You dont need to study IEEE F.P. , because
<br/>
 math , in cpu's is separate EXP and Mantissa .
<br/>
   We call it scaling and normalizing .
<br/>
  Your numbers , will be in a "context" , and
<br/>
 NOT in a standard form , as C++ forces .
<br/>
    So each set of numbers will have its own
<br/>
 std , depending on where they are used .
<br/>
<br/>
  I.E. , you are encoding MPG , and need fast
<br/>
 Cosines .  Experiment with normalizing to LOG .
<br/>
  Now you can divide numbers by simply subtracting
<br/>
 them !  And the LOG looks a bit like an exponent !
<br/>
<br/>
   No matter how much you pay your school , they
<br/>
 will NOT teach you this kind of programming!
<br/>
<br/>
  My OpSystem will use NO text , only Images .
<br/>
<br/>
<br/>
   I think everyone who likes to program ARM
<br/>
 should buy the $48  Olimex  "H256" from 
<br/>
<span style="font-weight: bold">[URL removed by MOD]</span>
<br/>
  It has USB "B" connector to start talking to
<br/>
 PC host , using Hyperterminal .  No power
<br/>
 supply needed , it uses USB power .
<br/>
  I have 3 .  Im hooking them to LCD's i
<br/>
  got for $10 .  
<br/>
<br/>
   I will test code , then move it to NDS Lites .
<br/>
  Im not a gamer , so i'll completely replace
<br/>
  the Op System , to handle a 120 GB HDD .
<br/>
  But NOT FAT32 !   It will be my own protocol .</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119612 - Miked0801 - Sat Feb 24, 2007 7:07 pm</h4>
    <div class="postbody"><span class="postbody">This looks like something I used to write in a journal right after I woke up from a dream with a 'great idea'.  Good luck you rebel you.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
