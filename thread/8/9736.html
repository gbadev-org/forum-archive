<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Weird ARM Instruction - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Weird ARM Instruction</h2>
<div id="posts">
<div class="post">
    <h4>#85357 - StiNKy - Mon May 29, 2006 10:10 am</h4>
    <div class="postbody"><span class="postbody">Hi all.
<br/>
<br/>
Not too sure if I'm posting in the correct forum, so please bare with me if I'm not.
<br/>
<br/>
I'm trying to decode this ARM instruction, but I'm having a little trouble identifying what it is, it's hexcode is: 0xE121F000.
<br/>
<br/>
The closest match I can find is MSR, but it definatly can't be it, observe:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Instruction:     1110 00010 0 1000011111 00000000 0000
<br/>
MSR instruction: cond 00010 P 1010011111 00000000 Rm..
<br/>
                            ^   ^                 ^
<br/>
                            |   + incorrect bit   + source register
<br/>
                            + Destination PSR (0=CPSR, 1=SPSR)</td> </tr></table><span class="postbody">
<br/>
<br/>
This instruction was found on a DS rom, hence why I wasn't sure if this was the correct forum...
<br/>
Can anyone help shed light on this subject?
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85358 - keldon - Mon May 29, 2006 10:18 am</h4>
    <div class="postbody"><span class="postbody">Are you sure that this is code and not data?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85364 - StiNKy - Mon May 29, 2006 1:41 pm</h4>
    <div class="postbody"><span class="postbody">100%, and just to confirm it: all the code around it is very logical, ie: mov operations into a register, then an ldr or an str after it using the same register.
<br/>
edit: Oh and all the code around it all have the "AL" condition, which also helps demonstrate it's real ARM code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85367 - chishm - Mon May 29, 2006 2:43 pm</h4>
    <div class="postbody"><span class="postbody">MSR to SPSR, write to flags and control field, using register Rm as source.
<br/>
Source: <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#arm6psrtransfermrsmsr" target="_blank">GBATek</a>
<br/>
<br/>
Oh, and this probably belongs in the ASM section.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85370 - keldon - Mon May 29, 2006 3:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>StiNKy wrote:</b></span></td> </tr> <tr> <td class="quote">100%, and just to confirm it: all the code around it is very logical, ie: mov operations into a register, then an ldr or an str after it using the same register.
<br/>
edit: Oh and all the code around it all have the "AL" condition, which also helps demonstrate it's real ARM code.</td> </tr></table><span class="postbody">
<br/>
<br/>
That does not tell you that the next instruction will be code. Could be just empty space for self modifying code, but you've got your answer now anyway.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130063 - Augustus - Wed May 30, 2007 5:34 pm</h4>
    <div class="postbody"><span class="postbody">Haha, I had the exact same problem a week ago. I was overlooking something evidentially, but yeah, it's definitely MSR. Chances are high that it's changing the mode to set the IRQ and user stack. That's one of the first things in crt0.<br/>_________________<br/>One of these things is not like the others
<br/>
One of these things just doesn't belong
<br/>
Can you tell me which thing is not like the others
<br/>
By the time I finish my song</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135019 - kiwi.ds - Thu Jul 19, 2007 12:24 pm</h4>
    <div class="postbody"><span class="postbody">this is the instruction:
<br/>
<br/>
MSR CPSR_c, r0<br/>_________________<br/><a href="http://kiwi.ds.googlepages.com/sdat.html" target="_blank">http://kiwi.ds.googlepages.com/sdat.html</a>
<br/>
<a href="http://kiwi.ds.googlepages.com/nsbmd.html" target="_blank">http://kiwi.ds.googlepages.com/nsbmd.html</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
