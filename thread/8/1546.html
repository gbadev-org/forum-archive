<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Benchmarking Code on Hardware - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Benchmarking Code on Hardware</h2>
<div id="posts">
<div class="post">
    <h4>#7888 - funkeejeffou - Fri Jun 27, 2003 12:39 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I've been wondering how to benchmark code on hardware(even on emulator though).
<br/>
I would like to run a loop on my GBA, and with the help of a timer, I'd like to measurate it's performance. How can I output the timer value after the loop's end from the GBA to my PC?
<br/>
I have a USB linker with a 128 MB F2A flash cart. Please tell me it is possible!!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7891 - niltsair - Fri Jun 27, 2003 3:25 pm</h4>
    <div class="postbody"><span class="postbody">You'll have to print the result to screen using some tiles. If you really want the result on your computer then you could output results to SRAM (gamepak save game) and retrieve it afterward with your usb linker.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7897 - Lupin - Fri Jun 27, 2003 7:50 pm</h4>
    <div class="postbody"><span class="postbody">I already thought about that too, I think I'm going to write an simple test environment to perform speed tests.
<br/>
<br/>
You will need an int-&gt;string function to convert the result into an readable string if you don't want to use library functions (I prefer doing so, because I like to write my own funcs in asm).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7924 - funkeejeffou - Sat Jun 28, 2003 7:17 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, I'm gonna try the SRAM thing then.
<br/>
If anybody has done it before, could you please give us some hints?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8756 - sgstair - Sat Jul 19, 2003 4:29 am</h4>
    <div class="postbody"><span class="postbody">Here's some code to profile things:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   .GLOBAL ProfileBegin, ProfileEnd
<br/>
<br/>
@ void ProfileBegin(void);
<br/>
<br/>
ProfileBegin:
<br/>
   mov      r3,#0x04000000
<br/>
   add      r3,r3,#0x00100
<br/>
   mov      r0,#0
<br/>
   mov      r1,#0x0080
<br/>
   mov      r2,#0x0084
<br/>
   strh   r0,[r3,#8]
<br/>
   strh   r0,[r3,#12]
<br/>
   strh   r2,[r3,#14]
<br/>
   strh   r1,[r3,#10]
<br/>
   bx      lr
<br/>
<br/>
<br/>
@ u32 ProfileEnd(void);
<br/>
<br/>
ProfileEnd:
<br/>
   mov      r3,#0x04000000
<br/>
   add      r3,r3,#0x00100
<br/>
   mov      r0,#0
<br/>
   strh   r0,[r3,#10]
<br/>
   strh   r0,[r3,#14]
<br/>
   ldrh   r0,[r3,#8]
<br/>
   ldrh   r1,[r3,#12]
<br/>
   add      r0,r0,r1,LSL #16
<br/>
   bx      lr
<br/>
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
Just slap it in a .s file and add the .o file to your makefile, then you can call the functions using the commented prototypes..
<br/>
<br/>
To get the profiler's overhead for wherever you put it:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u32 profileroverhead;
<br/>
ProfileBegin();
<br/>
profileroverhead=ProfileEnd();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
If you have a multiboot cable for returning results I'd suggest using it, other than that printing the results to screen is only a few lines of code.
<br/>
<br/>
Hope this helps
<br/>
-Stephen</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
