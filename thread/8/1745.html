<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>predefining variables doesnt work ... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>ASM > predefining variables doesnt work ...</h2>
<div id="posts">
<div class="post">
    <h4>#8911 - wasiliy - Wed Jul 23, 2003 6:43 pm</h4>
    <div class="postbody"><span class="postbody">hi
<br/>
i'm using armsdt and i'm trying to predefine a variable
<br/>
<br/>
color DCB 1
<br/>
<br/>
when i try to load the value via 
<br/>
<br/>
ldr r2,=color
<br/>
ldrb r1,[r2]
<br/>
<br/>
it doesnt work. r1 seems still to be zero. here is the whole code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   AREA  new, CODE, READONLY
<br/>
   ENTRY
<br/>
main
<br/>
   mov r0,#0x4000000
<br/>
   ldr r1,=0x404
<br/>
   str r1,[r0]                  ; set gfx mode 4
<br/>
<br/>
   ldr r0,=0x05000002   ; set color 1 to white
<br/>
   ldr r1,=0x0FFFF
<br/>
   strh r1,[r0]
<br/>
   
<br/>
   ldr r0,=0x6000000    ; set a white pixel on screen
<br/>
   ldr r2,=color
<br/>
   ldrb r1,[r2]
<br/>
   strb r1,[r0,#10]
<br/>
<br/>
infinit
<br/>
   b infinit
<br/>
   
<br/>
   AREA  Block, DATA, READWRITE
<br/>
color DCB 1
<br/>
   END
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
when i just load 1 into the r1 register by using
<br/>
<br/>
mov r1,#1
<br/>
<br/>
it works but when i try to load a 1 from memory it doesnt.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8977 - funkeejeffou - Fri Jul 25, 2003 11:30 am</h4>
    <div class="postbody"><span class="postbody">Really weird if it works when you move r1 manually...
<br/>
Try doing strh r1, [r0, #10] as the video bus is 16 bits wide (strb souldn't work). It will store the white color in the pixel 11. If you wanna store the white color in pixel 10, mov r1, r1 lsl#8 so that 1 will be in the 8 upper bits; then store it like above : strh r1, [r0, #10].
<br/>
<br/>
Also, white color is not 0xFFFF as each RVB value is 5bit coded.
<br/>
so white is 31 + 32*31 + 1024*31 = 0x7FFF. Same for the other colors.
<br/>
<br/>
When you store the video mode at 0x4000000, you should also use strh as the VIDEO_REG is 16 bit wide. Register from 0x4000002 to 0x4000004 is undocumented, but better not write to it.
<br/>
<br/>
Hope this helps.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9025 - wasiliy - Sat Jul 26, 2003 5:46 pm</h4>
    <div class="postbody"><span class="postbody">thank you for your reply,
<br/>
but i've already solved the problem. it was a memory issue. i cant write to rom thats why the assembler wont predefine the variable when i'm in readwrite mode. i have to define my data to readonly and copy it to ram manually, it works then.
<br/>
it was my fault, that i didnt tell you where i stored my data, sorry.
<br/>
but again, thanks for your effort.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
