<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Function call returning.... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>ASM > Function call returning....</h2>
<div id="posts">
<div class="post">
    <h4>#10691 - regularkid - Fri Sep 12, 2003 6:43 pm</h4>
    <div class="postbody"><span class="postbody">Quick question:
<br/>
<br/>
When you use a 'bl' or 'bx' instruction to call a function, does it automatically save/push the return address on the stack, or do you have to do this manually. Basically, i'm asking if I do nested function calls in ASM, do I need to worry about saving the return address for each one on the stack, or is this done automatically? Thanks!<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10693 - sajiimori - Fri Sep 12, 2003 6:57 pm</h4>
    <div class="postbody"><span class="postbody">bl saves the return address in r14, not on the stack.  bx doesn't save anything at all, and "bx lr" is often used for returning.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10694 - DekuTree64 - Fri Sep 12, 2003 8:51 pm</h4>
    <div class="postbody"><span class="postbody">You do need bx for calling thumb code from arm/arm code from thumb, and for that, use 
<br/>
mov lr, pc
<br/>
bx r0 (or whatever reg your function's address is in)
<br/>
pc points to 2 instructions ahead, so that will put the address of the instruction after the bx in lr, which is where you want to return to. You do need to push lr onto the stack before calling other functions though, since you're overwriting it with the new return address. Usually it's easiest to just push everything you need to right at the start, and pop it all back fight before you return.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10695 - regularkid - Fri Sep 12, 2003 8:58 pm</h4>
    <div class="postbody"><span class="postbody">Cool, that helps. Thanks!<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
