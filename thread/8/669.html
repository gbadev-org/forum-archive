<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Newbie- problems displaying a sprite. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Newbie- problems displaying a sprite.</h2>
<div id="posts">
<div class="post">
    <h4>#3468 - Saj - Tue Feb 25, 2003 4:27 pm</h4>
    <div class="postbody"><span class="postbody">Here is the code;
<br/>
 (I'm using goldroad 1.7 to compile it)
<br/>
 (gifs2sprites to convert it.)
<br/>
 (CtoASM to convert it.) 
<br/>
 (VBA(win) to test it)
<br/>
:-
<br/>
<br/>
It just displays 4 vertical lines (grey and blue) instead of a 16 color,32x32 picture of a head. What gives?!
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
@include screen.h
<br/>
@include sprites.h
<br/>
<br/>
b start
<br/>
@include manhead.h
<br/>
start:
<br/>
<br/>
Init_Sprites   
<br/>
<br/>
ldr r1,=REG_DISPCNT
<br/>
ldr r2,=(MODE_0|BG2_ENABLE|OBJ_ENABLE|OBJ_MAP_1D)
<br/>
str r2,[r1]
<br/>
<br/>
ldr r0,=OAM
<br/>
ldr r1,=(SQUARE|COLOR_16|10)|((SIZE_32|10)&lt;&lt;16)
<br/>
str r1,[r0]+4!
<br/>
ldr r1,=0
<br/>
str r1,[r0]
<br/>
<br/>
ldr r1,=(SQUARE|COLOR_16|10)|((SIZE_32|10)&lt;&lt;16)
<br/>
<br/>
ldr r1,=OBJPAL
<br/>
ldr r2,=128
<br/>
ldr r3,=pallete
<br/>
<br/>
palloop:
<br/>
ldr r7,[r3]+4!
<br/>
str r7,[r1]+4!
<br/>
subs r2,r2,1
<br/>
bne palloop
<br/>
<br/>
ldr r1,=CHARMEM
<br/>
ldr r2,=128
<br/>
ldr r3,=obj0
<br/>
<br/>
sprloop:
<br/>
ldr r7,[r3]+4!
<br/>
str r7,[r1]+4!
<br/>
subs r2,r2,1
<br/>
bne sprloop
<br/>
<br/>
infiniteloop
<br/>
b infiniteloop
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and here is the sprite (manhead.h) :-
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
pallete:
<br/>
@DCW (( 0)+( 0&lt;&lt;5)+( 0&lt;&lt;10))
<br/>
@DCW (( 0)+( 0&lt;&lt;5)+( 0&lt;&lt;10))
<br/>
@DCW (( 8)+( 5&lt;&lt;5)+( 0&lt;&lt;10))
<br/>
@DCW ((30)+(17&lt;&lt;5)+(12&lt;&lt;10))
<br/>
@DCW ((30)+(30&lt;&lt;5)+( 0&lt;&lt;10))
<br/>
@DCW (( 0)+(17&lt;&lt;5)+(26&lt;&lt;10))
<br/>
@DCW ((28)+(17&lt;&lt;5)+( 5&lt;&lt;10))
<br/>
@DCW ((30)+( 0&lt;&lt;5)+( 3&lt;&lt;10))
<br/>
@DCW ((30)+(30&lt;&lt;5)+(30&lt;&lt;10))
<br/>
obj:
<br/>
@DCW 0x4211, 0x6442
<br/>
@DCW 0x2421, 0x4644
<br/>
@DCW 0x6211, 0x6464
<br/>
@DCW 0x2111, 0x6446
<br/>
@DCW 0x1111, 0x2322
<br/>
@DCW 0x1111, 0x8332
<br/>
@DCW 0x2111, 0x3333
<br/>
@DCW 0x1111, 0x3332
<br/>
@DCW 0x2244, 0x1111
<br/>
@DCW 0x6464, 0x1112
<br/>
@DCW 0x4644, 0x1126
<br/>
@DCW 0x6446, 0x1124
<br/>
@DCW 0x3468, 0x1124
<br/>
@DCW 0x3438, 0x1123
<br/>
@DCW 0x3333, 0x1112
<br/>
@DCW 0x2333, 0x1111
<br/>
@DCW 0x1111, 0x7721
<br/>
@DCW 0x1111, 0x3321
<br/>
@DCW 0x1111, 0x2211
<br/>
@DCW 0x1111, 0x8211
<br/>
@DCW 0x1111, 0x7821
<br/>
@DCW 0x1111, 0x5521
<br/>
@DCW 0x1111, 0x5582
<br/>
@DCW 0x2211, 0x2221
<br/>
@DCW 0x1233, 0x1111
<br/>
@DCW 0x2533, 0x1111
<br/>
@DCW 0x5553, 0x1112
<br/>
@DCW 0x5555, 0x1125
<br/>
@DCW 0x7555, 0x1127
<br/>
@DCW 0x5777, 0x1125
<br/>
@DCW 0x5333, 0x1125
<br/>
@DCW 0x1111, 0x1111
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3506 - TurboHz - Wed Feb 26, 2003 9:28 am</h4>
    <div class="postbody"><span class="postbody">I'm also a newbie, and something that has been extremely helpful for me is using the tools in VBA.
<br/>
<br/>
First of all I'll check if you can see the tiles in "Tile viewer"... use the palette slider to select the right palette for the tiles. Go to th "Palette viewer" to see if the palette has been set and if its been set as tile or sprite palette.
<br/>
<br/>
Finally have a peek at the "OAM viewer" to check if the sprite has been well defined.
<br/>
<br/>
Just as a last comment, I'm not sure of this one, but I had trouble converting 16 colour sprites with many of those utilities (gif2sprites and many others are written only for 256 colour image data). I'm now using bmp2raw to convert 16 colour data, and it works (just make sure the bmp has a bit depth of 4 and the pallete is used, 'cos some image packages apply a standard palette to 4bit bmps...).
<br/>
<br/>
Good luck!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3852 - Saj - Mon Mar 10, 2003 8:58 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, I'm now using pcxgba and it seems to be fine. 
<br/>
<br/>
My artist is using gifs so one of these days I want to write a windows program that :-
<br/>
<br/>
Step 1. Cuts up the individual frames of the animated gif.
<br/>
<br/>
Step 2. Converts each frame into individual PCX files.
<br/>
<br/>
Step 3. Converts each PCX file into a usable C/Header file.
<br/>
<br/>
Step 4. Combines the seperate header files into one for easy
<br/>
           use as a 1D array for programing.
<br/>
<br/>
Step 5. rewards me by making me a nice cup of tea.
<br/>
<br/>
Unless you guys know of a program that does this....</span><span class="gensmall"><br/><br/>Last edited by Saj on Tue Mar 11, 2003 10:33 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#3856 - Lord Graga - Mon Mar 10, 2003 10:01 pm</h4>
    <div class="postbody"><span class="postbody">Shouldn't it be:
<br/>
<br/>
palloop: 
<br/>
ldr r7,[r3]+4! 
<br/>
str r7,[r1]+4! 
<br/>
subs r2,r2,1
<br/>
cmp r2, 0 
<br/>
bne palloop</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3872 - arundel - Tue Mar 11, 2003 12:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lord Graga wrote:</b></span></td> </tr> <tr> <td class="quote">Shouldn't it be:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">palloop: 
<br/>
ldr r7,[r3]+4! 
<br/>
str r7,[r1]+4! 
<br/>
subs r2,r2,1
<br/>
cmp r2, 0 
<br/>
bne palloop</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
either
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">palloop: 
<br/>
ldr r7,[r3]+4! 
<br/>
str r7,[r1]+4! 
<br/>
sub r2,r2,1
<br/>
cmp r2, 0 
<br/>
bne palloop</td> </tr></table><span class="postbody">
<br/>
<br/>
or
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">palloop: 
<br/>
ldr r7,[r3]+4! 
<br/>
str r7,[r1]+4! 
<br/>
subs r2,r2,1
<br/>
bne palloop</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="font-weight: bold">http://www.nausicaa.net</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3875 - Kay - Tue Mar 11, 2003 1:51 pm</h4>
    <div class="postbody"><span class="postbody">The good question is why do you use <span style="color: red">OR 10 </span> to setup the sprite ???
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
ldr r1,=(SQUARE|COLOR_16|10)|((SIZE_32|10)&lt;&lt;16) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
-- Kay</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3881 - tepples - Tue Mar 11, 2003 5:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kay wrote:</b></span></td> </tr> <tr> <td class="quote">The good question is why do you use <span style="color: red">OR 10 </span> to setup the sprite ???</td> </tr></table><span class="postbody">
<br/>
to place the sprite at (10, 10) on screen, apparently<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3882 - tepples - Tue Mar 11, 2003 5:29 pm</h4>
    <div class="postbody"><span class="postbody">Saj:
<br/>
<br/>
ImageMagick can do steps 1 and 2.
<br/>
<br/>
Steps 3 and 4: convert images to binary files, 'cat' the binary files, and then either convert them to a .s file or place them in a <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GBFS archive</a>.
<br/>
<br/>
Oh, and by the way, ask your artist to switch from GIF to <a class="postlink" href="http://www.libpng.org/pub/mng/" target="_blank">MNG</a> because of the advantages MNG has over GIF (better compression, no patent problems anywhere on earth, gamma correction, alpha blending, true color, etc) in every area other than IE browser support (IE can display only <a class="postlink" href="http://www.libpng.org/pub/png/" target="_blank">the still version</a>).
<br/>
<br/>
And for step 5, just buy a case of canned Lipton iced tea. (Note: this is for the USA; do they even drink iced tea in the UK?)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3888 - Kay - Tue Mar 11, 2003 9:00 pm</h4>
    <div class="postbody"><span class="postbody">My latest reply to this post was a mistake (badly click to submit instead of preview), please read:
<br/>
<br/>
Why do you put this line 2 times ?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ldr r1,=(SQUARE|COLOR_16|10)|((SIZE_32|10)&lt;&lt;16) </td> </tr></table><span class="postbody">
<br/>
<br/>
And please notice that Obj parameters are halfword (16 bits).
<br/>
Writting a Word results in inversion of bytes order due to indianness of bytes storage of GBA ARM7.
<br/>
<br/>
Simply try to write halfwords.
<br/>
<br/>
<br/>
-- Kay</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3889 - Kay - Tue Mar 11, 2003 9:00 pm</h4>
    <div class="postbody"><span class="postbody">My latest reply to this post was a mistake (badly click to submit instead of preview), please read:
<br/>
<br/>
Why do you put this line 2 times ?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ldr r1,=(SQUARE|COLOR_16|10)|((SIZE_32|10)&lt;&lt;16) </td> </tr></table><span class="postbody">
<br/>
<br/>
And please notice that Obj parameters are halfword (16 bits).
<br/>
Writting a Word results in inversion of bytes order due to indianness of bytes storage of GBA ARM7.
<br/>
<br/>
Simply try to write halfwords.
<br/>
<br/>
<br/>
-- Kay</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3897 - FluBBa - Wed Mar 12, 2003 8:31 am</h4>
    <div class="postbody"><span class="postbody">Where does CHARMEM point to?<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3963 - Saj - Thu Mar 13, 2003 8:49 pm</h4>
    <div class="postbody"><span class="postbody">Tepples, you da man!!!
<br/>
<br/>
Should've known I'd get a great response from you!
<br/>
<br/>
I'll get ImageMagick asap &amp; NO, What is ice tea?!?
<br/>
<br/>
Good ol' Earl grey served up from a type 4 replicator's the good stuff!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4696 - idle - Mon Apr 07, 2003 5:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Saj wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
ldr r3,=obj0
<br/>
-------------------
<br/>
obj:
<br/>
[/code]</td> </tr></table><span class="postbody">
<br/>
<br/>
the solution is actually quite a lot simpler.
<br/>
<br/>
see those two quoted lines?
<br/>
<br/>
they don't match.
<br/>
<br/>
change the first to ldr r3,=obj or change the label in the included file to read obj0: and it'll work.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
