<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>registers in ARM mode - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>ASM > registers in ARM mode</h2>
<div id="posts">
<div class="post">
    <h4>#81482 - Fry_Day - Sat Apr 29, 2006 1:55 pm</h4>
    <div class="postbody"><span class="postbody">well, this is my first time coding for the platform, and I just wondered if using all the registers was safe.
<br/>
<br/>
let me emphasize that I know ARM assembly, it's just an odd wonder about the environment.
<br/>
The reason I ask is that I noticed the BIOS's interrupt handler doesn't push all the high registers, and, whilst I know a function is supposed to preserve registers it changes on the stack, I really don't know if they have any special meaning (e.g., in the RealView ARM C compiler (The official compiler), it uses R9 as a pointer to imagebase when generating PIC code, so it mustn't be changed ever).<br/>_________________<br/>"Facts Shmacts! They can prove even remotely true things!" -Homer Simpson</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#81503 - poslundc - Sat Apr 29, 2006 4:25 pm</h4>
    <div class="postbody"><span class="postbody">The BIOS interrupt handler observes the ARM intra-procedure call standard (you can google it).
<br/>
<br/>
The short of it is that any function that's called gets r0-r3 and r12 for free, but is responsible for preserving r4-r11 and sp across the function call. (The link register r14 does not need to be preserved, but contains the return address so usually at least needs to be stored.)
<br/>
<br/>
This applies to ISRs as well as normal functions. So if your ISR needs to use r9, then it needs to save r9's value and restore it before exiting to the calling procedure.
<br/>
<br/>
This is also why functions that are going to require use of all of the registers are typically framed at the beginning and end with:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">stmfd     sp!, {r4-r11, lr}
<br/>
...
<br/>
ldmfd     sp!, {r4-r11, pc}
<br/>
<br/>
# (or for Thumb compatibility)
<br/>
ldmfd     sp!, {r4-r11, lr}
<br/>
bx     lr
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
