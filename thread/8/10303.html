<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GCC equivalent to SDT's MAP directive? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > GCC equivalent to SDT's MAP directive?</h2>
<div id="posts">
<div class="post">
    <h4>#91865 - Dwedit - Mon Jul 10, 2006 8:37 am</h4>
    <div class="postbody"><span class="postbody">Does GCC have an equivalent to ARM SDT's MAP directive?  PocketNES heavily uses this feature, and it would be hard to do without it.
<br/>
<br/>
The MAP directive takes in a register, then defines offsets from that register.  
<br/>
for example:
<br/>
 MAP 0,r11
<br/>
nes_ram # 0x800
<br/>
nes_sram # 0x2000
<br/>
chr_decode # 0x400
<br/>
...
<br/>
<br/>
Here nes_sram becomes [r11+0x800] when used in an instruction like ldr r0,nes_sram
<br/>
But also you can do ldr r2,nes_sram+4, and it will just work.  You can also use the ADR instruction to generate an address (it just turns it into addition).
<br/>
Any equivalents in GCC?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92000 - tepples - Tue Jul 11, 2006 12:38 am</h4>
    <div class="postbody"><span class="postbody">You could probably build something similar using C preprocessor macros.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define nes_ram(off)    [r11+off]
<br/>
#define nes_sram(off)   nes_ram(0x800+off)
<br/>
#define chr_decode(off) nes_sram(0x2000+off)</td> </tr></table><span class="postbody">
<br/>
Then you can specify that you want C preprocessing applied to your .s file by passing the flag <span style="font-weight: bold">-x assembler-with-cpp</span> to GCC when compiling the .s file.
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">It's also possible to use the file name suffix .S instead of .s to add automatic C preprocessing to the assembler, but I wouldn't recommend it on a case-insensitive file system such as all file systems shipped with Microsoft Windows.</span><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
