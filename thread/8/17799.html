<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Is this how stacks  work in principle? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Is this how stacks  work in principle?</h2>
<div id="posts">
<div class="post">
    <h4>#177122 - blessingta@hotmail.co.uk - Wed Dec 14, 2011 3:46 am</h4>
    <div class="postbody"><span class="postbody">is this how stacks work in principle ?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
	//variables depended on case 1 being true
<br/>
	...
<br/>
<br/>
	//variables depended on case 2 being true
<br/>
	....
<br/>
<br/>
	//blah blah...
<br/>
    TEST_IF_CASE1_OR_CASE2:
<br/>
<br/>
	//push to stack
<br/>
<br/>
    EXECUTE_SUBROUTINE_HERE:
<br/>
//liftback from stack
<br/>
	//latter functionality here
<br/>
	....
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177123 - elhobbs - Wed Dec 14, 2011 7:26 pm</h4>
    <div class="postbody"><span class="postbody">the ds/gba has a region of memory set aside (by devkitARM) for stack usage. stack space is reserved when a function is entered. it stores local variables, saves current register values, and other compiler created workspace. when the function returns then the reserved space is released. there are more places where stack can be reserved - local variables inside blocks, etc, but this is a simplified description.
<br/>
<br/>
I would say this is not really an ASM questions and you can find much more detail on the web - I will give you a hint - it rhymes with moogle ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177124 - Miked0801 - Wed Dec 14, 2011 7:29 pm</h4>
    <div class="postbody"><span class="postbody">Sort of:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void main()
<br/>
{
<br/>
  int a = 1;
<br/>
  int b = 2;
<br/>
  int c = sum(a,b);
<br/>
}
<br/>
<br/>
int sum(int a, int b)
<br/>
{
<br/>
  return a + b;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The above code can be compiled without a single use of the stack, or it can use it extensively, depending on how the compiler wants to do things.
<br/>
<br/>
It could push the value of a and b on the stack along with a return address,  call sum, then have sum pop all those values off the stack and the return value into a register to tell it how to return, or it could leave a and b in registers and inline the call to sum by just adding the registers into a 3rd register c.
<br/>
<br/>
Basically, as routines become more complex and more values are needed to be tracked, the stack is used as a variable overflow area.  This is especially true of any non-trivial sized structure.  When allocating space for them, the compiler just offsets the stack pointer directly with a subtract instead of pushing a ton of values.
<br/>
<br/>
Your example seems to assume that variables are set before the conditional is checked.  While this can be true, it usually is not the case.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(a == 1)
<br/>
{
<br/>
  myStruct.a = 0;
<br/>
  foo(myStruct);
<br/>
}
<br/>
else
<br/>
{
<br/>
  myStruct.a = 1;
<br/>
  foo(myStruct);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Here, the values are set individually in each if statement before the function call.   Also, the push of stack state happens within the called function, not before the call.  This is more space efficient and keeps pushes and pops together close to each other making it much easier to fix push/pop mismatches - quite common when coding assembler.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
