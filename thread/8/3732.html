<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>C to ASM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > C to ASM</h2>
<div id="posts">
<div class="post">
    <h4>#23602 - ProblemBaby - Fri Jul 16, 2004 1:51 am</h4>
    <div class="postbody"><span class="postbody">Hi iam trying to convert my whole GBA library to ASM
<br/>
to make it smaller and faster:D
<br/>
<br/>
but since iam new ASM I need to ask a couple of things
<br/>
1.
<br/>
First when I wrote my code in ASM it went bigger then the C-code
<br/>
but then I wrote .thumb. And Yeah it got much smaller. But it didnt work=/ First I got compile errors from this kind of line: mov r0, r0, lsl #2
<br/>
why?  well I changed it and wrote lsl r0, r0 #2
<br/>
after that I didnt get errors but the emulator (no$gba) said the rom-image has crashed.. I just wonder why??? are the instructions not equvalent (dont know how it is spelled)
<br/>
<br/>
2.
<br/>
at GbaGuys asm tutorials I read that it was possible to include the defines that was written in C well I can include the file but i got undefined blah blah when I try to use them. I included it like this:
<br/>
.include "gba_regs.h", why??
<br/>
<br/>
Thanks in advance</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23603 - poslundc - Fri Jul 16, 2004 2:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">Hi iam trying to convert my whole GBA library to ASM
<br/>
to make it smaller and faster:D</td> </tr></table><span class="postbody">
<br/>
<br/>
That is a very bad reason. In almost any game, 90% of of the processor's time is spent on 10% of the code. It is wasteful to optimize the 90% of the code that is only being run 10% of the time. ASM is much better suited to speed critical tasks. But anyway.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">but since iam new ASM I need to ask a couple of things
<br/>
1.
<br/>
First when I wrote my code in ASM it went bigger then the C-code
<br/>
but then I wrote .thumb. And Yeah it got much smaller. But it didnt work=/ First I got compile errors from this kind of line: mov r0, r0, lsl #2
<br/>
why?  well I changed it and wrote lsl r0, r0 #2
<br/>
after that I didnt get errors but the emulator (no$gba) said the rom-image has crashed.. I just wonder why??? are the instructions not equvalent (dont know how it is spelled)</td> </tr></table><span class="postbody">
<br/>
<br/>
ARM and Thumb instruction sets are very different and have different rules to them. You cannot expect your ARM code to assemble properly just by changing the .arm directive to .thumb; you need to recode it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">2.
<br/>
at GbaGuys asm tutorials I read that it was possible to include the defines that was written in C well I can include the file but i got undefined blah blah when I try to use them. I included it like this:
<br/>
.include "gba_regs.h", why??</td> </tr></table><span class="postbody">
<br/>
<br/>
Take a look in your gba_regs.h file. See all those pointers and data types? Those things don't exist in assembly, they exist in C. C and assembly are two very different languages. That's why.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23615 - DekuTree64 - Fri Jul 16, 2004 7:56 am</h4>
    <div class="postbody"><span class="postbody">Yeah, you can write a plenty fast game in pure C almost all the time. ASM is generally only needed when you're doing crazy stuff like 3D, or for sound mixers that just have a whole lot of repetitive work to do and usually waste a whole lot of time doing it if written in C.
<br/>
<br/>
That said, I think it's a great idea to rewrite your library in assembly^_^ Not for the purpose of speeding it up, but for learning and having fun doing it. Small hunks of code like generic libraries tend to be more self-contained and easy to work with than writing a whole game, but by the time you finish it you should be used to the ASM style enough to start thinking more in algorithms than struggling with individual instructions<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23625 - ProblemBaby - Fri Jul 16, 2004 12:25 pm</h4>
    <div class="postbody"><span class="postbody">But it is much 3d/math in my lib and run a bit too slow I think and of course i want to learn asm..
<br/>
<br/>
1.
<br/>
isnt ldr, str, ldrh etc.. the same things if I switch or wahts the difference?
<br/>
Is it two totally different instruction sets???
<br/>
where can I read about it??
<br/>
<br/>
2.
<br/>
why is it possible to compile? he said in his tutorials that you can include your old c header. but it doesnt work so...
<br/>
what should I do then?[/quote]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23629 - poslundc - Fri Jul 16, 2004 2:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">1.
<br/>
isnt ldr, str, ldrh etc.. the same things if I switch or wahts the difference?</td> </tr></table><span class="postbody">
<br/>
<br/>
There are different restrictions on the registers you can use, and possibly the addressing modes as well.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Is it two totally different instruction sets???
<br/>
where can I read about it??</td> </tr></table><span class="postbody">
<br/>
<br/>
<a href="http://www.arm.com/documentation/ARMProcessor_Cores/index.html" target="_blank">http://www.arm.com/documentation/ARMProcessor_Cores/index.html</a> (the GBA uses an ARM7TDMI)
<br/>
<a href="http://www.gbadev.org/docs.php?section=arm" target="_blank">http://www.gbadev.org/docs.php?section=arm</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">2.
<br/>
why is it possible to compile? he said in his tutorials that you can include your old c header. but it doesnt work so...
<br/>
what should I do then?</td> </tr></table><span class="postbody">
<br/>
<br/>
C and assembler are two different languages. If you wrote code in Visual Basic and just #included it into a C program, would you expect it to work?
<br/>
<br/>
You can use the #include and #define preprocessor statements if you name your assembly file with a capital .S extension (which tells gcc to run your file through the preprocessor first), but that's about it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23636 - Miked0801 - Fri Jul 16, 2004 5:50 pm</h4>
    <div class="postbody"><span class="postbody">lol - reminds me of when I had a C64.  I was reading from Compute's Gazette magazine and they had some assembly listings for a game.  I thought cool and started typing the assembly into the basic interpretor.  It didn't work too well :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23643 - ProblemBaby - Fri Jul 16, 2004 9:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
C and assembler are two different languages. If you wrote code in Visual Basic and just #included it into a C program, would you expect it to work?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
No and I dont expect it to compile without errors either.
<br/>
<br/>
thanks for the links!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23646 - poslundc - Fri Jul 16, 2004 10:35 pm</h4>
    <div class="postbody"><span class="postbody">It compiles because #define directives are only read by the preprocessor.
<br/>
<br/>
I can use the following #define in C code if I want:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define fakeconstant lksj df02 31;2312jore ?lksfja( lksjdf</td> </tr></table><span class="postbody">
<br/>
<br/>
... and it will compile just fine so long as I don't use fakeconstant anywhere.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
