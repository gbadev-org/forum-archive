<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Branch out of range Error - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Branch out of range Error</h2>
<div id="posts">
<div class="post">
    <h4>#7781 - funkeejeffou - Tue Jun 24, 2003 4:42 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I'm using goldroad, and I've been implementing a long functiun in Iwram.
<br/>
The problem is when I call it from ROM code with a "bl my_functiun", golroad generates me an error saying the branch is out of range.
<br/>
My textareas, pool splitting as well as my copy data loops are fine since they've been working well till now.
<br/>
Is it normal that the assembler cannot branch a label as far as this?
<br/>
If so, should I manually change the PC and stack the oldest one so I can return after my functiun finished?
<br/>
In this case, should I take care of the pipelining and substract 12 from the PC (it's ARM code)?
<br/>
Also thought of this, what about :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">addr r0, my_functiun
<br/>
bl r0</td> </tr></table><span class="postbody">
<br/>
<br/>
If this works, then WHY does "bl my_functiun" doesn't work?
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7787 - DekuTree64 - Tue Jun 24, 2003 5:55 pm</h4>
    <div class="postbody"><span class="postbody">bl can only reach 24 bits, and ROM starts at 0x8000000, and IWRAM starts at 0x3000000, and those are farther apart than 24 bits can reach. I'm not sure if this is how you're supposed to do it, but I just use 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
ldr r0, =FuncName
<br/>
mov lr, pc
<br/>
bx r0
<br/>
</td> </tr></table><span class="postbody">
<br/>
and it seems to work fine. Since pc points to 2 instructions ahead, when that mov lr, pc executes, pc is at the instruction after the bx r0, which is where you would want  to return to. And as far as I know, you can bl to a register, so you have to use a bx.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7944 - funkeejeffou - Sun Jun 29, 2003 5:07 am</h4>
    <div class="postbody"><span class="postbody">It works great DekuTree64  !!!
<br/>
Many thanks.
<br/>
<br/>
Haven't tested it in Thumb, but I suppose it should work as the pc will be set to the current instruction + 4 bytes, right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7958 - torne - Sun Jun 29, 2003 1:44 pm</h4>
    <div class="postbody"><span class="postbody">Yes, the program counter points 2 instructions ahead because of the ARM7's three-stage pipeline; it's always 2 whole instructions in whichever the current instruction set is (pipeline is flushed when you switch instruction set).
<br/>
<br/>
Torne</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
