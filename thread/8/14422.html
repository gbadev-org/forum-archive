<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>A Little ASM Help(80x86) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > A Little ASM Help(80x86)</h2>
<div id="posts">
<div class="post">
    <h4>#144103 - jake2431 - Mon Oct 29, 2007 3:38 am</h4>
    <div class="postbody"><span class="postbody">I need some help with my ASM homework, if you guys don't mind. I am writing code to find the average of numbers stored in an array, but I am getting 0 when it should be 89(if I remember correctly). I have stepped through it with a debugger, but since I am linking the files I can't follow my variables (not sure how to just watch the memory). Stepping through, everything looks from (I even get the average) until the computer travels from the procedure to the main program again. Somehow I don't think I ever stored it in my average variable. I don't need another way to do it, as the code I have is how the teacher wants us to program it (we are learning how to pass local variables as arguments to the procedure. My books is hard for me to understand, so after working on it for a while, I would like to ask for you guys help. 
<br/>
<br/>
The main program: 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
;Jake Johnson
<br/>
;Programming exercise 6.3 #3
<br/>
;main
<br/>
<br/>
.386
<br/>
.MODEL FLAT
<br/>
<br/>
ExitProcess PROTO NEAR32 stdcall, dwExitCode:DWORD
<br/>
<br/>
INCLUDE io.h            ; header file for input/output
<br/>
<br/>
.STACK  4096            ; reserve 4096-byte stack
<br/>
EXTERN   Avg:Near32   ;make external procedure available
<br/>
<br/>
.DATA                   ; reserve storage for data
<br/>
   string   BYTE   "The average of the grades is: ", 0
<br/>
   see      BYTE   11 DUP   (?)
<br/>
         BYTE   0
<br/>
   string6 BYTE   40 DUP (?) ;use to pause without exiting program
<br/>
   array   DWORD   80,95,70,100,100 ;setup array
<br/>
   count   DWORD   5
<br/>
   average   DWORD   0
<br/>
<br/>
.CODE                           ; start of main program code
<br/>
_start:
<br/>
      lea      ebx, array      ;get address of array (parm 1)
<br/>
      push   ebx
<br/>
      push      count         ;(parm 2): number of ints in array
<br/>
      lea      ecx, average   ;get address of average(parm 3)
<br/>
      push   ecx
<br/>
      
<br/>
      call   Avg            ;call procedure
<br/>
      
<br/>
      add      esp,16
<br/>
      output  string
<br/>
      dtoa   see, average   ;convert average to ascii for display
<br/>
      output   see
<br/>
      input   string6, 40
<br/>
<br/>
        INVOKE  ExitProcess, 0  ; exit with return code 0
<br/>
<br/>
PUBLIC _start                   ; make entry point public
<br/>
<br/>
END                             ; end of source code
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The Procedure:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
;Jake Johnson
<br/>
;Programming exercise 6.3 #3
<br/>
;procedure
<br/>
<br/>
.386
<br/>
.MODEL FLAT
<br/>
<br/>
.STACK 4096
<br/>
PUBLIC Avg      ;make Avg public
<br/>
.CODE
<br/>
<br/>
Avg      PROC   NEAR32
<br/>
         push   ebp         ;establish stack frame
<br/>
         mov      ebp, esp   
<br/>
         pushad            ;save all registers
<br/>
         pushf            ;save flags
<br/>
         mov      eax, 0      ;clear out eax
<br/>
         mov      ebx, 0      ;clear out ebx
<br/>
         mov      ecx,[ebp+16]   ;get address of array
<br/>
      startLoop:
<br/>
         cmp      eax, [ebp+12]   ;compare eax to number of elements in array   
<br/>
         je      endLoop
<br/>
         add      ebx, [ecx]   ;add element to ebx
<br/>
         add      ecx, 4      ;get next element in array
<br/>
         inc      eax
<br/>
         jmp    startLoop
<br/>
      endLoop:
<br/>
         mov      eax, ebx   ;get average
<br/>
         mov      ecx,[ebp+12]
<br/>
         cdq   
<br/>
         div      ecx
<br/>
         mov      [ebp+8], eax
<br/>
         popf            ;restore register values
<br/>
         popad
<br/>
         mov      esp, ebp   ;restore esp
<br/>
         pop      ebp
<br/>
         ret               ;return
<br/>
Avg      ENDP
<br/>
END
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
P.S. If this should be in the OffTopic forum, since it isn't GBA or NDS related, feel free to move it. I just thought since it was ASM, well... :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144112 - jake2431 - Mon Oct 29, 2007 5:29 am</h4>
    <div class="postbody"><span class="postbody">Oh, and what windows debuggers do you guys use. I am using windbg for this class, but I didn't know if there was a better one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144140 - gmiller - Mon Oct 29, 2007 2:55 pm</h4>
    <div class="postbody"><span class="postbody">look at how you set the return value using the pointer to your answer ....
<br/>
<br/>
BTW:  this is for ARM assembly not x86 so you might not get many answers.  I just glanced at it and saw the error with the return value I did not look to see if your divide was correct.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144150 - kusma - Mon Oct 29, 2007 5:41 pm</h4>
    <div class="postbody"><span class="postbody">Why don't you step through the routine in your debugger to see where it fails?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144154 - jake2431 - Mon Oct 29, 2007 6:15 pm</h4>
    <div class="postbody"><span class="postbody">I did step through with the debugger, but since it is multiple source files, I don't know how to watch my average variable in memory. I have to use the disassembler and watch registers. I get the right answer until I leave the procedure, but I finally figured it out. Thanks for the help guys.
<br/>
<br/>
Sorry, I should have posted in OffTopic.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144158 - gmiller - Mon Oct 29, 2007 7:30 pm</h4>
    <div class="postbody"><span class="postbody">Good, the address was on the stack and you needed to get that address and then indirect address it ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144162 - keldon - Mon Oct 29, 2007 8:32 pm</h4>
    <div class="postbody"><span class="postbody">I use RosAsm for my assembler. It's macro system allows for amazing things, like ...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
L1:
<br/>
   jmp L1&gt;
<br/>
L1:</td> </tr></table><span class="postbody">
<br/>
<br/>
Basically labels in the form of [character][number] can appear multiple times in a file and you decide by direction. This allows for further features that are self explanatory when you begin to use it.
<br/>
<br/>
Also its IDE has a built in debugger, fairly good disassembler and is just great. The Nessie emulator was written entirely in RosAsm!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144178 - gmiller - Mon Oct 29, 2007 11:20 pm</h4>
    <div class="postbody"><span class="postbody">If you happen to have Visual Studio then you can use it to create and debug ASM files.  To get it to assemble in 2005 you will need some custom steps defined, but it is pretty simple.  My students use it to debug assembly calls from C and C++.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144183 - jake2431 - Mon Oct 29, 2007 11:59 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the help, guys. That RosAsm looks really cool keldon.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
