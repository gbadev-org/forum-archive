<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ASM newb question :P - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > ASM newb question :P</h2>
<div id="posts">
<div class="post">
    <h4>#9733 - Opius - Fri Aug 15, 2003 2:56 pm</h4>
    <div class="postbody"><span class="postbody">I have been following gbaguys tutorials, and they work fine on VisualBoy. The problem I am having is when i try to flash them on to my cart and test them on the GBA, they dont work properly.
<br/>
<br/>
For example the displaying a sprite tutorial, the sprite draws but the top half of it is corrupted (random pixel colors) and the bottom half of it seems darker then it should be. Also the sound tutorial, the code works fine in VisualBoy, but nothing plays on my GBA (yes i do have the volume turned up :P )
<br/>
<br/>
Anyway i was just wondering if anyone had encountered similar problems, or had suggestions to what the problem could be?
<br/>
<br/>
Could it be my linker/flash card? I havent had any problems with C programs i have written or with backups of comercial roms i have tested..
<br/>
<br/>
Its a visoly linker and a flash advance extreme 256m card btw
<br/>
<br/>
Any help or suggestions will be much appreciated. 
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9735 - tepples - Fri Aug 15, 2003 4:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Opius wrote:</b></span></td> </tr> <tr> <td class="quote">I have been following gbaguys tutorials, and they work fine on VisualBoy. The problem I am having is when i try to flash them on to my cart and test them on the GBA, they dont work properly.</td> </tr></table><span class="postbody">
<br/>
What version of VBA? Version 1.6 (just released) emulates a few of the GBA's bugs better.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">For example the displaying a sprite tutorial, the sprite draws but the top half of it is corrupted (random pixel colors) and the bottom half of it seems darker then it should be.</td> </tr></table><span class="postbody">
<br/>
I can't exactly help you on the top half, but the bottom half will be dark. The GBA's screen (gamma about 4) is darker than a PC's (standard sRGB gamma 2.2).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also the sound tutorial, the code works fine in VisualBoy, but nothing plays on my GBA (yes i do have the volume turned up :P )</td> </tr></table><span class="postbody">
<br/>
Does this "sound tutorial" use the tone generators, or does it use Dsound DMA? If you're having Dsound problems, the first thing to check is that on hardware, you have to zero out the DMA channel's control register when writing to the source or destination registers.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9740 - Opius - Fri Aug 15, 2003 5:50 pm</h4>
    <div class="postbody"><span class="postbody">hmm i still havent fixed it but i think this might be a problem with headers...
<br/>
<br/>
the reason i think this is that the program works fine in VBA (1.6) but not when i flash it to my cart. But if i fix the header using GBARM then load it on VBA it does the same thing that it does on my GBA, with all the weird color corruptions ;/
<br/>
<br/>
hmm :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9742 - torne - Fri Aug 15, 2003 6:56 pm</h4>
    <div class="postbody"><span class="postbody">The linker software often does the header fix for you when you flash the game to the cart (LittleWriter certainly does), as a rom with an invalid header will never start at all on real hardware. If your ROM works on VBA before but not after you do a header fix, check that you have left space for the header at the start of your ROM..
<br/>
<br/>
Torne</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9756 - Opius - Sat Aug 16, 2003 6:24 am</h4>
    <div class="postbody"><span class="postbody">Ah cool, that sounds like it must be what is causing my troubles.
<br/>
<br/>
How would you go about making sure there was space left for the header?
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9758 - torne - Sat Aug 16, 2003 1:40 pm</h4>
    <div class="postbody"><span class="postbody">Are you using Goldroad or GAS?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9793 - Opius - Mon Aug 18, 2003 10:30 am</h4>
    <div class="postbody"><span class="postbody">I had been using goldroad, but I think I am going to wtry and switch over to using gas</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9796 - torne - Mon Aug 18, 2003 12:31 pm</h4>
    <div class="postbody"><span class="postbody">I tried using Goldroad once; it was pretty painful for me. I develop for a number of platforms and am highly accustomed to GNU syntax (and to manually using the linker), so using gas was a pretty obvious choice.
<br/>
<br/>
I can't really help you for Goldroad; it does things in a sufficiently different way that any suggestions I make will be pretty useless. Goldroad seems to be structured around the idea of building a GBA rom, (whereas gas just makes ordinary ELF .o files, no platform specificity), so you'd expect it to work out that they need headers. Ah well. The crt0.S that I use in DevKitAdvance has a valid (minus the Nintendo logo) header built into it at the correct location, so only needs to have the logo pasted in to be usable. =)
<br/>
<br/>
Torne</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9806 - GbaGuy - Mon Aug 18, 2003 4:34 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
I've had this problem with Goldroad recently also,
<br/>
adding this to the start of the file should fix it
<br/>
(slightly changed from what I was using):
<br/>
<br/>
@arm
<br/>
@fsize	32
<br/>
<br/>
b start
<br/>
@dup	dcb 0xba,0x0
<br/>
start:
<br/>
<br/>
Goldroad is sure doing something wierd when/if it
<br/>
does the header. I'd switch to GAS, but assemblers that
<br/>
output object files is something I really don't like...
<br/>
<br/>
Greetings,
<br/>
- Mike H</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9808 - tepples - Mon Aug 18, 2003 5:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GbaGuy wrote:</b></span></td> </tr> <tr> <td class="quote">assemblers that output object files is something I really don't like...</td> </tr></table><span class="postbody">
<br/>
And why not? If you specify <span style="font-weight: bold">arm-agb-elf-gcc kitten.s -o kitten.elf</span> then all you need to do to go from that to a ROM is the <span style="font-weight: bold">arm-agb-elf-objcopy</span> that comes with DKA binutils.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9809 - torne - Mon Aug 18, 2003 6:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GbaGuy wrote:</b></span></td> </tr> <tr> <td class="quote">I'd switch to GAS, but assemblers that
<br/>
output object files is something I really don't like...</td> </tr></table><span class="postbody">
<br/>
<br/>
Then take the time with a conventional assembly/linkage tutorial, one not associated with the GBA, to understand how it works. =)
<br/>
<br/>
Torne</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
