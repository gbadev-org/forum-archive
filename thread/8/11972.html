<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Writting a Passme function for a slot1 card - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>ASM > Writting a Passme function for a slot1 card</h2>
<div id="posts">
<div class="post">
    <h4>#112598 - bobmcbob - Mon Dec 18, 2006 11:44 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I rather foolishly it seems bought a Ninjapass x9 slot-1 based card.
<br/>
<br/>
Homebrew is barely supported but I made a small loader to enable some to boot.
<br/>
<br/>
Anyway, now i want to pick up a super card or something, so i need the x9 to act as a passme.
<br/>
<br/>
I got hold of a firmware dump of an old ninjapass thingy and managed to reverse most of it and I have reimplemented the code and it is below.
<br/>
To test this I have an nds homebrew burnt onto a ezflash 128mb which works fine in my friends flashme'd DS.
<br/>
<br/>
(I have a DS-Lite if that makes any difference)
<br/>
<br/>
The code doesnt appear to work at teh moment and im wondering if it is because I am missing something?  
<br/>
<br/>
The firmware dump i peeked at was huge but only seemed to contain two really small sections of code that do exactly what I expected a passme to do.  Im very new to the DS so I may have got things confused.
<br/>
<br/>
Anyway the arm7 code is here: 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
.arm
<br/>
.global _start
<br/>
<br/>
   
<br/>
_start:
<br/>
   ldr r0, ADDR1    @ Memory address to check
<br/>
   ldr r1, GBA   @ GBA cart space
<br/>
<br/>
loop1:
<br/>
   ldr r2, [r0]    @ Load value at mem, (written to by arm9)
<br/>
   cmp r2, r1
<br/>
   bne loop1
<br/>
<br/>
   mov r0, #65536       @ For a loop to give us time to get teh stuff sorted
<br/>
   mov r1, #0
<br/>
<br/>
loop2:
<br/>
   add r1,r1, #1      @ r1=r1+1
<br/>
   cmp r1, r0      @ 
<br/>
   bne loop2      @ Basically a little sleep loop
<br/>
<br/>
   bx r2         @ R2 should contain the GBA address offset
<br/>
<br/>
   
<br/>
ADDR1:
<br/>
   .word 0x027ffe34
<br/>
<br/>
GBA:
<br/>
   .word 0x080000c0
<br/>
   
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And the ARM9 Code.. :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
.arm
<br/>
.global _start
<br/>
   
<br/>
_start:
<br/>
   ldr r0, ROM_TITLE    @ store some value in amongst rom title?
<br/>
   ldr r1, UNKNOWN_V
<br/>
   str r1, [r0]
<br/>
   
<br/>
   ldr r0, AUTO_START   @ Set teh auto start bit
<br/>
   mov r1, #4
<br/>
   strb r1, [r0]      
<br/>
<br/>
   ldr r0, A9_ROM_OFF    @ Clear the ARM 9 rom offset
<br/>
   mov r1, #1
<br/>
   strb r1, [r0]
<br/>
<br/>
   ldr r0, A9_RAM_ENTRY    @ Set A9 Entry point into rom header (has been cleared)
<br/>
   ldr r1, ROM_TITLE
<br/>
   str r1, [r0]
<br/>
<br/>
   ldr r0, A7_ENTRY   @ Set ARM7 Entry to GBA and SOFT RESET
<br/>
   ldr r1, GBA_ADDR
<br/>
   str r1, [r0]
<br/>
   swi     0x00000000    @  Call arm9 bios func SWI softreset
<br/>
   
<br/>
A7_ENTRY:   
<br/>
   .word 0x027ffe34
<br/>
      
<br/>
A9_RAM_ENTRY:
<br/>
   .word 0x027ffe24
<br/>
   
<br/>
A9_ROM_OFF:   
<br/>
   .word 0x027ffe22   
<br/>
   
<br/>
AUTO_START:
<br/>
   .word 0x027ffe1f
<br/>
   
<br/>
ROM_TITLE:
<br/>
   .word 0x027ffe04
<br/>
GBA_ADDR:
<br/>
   .word 0x080000c0
<br/>
UNKNOWN_V:
<br/>
   .word 0xe59ff018
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Any ideas/hints/clues/pointers or more information on what is needed would be great.
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112623 - bobmcbob - Mon Dec 18, 2006 7:26 pm</h4>
    <div class="postbody"><span class="postbody">ok i think i know what im forgetting.  I need to work out the CRC of the header after making the changes..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112659 - Lynx - Tue Dec 19, 2006 8:08 am</h4>
    <div class="postbody"><span class="postbody">Keep at it, but why don't you just install FlashMe and not worry about it?<br/>_________________<br/><a class="postlink" href="http://www.ndshb.com" target="_blank">NDS Homebrew Roms &amp; Reviews</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112660 - bobmcbob - Tue Dec 19, 2006 8:16 am</h4>
    <div class="postbody"><span class="postbody">I think i fixed the CRC thing now but its still not booting.
<br/>
<br/>
The reason Im not installing flashme is because I started this now and want to finish :)
<br/>
<br/>
I figure its a good way to get a feeling for the DS system.
<br/>
To check I got the header correct I was thinking maybe I could dump the area of ram containing it.
<br/>
<br/>
The only thing I have avail that I can possibly store it to is a ezflash128mb GBA cart.  Would it be possible to write it the sram on that cart and extract it with the ez software on the PC?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112662 - tepples - Tue Dec 19, 2006 8:37 am</h4>
    <div class="postbody"><span class="postbody">Try writing a "Hello World" program first, and once that's working, just plug in libcartreset, lying to it that you have a GBA Movie Player.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112673 - bobmcbob - Tue Dec 19, 2006 10:29 am</h4>
    <div class="postbody"><span class="postbody">Hi im not sure what the point in that would be?  I am able to write simple hello world programs already, and get them to boot on the X9.
<br/>
<br/>
I will look up libcartreset in a min.  Im more interested in how the passme works and if my code is correct or I am missing anything.  
<br/>
<br/>
Thanks for any help though :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
