<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>trouble with compilation - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > trouble with compilation</h2>
<div id="posts">
<div class="post">
    <h4>#163314 - moonlightcheese - Mon Sep 29, 2008 2:35 pm</h4>
    <div class="postbody"><span class="postbody">i'm using devkitadv and i'm trying to compile some assembly.  the compiler works fine for compiling C, but this program won't compile:
<br/>
<br/>
move16.s:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.arm
<br/>
.section .text
<br/>
<br/>
   MOV   PC,R1
<br/>
</td> </tr></table><span class="postbody">
<br/>
makefile:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">path=..\..\devkitadv\bin
<br/>
gcc -o move16.elf move16.s</td> </tr></table><span class="postbody">
<br/>
<br/>
output:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">E:\CS3243\examples&gt;make.bat
<br/>
<br/>
E:\CS3243\examples&gt;path=..\..\devkitadv\bin
<br/>
<br/>
E:\CS3243\examples&gt;gcc -o move16.elf move16.s
<br/>
../../devkitadv/bin/../lib/gcc-lib/arm-agb-elf/3.0.2/../../../../arm-agb-elf/lib/crt0.o: In function `__FarProcedure':
<br/>
../../devkitadv/bin/../lib/gcc-lib/arm-agb-elf/3.0.2/../../../../arm-agb-elf/lib/crt0.o(.text+0x1f0): undefined reference to `main'
<br/>
collect2: ld returned 1 exit status</td> </tr></table><span class="postbody">
<br/>
<br/>
i'm not sure what's wrong...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163315 - Griffin - Mon Sep 29, 2008 2:56 pm</h4>
    <div class="postbody"><span class="postbody">You need a main function for gcc.. Probably..
<br/>
Have you tried the equivalent compilation with gas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163318 - moonlightcheese - Mon Sep 29, 2008 3:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Griffin wrote:</b></span></td> </tr> <tr> <td class="quote">You need a main function for gcc.. Probably..
<br/>
Have you tried the equivalent compilation with gas?</td> </tr></table><span class="postbody">
<br/>
all i have at my disposal is devkitadv.  this is actually for a school project and i'm afraid i don't have time to muck around with compilers.  i believe devkitadv has the ability to compile assembly, as indicated on the site's FAQ, but i can't seem to get it to compile any sample code or anything in assembly.
<br/>
<br/>
if it's necessary, i can try to setup devkitpro again although last time i had some trouble with it...
<br/>
<br/>
and i'm not sure how to compile with gas, nor do i have time to set it up unless it's as simple as "apt-get install gas" or something to that effect.  i need to spend this time on development.  the first part of this project is due next weekend and i'm doing the best i can just to get a compiler to work...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163321 - Griffin - Mon Sep 29, 2008 4:16 pm</h4>
    <div class="postbody"><span class="postbody">With devkitarm you have arm-eabi-gcc and arm-eabi-as, I guess that gas would be arm-elf-as for you, if that doesn't work then look around your devkitadv/bin directory.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163324 - moonlightcheese - Mon Sep 29, 2008 5:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Griffin wrote:</b></span></td> </tr> <tr> <td class="quote">With devkitarm you have arm-eabi-gcc and arm-eabi-as, I guess that gas would be arm-elf-as for you, if that doesn't work then look around your devkitadv/bin directory.</td> </tr></table><span class="postbody">
<br/>
my temporary fix is just to use inline assembly and hopefully everything will work properly.  for the first part of this assignment, i basically have to be able to store a program on a process control block of my own design, store the data portion of the program on the appropriate stack, switch the program's first instruction into the PC, ... basically implement OS context switching.  i think i bit off more than i can chew for this project (x.O)
<br/>
<br/>
inevitably, i'll have to get devkitpro installed since everyone seems to be on the same page there.
<br/>
<br/>
thanks for the response.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163330 - Cearn - Mon Sep 29, 2008 6:25 pm</h4>
    <div class="postbody"><span class="postbody">Both PREFIX-as and PREFIX-gcc will assemble assembly, but the linker will still need a function/label called main for the boot code to jump to. If you don't have one already, make one.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    .text
<br/>
    .align
<br/>
    .thumb_func
<br/>
    .global main
<br/>
main:
<br/>
    [your code here]
<br/>
<br/>
    @ Return 0
<br/>
    mov     r0, #0
<br/>
    bx      lr
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163335 - moonlightcheese - Mon Sep 29, 2008 8:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">Both PREFIX-as and PREFIX-gcc will assemble assembly, but the linker will still need a function/label called main for the boot code to jump to. If you don't have one already, make one.
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    .text
<br/>
    .align
<br/>
    .thumb_func
<br/>
    .global main
<br/>
main:
<br/>
    [your code here]
<br/>
<br/>
    @ Return 0
<br/>
    mov     r0, #0
<br/>
    bx      lr
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
AWESOME!  i tried using main, but didn't declare it as a global section.  now it works.  additionally i got devkitarm working this time.  a reinstallation fixed it up, and i just tested compiling assembly with arm-eabi-as.exe and it works as expected, creating an a.out.
<br/>
<br/>
thanks for the help everyone!  i'm on my way to a gba operating system :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163348 - Dwedit - Tue Sep 30, 2008 9:53 am</h4>
    <div class="postbody"><span class="postbody">It's not a "global section", it's a "global" in that the symbol is exported so the linker can see it.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163351 - moonlightcheese - Tue Sep 30, 2008 12:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">It's not a "global section", it's a "global" in that the symbol is exported so the linker can see it.</td> </tr></table><span class="postbody">
<br/>
duly noted.
<br/>
<br/>
man i'm rusty... but then my only risc assembly experience is with a SPARC machine for a class i took over a year ago.  getting some good practice in now though :D</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
