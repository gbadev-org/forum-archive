<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Checking If Some Button Was Pressed - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Checking If Some Button Was Pressed</h2>
<div id="posts">
<div class="post">
    <h4>#174649 - nathanpc - Mon Jul 05, 2010 12:09 am</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
 I want to know how could I check if the A Button was pressed, and if it was. Do a <span style="font-weight: bold">b change_color</span>. If possible, first give the theory(but very well explained), then I will try to do some code and post the result here. By this way I will learn and try to practice my knowledge.
<br/>
<br/>
 Remember to specify the length of the addresses and values, as I usually have problems if I use <span style="font-weight: bold">str</span>/<span style="font-weight: bold">ldr</span>(for 32-bits values), or <span style="font-weight: bold">strh</span>/<span style="font-weight: bold">ldrh</span>(for 16-bits values). Or try to teach me how to recognize which type to use. :)
<br/>
<br/>
Best Regards,
<br/>
 Nathan Paulino Campos<br/>_________________<br/><span style="font-size: 9px; line-height: normal">Reading Tonc and trying to remind my very old C knowledge.
<br/>
<br/>
Just bought a GameBoy Advance SP one of those cartridges to put the ROMs for onboard debug.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174859 - Dirbaio - Mon Jul 26, 2010 4:03 pm</h4>
    <div class="postbody"><span class="postbody">(i'm assuming you know how hexadecimal and binary numbers work)
<br/>
<br/>
First off, you go to this document:
<br/>
<a class="postlink" href="http://nocash.emubase.de/gbatek.htm" target="_blank">http://nocash.emubase.de/gbatek.htm</a>
<br/>
<br/>
It is very useful for GBA and NDS developing and hacking. it explains how the communications to the GBA's hardware works. 
<br/>
<br/>
Generally, you talk to hardware using "registers". A register is a value that can be written or read, and can be used to retrieve or modify the state of the hardware. On the GBA (and the NDS) registers are in what is called the I/O area, which is in addresses 0x04xxxxxx
<br/>
<br/>
Look at GBA Keypad input: <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#gbakeypadinput" target="_blank">http://nocash.emubase.de/gbatek.htm#gbakeypadinput</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
4000130h - KEYINPUT - Key Status (R)
<br/>
<br/>
  Bit   Expl.
<br/>
  0     Button A        (0=Pressed, 1=Released)
<br/>
  1     Button B        (etc.)
<br/>
  2     Select          (etc.)
<br/>
  3     Start           (etc.)
<br/>
  4     Right           (etc.)
<br/>
  5     Left            (etc.)
<br/>
  6     Up              (etc.)
<br/>
  7     Down            (etc.)
<br/>
  8     Button R        (etc.)
<br/>
  9     Button L        (etc.)
<br/>
  10-15 Not used
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The first line is telling you that there is a register at 0x04000130 which tells you which keys are pressed. It's a 16-bit register.
<br/>
<br/>
So, we'll read the value of that register.
<br/>
<br/>
LDR R0, =0x04000130
<br/>
LDRH R0, [R0]
<br/>
<br/>
The first instruction loads the value 0x04000130 onto R0, and the second one reads the 16-bit value that is being pointed by R0, which is the register's value.
<br/>
<br/>
Now we have the value of the keypad register in R0. Now we want to get the value of Bit 0 only, to see if A is pressed or not. We'll be using the bitwise AND operation.
<br/>
<br/>
If we have a binary number like this: 000...01011b and we want to know it's bit 0, we have to do 000...01011b AND 1b:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
000...01011b 
<br/>
000...00001b
<br/>
--------------- &amp;
<br/>
00000000001b
<br/>
<br/>
but
<br/>
<br/>
000...01010b 
<br/>
000...00001b
<br/>
--------------- &amp;
<br/>
00000000000b
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
AND's in ASM are done with, well, the instruction AND :P
<br/>
<br/>
AND R0, R0, #1
<br/>
<br/>
The first R0 is the destination, the second one and the #1 are the operands. That instruction would read R0 = R0 AND 1
<br/>
Note the # on #1. It's put there because that #1 is called an "immediate expression", which is data included in the instruction itself. You have to prefix it with a #
<br/>
<br/>
Then, after that instruction, you'll get in R0: 1 if not pressed, 0 if pressed. 
<br/>
<br/>
Then:
<br/>
<br/>
CMP R0, #0  //Compare
<br/>
BEQ doSomething  //Branch if EQual
<br/>
<br/>
or
<br/>
<br/>
CMP R0, #0
<br/>
BNE skipSomething //Branch if Not Equal
<br/>
blah blah blah... //Code that will be run if R0 = 0
<br/>
skipSomething:
<br/>
<br/>
<br/>
<br/>
Hope it helps :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175100 - nathanpc - Thu Sep 09, 2010 12:49 am</h4>
    <div class="postbody"><span class="postbody">Thanks very much for your great and well explanated answer! :)<br/>_________________<br/><span style="font-size: 9px; line-height: normal">Reading Tonc and trying to remind my very old C knowledge.
<br/>
<br/>
Just bought a GameBoy Advance SP one of those cartridges to put the ROMs for onboard debug.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175102 - headspin - Thu Sep 09, 2010 9:32 am</h4>
    <div class="postbody"><span class="postbody">Also check out the "tst" instruction for checking input bits.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177359 - dantheman - Sat May 05, 2012 8:48 am</h4>
    <div class="postbody"><span class="postbody">God I wish GBAdev had a report function...
<br/>
<br/>
There's no way this poster is anything but a copy+paste spambot.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177360 - Dwedit - Sat May 05, 2012 10:14 pm</h4>
    <div class="postbody"><span class="postbody">You PM the mods, that's your report function.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
