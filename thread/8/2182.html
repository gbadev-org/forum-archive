<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Putting things in .rodata - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>ASM > Putting things in .rodata</h2>
<div id="posts">
<div class="post">
    <h4>#11377 - DekuTree64 - Fri Oct 03, 2003 7:10 pm</h4>
    <div class="postbody"><span class="postbody">I've been having problems with this for the longest time. How do you get things into the .rodata section in ASM?
<br/>
.section rodata
<br/>
compiles and links just fine, but I checked in the map file and all my C const data is in .rodata, and rodata seems to start at address 0, instead of somewhere in ROM, and therefore doesn't work. 
<br/>
.section .rodata 
<br/>
compiles, but when linking says it overlaps .iwram at 0x8000000-something, which makes no sense, because .iwram is at 0x3000000. 
<br/>
Is there something I'm missing or what? I can put data in the text section and it works fine, but that just doesn't seem quite proper.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11389 - regularkid - Sat Oct 04, 2003 2:10 am</h4>
    <div class="postbody"><span class="postbody">hmmm. I have the latest crt0.o and lnkscript from gbadevrs and all my code by default gets put into the .rodata. However, I'm not sure about variables declared in ASM (I always create variables in C code). That is really strange about the compiler screwing up and making .rodata at address 0. Maybe try grabbing the latest crt0.o and lnkscript.<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11391 - DekuTree64 - Sat Oct 04, 2003 3:01 am</h4>
    <div class="postbody"><span class="postbody">Well, I discovered that it only says it overlaps with .iwram if you put an .align 4 after the .section .rodata, so it works now. I'm not sure if it's quite safe not to align things specifically, but it seems to be fine. The weird thing is .align alone (which I think aligns to 4 bytes) and .align 2 are fine, but .align 4 causes linker problems.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11397 - tom - Sat Oct 04, 2003 10:45 am</h4>
    <div class="postbody"><span class="postbody">be careful with .align, btw:
<br/>
<br/>
from the gas docs:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The way the required alignment is specified varies from system to system. For the a29k, hppa, m68k, m88k, w65, sparc, and Hitachi SH, and i386 using ELF format, the first expression is the alignment request in bytes. For example `.align 8' advances the location counter until it is a multiple of 8. If the location counter is already a multiple of 8, no change is needed. 
<br/>
<br/>
For other systems, including the i386 using a.out format, it is the number of low-order zero bits the location counter must have after advancement. For example `.align 3' advances the location counter until it a multiple of 8. If the location counter is already a multiple of 8, no change is needed. 
<br/>
<br/>
This inconsistency is due to the different behaviors of the various native assemblers for these systems which GAS must emulate. GAS also provides .balign and .p2align directives, described later, which have a consistent behavior across all architectures (but are specific to GAS). 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
for the arm cpu the 2nd method is used, so .align 4 aligns to a 16 byte boundary, not to a 4 byte boundary. personally i always use .balign, since from other assemblers i'm used to specify alignment in bytes and not in number of low order bits to set to zero, but this is really just personal taste.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
