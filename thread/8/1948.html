<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Storing signed 16/8bit variables - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Storing signed 16/8bit variables</h2>
<div id="posts">
<div class="post">
    <h4>#10007 - funkeejeffou - Sun Aug 24, 2003 5:38 pm</h4>
    <div class="postbody"><span class="postbody">For loading signed value, there is "ldrsh" and "ldrsb", but for storing a signed variable, must we right shift the register?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mov r0, r0 asr#16;
<br/>
strh r0, [r1]</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10011 - Lupin - Sun Aug 24, 2003 6:04 pm</h4>
    <div class="postbody"><span class="postbody">I think this is for converting 32 bit values to 16 bit, because strh won't do this for you.
<br/>
I don't know if this works, but maybe this would be better:
<br/>
<br/>
ldrh r1, [r0 ASR #16]
<br/>
<br/>
I'm 90% sure that I'm wrong though :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10012 - tom - Sun Aug 24, 2003 7:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>funkeejeffou wrote:</b></span></td> </tr> <tr> <td class="quote">but for storing a signed variable, must we right shift the register?</td> </tr></table><span class="postbody">
<br/>
<br/>
no.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10018 - funkeejeffou - Sun Aug 24, 2003 7:51 pm</h4>
    <div class="postbody"><span class="postbody">no....
<br/>
Then strh converts a 32bit negative number to a 16bit number :
<br/>
mov r0, 0xFFFFFFFF           ;r0 = -1
<br/>
strh r0, [r1]                      ;0xFFFF in [r1]
<br/>
<br/>
or should we do this :
<br/>
<br/>
mov r0, 0xFFFFFFFF           ;r0 = -1
<br/>
and r0, r0, 0xFFFF             ;mask 16 low bit
<br/>
strh r0, [r1]                      ;0xFFFF in [r1]
<br/>
<br/>
or something else I don't know.
<br/>
<br/>
Please don't post such "short" answers.
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10027 - DekuTree64 - Sun Aug 24, 2003 10:48 pm</h4>
    <div class="postbody"><span class="postbody">There's no difference between storing a signed or unsigned halfword. The only time it matters is when you're loading a 16-bit value into a 32 bit register, and it needs to be sign extended, which is why there's an instruction for it. But if your number fits into 16 bits, and it's negative, then the upper 16 will all be 1, so when you store the lower 16 bits with strh and then load it with ldrsh, it will fill the upper 16 with 1s again, so it's the same as it was.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10028 - tom - Sun Aug 24, 2003 10:50 pm</h4>
    <div class="postbody"><span class="postbody">i thought quoting the part of your message my "no" refered to was enough =)
<br/>
<br/>
if you do something like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
strh r0,[r1]
<br/>
</td> </tr></table><span class="postbody">
<br/>
the cpu will simply store the lower half (bits 0..15) of r0 at [r1], which is what you want, i suppose.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10030 - funkeejeffou - Sun Aug 24, 2003 11:33 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, that's what I wanted to know.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
