<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Symbol Variables (Stack and Register) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Symbol Variables (Stack and Register)</h2>
<div id="posts">
<div class="post">
    <h4>#16081 - DarkPhantom - Sat Feb 07, 2004 8:17 pm</h4>
    <div class="postbody"><span class="postbody">I've noticed that GCC likes to use the registers for local variables rather than just putting them all on the stack. Now that I think about this it makes perfect sense (obviously) but I didn't expect it because I've never programmed for a processor with so many general purpose registers before.
<br/>
<br/>
My question is, how do you setup variable names with GAS? In TASM on the 80x86 you can use the LOCAL keyword to setup stack variables which you reference by name and this saves the sanity of any programmer not having to remember what he put at what offset since the assembler takes care of that. I assume that there must be a way to assign symbolic names both to stack offsets as well as registers with GAS. Anybody know? Thx!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16083 - torne - Sat Feb 07, 2004 8:55 pm</h4>
    <div class="postbody"><span class="postbody">You can't assign symbolic names to stack offsets in any sensible way; it can be done with symbols, but it's not really designed for it. You can create aliases for registers, though: see the info documentation and look for the .req directive (under ARM-dependent info).
<br/>
<br/>
I've written quite huge amounts of assembly code for ARM without actually ever using local variables, though; anything that has more live temporaries than you have integer registers free on ARM is probably too complicated in the first place. The only time I really use stack offsets is to get parameters for functions that take more than 4 arguments.
<br/>
<br/>
I'm working on a high-level assembler which will allow you to use names for registers without specifying which register they are (automatically binds to any suitable register in the most efficient way possible), and can use named local variables, but it's not anywhere near suitable for release yet. <a href="http://whitefang.fitz.cam.ac.uk/proposal/" target="_blank">http://whitefang.fitz.cam.ac.uk/proposal/</a> if you're interested.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16086 - DarkPhantom - Sat Feb 07, 2004 9:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">I've written quite huge amounts of assembly code for ARM without actually ever using local variables, though; anything that has more live temporaries than you have integer registers free on ARM is probably too complicated in the first place. The only time I really use stack offsets is to get parameters for functions that take more than 4 arguments.</td> </tr></table><span class="postbody">
<br/>
<br/>
Cool. But what about recursive functions? Just push your regs to the stack before the call and then pop them?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16090 - poslundc - Sat Feb 07, 2004 9:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DarkPhantom wrote:</b></span></td> </tr> <tr> <td class="quote">Cool. But what about recursive functions? Just push your regs to the stack before the call and then pop them?</td> </tr></table><span class="postbody">
<br/>
<br/>
The only registers you may need to save before calling a function (because they may be overwritten) are r0-r3, r12, and r14 (lr).
<br/>
<br/>
Conversely, any function you write is expected to preserve the values in r4-r11, which is why if you need them in a function you should push them onto the stack at the beginning and pop them off at the end (as well as lr if you want to free it up for use).
<br/>
<br/>
The only difference with recursive functions is that since you know the function will be calling itself, you can make some of your own optimizations and plan which registers you'll preserve and clobber. Then you just push and pop them before and after the call as you describe.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16095 - torne - Sun Feb 08, 2004 3:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">The only registers you may need to save before calling a function (because they may be overwritten) are r0-r3, r12, and r14 (lr).</td> </tr></table><span class="postbody">
<br/>
Exactly; this is why I only use them for temporaries that don't live across function calls (I reorder instructions if neccecary).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
