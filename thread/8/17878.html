<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Reordering halfwords [ASM optimization] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>ASM > Reordering halfwords [ASM optimization]</h2>
<div id="posts">
<div class="post">
    <h4>#177549 - sverx - Thu Aug 16, 2012 9:29 am</h4>
    <div class="postbody"><span class="postbody">Do anyone can suggest the faster method to move halfwords to the locations I need?
<br/>
- One register contains the 'B' halfword in the higher half (lower half is zero)
<br/>
- Another register contains the 'D' halfword in the higher half (lower half is zero)
<br/>
- a third register contains the 'C' halfword in the higher half and the 'A' halfword in the lower half
<br/>
<br/>
I have to rearrange them in 2 registers so that in one register I get 'A' in the lower half and 'B' in the higher half, and in another register I get the 'C' in the lower half and 'D' in the higher half (thus I can write the 4 'ordered' halfwords to memory using a single STRD/STM)
<br/>
<br/>
Thanks :)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS (and GBA!)</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177553 - Dwedit - Thu Aug 16, 2012 4:00 pm</h4>
    <div class="postbody"><span class="postbody">So the problem is something like this:
<br/>
Given:
<br/>
r1 = BBBB0000
<br/>
r2 = DDDD0000
<br/>
r3 = CCCCAAAA
<br/>
Make:
<br/>
r1 = BBBBAAAA
<br/>
r2 = DDDDCCCC
<br/>
<br/>
use this:
<br/>
r2 = r2 | (r3 &gt;&gt; 16)
<br/>
r3 = r3 &lt;&lt; 16
<br/>
r1 = r1 | (r3 &gt;&gt; 16)<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177554 - sverx - Fri Aug 17, 2012 7:57 am</h4>
    <div class="postbody"><span class="postbody">Thanks Dwedit! Once more I realize I always fail completely at asking questions :| The matter is that I already do something similar, and I was wondering if I really needed 3 instructions. I'm not an expert in ARM asm so maybe there is some way I'm missing to calculate r1 value using a single instruction, after calculating r2 as you did. Maybe it's simply impossible... :|<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS (and GBA!)</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177555 - Miked0801 - Tue Aug 21, 2012 5:48 pm</h4>
    <div class="postbody"><span class="postbody">Nope, pretty sure this takes 3 instructions.  You are already using the barrel shifter on 2 ops so I think that's about as good as it gets.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177557 - sverx - Wed Aug 22, 2012 8:06 am</h4>
    <div class="postbody"><span class="postbody">yesterday evening I tried using a 'SMLABB' instruction, but I had no luck since it performs a signed multiplication, so I've got a sign extension on the halfword msb :|  Beside that, I'm not even sure it would have been a faster option, even if it surely was a single instruction instead of two...<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS (and GBA!)</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
