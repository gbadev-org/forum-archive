<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ARM7 core - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > ARM7 core</h2>
<div id="posts">
<div class="post">
    <h4>#85887 - sephiroth111 - Fri Jun 02, 2006 9:29 pm</h4>
    <div class="postbody"><span class="postbody">I want to make an ARM7 CPU core emulator in ARM9 assembly for the gp2x. It seems like a daunting task, and virtually impossible to one such limited knowledge as I. I know that most of the ARM7TDMI's instructions are compatable with the arm9. 
<br/>
<br/>
Since most of the people here have an idea of what this task consists of, i ask what would i need (in instruction wise), and what should i know about.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85897 - tepples - Fri Jun 02, 2006 10:57 pm</h4>
    <div class="postbody"><span class="postbody">You're trying to make a GBA emulator for a GamePark or GamePark Holdings handheld system, aren't you? Or is it on Pocket PC?
<br/>
<br/>
First you'll need to make one to throw away. Your first emulator will have an interpretive core, meaning that it will fetch, decode, and execute each instruction and will run 10 to 20 times slower than native code. Only once you fully understand the interpretive core can you develop a virtualizer, which translates ARM code that writes to GBA registers into ARM code that writes to GP32/GP2X registers or ARM code that calls DirectX while keeping inner loops (e.g. audio mixers, physics, and NPC intelligence) native.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85921 - sephiroth111 - Sat Jun 03, 2006 4:59 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">You're trying to make a GBA emulator for a GamePark or GamePark Holdings handheld system, aren't you? Or is it on Pocket PC?
<br/>
<br/>
First you'll need to make one to throw away. Your first emulator will have an interpretive core, meaning that it will fetch, decode, and execute each instruction and will run 10 to 20 times slower than native code. Only once you fully understand the interpretive core can you develop a virtualizer, which translates ARM code that writes to GBA registers into ARM code that writes to GP32/GP2X registers or ARM code that calls DirectX while keeping inner loops (e.g. audio mixers, physics, and NPC intelligence) native.</td> </tr></table><span class="postbody">
<br/>
<br/>
GP2x unit, good guess. i'm looking at the VBA sources as well as the GPadvance sources, and its way too complicated looking =). 
<br/>
<br/>
obviously rome wasn't built in a day, so i'll keep it up, but knowing absolutly nothing about the arm7/9 asm as well as even how to write an emulator in general doesn't really help (i pretty much want to take the modified GP2x VBA sources, and dump the CPU into that, instead of rewriting the entire codebase. it functions well enough that i can just remove the core chunks and recode them one at a time... i guess.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#86020 - tepples - Sat Jun 03, 2006 11:14 pm</h4>
    <div class="postbody"><span class="postbody">First make a Game Boy (classic) emulator as practice. It's a much simpler system, and most of the skills will transfer.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#86048 - gladius - Sun Jun 04, 2006 2:00 am</h4>
    <div class="postbody"><span class="postbody">There are tons of cool tricks you can do when emulating a processor on the same processor type.  If there is a MMU on the GP2X then you can have even more fun trapping memory accesses and redirecting to your I/O handlers or whatever.
<br/>
<br/>
Of course if you just jump into the code the processor will happily never come back to you.  Counting CPU cycles is also very tough using this method, but it's certainly doable, you can treat it like a dynarec where you execute a cpu chunk until a branch and then the dynarec generated code is just arm code.
<br/>
<br/>
Lots of fun possibilities :).
<br/>
<br/>
Edit: I agree with Tepples though, a simpler project to start might be more prudent.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#86066 - Dwedit - Sun Jun 04, 2006 4:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gladius wrote:</b></span></td> </tr> <tr> <td class="quote">Of course if you just jump into the code the processor will happily never come back to you.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's what Interrupts are for!<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#86112 - tepples - Sun Jun 04, 2006 3:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gladius wrote:</b></span></td> </tr> <tr> <td class="quote">Of course if you just jump into the code the processor will happily never come back to you.</td> </tr></table><span class="postbody">
<br/>
That's what Interrupts are for!</span></td> </tr></table><span class="postbody">
<br/>
Unless the emulated program overwrites the interrupt registers.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#86139 - gladius - Sun Jun 04, 2006 7:13 pm</h4>
    <div class="postbody"><span class="postbody">Dwedit, of course, interrupts will work, but at that point your cycle counting is going to be wildly inaccurate, and the GBA still relies on at least semi-accurate cycle counts.
<br/>
<br/>
Tepples, good point, if the program turned of interrupts on the CPU then you would be in some pain :).
<br/>
<br/>
IMO, a dynarec is the best tradeoff between speed and accuracy.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
