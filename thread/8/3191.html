<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>What is r7 used for? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>ASM > What is r7 used for?</h2>
<div id="posts">
<div class="post">
    <h4>#18882 - niallz - Wed Apr 07, 2004 7:15 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I'm just doing some work here, and I've noticed that GCC uses r7 (in thumb mode) when entering and exiting a function for saving the stack pointer.  Does anyone know why it does this?
<br/>
<br/>
Thanks
<br/>
<br/>
Niall</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18885 - Lupin - Wed Apr 07, 2004 7:29 pm</h4>
    <div class="postbody"><span class="postbody">because you can not access the other registers in thumb mode (only from r0-r7)<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18887 - jma - Wed Apr 07, 2004 7:47 pm</h4>
    <div class="postbody"><span class="postbody">This is done because the SP register can change (allocating local variable memory on the stack). However, parameters being passed are always going to be on the stack, minus the ones already in registers. These are accessed by the compiler using R7 -- the original position of the stack.
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18888 - poslundc - Wed Apr 07, 2004 7:52 pm</h4>
    <div class="postbody"><span class="postbody">GCC is most likely using r7 as a frame pointer. According to the ARM procedure call standards, any of r4 to r7 can be used as a frame pointer when in Thumb mode. Frame pointers aren't really a necessity, though, so I can't say for certain why it's implementing it.
<br/>
<br/>
And Lupin, you are incorrect.
<br/>
<br/>
<span style="font-weight: bold">Edit:</span> I am more-or-less saying the same thing that Jeff is... frame pointers are most useful in variadic routines, but I'm not certain why GCC would generate them for non-variadic routines.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18892 - Lupin - Wed Apr 07, 2004 8:15 pm</h4>
    <div class="postbody"><span class="postbody">Uhm, why does GCC use r13 for all other functions than thumb functions?
<br/>
<br/>
Sorry for posting wrong answer...<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18895 - poslundc - Wed Apr 07, 2004 8:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">Uhm, why does GCC use r13 for all other functions than thumb functions?</td> </tr></table><span class="postbody">
<br/>
<br/>
r13 is the stack pointer, not the frame pointer. It is used as the stack pointer in Thumb mode as well as well as ARM mode.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Sorry for posting wrong answer...</td> </tr></table><span class="postbody">
<br/>
<br/>
You can access all of the registers in Thumb mode. You just can't access all of the registers with every instruction. Please look into these things before you post your answers with such certainty.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18908 - torne - Thu Apr 08, 2004 12:42 am</h4>
    <div class="postbody"><span class="postbody">It uses R7 as the frame pointer in Thumb mode, yes. The reason it generates one for non-variadic functions is because you have not specified -fomit-frame-pointer. Debugging code without a frame pointer can be more difficult on some architectures; I've not used gdb on ARM so no idea if this is the case.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
