<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Using the soundregisters with asm - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>ASM > Using the soundregisters with asm</h2>
<div id="posts">
<div class="post">
    <h4>#130686 - deepak - Wed Jun 06, 2007 5:26 pm</h4>
    <div class="postbody"><span class="postbody">Hi, Ive been trying to get some sound of my gba, I can't get any sound(probably It's not that hard but It's also hard to figure out what's wrong when you haven't been doing this for that long) and I'm quite sure I would need more code to do it, however; This is how I thaugt it would be written:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
tone:
<br/>
   mov r0, #0x4000000
<br/>
   add r0, r0, #80
<br/>
   mov r1, #10
<br/>
   str r1, [r0]
<br/>
   b tone
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And also I think someone should ad a newbie section for these kind of questions, in the asm section I meen, I know there is one but it's hard to sort out everything regarding everything else since C++ is as popular as it is.
<br/>
//Robert[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130692 - Lick - Wed Jun 06, 2007 6:41 pm</h4>
    <div class="postbody"><span class="postbody">I don't think that register works that way. Try looking on GBATek to see how those sound registers work and perhaps look at the C equivalent of your assembly to see what procedures you're <span style="font-style: italic">missing</span>.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130703 - tepples - Wed Jun 06, 2007 9:28 pm</h4>
    <div class="postbody"><span class="postbody">If you can't understand GBATEK on the first reading, you could try also reading <a class="postlink" href="http://belogic.com/gba/" target="_blank">The Audio Advance</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130740 - deepak - Thu Jun 07, 2007 10:09 am</h4>
    <div class="postbody"><span class="postbody">Hm... I'm gona look in to it some more, I've programed some basic on the c64, however it seems that this would differ a bit. The problem I see is that it's really hard to get some examplecode width sound, built in asm, everything seems to be written in C/C++. It might seem stupid but this is how I learn. //Robert</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130741 - keldon - Thu Jun 07, 2007 10:21 am</h4>
    <div class="postbody"><span class="postbody">How much ASM and coding experience do you have?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130751 - Cearn - Thu Jun 07, 2007 1:42 pm</h4>
    <div class="postbody"><span class="postbody">How the hardware works does not depend on the language you use. For example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// soundtest in C. Warning: magic numbers to keep line-count low.
<br/>
int soundtest()
<br/>
{
<br/>
    REG_SOUNDCNT_X= 0x0080;       // Main sound turn on!
<br/>
    REG_SOUNDCNT_L= 0x11FF;     // snd1 on left/right, Vol=15
<br/>
    REG_SOUNDCNT_H= 0x0002;     // DMG ratio to 100%
<br/>
<br/>
    REG_SOUND1CNT_H= 0xF780;    // Vol=15; Tstep=7, 1/2 duty
<br/>
    REG_SOUND1CNT_X= 0x8123;    // Play sound at rate=0x123
<br/>
<br/>
    while(1);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
and
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@ soundtest in ARM asm for GNU assembler. Again, magic numbers :\
<br/>
    .text
<br/>
    .arm
<br/>
    .align  2
<br/>
    .global soundtest
<br/>
soundtest:
<br/>
    mov     r0, #0x04000000
<br/>
<br/>
    @ Main sound turn on!
<br/>
    mov     r3, #0x0080
<br/>
    strh    r3, [r0, #0x84]
<br/>
    @ snd1 on left/right, Vol=15
<br/>
    ldr     r3,=0x11FF
<br/>
    strh    r3, [r0, #0x80]
<br/>
    @ DMG ratio to 100%
<br/>
    mov     r3, #0x0002
<br/>
    strh    r3, [r0, #0x82]
<br/>
<br/>
    @ Vol=15; Tstep=7, 1/2 duty
<br/>
    ldr     r3,=0xF780
<br/>
    strh    r3, [r0, #0x62]
<br/>
    @ Play sound at rate=0x123
<br/>
    ldr     r3,=0x8123
<br/>
    strh    r3, [r0, #0x64]
<br/>
<br/>
.Lloop:
<br/>
    b       .Lloop
<br/>
</td> </tr></table><span class="postbody">are functionally equivalent. All that really matters is that certain bits are set in certain registers. The tutorial and demo code usually use C because that's easier to read than assembly. 
<br/>
<br/>
Read <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#soundcontroller" target="_blank">GBATek</a>, <a class="postlink" href="http://www.belogic.com/gba/" target="_blank">Belogic</a>, <a class="postlink" href="http://www.coranac.com/tonc/text/sndsqr.htm" target="_blank">tonc</a> and/or <a class="postlink" href="http://deku.gbadev.org/program/sound1.html" target="_blank">Deku's Modplayer tutorial</a> to learn how the the GBA sound hardware works, then use your language of choice to do it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130755 - deepak - Thu Jun 07, 2007 2:52 pm</h4>
    <div class="postbody"><span class="postbody">Ah, I see, well I kinda figured that out, that it wasn't too much of a difference I mean. 
<br/>
<br/>
Not a lot, I made something move around and sound on the nes some time ago but that was quite easy. Also I'm for the moment in to GbaGuys tutorial at patatersoft, all cred to this guy however he is, It's really good.
<br/>
<br/>
Thx for all, now I will code and not bother you for some time. Have been thinking of doing some kind of sprite library, kinda like the midi-interface but for sounds, for the gba.
<br/>
//Robert</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
