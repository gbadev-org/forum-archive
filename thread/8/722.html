<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Arrays - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Arrays</h2>
<div id="posts">
<div class="post">
    <h4>#3684 - regularkid - Wed Mar 05, 2003 3:45 am</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
<br/>
I am trying to access an array in asm code and can't seem to do it without using a multiply. There has to be a better way of doing this! So, say I want to translate this C code into ASM, I would do:
<br/>
<br/>
C Code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int x = 10;
<br/>
myArray[10] = 5;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
ASM Code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
ldr        r0, =myArray
<br/>
mov     r1, #4
<br/>
mov     r2, #10
<br/>
mul      r3, r1, r2
<br/>
add      r0, r0, r2
<br/>
ldr        r0, [r0]
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This still works, however I have a feeling that there is a much quicker way of doing this. So, I put in the -S compiler option and this is what the above C code translated into:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
mov   ip, sp
<br/>
stmfd   sp!, {fp, ip, lr, pc}
<br/>
sub   fp, ip, #4
<br/>
sub   sp, sp, #4
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I have no idea what this is trying to do! Can someone help me try to understand this code or maybe just help me find a quick way to access an element from an array? Thanks so much!<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3687 - tepples - Wed Mar 05, 2003 5:41 am</h4>
    <div class="postbody"><span class="postbody">In a 'mov' instruction, you can <span style="font-weight: bold">shift</span> the index term in the address calculation (the third operand) left by a given number of bits.  A left-shift is a fast multiply by 2^n.  For an array of 32-bit values, you'd use 'asl 2' or something like that.  For syntax details, read any ARM assembly documentation.
<br/>
<br/>
You can also access the elements of an array sequentially by adding the size of an element to your base pointer every time through the loop.  This is fast and frees up a register.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3691 - Torlus - Wed Mar 05, 2003 8:43 am</h4>
    <div class="postbody"><span class="postbody">To read the 10th element for your array :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
ldr r0, =myArray
<br/>
ldr r1, =10
<br/>
ldr r0, [r0, r1, lsl #2]
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
lsl #2 performs a 2-bit left logical shift, so multiply by 4.
<br/>
<br/>
For your question, the C and ASM code of your post does not do the same thing : C code writes value 5 at 10th poisiton, whereas the first ASM code just reads the value. And the second one seems to be "off-topic" :)
<br/>
<br/>
Maybe you should have another look at the generated code :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3693 - ampz - Wed Mar 05, 2003 11:32 am</h4>
    <div class="postbody"><span class="postbody">I'd say your compiler optimized (removed) the write to the array. Or, the write is done somewhere else.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3698 - regularkid - Wed Mar 05, 2003 3:57 pm</h4>
    <div class="postbody"><span class="postbody">Awsome! Thanks, Torlus! That worked great. Does that also work for writes? Like, can I do this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
ldr    r0, =myArray
<br/>
ldr    r1, =10
<br/>
ldr    r2, =5
<br/>
str    [r0, r1, lsl#2], r2
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Wait....I just tried that and it wouldn't compile. Any ideas?<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3703 - Torlus - Wed Mar 05, 2003 6:29 pm</h4>
    <div class="postbody"><span class="postbody">you need to use :
<br/>
<br/>
str r2, [r0, r1, lsl #2]
<br/>
<br/>
I think you should have a look a the excellent tutorials available, especially gbaguy's one.
<br/>
I also keep under my pillow the "Imperial College - University of London" tutorials, which have a good explanation of this kind of memory operations, and quick reference sheet.
<br/>
<br/>
You will find it at <a class="postlink" href="http://www.ee.ic.ac.uk/pcheung/teaching/ee2_computing/" target="_blank">http://www.ee.ic.ac.uk/pcheung/teaching/ee2_computing/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3723 - regularkid - Thu Mar 06, 2003 4:51 pm</h4>
    <div class="postbody"><span class="postbody">Great! Thanks alot! This helps me tons!<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
