<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Strange label problem with DevKitPro - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Strange label problem with DevKitPro</h2>
<div id="posts">
<div class="post">
    <h4>#106658 - HyperHacker - Sun Oct 22, 2006 8:40 am</h4>
    <div class="postbody"><span class="postbody">I'm trying to write some ASM routines for a DS app in DevKitPro, and it's treating labels strangely. For example, if I do this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SomeFunction:
<br/>
@blabla
<br/>
.label:
<br/>
@blah
<br/>
<br/>
SomeOtherFunction:
<br/>
@foo
<br/>
.label:
<br/>
@bar</td> </tr></table><span class="postbody">
<br/>
When it gets to .label in SomeOtherFunction it says .label is already defined. Most assemblers I've worked with treat labels beginning with a period as local to the function they're in; why is this not the case here?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106666 - tepples - Sun Oct 22, 2006 11:37 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b><a class="postlink" href="http://www.gnu.org/software/binutils/manual/gas-2.9.1/html_chapter/as_5.html#SEC45" target="_blank">GAS manual: Symbols</a> wrote:</b></span></td> </tr> <tr> <td class="quote">There are ten local symbol names, which are re-used throughout the program. You may refer to them using the names `0' `1' ... `9'.</td> </tr></table><span class="postbody">
<br/>
GAS was intended to postprocess the output of GCC, not to be a tool for compiling assembly language written from whole cloth. So in GAS, there are only ten local symbols, and you can refer to them by names such as 3f (look for the <span style="font-style: italic">following</span> local symbol 3) or 3b (look for the <span style="font-style: italic">preceding</span> local symbol 3).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106683 - HyperHacker - Sun Oct 22, 2006 6:41 pm</h4>
    <div class="postbody"><span class="postbody">Ah, so is there a better way to assemble my code, or should I just be prepending the function names to local label names to ensure uniqueness?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106690 - tepples - Sun Oct 22, 2006 7:03 pm</h4>
    <div class="postbody"><span class="postbody">If prepending function names works, then you could write a preprocessor that turns your preferred dialect of assembly into what GAS wants.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106707 - poslundc - Sun Oct 22, 2006 9:10 pm</h4>
    <div class="postbody"><span class="postbody">Or you could just use meaningful label names.
<br/>
<br/>
I know it's harder to give names to simple jumps than it is to name functions in a compiled language, but I've written a lot of assembly and never found a jump so inconsequential I couldn't name it.
<br/>
<br/>
If you're writing code that ever needs to be reviewed/understood/modified/upgraded, it's a pretty good idea.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106710 - tepples - Sun Oct 22, 2006 9:21 pm</h4>
    <div class="postbody"><span class="postbody">Except the OP wants to reuse the same meaningful labels (e.g. "copyLoop") within multiple functions and thus wants to have labels that are local to a function. CA65 (a 6502 assembler) supports this, but GAS appears not to without a separate preprocessor.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106720 - HyperHacker - Sun Oct 22, 2006 11:42 pm</h4>
    <div class="postbody"><span class="postbody">That's the idea. I have FastCopy and FastFill, which are similar in nature and thus use similar labels.
<br/>
<br/>
What about ldr r0, =1234? It doesn't seem to like this either.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106743 - gladius - Mon Oct 23, 2006 4:19 am</h4>
    <div class="postbody"><span class="postbody">ldr r0, =1234 should be fine, you just need a .pool declaration somewhere close by.
<br/>
<br/>
As for reusable labels, any integer can be used, not just 0-9.  But there is no way I know to have a "nice" label name, and re-use it in plain gas.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106746 - HyperHacker - Mon Oct 23, 2006 4:40 am</h4>
    <div class="postbody"><span class="postbody">Aha, I found the problem. GAS's syntax is a bit odd: you use ldr r0,=1234, not ldr r0,=<span style="font-weight: bold">#</span>1234 like you would elsewhere (and as No$GBA's disassembly uses). This assembler sure has some odd syntax. (@ for comments?)<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
