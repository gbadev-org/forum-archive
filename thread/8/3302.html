<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Plotting a Pixel - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>ASM > Plotting a Pixel</h2>
<div id="posts">
<div class="post">
    <h4>#19858 - dagamer34 - Mon Apr 26, 2004 11:26 pm</h4>
    <div class="postbody"><span class="postbody">I have decided to learn some ARM assebly so the first thing I wrote was a mode 3 pixel plotter (since it's supposed to be simple) but it doesn't seem to work exactly like it's supposed to. Somewhere my multiplication is off, and I get a pixel in the totally wrong place. Here's the code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
@Asm file
<br/>
<br/>
@ As declared in a C++ file
<br/>
@ extern "C" { void func (u32 x, u32 y, u32 color); }
<br/>
<br/>
@ Plots a pixel in mode 3
<br/>
     .global func
<br/>
     .section .iwram
<br/>
     .arm
<br/>
     .align 2
<br/>
func:
<br/>
    mov r1, r1, lsl #8     @ Multiply the Y address by 240
<br/>
    sub r1, r1, r1, lsr #8
<br/>
    mov r3, #0x6000000     @ Load the VRAM address
<br/>
    add r1, r3, r1         @ Add the VRAM address to the Y address
<br/>
    add r1, r0, r1         @ Add the X offset to the Y address
<br/>
    strh r2, [r1]          @ Store the pixel
<br/>
    bx lr
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19862 - sajiimori - Tue Apr 27, 2004 12:27 am</h4>
    <div class="postbody"><span class="postbody">The VRAM offset you computed is measured in half-words.  Before you add it to the VRAM address, shift it left a bit to get the offset in bytes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19865 - dagamer34 - Tue Apr 27, 2004 12:45 am</h4>
    <div class="postbody"><span class="postbody">No difference.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
@ Plots a pixel in mode 3
<br/>
     .global func
<br/>
     .section .iwram
<br/>
     .arm
<br/>
     .align 2
<br/>
func:
<br/>
    mov r1, r1, lsl #8     @ Multiply the Y address by 240
<br/>
    sub r1, r1, r1, lsr #8
<br/>
    mov r3, #0x6000000     @ Load the VRAM address
<br/>
    mov r12, r3, lsl #1   @ Shift left the VRAM address to get it measured in bytes
<br/>
    add r1, r12, r1         @ Add the VRAM address to the Y address
<br/>
    add r1, r0, r1         @ Add the X offset to the Y address
<br/>
    strh r2, [r1]          @ Store the pixel
<br/>
    bx lr
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19868 - Miked0801 - Tue Apr 27, 2004 1:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
func: 
<br/>
    mov r3, r1, lsl #9      @ Multiply the Y address by 512
<br/>
    sub r3, r1, r1, lsl #5  @ - 32 * Y  == 480 * y (240 * 2)
<br/>
    add r3, r3, r0, lsl #1  @ Add the X offset (*2) to the Y address 
<br/>
    add r3, r3, #0x6000000  @ Add the VRAM address 
<br/>
    strh r2, [r3]           @ Store the pixel 
<br/>
    bx lr 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Same idea, but making sure to mul both X and Y components by 2.  I believe the original problem is with your mul by 240 though I may be incorrect.  Untested as I'm at home, but I think mine will do the job quickly.  Too bad we're in half-word mode or we could get rid of 1 more instruction by using addressing to do an add or shift.  A double pixel plotter might be in order to do that and be a bit faster perhaps.
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19869 - dagamer34 - Tue Apr 27, 2004 1:45 am</h4>
    <div class="postbody"><span class="postbody">Still nothing...
<br/>
<br/>
I'm not sure what's the problem.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19873 - sajiimori - Tue Apr 27, 2004 2:42 am</h4>
    <div class="postbody"><span class="postbody">You multiplied the VRAM base address by 2, which makes no sense -- VRAM really is at 0x6000000, not 0xC000000.  I was talking about the offset.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19883 - FluBBa - Tue Apr 27, 2004 10:57 am</h4>
    <div class="postbody"><span class="postbody">I think <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=3006" target="_blank">this thread</a> has it right.<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
