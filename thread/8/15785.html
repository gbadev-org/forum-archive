<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Palette Change - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>ASM > Palette Change</h2>
<div id="posts">
<div class="post">
    <h4>#159950 - zodiacdagreat - Tue Jul 08, 2008 8:16 pm</h4>
    <div class="postbody"><span class="postbody">Hi, I'm a new learner to asm, and I did a routine, whicha actually works and changes palettes:
<br/>
<br/>
push {r0, r1, r2, lr}
<br/>
ldr r1, .PaletteDestination
<br/>
ldr r0, .PaletteSource
<br/>
mov r2, #16 	@lenght of palette change
<br/>
swi 11
<br/>
pop {r0, r1, r2, pc}
<br/>
.align 2
<br/>
.PaletteDestination:
<br/>
.word 0x202F0C8 @ Sprite Pal begins here I think
<br/>
.PaletteSource:
<br/>
.word 0x8800100
<br/>
<br/>
But, the bad point is when the screen refreshes the palette change is, useless, as the colors turn back to normal. What I need to know, is how to perform a constant palette change routine, that keeps writing changes to the palette data, until, I cancel it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159954 - Dwedit - Tue Jul 08, 2008 9:02 pm</h4>
    <div class="postbody"><span class="postbody">Is that even valid code?
<br/>
The palette is at 0x05000000.
<br/>
How do you know that your source address is 0x08800100?  Are you reserving space there?  I'd just use a label to point to the address of some data.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159965 - Miked0801 - Tue Jul 08, 2008 9:50 pm</h4>
    <div class="postbody"><span class="postbody">Why use assmebly at all?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 *palDest = (u16 *)0x202F0C8;
<br/>
u16 *palSrc = (u16 *)0x8800100;
<br/>
<br/>
for(i=0;i&lt;16;i++)
<br/>
{
<br/>
    *palDest++ = *palSrc;  
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
or even
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct
<br/>
{
<br/>
    u32 foo[8];
<br/>
} COPY_32_BYTES;
<br/>
<br/>
foo()
<br/>
{
<br/>
    COPY_32_BYTES*palDest = (COPY_32_BYTES*)0x202F0C8;
<br/>
    COPY_32_BYTES*palSrc = (COPY_32_BYTES*)0x8800100;
<br/>
<br/>
    *palDest = *palSrc;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I bet you the compiler does a much better job than you in this case.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159970 - gauauu - Tue Jul 08, 2008 10:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zodiacdagreat wrote:</b></span></td> </tr> <tr> <td class="quote">Hi, I'm a new learner to asm, and I did a routine, whicha actually works....</td> </tr></table><span class="postbody">
<br/>
<br/>
Not to disagree with you Mike (really I completely agree), but in this case, sounds like he's doing it as a learning exercise.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159999 - zodiacdagreat - Wed Jul 09, 2008 5:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">push {r0, r1, r2, lr}
<br/>
ldr r1, .PaletteDestination
<br/>
ldr r0, .PaletteSource
<br/>
mov r2, #16 @lenght of palette change
<br/>
swi 11
<br/>
pop {r0, r1, r2, pc}
<br/>
.align 2
<br/>
.PaletteDestination:
<br/>
.word 0x202F0C8 @ Sprite Pal begins here I think
<br/>
.PaletteSource:
<br/>
.word 0x8800100 </td> </tr></table><span class="postbody">
<br/>
<br/>
Well, I'm a ROM Hacker, who's learning asm ... So the destination is 0202f0c8 , the game copies palette data from 0202f0c8 to 05000000, which is how I got it to work, while the PaletteSource is where, the palette data lies in the ROM.
<br/>
<br/>
I just need to know, how to make the palette change permanent.
<br/>
<br/>
@Miked0801 - I wished the game supports C/C++(What is it??) Thanks, for your help though. But, I wish I get the solution in ASM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160000 - sgeos - Wed Jul 09, 2008 5:08 am</h4>
    <div class="postbody"><span class="postbody">Given your goals, why not write the code in C or C++, compile it and then inspect the results?  Sure, it may not be the cleanest ASM, but it will be working ASM and you can learn how to improve it from there.  You might even get somewhat good at C or C++ in the process.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160001 - zodiacdagreat - Wed Jul 09, 2008 5:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Given your goals, why not write the code in C or C++, compile it and then inspect the results? Sure, it may not be the cleanest ASM, but it will be working ASM and you can learn how to improve it from there. You might even get somewhat good at C or C++ in the process.
<br/>
<br/>
-Brendan</td> </tr></table><span class="postbody">
<br/>
<br/>
You got a point there, so what do I use to compile C or C++, and is the above code performing the permanent palette change ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160004 - eKid - Wed Jul 09, 2008 6:07 am</h4>
    <div class="postbody"><span class="postbody">Maybe you're writing to a scratch buffer that the game is refilling every frame? :\</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160005 - sgeos - Wed Jul 09, 2008 6:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zodiacdagreat wrote:</b></span></td> </tr> <tr> <td class="quote">You got a point there, so what do I use to compile C or C++,</td> </tr></table><span class="postbody">
<br/>
The <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=418" target="_blank">Beginners FAQ</a> covers the basics on getting started in homebrew.  The <a class="postlink" href="http://gbadev.org/docs.php" target="_blank">documentation section</a> of gbadev proper lists some tutorials.  Some of them will take you through setting up the environment.  To the extent you make it through a tutorial, you should have a grasp of all of the basic facilities of the GBA.  I have no idea what the best up to date tutorials are at this point.
<br/>
<br/>
Keep in mind that you can have the compiler spit out assembler code.  I could never make any sense out of GCC's ASM output, but someone else may be willing to share some insight on this.
<br/>
<br/>
If you are feeling motived to get a grasp of C, there is a tutorial listed in the FAQ.  Also, I'm sure google will be able to churn out tutorials.  Find a book on C should also be trivial, if you have any sort of a budget to work with.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zodiacdagreat wrote:</b></span></td> </tr> <tr> <td class="quote">and is the above code performing the permanent palette change ?</td> </tr></table><span class="postbody">
<br/>
Palettes are memory mapped.  As far as hardware is concerned, writing new values to palette RAM is changing the palette.  The palette will not change until the old value is overwritten.  Different games manage palettes differently.  I suspect a fair number of them refresh palettes every frame, and some of them will even modify them every scanline.  There is always more than one way to get the job done.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160007 - zodiacdagreat - Wed Jul 09, 2008 6:22 am</h4>
    <div class="postbody"><span class="postbody">So is there any ways you know of to get the job done? Sorry to sound impolite.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Maybe you're writing to a scratch buffer that the game is refilling every frame? :\</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, maybe, cause that same address, is used by all palettes to load the all. So I think a constant write to that address would do.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160009 - eKid - Wed Jul 09, 2008 6:28 am</h4>
    <div class="postbody"><span class="postbody">I think you'll have to find the function that writes data there and somehow work your routine into there.. :\</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160010 - sgeos - Wed Jul 09, 2008 6:49 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zodiacdagreat wrote:</b></span></td> </tr> <tr> <td class="quote">So is there any ways you know of to get the job done?</td> </tr></table><span class="postbody">
<br/>
Generally, if you have arcane aspirations, achieving them will probably require a non-trivial upfront time investment to pick up the skills you need.  The only way to properly get the job done is to begin at the beginning.
<br/>
<br/>
I know of plenty of ways to get things done when building a system from the ground up.  If you are dealing with a system that is already in place, you will need to figure out what it is doing and either work with it or work around it.  This will require a fair amount of time, and it will probably require a fair amount of trial and error, depending on what you are doing.  It sounds like you are aiming to do something that is a taboo topic on this forum.  If you ask questions about dealing with hardware, people will probably answer them.
<br/>
<br/>
In concrete terms:
<br/>
Work through a simple C tutorial.  You do not need to get very good at C, but you will need to be able to deal with it.  The better you are at C, the easier your journey will be.
<br/>
Work through at least one GBA tutorial.  This should answer all of your basic questions.
<br/>
Figure out what tools are available to get things done.  The tutorials should introduce you to basic tools for GBA development.  Typically people need other tools as well- level editors for people making games, etc.  I'm sure you already have some of the special tools you need.  You will certainly need documentation on the GBA no matter what you are doing, but it will not do you any good until you are familiar with the system.
<br/>
At this point, if you are not up to speed on certain things, it may make sense to ask questions.  Keep in mind though, that discussion of software reverse engineering on this forum generally stops at "how do I recreate this effect".  Loading palettes are pretty simple.  They are covered in the tutorials, but the basic patterns are either load once or update every tic.  Plenty of variations are used though, because those generic solutions are very lacking depending on your goals.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160013 - zodiacdagreat - Wed Jul 09, 2008 7:52 am</h4>
    <div class="postbody"><span class="postbody">You know, I never came to this forum to ROM Hack, and to ROM Hack, I'm no beginner I came to learn ASM - to proceed further in ROM hacking xD.
<br/>
<br/>
So, until I find anything further - reverse the game engine (Like you suggested :) ) then I'll report back.
<br/>
<br/>
Thanks guys!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160033 - Dwedit - Wed Jul 09, 2008 4:01 pm</h4>
    <div class="postbody"><span class="postbody">Also, go buy no$gba, just for the debugger.  No other GBA emulator author has bothered to make a decent debugger.
<br/>
Romhacking without breakpoints is like skydiving without a parachute.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160039 - silent_code - Wed Jul 09, 2008 5:07 pm</h4>
    <div class="postbody"><span class="postbody">The only problem with that is, that Martin, no$gba's author, is currently missing, so licenses can not be purchased at the moment. :^(<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
